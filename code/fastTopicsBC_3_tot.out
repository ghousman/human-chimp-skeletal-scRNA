
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 3"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filterC.log.indv-cell.intNo0.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-3 Poisson NMF to 101000 x 18482 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.174826008e+09 +1.32549176e+09 1.38e+04 9.6e+01 1.5e-01 0.900 0.893 0.00
   2 -1.171573215e+09 +1.31898617e+09 1.77e+04 6.8e+00 1.1e+00 0.904 0.880 0.00
   3 -1.170695162e+09 +1.31723006e+09 1.13e+03 5.2e+00 6.9e-01 0.902 0.886 0.00
   4 -1.170340946e+09 +1.31652163e+09 5.43e+02 4.2e+00 6.0e-01 0.901 0.876 0.00
   5 -1.170168718e+09 +1.31617718e+09 3.83e+02 3.0e+00 6.4e-01 0.901 0.870 0.00
   6 -1.170063203e+09 +1.31596615e+09 2.87e+02 2.2e+00 1.6e-01 0.902 0.867 0.00
   7 -1.169993003e+09 +1.31582575e+09 2.37e+02 1.7e+00 8.4e-02 0.903 0.868 0.00
   8 -1.169945214e+09 +1.31573017e+09 1.96e+02 1.3e+00 6.2e-02 0.904 0.868 0.00
   9 -1.169912626e+09 +1.31566499e+09 1.62e+02 1.1e+00 4.7e-02 0.904 0.869 0.00
  10 -1.169890243e+09 +1.31562023e+09 1.34e+02 8.6e-01 3.7e-02 0.905 0.869 0.00
  11 -1.169874962e+09 +1.31558966e+09 1.11e+02 7.0e-01 3.0e-02 0.905 0.869 0.00
  12 -1.169864610e+09 +1.31556896e+09 9.15e+01 5.8e-01 2.5e-02 0.905 0.869 0.00
  13 -1.169857589e+09 +1.31555492e+09 7.57e+01 4.8e-01 2.1e-02 0.905 0.869 0.00
  14 -1.169852773e+09 +1.31554529e+09 6.26e+01 3.9e-01 1.7e-02 0.906 0.869 0.00
  15 -1.169849475e+09 +1.31553869e+09 5.14e+01 3.3e-01 1.4e-02 0.906 0.869 0.00
  16 -1.169847234e+09 +1.31553421e+09 4.27e+01 2.7e-01 1.2e-02 0.906 0.869 0.00
  17 -1.169845706e+09 +1.31553115e+09 3.54e+01 2.2e-01 9.6e-03 0.906 0.868 0.00
  18 -1.169844664e+09 +1.31552907e+09 2.93e+01 1.8e-01 7.9e-03 0.906 0.868 0.00
  19 -1.169843960e+09 +1.31552766e+09 2.42e+01 1.5e-01 6.5e-03 0.906 0.868 0.00
  20 -1.169843484e+09 +1.31552671e+09 1.99e+01 1.2e-01 5.4e-03 0.906 0.868 0.00
  21 -1.169843163e+09 +1.31552607e+09 1.64e+01 1.0e-01 4.4e-03 0.906 0.868 0.00
  22 -1.169842946e+09 +1.31552563e+09 1.35e+01 8.5e-02 3.6e-03 0.906 0.868 0.00
  23 -1.169842799e+09 +1.31552534e+09 1.12e+01 7.0e-02 3.0e-03 0.906 0.868 0.00
  24 -1.169842700e+09 +1.31552514e+09 9.18e+00 5.8e-02 2.5e-03 0.906 0.868 0.00
  25 -1.169842633e+09 +1.31552501e+09 7.56e+00 4.7e-02 2.0e-03 0.906 0.868 0.00
  26 -1.169842588e+09 +1.31552492e+09 6.22e+00 3.9e-02 1.7e-03 0.906 0.868 0.00
  27 -1.169842558e+09 +1.31552486e+09 5.11e+00 3.2e-02 1.4e-03 0.906 0.868 0.00
  28 -1.169842537e+09 +1.31552482e+09 4.21e+00 2.6e-02 1.1e-03 0.906 0.868 0.00
  29 -1.169842523e+09 +1.31552479e+09 3.46e+00 2.2e-02 9.1e-04 0.906 0.868 0.00
  30 -1.169842514e+09 +1.31552477e+09 2.85e+00 1.8e-02 7.5e-04 0.906 0.868 0.00
  31 -1.169842507e+09 +1.31552476e+09 2.34e+00 1.5e-02 6.2e-04 0.906 0.868 0.00
  32 -1.169842503e+09 +1.31552475e+09 1.93e+00 1.2e-02 5.1e-04 0.906 0.868 0.00
  33 -1.169842500e+09 +1.31552474e+09 1.59e+00 9.9e-03 4.2e-04 0.906 0.868 0.00
  34 -1.169842498e+09 +1.31552474e+09 1.31e+00 8.2e-03 3.4e-04 0.906 0.868 0.00
  35 -1.169842496e+09 +1.31552473e+09 1.08e+00 6.7e-03 2.8e-04 0.906 0.868 0.00
  36 -1.169842495e+09 +1.31552473e+09 8.87e-01 5.5e-03 2.3e-04 0.906 0.868 0.00
  37 -1.169842495e+09 +1.31552473e+09 7.30e-01 4.6e-03 1.9e-04 0.906 0.868 0.00
  38 -1.169842494e+09 +1.31552473e+09 6.01e-01 3.7e-03 1.6e-04 0.906 0.868 0.00
  39 -1.169842494e+09 +1.31552473e+09 4.95e-01 3.1e-03 1.3e-04 0.906 0.868 0.00
  40 -1.169842494e+09 +1.31552473e+09 4.08e-01 2.5e-03 1.1e-04 0.906 0.868 0.00
  41 -1.169842494e+09 +1.31552473e+09 3.36e-01 2.1e-03 8.8e-05 0.906 0.868 0.00
  42 -1.169842494e+09 +1.31552473e+09 2.77e-01 1.7e-03 7.3e-05 0.906 0.868 0.00
  43 -1.169842494e+09 +1.31552473e+09 2.28e-01 1.4e-03 6.0e-05 0.906 0.868 0.00
  44 -1.169842494e+09 +1.31552473e+09 1.88e-01 1.2e-03 4.9e-05 0.906 0.868 0.00
  45 -1.169842493e+09 +1.31552473e+09 1.55e-01 9.6e-04 4.1e-05 0.906 0.868 0.00
  46 -1.169842493e+09 +1.31552473e+09 1.28e-01 7.9e-04 3.3e-05 0.906 0.868 0.00
  47 -1.169842493e+09 +1.31552473e+09 1.05e-01 6.5e-04 2.8e-05 0.906 0.868 0.00
  48 -1.169842493e+09 +1.31552473e+09 8.66e-02 5.4e-04 2.3e-05 0.906 0.868 0.00
  49 -1.169842493e+09 +1.31552473e+09 7.13e-02 4.4e-04 1.9e-05 0.906 0.868 0.00
  50 -1.169842493e+09 +1.31552473e+09 5.88e-02 3.6e-04 1.7e-05 0.906 0.868 0.00
  51 -1.169842493e+09 +1.31552473e+09 4.85e-02 3.0e-04 1.7e-05 0.906 0.868 0.00
  52 -1.169842493e+09 +1.31552473e+09 4.00e-02 2.5e-04 1.0e-05 0.906 0.868 0.00
  53 -1.169842493e+09 +1.31552473e+09 3.30e-02 2.0e-04 8.6e-06 0.906 0.868 0.00
  54 -1.169842493e+09 +1.31552473e+09 2.72e-02 1.7e-04 7.3e-06 0.906 0.868 0.00
  55 -1.169842493e+09 +1.31552473e+09 2.24e-02 1.4e-04 7.0e-06 0.906 0.868 0.00
  56 -1.169842493e+09 +1.31552473e+09 1.85e-02 1.1e-04 6.7e-06 0.906 0.868 0.00
  57 -1.169842493e+09 +1.31552473e+09 1.53e-02 9.4e-05 6.4e-06 0.906 0.868 0.00
  58 -1.169842493e+09 +1.31552473e+09 1.26e-02 7.8e-05 6.2e-06 0.906 0.868 0.00
  59 -1.169842493e+09 +1.31552473e+09 1.04e-02 6.4e-05 6.1e-06 0.906 0.868 0.00
  60 -1.169842493e+09 +1.31552473e+09 8.61e-03 5.3e-05 5.9e-06 0.906 0.868 0.00
  61 -1.169842493e+09 +1.31552473e+09 7.12e-03 4.4e-05 5.8e-06 0.906 0.868 0.00
  62 -1.169842493e+09 +1.31552473e+09 5.89e-03 3.6e-05 5.6e-06 0.906 0.868 0.00
  63 -1.169842493e+09 +1.31552473e+09 4.87e-03 3.0e-05 5.5e-06 0.906 0.868 0.00
  64 -1.169842493e+09 +1.31552473e+09 4.28e-03 2.5e-05 5.3e-06 0.906 0.868 0.00
  65 -1.169842493e+09 +1.31552473e+09 4.02e-03 2.0e-05 5.1e-06 0.906 0.868 0.00
  66 -1.169842493e+09 +1.31552473e+09 3.79e-03 1.7e-05 4.9e-06 0.906 0.868 0.00
  67 -1.169842493e+09 +1.31552473e+09 3.57e-03 1.4e-05 4.7e-06 0.906 0.868 0.00
  68 -1.169842493e+09 +1.31552473e+09 3.36e-03 1.1e-05 4.6e-06 0.906 0.868 0.00
  69 -1.169842493e+09 +1.31552473e+09 3.17e-03 9.5e-06 4.4e-06 0.906 0.868 0.00
  70 -1.169842493e+09 +1.31552473e+09 2.99e-03 7.9e-06 4.2e-06 0.906 0.868 0.00
  71 -1.169842493e+09 +1.31552473e+09 2.82e-03 6.5e-06 4.0e-06 0.906 0.868 0.00
  72 -1.169842493e+09 +1.31552473e+09 2.66e-03 5.4e-06 3.9e-06 0.906 0.868 0.00
  73 -1.169842493e+09 +1.31552473e+09 2.52e-03 4.5e-06 3.7e-06 0.906 0.868 0.00
  74 -1.169842493e+09 +1.31552473e+09 2.38e-03 3.7e-06 3.6e-06 0.906 0.868 0.00
  75 -1.169842493e+09 +1.31552473e+09 2.25e-03 3.1e-06 3.4e-06 0.906 0.868 0.00
  76 -1.169842493e+09 +1.31552473e+09 2.12e-03 2.6e-06 3.3e-06 0.906 0.868 0.00
  77 -1.169842493e+09 +1.31552473e+09 2.01e-03 2.1e-06 3.1e-06 0.906 0.868 0.00
  78 -1.169842493e+09 +1.31552473e+09 1.90e-03 1.8e-06 3.0e-06 0.906 0.868 0.00
  79 -1.169842493e+09 +1.31552473e+09 1.80e-03 1.5e-06 2.9e-06 0.906 0.868 0.00
  80 -1.169842493e+09 +1.31552473e+09 1.70e-03 1.2e-06 2.7e-06 0.906 0.868 0.00
  81 -1.169842493e+09 +1.31552473e+09 1.61e-03 1.0e-06 2.6e-06 0.906 0.868 0.00
  82 -1.169842493e+09 +1.31552473e+09 1.53e-03 8.5e-07 2.5e-06 0.906 0.868 0.00
  83 -1.169842493e+09 +1.31552473e+09 1.45e-03 7.1e-07 2.4e-06 0.906 0.868 0.00
  84 -1.169842493e+09 +1.31552473e+09 1.37e-03 6.0e-07 2.3e-06 0.906 0.868 0.00
  85 -1.169842493e+09 +1.31552473e+09 1.30e-03 5.2e-07 2.2e-06 0.906 0.868 0.00
  86 -1.169842493e+09 +1.31552473e+09 1.24e-03 4.6e-07 2.1e-06 0.906 0.868 0.00
  87 -1.169842493e+09 +1.31552473e+09 1.17e-03 4.0e-07 2.0e-06 0.906 0.868 0.00
  88 -1.169842493e+09 +1.31552473e+09 1.11e-03 3.6e-07 1.9e-06 0.906 0.868 0.00
  89 -1.169842493e+09 +1.31552473e+09 1.06e-03 3.2e-07 1.8e-06 0.906 0.868 0.00
  90 -1.169842493e+09 +1.31552473e+09 1.00e-03 2.8e-07 1.7e-06 0.906 0.868 0.00
  91 -1.169842493e+09 +1.31552473e+09 9.52e-04 2.5e-07 1.7e-06 0.906 0.868 0.00
  92 -1.169842493e+09 +1.31552473e+09 9.05e-04 2.4e-07 1.6e-06 0.906 0.868 0.00
  93 -1.169842493e+09 +1.31552473e+09 8.60e-04 2.3e-07 1.5e-06 0.906 0.868 0.00
  94 -1.169842493e+09 +1.31552473e+09 8.17e-04 2.2e-07 1.5e-06 0.906 0.868 0.00
  95 -1.169842493e+09 +1.31552473e+09 7.77e-04 2.1e-07 1.4e-06 0.906 0.868 0.00
  96 -1.169842493e+09 +1.31552473e+09 7.39e-04 2.0e-07 1.3e-06 0.906 0.868 0.00
  97 -1.169842493e+09 +1.31552473e+09 7.03e-04 1.9e-07 1.3e-06 0.906 0.868 0.00
  98 -1.169842493e+09 +1.31552473e+09 6.68e-04 1.8e-07 1.2e-06 0.906 0.868 0.00
  99 -1.169842493e+09 +1.31552473e+09 6.36e-04 1.8e-07 1.2e-06 0.906 0.868 0.00
 100 -1.169842493e+09 +1.31552473e+09 6.05e-04 1.7e-07 1.1e-06 0.906 0.868 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".data.filterC.log.indv-cell.intNo0.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
56350.070  7065.641 38891.353 
