
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 5"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filterC.log.indv-cell.intNo0.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-5 Poisson NMF to 101000 x 18482 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.146945764e+09 +1.26973127e+09 7.79e+03 8.1e+01 3.7e-01 0.830 0.719 0.00
   2 -1.139443403e+09 +1.25472655e+09 1.18e+04 1.7e+01 2.5e+00 0.838 0.831 0.00
   3 -1.136786915e+09 +1.24941357e+09 4.35e+03 1.7e+01 2.0e+00 0.833 0.816 0.00
   4 -1.135643754e+09 +1.24712725e+09 7.99e+02 1.7e+01 2.8e+00 0.835 0.802 0.00
   5 -1.135087573e+09 +1.24601489e+09 6.49e+02 1.5e+01 6.1e-01 0.835 0.800 0.00
   6 -1.134751831e+09 +1.24534340e+09 5.24e+02 1.1e+01 4.2e-01 0.836 0.797 0.00
   7 -1.134531229e+09 +1.24490220e+09 4.26e+02 8.8e+00 2.9e-01 0.837 0.795 0.00
   8 -1.134379535e+09 +1.24459881e+09 3.53e+02 7.0e+00 2.0e-01 0.837 0.793 0.00
   9 -1.134272033e+09 +1.24438381e+09 2.95e+02 5.8e+00 1.6e-01 0.837 0.792 0.00
  10 -1.134194216e+09 +1.24422817e+09 2.50e+02 4.8e+00 1.3e-01 0.837 0.792 0.00
  11 -1.134136888e+09 +1.24411352e+09 2.14e+02 4.1e+00 1.1e-01 0.837 0.792 0.00
  12 -1.134093814e+09 +1.24402737e+09 1.85e+02 3.4e+00 9.0e-02 0.837 0.791 0.00
  13 -1.134060844e+09 +1.24396143e+09 1.63e+02 2.9e+00 7.5e-02 0.836 0.791 0.00
  14 -1.134035075e+09 +1.24390989e+09 1.65e+02 2.5e+00 6.2e-02 0.836 0.791 0.00
  15 -1.134014508e+09 +1.24386876e+09 1.73e+02 2.1e+00 5.2e-02 0.835 0.791 0.00
  16 -1.133997769e+09 +1.24383528e+09 1.79e+02 1.8e+00 4.5e-02 0.835 0.791 0.00
  17 -1.133983910e+09 +1.24380756e+09 1.85e+02 1.6e+00 4.0e-02 0.834 0.792 0.00
  18 -1.133972264e+09 +1.24378427e+09 1.90e+02 1.4e+00 3.6e-02 0.833 0.792 0.00
  19 -1.133962342e+09 +1.24376443e+09 1.94e+02 1.2e+00 3.4e-02 0.833 0.792 0.00
  20 -1.133953767e+09 +1.24374728e+09 1.97e+02 1.0e+00 3.2e-02 0.832 0.793 0.00
  21 -1.133946273e+09 +1.24373229e+09 2.00e+02 9.2e-01 3.1e-02 0.832 0.793 0.00
  22 -1.133939657e+09 +1.24371906e+09 2.02e+02 8.5e-01 2.9e-02 0.831 0.793 0.00
  23 -1.133933773e+09 +1.24370729e+09 2.04e+02 8.0e-01 2.7e-02 0.831 0.794 0.00
  24 -1.133928513e+09 +1.24369677e+09 2.06e+02 7.5e-01 2.5e-02 0.830 0.794 0.00
  25 -1.133923769e+09 +1.24368728e+09 2.07e+02 7.0e-01 2.4e-02 0.830 0.794 0.00
  26 -1.133919492e+09 +1.24367873e+09 2.07e+02 6.5e-01 2.2e-02 0.829 0.795 0.00
  27 -1.133915609e+09 +1.24367096e+09 2.08e+02 6.1e-01 2.1e-02 0.829 0.795 0.00
  28 -1.133912060e+09 +1.24366386e+09 2.09e+02 5.8e-01 2.0e-02 0.828 0.795 0.00
  29 -1.133908804e+09 +1.24365735e+09 2.09e+02 5.6e-01 1.9e-02 0.828 0.796 0.00
  30 -1.133905804e+09 +1.24365135e+09 2.09e+02 5.4e-01 1.8e-02 0.828 0.796 0.00
  31 -1.133903030e+09 +1.24364580e+09 2.09e+02 5.2e-01 1.7e-02 0.827 0.796 0.00
  32 -1.133900456e+09 +1.24364065e+09 2.08e+02 5.0e-01 1.7e-02 0.827 0.796 0.00
  33 -1.133898060e+09 +1.24363586e+09 2.07e+02 4.8e-01 1.6e-02 0.827 0.797 0.00
  34 -1.133895823e+09 +1.24363139e+09 2.06e+02 4.7e-01 1.5e-02 0.826 0.797 0.00
  35 -1.133893729e+09 +1.24362720e+09 2.05e+02 4.5e-01 1.5e-02 0.826 0.797 0.00
  36 -1.133891764e+09 +1.24362327e+09 2.04e+02 4.4e-01 1.4e-02 0.826 0.798 0.00
  37 -1.133889916e+09 +1.24361957e+09 2.02e+02 4.2e-01 1.4e-02 0.825 0.798 0.00
  38 -1.133888174e+09 +1.24361609e+09 2.00e+02 4.1e-01 1.3e-02 0.825 0.798 0.00
  39 -1.133886529e+09 +1.24361280e+09 1.99e+02 3.9e-01 1.3e-02 0.825 0.798 0.00
  40 -1.133884973e+09 +1.24360969e+09 1.97e+02 3.8e-01 1.2e-02 0.825 0.798 0.00
  41 -1.133883498e+09 +1.24360674e+09 1.95e+02 3.7e-01 1.2e-02 0.824 0.799 0.00
  42 -1.133882101e+09 +1.24360394e+09 1.93e+02 3.5e-01 1.2e-02 0.824 0.799 0.00
  43 -1.133880773e+09 +1.24360129e+09 1.92e+02 3.4e-01 1.2e-02 0.824 0.799 0.00
  44 -1.133879509e+09 +1.24359876e+09 1.91e+02 3.3e-01 1.1e-02 0.823 0.799 0.00
  45 -1.133878304e+09 +1.24359635e+09 1.89e+02 3.2e-01 1.1e-02 0.823 0.799 0.00
  46 -1.133877153e+09 +1.24359405e+09 1.88e+02 3.1e-01 1.1e-02 0.823 0.799 0.00
  47 -1.133876052e+09 +1.24359185e+09 1.87e+02 3.0e-01 1.1e-02 0.823 0.800 0.00
  48 -1.133874998e+09 +1.24358974e+09 1.86e+02 2.9e-01 1.1e-02 0.823 0.800 0.00
  49 -1.133873987e+09 +1.24358771e+09 1.85e+02 2.8e-01 1.1e-02 0.822 0.800 0.00
  50 -1.133873015e+09 +1.24358577e+09 1.85e+02 2.7e-01 1.0e-02 0.822 0.800 0.00
  51 -1.133872081e+09 +1.24358390e+09 1.84e+02 2.6e-01 1.0e-02 0.822 0.800 0.00
  52 -1.133871185e+09 +1.24358211e+09 1.85e+02 2.5e-01 1.0e-02 0.822 0.800 0.00
  53 -1.133870323e+09 +1.24358039e+09 1.85e+02 2.4e-01 9.9e-03 0.821 0.801 0.00
  54 -1.133869493e+09 +1.24357873e+09 1.84e+02 2.3e-01 9.8e-03 0.821 0.801 0.00
  55 -1.133868693e+09 +1.24357713e+09 1.84e+02 2.3e-01 9.6e-03 0.821 0.801 0.00
  56 -1.133867921e+09 +1.24357558e+09 1.83e+02 2.2e-01 9.5e-03 0.821 0.801 0.00
  57 -1.133867173e+09 +1.24357409e+09 1.83e+02 2.1e-01 9.4e-03 0.821 0.801 0.00
  58 -1.133866449e+09 +1.24357264e+09 1.82e+02 2.0e-01 9.3e-03 0.821 0.801 0.00
  59 -1.133865747e+09 +1.24357124e+09 1.82e+02 2.0e-01 9.2e-03 0.821 0.801 0.00
  60 -1.133865066e+09 +1.24356987e+09 1.81e+02 1.9e-01 9.1e-03 0.821 0.801 0.00
  61 -1.133864403e+09 +1.24356855e+09 1.81e+02 1.9e-01 9.0e-03 0.820 0.801 0.00
  62 -1.133863759e+09 +1.24356726e+09 1.80e+02 1.8e-01 8.9e-03 0.820 0.801 0.00
  63 -1.133863131e+09 +1.24356600e+09 1.80e+02 1.8e-01 8.9e-03 0.820 0.802 0.00
  64 -1.133862519e+09 +1.24356478e+09 1.79e+02 1.8e-01 8.8e-03 0.820 0.802 0.00
  65 -1.133861922e+09 +1.24356358e+09 1.79e+02 1.8e-01 8.7e-03 0.820 0.802 0.00
  66 -1.133861338e+09 +1.24356242e+09 1.79e+02 1.8e-01 8.7e-03 0.820 0.802 0.00
  67 -1.133860767e+09 +1.24356128e+09 1.79e+02 1.8e-01 8.6e-03 0.819 0.802 0.00
  68 -1.133860208e+09 +1.24356016e+09 1.78e+02 1.8e-01 8.6e-03 0.819 0.802 0.00
  69 -1.133859661e+09 +1.24355906e+09 1.78e+02 1.7e-01 8.5e-03 0.819 0.802 0.00
  70 -1.133859124e+09 +1.24355799e+09 1.77e+02 1.7e-01 8.5e-03 0.819 0.802 0.00
  71 -1.133858597e+09 +1.24355693e+09 1.77e+02 1.7e-01 8.4e-03 0.819 0.802 0.00
  72 -1.133858078e+09 +1.24355590e+09 1.77e+02 1.7e-01 8.4e-03 0.819 0.802 0.00
  73 -1.133857569e+09 +1.24355488e+09 1.77e+02 1.7e-01 8.4e-03 0.819 0.802 0.00
  74 -1.133857066e+09 +1.24355387e+09 1.76e+02 1.7e-01 8.3e-03 0.819 0.802 0.00
  75 -1.133856571e+09 +1.24355288e+09 1.76e+02 1.7e-01 8.3e-03 0.819 0.803 0.00
  76 -1.133856082e+09 +1.24355191e+09 1.76e+02 1.7e-01 8.3e-03 0.818 0.803 0.00
  77 -1.133855599e+09 +1.24355094e+09 1.76e+02 1.7e-01 8.3e-03 0.818 0.803 0.00
  78 -1.133855121e+09 +1.24354998e+09 1.77e+02 1.7e-01 8.2e-03 0.818 0.803 0.00
  79 -1.133854647e+09 +1.24354904e+09 1.77e+02 1.7e-01 8.2e-03 0.818 0.803 0.00
  80 -1.133854178e+09 +1.24354810e+09 1.77e+02 1.7e-01 8.2e-03 0.818 0.803 0.00
  81 -1.133853712e+09 +1.24354717e+09 1.77e+02 1.7e-01 8.2e-03 0.818 0.803 0.00
  82 -1.133853250e+09 +1.24354624e+09 1.76e+02 1.7e-01 8.2e-03 0.818 0.803 0.00
  83 -1.133852791e+09 +1.24354532e+09 1.76e+02 1.7e-01 8.2e-03 0.818 0.803 0.00
  84 -1.133852334e+09 +1.24354441e+09 1.76e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  85 -1.133851880e+09 +1.24354350e+09 1.76e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  86 -1.133851427e+09 +1.24354260e+09 1.76e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  87 -1.133850977e+09 +1.24354170e+09 1.75e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  88 -1.133850528e+09 +1.24354080e+09 1.76e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  89 -1.133850081e+09 +1.24353990e+09 1.76e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  90 -1.133849634e+09 +1.24353901e+09 1.76e+02 1.7e-01 8.2e-03 0.817 0.803 0.00
  91 -1.133849188e+09 +1.24353812e+09 1.75e+02 1.7e-01 8.2e-03 0.817 0.804 0.00
  92 -1.133848742e+09 +1.24353723e+09 1.75e+02 1.7e-01 8.2e-03 0.817 0.804 0.00
  93 -1.133848296e+09 +1.24353633e+09 1.75e+02 1.7e-01 8.2e-03 0.817 0.804 0.00
  94 -1.133847850e+09 +1.24353544e+09 1.75e+02 1.7e-01 8.2e-03 0.817 0.804 0.00
  95 -1.133847403e+09 +1.24353455e+09 1.74e+02 1.7e-01 8.3e-03 0.816 0.804 0.00
  96 -1.133846955e+09 +1.24353365e+09 1.73e+02 1.7e-01 8.3e-03 0.816 0.804 0.00
  97 -1.133846508e+09 +1.24353276e+09 1.72e+02 1.7e-01 8.3e-03 0.816 0.804 0.00
  98 -1.133846060e+09 +1.24353186e+09 1.71e+02 1.7e-01 8.3e-03 0.816 0.804 0.00
  99 -1.133845611e+09 +1.24353096e+09 1.70e+02 1.6e-01 8.3e-03 0.816 0.804 0.00
 100 -1.133845162e+09 +1.24353007e+09 1.69e+02 1.6e-01 8.3e-03 0.816 0.804 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".data.filterC.log.indv-cell.intNo0.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
86731.642  8055.733 47467.728 
