
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 7"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filterC.log.indv-cell.intNo0.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-7 Poisson NMF to 101000 x 18482 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.132727703e+09 +1.24129515e+09 2.97e+04 1.3e+02 1.1e+00 0.786 0.639 0.00
   2 -1.123139297e+09 +1.22211833e+09 5.91e+03 5.3e+01 2.8e+00 0.782 0.796 0.00
   3 -1.119184636e+09 +1.21420901e+09 1.18e+04 3.8e+01 1.9e+00 0.780 0.709 0.00
   4 -1.116933524e+09 +1.20970679e+09 1.87e+04 3.0e+01 1.2e+00 0.775 0.717 0.00
   5 -1.115334138e+09 +1.20650802e+09 2.17e+04 2.0e+01 7.1e-01 0.772 0.720 0.00
   6 -1.114205329e+09 +1.20425040e+09 1.76e+04 1.4e+01 5.7e-01 0.771 0.719 0.00
   7 -1.113454018e+09 +1.20274778e+09 9.98e+03 1.2e+01 4.3e-01 0.771 0.719 0.00
   8 -1.112977737e+09 +1.20179522e+09 4.79e+03 8.3e+00 3.3e-01 0.770 0.719 0.00
   9 -1.112686471e+09 +1.20121268e+09 3.14e+03 6.4e+00 2.4e-01 0.770 0.720 0.00
  10 -1.112504588e+09 +1.20084892e+09 2.10e+03 4.8e+00 1.7e-01 0.770 0.721 0.00
  11 -1.112382801e+09 +1.20060534e+09 2.63e+03 3.7e+00 1.3e-01 0.769 0.722 0.00
  12 -1.112293180e+09 +1.20042610e+09 2.57e+03 3.0e+00 1.1e-01 0.770 0.723 0.00
  13 -1.112221362e+09 +1.20028247e+09 2.21e+03 2.6e+00 1.1e-01 0.769 0.724 0.00
  14 -1.112160148e+09 +1.20016004e+09 1.75e+03 2.4e+00 1.1e-01 0.769 0.725 0.00
  15 -1.112105483e+09 +1.20005071e+09 1.54e+03 2.4e+00 1.1e-01 0.769 0.726 0.00
  16 -1.112055586e+09 +1.19995091e+09 1.51e+03 2.7e+00 1.1e-01 0.768 0.726 0.00
  17 -1.112009580e+09 +1.19985890e+09 1.58e+03 3.0e+00 1.1e-01 0.768 0.728 0.00
  18 -1.111965542e+09 +1.19977083e+09 1.65e+03 3.2e+00 1.2e-01 0.767 0.729 0.00
  19 -1.111922034e+09 +1.19968381e+09 1.66e+03 3.4e+00 1.2e-01 0.767 0.730 0.00
  20 -1.111877875e+09 +1.19959549e+09 1.58e+03 3.4e+00 1.2e-01 0.766 0.731 0.00
  21 -1.111832256e+09 +1.19950425e+09 1.36e+03 3.3e+00 1.2e-01 0.766 0.732 0.00
  22 -1.111784576e+09 +1.19940889e+09 1.34e+03 3.2e+00 1.2e-01 0.765 0.733 0.00
  23 -1.111734493e+09 +1.19930873e+09 1.61e+03 3.7e+00 1.1e-01 0.764 0.735 0.00
  24 -1.111682217e+09 +1.19920417e+09 1.89e+03 4.2e+00 1.1e-01 0.763 0.737 0.00
  25 -1.111628545e+09 +1.19909683e+09 2.16e+03 4.6e+00 1.0e-01 0.762 0.739 0.00
  26 -1.111574718e+09 +1.19898918e+09 2.40e+03 4.9e+00 1.0e-01 0.762 0.740 0.00
  27 -1.111521716e+09 +1.19888317e+09 2.63e+03 5.1e+00 9.5e-02 0.761 0.743 0.00
  28 -1.111470474e+09 +1.19878069e+09 2.84e+03 5.1e+00 9.0e-02 0.760 0.745 0.00
  29 -1.111421519e+09 +1.19868278e+09 3.04e+03 5.0e+00 8.5e-02 0.760 0.747 0.00
  30 -1.111375196e+09 +1.19859013e+09 3.25e+03 4.9e+00 8.0e-02 0.759 0.749 0.00
  31 -1.111331634e+09 +1.19850301e+09 3.47e+03 4.7e+00 7.5e-02 0.759 0.750 0.00
  32 -1.111290853e+09 +1.19842145e+09 3.70e+03 4.4e+00 7.1e-02 0.758 0.752 0.00
  33 -1.111252815e+09 +1.19834537e+09 3.95e+03 4.2e+00 6.7e-02 0.758 0.753 0.00
  34 -1.111217239e+09 +1.19827422e+09 4.23e+03 4.0e+00 6.4e-02 0.758 0.754 0.00
  35 -1.111184149e+09 +1.19820804e+09 4.51e+03 3.7e+00 6.1e-02 0.758 0.755 0.00
  36 -1.111153286e+09 +1.19814631e+09 4.81e+03 3.5e+00 5.7e-02 0.758 0.755 0.00
  37 -1.111124514e+09 +1.19808877e+09 5.12e+03 3.3e+00 5.4e-02 0.757 0.756 0.00
  38 -1.111097739e+09 +1.19803522e+09 5.43e+03 3.1e+00 5.1e-02 0.758 0.757 0.00
  39 -1.111072768e+09 +1.19798528e+09 5.77e+03 2.9e+00 4.7e-02 0.757 0.757 0.00
  40 -1.111049461e+09 +1.19793866e+09 6.10e+03 2.8e+00 4.4e-02 0.757 0.758 0.00
  41 -1.111027717e+09 +1.19789517e+09 6.39e+03 2.6e+00 4.1e-02 0.757 0.758 0.00
  42 -1.111007482e+09 +1.19785471e+09 6.63e+03 2.5e+00 3.9e-02 0.758 0.758 0.00
  43 -1.110988700e+09 +1.19781714e+09 6.78e+03 2.3e+00 3.7e-02 0.757 0.759 0.00
  44 -1.110971377e+09 +1.19778249e+09 6.75e+03 2.2e+00 3.6e-02 0.757 0.759 0.00
  45 -1.110955582e+09 +1.19775091e+09 6.40e+03 2.1e+00 3.5e-02 0.757 0.759 0.00
  46 -1.110941524e+09 +1.19772279e+09 5.50e+03 1.9e+00 3.3e-02 0.757 0.759 0.00
  47 -1.110928747e+09 +1.19769724e+09 4.98e+03 1.7e+00 3.1e-02 0.757 0.760 0.00
  48 -1.110917682e+09 +1.19767510e+09 4.60e+03 1.5e+00 2.8e-02 0.758 0.760 0.00
  49 -1.110908041e+09 +1.19765582e+09 4.13e+03 1.4e+00 2.6e-02 0.758 0.760 0.00
  50 -1.110899655e+09 +1.19763905e+09 3.58e+03 1.6e+00 2.5e-02 0.758 0.760 0.00
  51 -1.110892327e+09 +1.19762439e+09 3.03e+03 2.2e+00 2.4e-02 0.758 0.760 0.00
  52 -1.110885933e+09 +1.19761161e+09 2.50e+03 2.4e+00 2.3e-02 0.758 0.760 0.00
  53 -1.110880270e+09 +1.19760028e+09 2.05e+03 2.2e+00 2.2e-02 0.758 0.760 0.00
  54 -1.110875184e+09 +1.19759011e+09 1.76e+03 2.1e+00 2.1e-02 0.759 0.760 0.00
  55 -1.110870577e+09 +1.19758089e+09 1.55e+03 2.0e+00 2.1e-02 0.759 0.760 0.00
  56 -1.110866365e+09 +1.19757247e+09 1.42e+03 1.9e+00 2.1e-02 0.759 0.760 0.00
  57 -1.110862489e+09 +1.19756472e+09 1.34e+03 1.8e+00 2.0e-02 0.759 0.759 0.00
  58 -1.110858902e+09 +1.19755754e+09 1.28e+03 1.7e+00 2.0e-02 0.759 0.759 0.00
  59 -1.110855563e+09 +1.19755087e+09 1.24e+03 1.6e+00 1.9e-02 0.760 0.759 0.00
  60 -1.110852443e+09 +1.19754463e+09 1.20e+03 1.5e+00 1.9e-02 0.760 0.759 0.00
  61 -1.110849515e+09 +1.19753877e+09 1.18e+03 1.5e+00 1.9e-02 0.760 0.759 0.00
  62 -1.110846760e+09 +1.19753326e+09 1.16e+03 1.4e+00 1.8e-02 0.760 0.759 0.00
  63 -1.110844163e+09 +1.19752807e+09 1.13e+03 1.4e+00 1.8e-02 0.760 0.758 0.00
  64 -1.110841709e+09 +1.19752316e+09 1.11e+03 1.3e+00 1.8e-02 0.760 0.758 0.00
  65 -1.110839384e+09 +1.19751851e+09 1.08e+03 1.3e+00 1.7e-02 0.760 0.758 0.00
  66 -1.110837173e+09 +1.19751409e+09 1.05e+03 1.3e+00 1.7e-02 0.761 0.758 0.00
  67 -1.110835061e+09 +1.19750986e+09 1.02e+03 1.2e+00 1.6e-02 0.761 0.758 0.00
  68 -1.110833038e+09 +1.19750582e+09 9.91e+02 1.2e+00 1.6e-02 0.761 0.758 0.00
  69 -1.110831094e+09 +1.19750193e+09 9.58e+02 1.2e+00 1.5e-02 0.761 0.758 0.00
  70 -1.110829223e+09 +1.19749819e+09 9.24e+02 1.2e+00 1.5e-02 0.761 0.758 0.00
  71 -1.110827416e+09 +1.19749457e+09 9.04e+02 1.1e+00 1.5e-02 0.761 0.758 0.00
  72 -1.110825669e+09 +1.19749108e+09 8.88e+02 1.1e+00 1.5e-02 0.761 0.758 0.00
  73 -1.110823976e+09 +1.19748769e+09 8.73e+02 1.1e+00 1.5e-02 0.761 0.758 0.00
  74 -1.110822335e+09 +1.19748441e+09 8.57e+02 1.1e+00 1.5e-02 0.762 0.757 0.00
  75 -1.110820741e+09 +1.19748122e+09 8.41e+02 1.1e+00 1.4e-02 0.762 0.757 0.00
  76 -1.110819189e+09 +1.19747812e+09 8.26e+02 1.1e+00 1.4e-02 0.762 0.757 0.00
  77 -1.110817682e+09 +1.19747510e+09 8.10e+02 1.0e+00 1.4e-02 0.762 0.757 0.00
  78 -1.110816222e+09 +1.19747219e+09 7.56e+02 1.0e+00 1.4e-02 0.762 0.757 0.00
  79 -1.110814806e+09 +1.19746935e+09 7.08e+02 1.0e+00 1.4e-02 0.762 0.757 0.00
  80 -1.110813430e+09 +1.19746660e+09 6.72e+02 1.0e+00 1.3e-02 0.762 0.757 0.00
  81 -1.110812092e+09 +1.19746393e+09 6.45e+02 1.0e+00 1.3e-02 0.763 0.757 0.00
  82 -1.110810791e+09 +1.19746132e+09 6.23e+02 1.0e+00 1.3e-02 0.763 0.757 0.00
  83 -1.110809524e+09 +1.19745879e+09 6.05e+02 9.9e-01 1.3e-02 0.763 0.757 0.00
  84 -1.110808290e+09 +1.19745632e+09 5.92e+02 9.8e-01 1.2e-02 0.763 0.757 0.00
  85 -1.110807086e+09 +1.19745391e+09 5.84e+02 9.7e-01 1.2e-02 0.763 0.757 0.00
  86 -1.110805914e+09 +1.19745157e+09 5.76e+02 9.6e-01 1.2e-02 0.763 0.757 0.00
  87 -1.110804772e+09 +1.19744929e+09 5.69e+02 9.5e-01 1.2e-02 0.763 0.757 0.00
  88 -1.110803660e+09 +1.19744706e+09 5.62e+02 9.4e-01 1.2e-02 0.763 0.757 0.00
  89 -1.110802578e+09 +1.19744490e+09 5.54e+02 9.2e-01 1.1e-02 0.763 0.757 0.00
  90 -1.110801524e+09 +1.19744279e+09 5.46e+02 9.1e-01 1.1e-02 0.763 0.757 0.00
  91 -1.110800497e+09 +1.19744074e+09 5.38e+02 9.0e-01 1.1e-02 0.764 0.757 0.00
  92 -1.110799498e+09 +1.19743874e+09 5.28e+02 8.9e-01 1.1e-02 0.764 0.757 0.00
  93 -1.110798528e+09 +1.19743680e+09 5.19e+02 8.8e-01 1.1e-02 0.764 0.757 0.00
  94 -1.110797586e+09 +1.19743491e+09 5.10e+02 8.7e-01 1.1e-02 0.764 0.757 0.00
  95 -1.110796673e+09 +1.19743309e+09 4.99e+02 8.5e-01 1.0e-02 0.764 0.757 0.00
  96 -1.110795790e+09 +1.19743132e+09 4.88e+02 8.4e-01 1.0e-02 0.764 0.757 0.00
  97 -1.110794936e+09 +1.19742961e+09 4.78e+02 8.2e-01 9.9e-03 0.764 0.757 0.00
  98 -1.110794113e+09 +1.19742797e+09 4.67e+02 8.1e-01 9.7e-03 0.764 0.756 0.00
  99 -1.110793321e+09 +1.19742638e+09 4.56e+02 7.9e-01 9.5e-03 0.764 0.757 0.00
 100 -1.110792558e+09 +1.19742486e+09 4.45e+02 7.8e-01 9.3e-03 0.764 0.756 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".data.filterC.log.indv-cell.intNo0.reg-",data.source,".bc1.rds"))
> 
> proc.time()
      user     system    elapsed 
106341.259   8580.207  52544.636 
