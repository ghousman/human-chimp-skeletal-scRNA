
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 4"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filterC.log.indv-cell.intNo0.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-4 Poisson NMF to 101000 x 18482 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.157425929e+09 +1.29069160e+09 8.66e+03 7.5e+01 9.8e-01 0.870 0.777 0.00
   2 -1.153294415e+09 +1.28242857e+09 2.42e+03 1.3e+01 2.1e+00 0.882 0.837 0.00
   3 -1.151969397e+09 +1.27977854e+09 1.33e+03 1.1e+01 2.0e+00 0.874 0.820 0.00
   4 -1.151504694e+09 +1.27884913e+09 6.91e+02 1.3e+01 2.1e+00 0.871 0.810 0.00
   5 -1.151338228e+09 +1.27851620e+09 3.00e+02 1.0e+01 6.5e-01 0.868 0.808 0.00
   6 -1.151251822e+09 +1.27834338e+09 2.65e+02 7.5e+00 2.9e-01 0.866 0.806 0.00
   7 -1.151195822e+09 +1.27823138e+09 2.47e+02 5.7e+00 1.9e-01 0.865 0.805 0.00
   8 -1.151155598e+09 +1.27815094e+09 2.91e+02 4.4e+00 1.4e-01 0.864 0.804 0.00
   9 -1.151124687e+09 +1.27808911e+09 3.56e+02 3.6e+00 1.1e-01 0.863 0.804 0.00
  10 -1.151099707e+09 +1.27803916e+09 4.05e+02 2.9e+00 8.5e-02 0.863 0.804 0.00
  11 -1.151078764e+09 +1.27799727e+09 4.45e+02 2.5e+00 7.0e-02 0.862 0.804 0.00
  12 -1.151060672e+09 +1.27796108e+09 4.80e+02 2.1e+00 6.0e-02 0.861 0.804 0.00
  13 -1.151044663e+09 +1.27792907e+09 5.09e+02 1.9e+00 5.3e-02 0.861 0.805 0.00
  14 -1.151030258e+09 +1.27790026e+09 5.35e+02 1.7e+00 4.8e-02 0.860 0.805 0.00
  15 -1.151017109e+09 +1.27787396e+09 5.56e+02 1.5e+00 4.5e-02 0.860 0.805 0.00
  16 -1.151004964e+09 +1.27784967e+09 5.76e+02 1.4e+00 4.3e-02 0.859 0.805 0.00
  17 -1.150993634e+09 +1.27782701e+09 5.95e+02 1.3e+00 4.1e-02 0.859 0.805 0.00
  18 -1.150982980e+09 +1.27780570e+09 6.13e+02 1.2e+00 3.9e-02 0.858 0.806 0.00
  19 -1.150972918e+09 +1.27778558e+09 6.28e+02 1.1e+00 3.7e-02 0.858 0.806 0.00
  20 -1.150963380e+09 +1.27776650e+09 6.38e+02 1.1e+00 3.6e-02 0.858 0.806 0.00
  21 -1.150954293e+09 +1.27774833e+09 6.49e+02 1.0e+00 3.6e-02 0.857 0.806 0.00
  22 -1.150945613e+09 +1.27773097e+09 6.60e+02 9.8e-01 3.5e-02 0.857 0.806 0.00
  23 -1.150937315e+09 +1.27771437e+09 6.66e+02 9.4e-01 3.5e-02 0.856 0.807 0.00
  24 -1.150929357e+09 +1.27769846e+09 6.73e+02 9.1e-01 3.4e-02 0.856 0.807 0.00
  25 -1.150921705e+09 +1.27768315e+09 6.78e+02 8.8e-01 3.4e-02 0.856 0.807 0.00
  26 -1.150914325e+09 +1.27766839e+09 6.83e+02 8.5e-01 3.3e-02 0.855 0.807 0.00
  27 -1.150907177e+09 +1.27765410e+09 6.83e+02 8.3e-01 3.3e-02 0.855 0.807 0.00
  28 -1.150900225e+09 +1.27764019e+09 6.83e+02 8.0e-01 3.2e-02 0.855 0.807 0.00
  29 -1.150893449e+09 +1.27762664e+09 6.82e+02 7.8e-01 3.2e-02 0.854 0.807 0.00
  30 -1.150886835e+09 +1.27761341e+09 6.75e+02 7.7e-01 3.2e-02 0.854 0.807 0.00
  31 -1.150880374e+09 +1.27760049e+09 6.63e+02 7.6e-01 3.1e-02 0.853 0.807 0.00
  32 -1.150874058e+09 +1.27758786e+09 6.48e+02 7.4e-01 3.1e-02 0.853 0.807 0.00
  33 -1.150867880e+09 +1.27757550e+09 6.28e+02 7.3e-01 3.1e-02 0.853 0.808 0.00
  34 -1.150861833e+09 +1.27756341e+09 6.04e+02 7.2e-01 3.1e-02 0.853 0.808 0.00
  35 -1.150855914e+09 +1.27755157e+09 5.71e+02 7.1e-01 3.0e-02 0.852 0.808 0.00
  36 -1.150850118e+09 +1.27753998e+09 5.38e+02 7.0e-01 3.0e-02 0.852 0.808 0.00
  37 -1.150844445e+09 +1.27752863e+09 4.93e+02 6.9e-01 3.0e-02 0.852 0.808 0.00
  38 -1.150838897e+09 +1.27751754e+09 4.37e+02 6.8e-01 2.9e-02 0.852 0.808 0.00
  39 -1.150833473e+09 +1.27750669e+09 2.51e+02 6.8e-01 2.9e-02 0.851 0.808 0.00
  40 -1.150828235e+09 +1.27749621e+09 2.48e+02 6.7e-01 2.9e-02 0.851 0.808 0.00
  41 -1.150823195e+09 +1.27748613e+09 2.37e+02 6.4e-01 2.8e-02 0.851 0.808 0.00
  42 -1.150818319e+09 +1.27747638e+09 2.29e+02 6.2e-01 2.8e-02 0.851 0.808 0.00
  43 -1.150813593e+09 +1.27746693e+09 2.23e+02 6.1e-01 2.7e-02 0.851 0.808 0.00
  44 -1.150809007e+09 +1.27745776e+09 2.20e+02 5.9e-01 2.7e-02 0.850 0.808 0.00
  45 -1.150804551e+09 +1.27744884e+09 2.17e+02 5.8e-01 2.6e-02 0.850 0.808 0.00
  46 -1.150800217e+09 +1.27744018e+09 2.15e+02 5.8e-01 2.6e-02 0.850 0.808 0.00
  47 -1.150796000e+09 +1.27743174e+09 2.13e+02 5.7e-01 2.5e-02 0.850 0.808 0.00
  48 -1.150791894e+09 +1.27742353e+09 2.13e+02 5.6e-01 2.5e-02 0.850 0.808 0.00
  49 -1.150787888e+09 +1.27741552e+09 2.13e+02 5.5e-01 2.5e-02 0.849 0.808 0.00
  50 -1.150783977e+09 +1.27740770e+09 2.13e+02 5.5e-01 2.4e-02 0.849 0.808 0.00
  51 -1.150780155e+09 +1.27740005e+09 2.13e+02 5.4e-01 2.4e-02 0.849 0.808 0.00
  52 -1.150776414e+09 +1.27739257e+09 2.12e+02 5.4e-01 2.4e-02 0.849 0.808 0.00
  53 -1.150772752e+09 +1.27738525e+09 2.12e+02 5.3e-01 2.3e-02 0.849 0.808 0.00
  54 -1.150769163e+09 +1.27737807e+09 2.12e+02 5.3e-01 2.3e-02 0.849 0.808 0.00
  55 -1.150765642e+09 +1.27737103e+09 2.13e+02 5.2e-01 2.3e-02 0.849 0.808 0.00
  56 -1.150762184e+09 +1.27736411e+09 2.13e+02 5.2e-01 2.3e-02 0.848 0.808 0.00
  57 -1.150758788e+09 +1.27735732e+09 2.13e+02 5.2e-01 2.2e-02 0.848 0.808 0.00
  58 -1.150755449e+09 +1.27735064e+09 2.14e+02 5.2e-01 2.2e-02 0.848 0.808 0.00
  59 -1.150752166e+09 +1.27734407e+09 2.15e+02 5.1e-01 2.2e-02 0.848 0.808 0.00
  60 -1.150748939e+09 +1.27733762e+09 2.16e+02 5.1e-01 2.2e-02 0.848 0.808 0.00
  61 -1.150745762e+09 +1.27733127e+09 2.17e+02 5.1e-01 2.2e-02 0.847 0.808 0.00
  62 -1.150742629e+09 +1.27732500e+09 2.18e+02 5.1e-01 2.1e-02 0.847 0.808 0.00
  63 -1.150739535e+09 +1.27731881e+09 2.20e+02 5.1e-01 2.1e-02 0.847 0.808 0.00
  64 -1.150736469e+09 +1.27731268e+09 2.23e+02 5.1e-01 2.1e-02 0.847 0.808 0.00
  65 -1.150733415e+09 +1.27730657e+09 2.26e+02 5.1e-01 2.1e-02 0.847 0.808 0.00
  66 -1.150730356e+09 +1.27730045e+09 2.31e+02 5.1e-01 2.1e-02 0.847 0.807 0.00
  67 -1.150727264e+09 +1.27729427e+09 2.40e+02 5.2e-01 2.1e-02 0.847 0.807 0.00
  68 -1.150724095e+09 +1.27728793e+09 2.52e+02 5.3e-01 2.1e-02 0.847 0.807 0.00
  69 -1.150720775e+09 +1.27728129e+09 2.67e+02 5.5e-01 2.8e-02 0.846 0.807 0.00
  70 -1.150717190e+09 +1.27727412e+09 3.50e+02 5.7e-01 3.7e-02 0.846 0.807 0.00
  71 -1.150713109e+09 +1.27726596e+09 7.08e+02 7.7e-01 5.1e-02 0.846 0.807 0.00
  72 -1.150708125e+09 +1.27725599e+09 1.41e+03 1.1e+00 7.1e-02 0.846 0.807 0.00
  73 -1.150701549e+09 +1.27724284e+09 2.73e+03 1.5e+00 1.0e-01 0.846 0.807 0.00
  74 -1.150692391e+09 +1.27722452e+09 4.92e+03 2.0e+00 1.4e-01 0.846 0.807 0.00
  75 -1.150679696e+09 +1.27719913e+09 7.86e+03 2.4e+00 1.6e-01 0.845 0.807 0.00
  76 -1.150663541e+09 +1.27716682e+09 9.91e+03 2.6e+00 2.1e-01 0.845 0.807 0.00
  77 -1.150646710e+09 +1.27713316e+09 2.63e+03 2.0e+00 2.5e-01 0.845 0.807 0.00
  78 -1.150633724e+09 +1.27710719e+09 1.01e+03 1.3e+00 1.8e-01 0.844 0.807 0.00
  79 -1.150622921e+09 +1.27708558e+09 9.30e+02 1.2e+00 4.4e-02 0.844 0.806 0.00
  80 -1.150612863e+09 +1.27706547e+09 8.61e+02 1.2e+00 4.3e-02 0.844 0.806 0.00
  81 -1.150603392e+09 +1.27704653e+09 8.16e+02 1.1e+00 4.1e-02 0.843 0.806 0.00
  82 -1.150594432e+09 +1.27702861e+09 7.87e+02 1.1e+00 4.0e-02 0.843 0.806 0.00
  83 -1.150585954e+09 +1.27701165e+09 7.71e+02 1.1e+00 3.9e-02 0.843 0.807 0.00
  84 -1.150577938e+09 +1.27699562e+09 7.62e+02 1.0e+00 3.7e-02 0.843 0.807 0.00
  85 -1.150570368e+09 +1.27698048e+09 7.62e+02 1.0e+00 3.6e-02 0.843 0.807 0.00
  86 -1.150563241e+09 +1.27696622e+09 7.67e+02 1.0e+00 3.5e-02 0.842 0.807 0.00
  87 -1.150556531e+09 +1.27695280e+09 7.77e+02 1.0e+00 3.4e-02 0.842 0.807 0.00
  88 -1.150550194e+09 +1.27694013e+09 7.85e+02 9.9e-01 3.3e-02 0.842 0.806 0.00
  89 -1.150544192e+09 +1.27692813e+09 7.92e+02 9.8e-01 3.2e-02 0.842 0.806 0.00
  90 -1.150538496e+09 +1.27691673e+09 7.95e+02 9.7e-01 3.1e-02 0.842 0.806 0.00
  91 -1.150533082e+09 +1.27690591e+09 7.96e+02 9.6e-01 3.0e-02 0.842 0.806 0.00
  92 -1.150527929e+09 +1.27689560e+09 7.95e+02 9.5e-01 3.0e-02 0.842 0.806 0.00
  93 -1.150523015e+09 +1.27688577e+09 7.96e+02 9.3e-01 2.9e-02 0.842 0.806 0.00
  94 -1.150518324e+09 +1.27687639e+09 7.94e+02 9.2e-01 2.8e-02 0.842 0.806 0.00
  95 -1.150513844e+09 +1.27686743e+09 7.91e+02 9.1e-01 2.8e-02 0.842 0.806 0.00
  96 -1.150509563e+09 +1.27685887e+09 7.88e+02 9.0e-01 2.7e-02 0.842 0.806 0.00
  97 -1.150505468e+09 +1.27685068e+09 7.84e+02 8.8e-01 2.7e-02 0.842 0.806 0.00
  98 -1.150501552e+09 +1.27684284e+09 7.78e+02 8.7e-01 2.6e-02 0.842 0.805 0.00
  99 -1.150497804e+09 +1.27683535e+09 7.72e+02 8.5e-01 2.6e-02 0.842 0.805 0.00
 100 -1.150494216e+09 +1.27682817e+09 7.64e+02 8.4e-01 2.5e-02 0.842 0.805 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".data.filterC.log.indv-cell.intNo0.reg-",data.source,".bc1.rds"))
> 
> proc.time()
    user   system  elapsed 
70573.89  7774.48 43601.97 
