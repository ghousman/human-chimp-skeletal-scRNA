
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 5"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-5 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.100998546e+09 +1.21736036e+09 5.60e+03 9.1e+01 7.3e-01 0.836 0.722 0.00
   2 -1.094433557e+09 +1.20423038e+09 1.76e+04 1.4e+01 1.9e+00 0.839 0.817 0.00
   3 -1.091625020e+09 +1.19861331e+09 3.07e+03 1.1e+01 1.6e+00 0.833 0.793 0.00
   4 -1.090307114e+09 +1.19597750e+09 1.58e+03 1.2e+01 1.0e+00 0.830 0.792 0.00
   5 -1.089603410e+09 +1.19457009e+09 1.55e+03 1.0e+01 6.6e-01 0.826 0.795 0.00
   6 -1.089197430e+09 +1.19375813e+09 1.32e+03 8.4e+00 4.3e-01 0.825 0.796 0.00
   7 -1.088947544e+09 +1.19325836e+09 1.38e+03 7.1e+00 2.9e-01 0.822 0.796 0.00
   8 -1.088784699e+09 +1.19293267e+09 1.58e+03 6.2e+00 2.0e-01 0.821 0.797 0.00
   9 -1.088674052e+09 +1.19271137e+09 1.72e+03 5.6e+00 1.6e-01 0.820 0.797 0.00
  10 -1.088596275e+09 +1.19255582e+09 1.82e+03 4.9e+00 1.2e-01 0.819 0.797 0.00
  11 -1.088539463e+09 +1.19244219e+09 1.87e+03 4.2e+00 1.1e-01 0.817 0.796 0.00
  12 -1.088496136e+09 +1.19235554e+09 1.91e+03 3.6e+00 9.9e-02 0.816 0.796 0.00
  13 -1.088461279e+09 +1.19228583e+09 1.95e+03 3.1e+00 9.0e-02 0.815 0.796 0.00
  14 -1.088431806e+09 +1.19222688e+09 2.00e+03 2.7e+00 8.3e-02 0.814 0.796 0.00
  15 -1.088405742e+09 +1.19217475e+09 2.07e+03 2.3e+00 7.6e-02 0.813 0.796 0.00
  16 -1.088381604e+09 +1.19212648e+09 2.16e+03 2.0e+00 7.3e-02 0.812 0.796 0.00
  17 -1.088357725e+09 +1.19207872e+09 2.28e+03 1.7e+00 7.2e-02 0.811 0.796 0.00
  18 -1.088332030e+09 +1.19202733e+09 2.45e+03 1.9e+00 7.6e-02 0.810 0.797 0.00
  19 -1.088301563e+09 +1.19196639e+09 6.55e+03 3.0e+00 1.3e-01 0.808 0.797 0.00
  20 -1.088262742e+09 +1.19188875e+09 1.40e+04 4.0e+00 1.8e-01 0.807 0.797 0.00
  21 -1.088214675e+09 +1.19179262e+09 1.80e+04 4.6e+00 2.3e-01 0.806 0.798 0.00
  22 -1.088176840e+09 +1.19171695e+09 3.77e+03 2.1e+00 3.3e-01 0.804 0.798 0.00
  23 -1.088133237e+09 +1.19162974e+09 3.67e+03 2.0e+00 1.2e-01 0.803 0.800 0.00
  24 -1.088099016e+09 +1.19156130e+09 3.29e+03 1.8e+00 8.6e-02 0.801 0.801 0.00
  25 -1.088067668e+09 +1.19149860e+09 2.81e+03 1.6e+00 8.1e-02 0.800 0.801 0.00
  26 -1.088038728e+09 +1.19144072e+09 2.26e+03 1.4e+00 7.7e-02 0.799 0.802 0.00
  27 -1.088012097e+09 +1.19138746e+09 1.71e+03 1.2e+00 7.5e-02 0.798 0.803 0.00
  28 -1.087987962e+09 +1.19133919e+09 1.27e+03 9.4e-01 7.3e-02 0.796 0.803 0.00
  29 -1.087967070e+09 +1.19129741e+09 1.17e+03 8.4e-01 6.9e-02 0.796 0.804 0.00
  30 -1.087949193e+09 +1.19126165e+09 1.05e+03 7.8e-01 6.4e-02 0.795 0.805 0.00
  31 -1.087933952e+09 +1.19123117e+09 9.33e+02 7.3e-01 5.9e-02 0.794 0.806 0.00
  32 -1.087920988e+09 +1.19120524e+09 8.19e+02 6.8e-01 5.5e-02 0.794 0.806 0.00
  33 -1.087909920e+09 +1.19118311e+09 7.14e+02 6.4e-01 5.1e-02 0.793 0.807 0.00
  34 -1.087900435e+09 +1.19116414e+09 6.19e+02 6.0e-01 4.8e-02 0.793 0.807 0.00
  35 -1.087892279e+09 +1.19114783e+09 5.60e+02 5.7e-01 4.5e-02 0.792 0.808 0.00
  36 -1.087885294e+09 +1.19113386e+09 5.34e+02 5.4e-01 4.2e-02 0.792 0.808 0.00
  37 -1.087879357e+09 +1.19112198e+09 4.97e+02 5.0e-01 3.9e-02 0.792 0.808 0.00
  38 -1.087874275e+09 +1.19111182e+09 4.57e+02 4.6e-01 3.6e-02 0.792 0.809 0.00
  39 -1.087869884e+09 +1.19110304e+09 4.16e+02 4.3e-01 3.4e-02 0.791 0.809 0.00
  40 -1.087866057e+09 +1.19109538e+09 3.84e+02 4.0e-01 3.2e-02 0.791 0.809 0.00
  41 -1.087862703e+09 +1.19108867e+09 3.67e+02 3.7e-01 3.0e-02 0.791 0.809 0.00
  42 -1.087859785e+09 +1.19108284e+09 3.49e+02 3.5e-01 2.8e-02 0.791 0.810 0.00
  43 -1.087857286e+09 +1.19107784e+09 3.22e+02 3.2e-01 2.6e-02 0.791 0.810 0.00
  44 -1.087855165e+09 +1.19107360e+09 2.90e+02 2.8e-01 2.3e-02 0.791 0.810 0.00
  45 -1.087853357e+09 +1.19106998e+09 2.62e+02 2.7e-01 2.1e-02 0.791 0.810 0.00
  46 -1.087851845e+09 +1.19106696e+09 2.28e+02 2.7e-01 1.9e-02 0.791 0.810 0.00
  47 -1.087850568e+09 +1.19106440e+09 1.94e+02 2.7e-01 1.7e-02 0.791 0.810 0.00
  48 -1.087849472e+09 +1.19106221e+09 1.64e+02 2.7e-01 1.6e-02 0.791 0.810 0.00
  49 -1.087848521e+09 +1.19106031e+09 1.38e+02 2.7e-01 1.5e-02 0.791 0.810 0.00
  50 -1.087847686e+09 +1.19105864e+09 1.24e+02 2.7e-01 1.4e-02 0.791 0.810 0.00
  51 -1.087846947e+09 +1.19105716e+09 1.50e+02 2.9e-01 1.3e-02 0.791 0.810 0.00
  52 -1.087846284e+09 +1.19105584e+09 1.79e+02 3.0e-01 1.2e-02 0.791 0.810 0.00
  53 -1.087845681e+09 +1.19105463e+09 2.03e+02 3.1e-01 1.1e-02 0.791 0.810 0.00
  54 -1.087845129e+09 +1.19105353e+09 2.22e+02 3.2e-01 1.1e-02 0.791 0.810 0.00
  55 -1.087844619e+09 +1.19105250e+09 2.37e+02 3.3e-01 1.0e-02 0.791 0.810 0.00
  56 -1.087844143e+09 +1.19105155e+09 2.49e+02 3.3e-01 9.9e-03 0.791 0.810 0.00
  57 -1.087843698e+09 +1.19105066e+09 2.57e+02 3.3e-01 9.5e-03 0.791 0.810 0.00
  58 -1.087843278e+09 +1.19104982e+09 2.63e+02 3.3e-01 9.2e-03 0.791 0.810 0.00
  59 -1.087842882e+09 +1.19104903e+09 2.68e+02 3.3e-01 8.9e-03 0.791 0.810 0.00
  60 -1.087842506e+09 +1.19104828e+09 2.71e+02 3.3e-01 8.7e-03 0.792 0.810 0.00
  61 -1.087842148e+09 +1.19104756e+09 2.72e+02 3.3e-01 8.4e-03 0.792 0.810 0.00
  62 -1.087841807e+09 +1.19104688e+09 2.73e+02 3.3e-01 8.2e-03 0.792 0.810 0.00
  63 -1.087841482e+09 +1.19104623e+09 2.74e+02 3.2e-01 8.0e-03 0.792 0.809 0.00
  64 -1.087841170e+09 +1.19104561e+09 2.74e+02 3.2e-01 7.7e-03 0.792 0.809 0.00
  65 -1.087840872e+09 +1.19104501e+09 2.74e+02 3.2e-01 7.6e-03 0.792 0.809 0.00
  66 -1.087840585e+09 +1.19104444e+09 2.72e+02 3.1e-01 7.4e-03 0.792 0.809 0.00
  67 -1.087840309e+09 +1.19104389e+09 2.71e+02 3.1e-01 7.2e-03 0.792 0.809 0.00
  68 -1.087840042e+09 +1.19104335e+09 2.69e+02 3.1e-01 7.1e-03 0.793 0.809 0.00
  69 -1.087839785e+09 +1.19104284e+09 2.67e+02 3.0e-01 6.9e-03 0.793 0.809 0.00
  70 -1.087839536e+09 +1.19104234e+09 2.65e+02 3.0e-01 6.8e-03 0.793 0.809 0.00
  71 -1.087839296e+09 +1.19104186e+09 2.63e+02 3.0e-01 6.5e-03 0.793 0.809 0.00
  72 -1.087839064e+09 +1.19104140e+09 2.61e+02 2.9e-01 6.4e-03 0.793 0.809 0.00
  73 -1.087838839e+09 +1.19104095e+09 2.58e+02 2.9e-01 6.3e-03 0.793 0.809 0.00
  74 -1.087838622e+09 +1.19104051e+09 2.56e+02 2.9e-01 6.3e-03 0.793 0.809 0.00
  75 -1.087838411e+09 +1.19104009e+09 2.53e+02 2.8e-01 6.2e-03 0.793 0.809 0.00
  76 -1.087838208e+09 +1.19103968e+09 2.50e+02 2.8e-01 6.2e-03 0.793 0.808 0.00
  77 -1.087838011e+09 +1.19103929e+09 2.47e+02 2.7e-01 6.1e-03 0.793 0.808 0.00
  78 -1.087837820e+09 +1.19103891e+09 2.45e+02 2.7e-01 6.0e-03 0.793 0.808 0.00
  79 -1.087837636e+09 +1.19103854e+09 2.42e+02 2.7e-01 6.0e-03 0.793 0.808 0.00
  80 -1.087837457e+09 +1.19103818e+09 2.39e+02 2.6e-01 5.9e-03 0.793 0.808 0.00
  81 -1.087837284e+09 +1.19103784e+09 2.36e+02 2.6e-01 5.8e-03 0.793 0.808 0.00
  82 -1.087837117e+09 +1.19103750e+09 2.33e+02 2.6e-01 5.8e-03 0.793 0.808 0.00
  83 -1.087836955e+09 +1.19103718e+09 2.30e+02 2.5e-01 5.7e-03 0.793 0.808 0.00
  84 -1.087836798e+09 +1.19103686e+09 2.27e+02 2.5e-01 5.6e-03 0.794 0.808 0.00
  85 -1.087836646e+09 +1.19103656e+09 2.25e+02 2.5e-01 5.5e-03 0.794 0.808 0.00
  86 -1.087836499e+09 +1.19103627e+09 2.22e+02 2.4e-01 5.4e-03 0.794 0.808 0.00
  87 -1.087836357e+09 +1.19103598e+09 2.19e+02 2.4e-01 5.4e-03 0.794 0.807 0.00
  88 -1.087836219e+09 +1.19103571e+09 2.16e+02 2.4e-01 5.3e-03 0.794 0.807 0.00
  89 -1.087836085e+09 +1.19103544e+09 2.14e+02 2.3e-01 5.2e-03 0.794 0.807 0.00
  90 -1.087835956e+09 +1.19103518e+09 2.11e+02 2.3e-01 5.1e-03 0.794 0.807 0.00
  91 -1.087835831e+09 +1.19103493e+09 2.08e+02 2.3e-01 5.1e-03 0.794 0.807 0.00
  92 -1.087835710e+09 +1.19103469e+09 2.06e+02 2.2e-01 5.0e-03 0.794 0.807 0.00
  93 -1.087835592e+09 +1.19103445e+09 2.03e+02 2.2e-01 4.9e-03 0.794 0.807 0.00
  94 -1.087835477e+09 +1.19103422e+09 2.01e+02 2.2e-01 4.9e-03 0.794 0.807 0.00
  95 -1.087835365e+09 +1.19103400e+09 1.99e+02 2.2e-01 4.8e-03 0.794 0.807 0.00
  96 -1.087835256e+09 +1.19103378e+09 1.98e+02 2.1e-01 4.7e-03 0.794 0.807 0.00
  97 -1.087835150e+09 +1.19103357e+09 1.96e+02 2.1e-01 4.7e-03 0.794 0.807 0.00
  98 -1.087835046e+09 +1.19103336e+09 1.94e+02 2.1e-01 4.6e-03 0.794 0.807 0.00
  99 -1.087834945e+09 +1.19103316e+09 1.92e+02 2.1e-01 4.6e-03 0.795 0.807 0.00
 100 -1.087834847e+09 +1.19103296e+09 1.91e+02 2.0e-01 4.5e-03 0.795 0.807 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
85926.951  8204.544 48105.495 
