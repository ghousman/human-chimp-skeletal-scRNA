
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 20"
> print(paste0("data source: ",data.source))
[1] "data source: t2"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-20 Poisson NMF to 27151 x 17304 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -2.383350812e+08 +2.68475984e+08 1.02e+04 3.3e+02 1.5e+00 0.561 0.397 0.00
   2 -2.294948898e+08 +2.50795601e+08 2.20e+04 1.6e+02 3.5e+00 0.566 0.513 0.00
   3 -2.267352312e+08 +2.45276284e+08 5.24e+03 1.0e+02 2.6e+00 0.574 0.532 0.00
   4 -2.255937360e+08 +2.42993294e+08 3.42e+03 9.8e+01 1.9e+00 0.578 0.544 0.00
   5 -2.250013319e+08 +2.41808486e+08 1.95e+03 9.5e+01 8.6e-01 0.583 0.551 0.00
   6 -2.245926016e+08 +2.40991025e+08 1.98e+03 8.3e+01 9.3e-01 0.587 0.556 0.00
   7 -2.242498602e+08 +2.40305542e+08 2.35e+03 6.4e+01 1.2e+00 0.590 0.562 0.00
   8 -2.239670440e+08 +2.39739910e+08 2.29e+03 4.2e+01 1.3e+00 0.594 0.568 0.00
   9 -2.237498481e+08 +2.39305518e+08 1.66e+03 3.2e+01 1.1e+00 0.597 0.573 0.00
  10 -2.235796155e+08 +2.38965053e+08 1.59e+03 3.2e+01 8.4e-01 0.598 0.575 0.00
  11 -2.234432721e+08 +2.38692366e+08 1.42e+03 3.3e+01 9.8e-01 0.598 0.577 0.00
  12 -2.233353263e+08 +2.38476475e+08 1.16e+03 3.3e+01 9.6e-01 0.598 0.579 0.00
  13 -2.232544976e+08 +2.38314817e+08 1.05e+03 3.1e+01 7.2e-01 0.598 0.580 0.00
  14 -2.231952228e+08 +2.38196267e+08 9.78e+02 2.7e+01 4.6e-01 0.598 0.581 0.00
  15 -2.231515092e+08 +2.38108840e+08 8.39e+02 2.3e+01 2.8e-01 0.599 0.581 0.00
  16 -2.231190590e+08 +2.38043940e+08 6.84e+02 1.9e+01 2.2e-01 0.599 0.582 0.00
  17 -2.230948257e+08 +2.37995473e+08 5.54e+02 1.6e+01 1.8e-01 0.600 0.582 0.00
  18 -2.230764936e+08 +2.37958809e+08 4.53e+02 1.3e+01 1.4e-01 0.601 0.582 0.00
  19 -2.230620838e+08 +2.37929989e+08 3.77e+02 1.1e+01 1.4e-01 0.601 0.582 0.00
  20 -2.230503813e+08 +2.37906584e+08 3.27e+02 9.7e+00 1.5e-01 0.602 0.582 0.00
  21 -2.230405231e+08 +2.37886868e+08 2.88e+02 8.5e+00 1.5e-01 0.602 0.582 0.00
  22 -2.230316545e+08 +2.37869131e+08 2.30e+02 7.5e+00 1.6e-01 0.603 0.583 0.00
  23 -2.230231472e+08 +2.37852116e+08 2.85e+02 6.6e+00 1.8e-01 0.603 0.583 0.00
  24 -2.230144916e+08 +2.37834805e+08 5.16e+02 5.5e+00 2.0e-01 0.603 0.583 0.00
  25 -2.230052155e+08 +2.37816253e+08 5.56e+02 4.8e+00 2.4e-01 0.603 0.583 0.00
  26 -2.229948438e+08 +2.37795510e+08 5.85e+02 4.3e+00 2.7e-01 0.604 0.583 0.00
  27 -2.229830389e+08 +2.37771900e+08 5.33e+02 3.8e+00 3.1e-01 0.604 0.583 0.00
  28 -2.229698213e+08 +2.37745465e+08 6.22e+02 3.4e+00 3.6e-01 0.604 0.583 0.00
  29 -2.229557280e+08 +2.37717278e+08 7.29e+02 3.2e+00 4.0e-01 0.605 0.583 0.00
  30 -2.229414852e+08 +2.37688792e+08 9.25e+02 3.8e+00 4.2e-01 0.605 0.583 0.00
  31 -2.229280608e+08 +2.37661944e+08 1.05e+03 4.0e+00 4.2e-01 0.606 0.583 0.00
  32 -2.229162084e+08 +2.37638239e+08 1.07e+03 3.8e+00 3.9e-01 0.606 0.584 0.00
  33 -2.229063481e+08 +2.37618518e+08 1.02e+03 3.3e+00 3.4e-01 0.607 0.584 0.00
  34 -2.228984050e+08 +2.37602632e+08 9.47e+02 2.7e+00 2.8e-01 0.607 0.584 0.00
  35 -2.228920797e+08 +2.37589981e+08 8.73e+02 2.0e+00 2.3e-01 0.607 0.584 0.00
  36 -2.228869340e+08 +2.37579690e+08 8.01e+02 1.9e+00 1.9e-01 0.608 0.584 0.00
  37 -2.228825623e+08 +2.37570946e+08 6.40e+02 1.8e+00 1.8e-01 0.608 0.584 0.00
  38 -2.228786735e+08 +2.37563169e+08 5.43e+02 1.8e+00 1.7e-01 0.608 0.584 0.00
  39 -2.228750558e+08 +2.37555934e+08 4.73e+02 1.7e+00 1.7e-01 0.608 0.584 0.00
  40 -2.228715935e+08 +2.37549009e+08 4.14e+02 1.7e+00 1.7e-01 0.609 0.584 0.00
  41 -2.228681617e+08 +2.37542145e+08 3.57e+02 1.5e+00 1.8e-01 0.609 0.584 0.00
  42 -2.228646332e+08 +2.37535088e+08 3.02e+02 1.6e+00 1.9e-01 0.609 0.584 0.00
  43 -2.228608919e+08 +2.37527606e+08 2.48e+02 1.7e+00 2.0e-01 0.609 0.584 0.00
  44 -2.228568135e+08 +2.37519449e+08 1.96e+02 1.7e+00 2.0e-01 0.609 0.584 0.00
  45 -2.228522702e+08 +2.37510362e+08 1.90e+02 1.8e+00 2.1e-01 0.610 0.584 0.00
  46 -2.228471496e+08 +2.37500121e+08 2.03e+02 1.8e+00 2.2e-01 0.610 0.584 0.00
  47 -2.228413420e+08 +2.37488506e+08 2.10e+02 1.9e+00 2.3e-01 0.611 0.584 0.00
  48 -2.228346594e+08 +2.37475141e+08 2.18e+02 2.0e+00 2.3e-01 0.611 0.584 0.00
  49 -2.228269644e+08 +2.37459751e+08 2.24e+02 2.3e+00 2.3e-01 0.611 0.584 0.00
  50 -2.228181476e+08 +2.37442117e+08 2.26e+02 2.6e+00 2.2e-01 0.612 0.583 0.00
  51 -2.228081287e+08 +2.37422079e+08 2.16e+02 3.1e+00 2.4e-01 0.613 0.583 0.00
  52 -2.227970062e+08 +2.37399834e+08 2.00e+02 3.4e+00 2.5e-01 0.613 0.582 0.00
  53 -2.227850850e+08 +2.37375992e+08 2.11e+02 3.6e+00 2.6e-01 0.614 0.581 0.00
  54 -2.227729497e+08 +2.37351721e+08 2.27e+02 3.5e+00 2.7e-01 0.615 0.580 0.00
  55 -2.227614712e+08 +2.37328764e+08 2.32e+02 3.2e+00 2.7e-01 0.615 0.579 0.00
  56 -2.227513393e+08 +2.37308500e+08 2.58e+02 2.7e+00 2.6e-01 0.616 0.577 0.00
  57 -2.227428173e+08 +2.37291456e+08 2.90e+02 2.2e+00 2.4e-01 0.616 0.576 0.00
  58 -2.227358120e+08 +2.37277446e+08 3.09e+02 2.0e+00 2.3e-01 0.617 0.575 0.00
  59 -2.227300223e+08 +2.37265866e+08 3.09e+02 2.1e+00 2.1e-01 0.617 0.573 0.00
  60 -2.227252230e+08 +2.37256268e+08 2.97e+02 2.1e+00 1.9e-01 0.617 0.572 0.00
  61 -2.227211902e+08 +2.37248202e+08 2.76e+02 2.1e+00 1.7e-01 0.618 0.572 0.00
  62 -2.227177350e+08 +2.37241292e+08 2.51e+02 2.0e+00 1.6e-01 0.618 0.571 0.00
  63 -2.227147158e+08 +2.37235253e+08 2.25e+02 1.9e+00 1.4e-01 0.618 0.570 0.00
  64 -2.227120235e+08 +2.37229869e+08 2.00e+02 1.8e+00 1.3e-01 0.618 0.570 0.00
  65 -2.227095899e+08 +2.37225002e+08 1.76e+02 1.8e+00 1.2e-01 0.618 0.569 0.00
  66 -2.227073632e+08 +2.37220548e+08 1.53e+02 1.8e+00 1.1e-01 0.618 0.569 0.00
  67 -2.227053061e+08 +2.37216434e+08 1.32e+02 1.7e+00 1.0e-01 0.618 0.569 0.00
  68 -2.227033840e+08 +2.37212590e+08 1.13e+02 1.7e+00 9.7e-02 0.618 0.569 0.00
  69 -2.227015711e+08 +2.37208964e+08 9.71e+01 1.6e+00 9.0e-02 0.618 0.569 0.00
  70 -2.226998504e+08 +2.37205523e+08 8.20e+01 1.5e+00 8.3e-02 0.618 0.568 0.00
  71 -2.226982025e+08 +2.37202227e+08 6.82e+01 1.5e+00 7.9e-02 0.618 0.568 0.00
  72 -2.226966121e+08 +2.37199046e+08 6.23e+01 1.4e+00 9.2e-02 0.618 0.568 0.00
  73 -2.226950646e+08 +2.37195951e+08 6.54e+01 1.4e+00 1.1e-01 0.618 0.568 0.00
  74 -2.226935502e+08 +2.37192922e+08 6.83e+01 1.3e+00 1.2e-01 0.618 0.568 0.00
  75 -2.226920638e+08 +2.37189950e+08 7.27e+01 1.2e+00 1.4e-01 0.618 0.568 0.00
  76 -2.226906084e+08 +2.37187039e+08 7.82e+01 1.2e+00 1.5e-01 0.618 0.569 0.00
  77 -2.226891972e+08 +2.37184216e+08 8.02e+01 1.1e+00 1.5e-01 0.618 0.569 0.00
  78 -2.226878480e+08 +2.37181518e+08 7.65e+01 1.1e+00 1.5e-01 0.617 0.569 0.00
  79 -2.226865777e+08 +2.37178977e+08 6.91e+01 1.0e+00 1.4e-01 0.617 0.569 0.00
  80 -2.226853934e+08 +2.37176609e+08 6.18e+01 9.8e-01 1.2e-01 0.617 0.569 0.00
  81 -2.226842964e+08 +2.37174415e+08 6.12e+01 9.4e-01 1.1e-01 0.617 0.569 0.00
  82 -2.226832847e+08 +2.37172391e+08 6.13e+01 9.0e-01 8.9e-02 0.617 0.569 0.00
  83 -2.226823549e+08 +2.37170532e+08 6.09e+01 8.7e-01 7.4e-02 0.617 0.569 0.00
  84 -2.226815014e+08 +2.37168825e+08 6.03e+01 8.4e-01 6.2e-02 0.617 0.569 0.00
  85 -2.226807176e+08 +2.37167257e+08 5.93e+01 8.1e-01 5.1e-02 0.617 0.569 0.00
  86 -2.226799964e+08 +2.37165815e+08 8.91e+01 7.7e-01 4.3e-02 0.617 0.569 0.00
  87 -2.226793321e+08 +2.37164486e+08 1.11e+02 7.5e-01 3.7e-02 0.616 0.570 0.00
  88 -2.226787174e+08 +2.37163257e+08 1.05e+02 7.2e-01 3.2e-02 0.616 0.570 0.00
  89 -2.226781477e+08 +2.37162117e+08 1.01e+02 7.0e-01 3.1e-02 0.616 0.570 0.00
  90 -2.226776195e+08 +2.37161061e+08 9.82e+01 6.8e-01 3.2e-02 0.616 0.570 0.00
  91 -2.226771285e+08 +2.37160079e+08 9.59e+01 6.6e-01 3.2e-02 0.616 0.570 0.00
  92 -2.226766714e+08 +2.37159165e+08 9.40e+01 6.4e-01 3.1e-02 0.616 0.570 0.00
  93 -2.226762448e+08 +2.37158312e+08 9.23e+01 6.2e-01 3.1e-02 0.616 0.570 0.00
  94 -2.226758460e+08 +2.37157514e+08 9.08e+01 6.0e-01 3.0e-02 0.616 0.570 0.00
  95 -2.226754716e+08 +2.37156765e+08 8.95e+01 5.9e-01 3.2e-02 0.616 0.571 0.00
  96 -2.226751242e+08 +2.37156070e+08 8.83e+01 5.7e-01 4.9e-02 0.616 0.571 0.00
  97 -2.226748011e+08 +2.37155424e+08 8.73e+01 5.6e-01 2.8e-02 0.616 0.571 0.00
  98 -2.226744990e+08 +2.37154820e+08 8.66e+01 5.5e-01 2.7e-02 0.616 0.571 0.00
  99 -2.226742159e+08 +2.37154254e+08 8.58e+01 5.3e-01 2.6e-02 0.616 0.571 0.00
 100 -2.226739507e+08 +2.37153723e+08 8.50e+01 5.2e-01 2.6e-02 0.615 0.571 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
52012.812  1768.268 19126.824 
