
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 4"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-4 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.129880991e+09 +1.27276009e+09 4.88e+03 1.1e+02 5.5e-01 0.872 0.840 0.00
   2 -1.125958921e+09 +1.26491595e+09 2.31e+03 3.1e+01 1.7e+00 0.879 0.842 0.00
   3 -1.124878747e+09 +1.26275560e+09 1.53e+03 1.7e+01 1.4e+00 0.874 0.813 0.00
   4 -1.124503241e+09 +1.26200459e+09 4.16e+02 9.0e+00 9.2e-01 0.875 0.775 0.00
   5 -1.124350693e+09 +1.26169949e+09 7.12e+02 8.4e+00 4.6e-01 0.872 0.762 0.00
   6 -1.124272830e+09 +1.26154377e+09 2.36e+02 6.8e+00 2.8e-01 0.871 0.748 0.00
   7 -1.124225996e+09 +1.26145010e+09 1.99e+02 5.4e+00 2.2e-01 0.870 0.740 0.00
   8 -1.124195626e+09 +1.26138936e+09 1.80e+02 4.2e+00 1.8e-01 0.869 0.736 0.00
   9 -1.124175146e+09 +1.26134840e+09 1.62e+02 3.4e+00 1.4e-01 0.869 0.734 0.00
  10 -1.124161084e+09 +1.26132028e+09 1.43e+02 2.8e+00 1.1e-01 0.868 0.734 0.00
  11 -1.124151319e+09 +1.26130075e+09 1.26e+02 2.3e+00 9.1e-02 0.867 0.733 0.00
  12 -1.124144463e+09 +1.26128703e+09 1.10e+02 2.0e+00 7.5e-02 0.867 0.734 0.00
  13 -1.124139577e+09 +1.26127726e+09 9.32e+01 1.6e+00 6.3e-02 0.866 0.734 0.00
  14 -1.124136031e+09 +1.26127017e+09 7.47e+01 1.4e+00 5.2e-02 0.866 0.734 0.00
  15 -1.124133407e+09 +1.26126492e+09 5.45e+01 1.2e+00 4.4e-02 0.866 0.734 0.00
  16 -1.124131438e+09 +1.26126098e+09 5.33e+01 1.0e+00 3.8e-02 0.865 0.735 0.00
  17 -1.124129900e+09 +1.26125791e+09 5.37e+01 9.3e-01 3.3e-02 0.865 0.735 0.00
  18 -1.124128626e+09 +1.26125536e+09 5.39e+01 8.3e-01 3.0e-02 0.865 0.735 0.00
  19 -1.124127506e+09 +1.26125312e+09 5.40e+01 7.5e-01 2.8e-02 0.865 0.735 0.00
  20 -1.124126468e+09 +1.26125104e+09 5.42e+01 6.9e-01 2.6e-02 0.865 0.735 0.00
  21 -1.124125463e+09 +1.26124903e+09 5.44e+01 6.5e-01 2.5e-02 0.865 0.735 0.00
  22 -1.124124457e+09 +1.26124702e+09 5.47e+01 6.1e-01 2.4e-02 0.865 0.735 0.00
  23 -1.124123429e+09 +1.26124497e+09 5.51e+01 5.9e-01 2.3e-02 0.865 0.735 0.00
  24 -1.124122361e+09 +1.26124283e+09 5.55e+01 5.7e-01 2.3e-02 0.865 0.735 0.00
  25 -1.124121240e+09 +1.26124059e+09 5.60e+01 5.6e-01 2.3e-02 0.865 0.735 0.00
  26 -1.124120055e+09 +1.26123822e+09 5.64e+01 5.7e-01 2.3e-02 0.865 0.735 0.00
  27 -1.124118797e+09 +1.26123570e+09 5.69e+01 5.8e-01 2.3e-02 0.865 0.735 0.00
  28 -1.124117456e+09 +1.26123302e+09 5.73e+01 6.0e-01 2.3e-02 0.865 0.735 0.00
  29 -1.124116024e+09 +1.26123015e+09 5.77e+01 6.2e-01 2.3e-02 0.865 0.735 0.00
  30 -1.124114489e+09 +1.26122709e+09 5.81e+01 6.4e-01 2.4e-02 0.865 0.735 0.00
  31 -1.124112841e+09 +1.26122379e+09 5.83e+01 6.6e-01 2.4e-02 0.865 0.735 0.00
  32 -1.124111062e+09 +1.26122023e+09 6.25e+01 6.9e-01 2.5e-02 0.865 0.735 0.00
  33 -1.124109136e+09 +1.26121638e+09 7.05e+01 7.1e-01 2.5e-02 0.865 0.734 0.00
  34 -1.124107048e+09 +1.26121220e+09 7.99e+01 7.4e-01 2.6e-02 0.865 0.734 0.00
  35 -1.124104780e+09 +1.26120767e+09 9.11e+01 7.7e-01 2.7e-02 0.865 0.734 0.00
  36 -1.124102306e+09 +1.26120272e+09 1.04e+02 8.0e-01 2.7e-02 0.865 0.734 0.00
  37 -1.124099600e+09 +1.26119731e+09 1.20e+02 8.3e-01 2.8e-02 0.865 0.734 0.00
  38 -1.124096627e+09 +1.26119136e+09 1.39e+02 8.6e-01 2.9e-02 0.865 0.734 0.00
  39 -1.124093343e+09 +1.26118479e+09 1.62e+02 9.0e-01 3.1e-02 0.865 0.734 0.00
  40 -1.124089700e+09 +1.26117751e+09 1.89e+02 9.3e-01 3.2e-02 0.865 0.734 0.00
  41 -1.124085637e+09 +1.26116938e+09 2.22e+02 9.7e-01 3.4e-02 0.865 0.734 0.00
  42 -1.124081080e+09 +1.26116027e+09 2.61e+02 1.0e+00 3.6e-02 0.865 0.734 0.00
  43 -1.124075938e+09 +1.26114998e+09 3.07e+02 1.0e+00 3.8e-02 0.865 0.734 0.00
  44 -1.124070110e+09 +1.26113833e+09 3.59e+02 1.1e+00 4.0e-02 0.865 0.734 0.00
  45 -1.124063473e+09 +1.26112505e+09 4.16e+02 1.1e+00 4.3e-02 0.865 0.734 0.00
  46 -1.124055888e+09 +1.26110988e+09 4.70e+02 1.1e+00 4.6e-02 0.865 0.734 0.00
  47 -1.124047203e+09 +1.26109251e+09 5.13e+02 1.1e+00 4.9e-02 0.865 0.734 0.00
  48 -1.124037289e+09 +1.26107269e+09 5.27e+02 1.1e+00 5.3e-02 0.865 0.735 0.00
  49 -1.124026087e+09 +1.26105028e+09 4.93e+02 1.1e+00 6.1e-02 0.865 0.735 0.00
  50 -1.124013629e+09 +1.26102537e+09 4.06e+02 1.1e+00 6.7e-02 0.865 0.735 0.00
  51 -1.124000050e+09 +1.26099821e+09 2.84e+02 1.2e+00 6.6e-02 0.865 0.735 0.00
  52 -1.123985587e+09 +1.26096928e+09 1.98e+02 1.3e+00 6.5e-02 0.865 0.735 0.00
  53 -1.123970516e+09 +1.26093914e+09 1.70e+02 1.3e+00 6.7e-02 0.865 0.736 0.00
  54 -1.123955083e+09 +1.26090827e+09 2.00e+02 1.4e+00 6.8e-02 0.865 0.736 0.00
  55 -1.123939451e+09 +1.26087701e+09 2.15e+02 1.5e+00 7.0e-02 0.865 0.736 0.00
  56 -1.123923695e+09 +1.26084550e+09 2.13e+02 1.6e+00 7.2e-02 0.865 0.737 0.00
  57 -1.123907810e+09 +1.26081373e+09 2.09e+02 1.6e+00 7.5e-02 0.865 0.737 0.00
  58 -1.123891739e+09 +1.26078159e+09 2.27e+02 1.7e+00 7.7e-02 0.865 0.737 0.00
  59 -1.123875365e+09 +1.26074884e+09 2.50e+02 1.8e+00 7.9e-02 0.865 0.738 0.00
  60 -1.123858477e+09 +1.26071506e+09 3.44e+02 1.8e+00 8.1e-02 0.865 0.738 0.00
  61 -1.123840841e+09 +1.26067979e+09 3.89e+02 1.9e+00 8.3e-02 0.865 0.739 0.00
  62 -1.123822183e+09 +1.26064247e+09 3.68e+02 2.1e+00 8.6e-02 0.865 0.739 0.00
  63 -1.123802235e+09 +1.26060258e+09 2.90e+02 2.2e+00 9.3e-02 0.865 0.739 0.00
  64 -1.123780831e+09 +1.26055977e+09 1.79e+02 2.3e+00 9.9e-02 0.864 0.740 0.00
  65 -1.123757991e+09 +1.26051409e+09 1.64e+02 2.5e+00 1.0e-01 0.864 0.740 0.00
  66 -1.123734022e+09 +1.26046615e+09 1.59e+02 2.6e+00 1.0e-01 0.864 0.741 0.00
  67 -1.123709542e+09 +1.26041719e+09 1.39e+02 2.8e+00 1.0e-01 0.864 0.742 0.00
  68 -1.123685518e+09 +1.26036914e+09 1.22e+02 3.1e+00 1.1e-01 0.864 0.742 0.00
  69 -1.123662255e+09 +1.26032262e+09 2.86e+02 3.1e+00 1.1e-01 0.864 0.742 0.00
  70 -1.123639583e+09 +1.26027727e+09 2.53e+02 3.1e+00 1.1e-01 0.864 0.743 0.00
  71 -1.123617334e+09 +1.26023278e+09 2.10e+02 3.1e+00 1.1e-01 0.864 0.743 0.00
  72 -1.123595475e+09 +1.26018906e+09 1.52e+02 3.1e+00 1.1e-01 0.864 0.743 0.00
  73 -1.123574007e+09 +1.26014612e+09 1.25e+02 3.1e+00 1.1e-01 0.863 0.744 0.00
  74 -1.123553000e+09 +1.26010411e+09 1.25e+02 3.1e+00 1.0e-01 0.863 0.744 0.00
  75 -1.123532491e+09 +1.26006309e+09 1.26e+02 3.0e+00 1.0e-01 0.863 0.744 0.00
  76 -1.123512551e+09 +1.26002321e+09 1.34e+02 3.0e+00 1.0e-01 0.863 0.744 0.00
  77 -1.123493294e+09 +1.25998470e+09 1.44e+02 3.0e+00 1.0e-01 0.863 0.745 0.00
  78 -1.123474814e+09 +1.25994774e+09 1.54e+02 2.9e+00 9.9e-02 0.863 0.745 0.00
  79 -1.123457148e+09 +1.25991240e+09 1.63e+02 2.8e+00 9.8e-02 0.863 0.745 0.00
  80 -1.123440300e+09 +1.25987871e+09 1.73e+02 2.7e+00 9.5e-02 0.863 0.745 0.00
  81 -1.123424289e+09 +1.25984669e+09 1.82e+02 2.7e+00 9.3e-02 0.862 0.746 0.00
  82 -1.123409112e+09 +1.25981633e+09 1.91e+02 2.6e+00 9.1e-02 0.862 0.746 0.00
  83 -1.123394724e+09 +1.25978756e+09 1.99e+02 2.5e+00 8.8e-02 0.862 0.746 0.00
  84 -1.123381073e+09 +1.25976025e+09 2.07e+02 2.4e+00 8.5e-02 0.862 0.747 0.00
  85 -1.123368107e+09 +1.25973432e+09 2.15e+02 2.3e+00 8.3e-02 0.861 0.747 0.00
  86 -1.123355761e+09 +1.25970963e+09 2.23e+02 2.3e+00 8.0e-02 0.861 0.747 0.00
  87 -1.123343969e+09 +1.25968605e+09 2.30e+02 2.2e+00 7.8e-02 0.861 0.748 0.00
  88 -1.123332674e+09 +1.25966346e+09 2.37e+02 2.1e+00 7.5e-02 0.861 0.748 0.00
  89 -1.123321821e+09 +1.25964175e+09 2.43e+02 2.1e+00 7.3e-02 0.860 0.748 0.00
  90 -1.123311361e+09 +1.25962083e+09 2.50e+02 2.0e+00 7.1e-02 0.860 0.749 0.00
  91 -1.123301233e+09 +1.25960057e+09 2.56e+02 2.0e+00 6.9e-02 0.860 0.749 0.00
  92 -1.123291384e+09 +1.25958087e+09 2.62e+02 2.0e+00 6.7e-02 0.860 0.749 0.00
  93 -1.123281775e+09 +1.25956166e+09 2.68e+02 1.9e+00 6.6e-02 0.859 0.750 0.00
  94 -1.123272364e+09 +1.25954284e+09 2.73e+02 1.9e+00 6.4e-02 0.859 0.750 0.00
  95 -1.123263106e+09 +1.25952432e+09 2.77e+02 1.9e+00 6.3e-02 0.858 0.750 0.00
  96 -1.123253973e+09 +1.25950605e+09 2.81e+02 1.9e+00 6.2e-02 0.858 0.751 0.00
  97 -1.123244954e+09 +1.25948802e+09 2.85e+02 1.8e+00 6.1e-02 0.858 0.751 0.00
  98 -1.123236048e+09 +1.25947020e+09 2.88e+02 1.8e+00 6.0e-02 0.858 0.752 0.00
  99 -1.123227240e+09 +1.25945259e+09 2.91e+02 1.8e+00 5.9e-02 0.857 0.752 0.00
 100 -1.123218513e+09 +1.25943513e+09 2.92e+02 1.8e+00 5.8e-02 0.857 0.752 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
66756.863  8164.111 40005.810 
