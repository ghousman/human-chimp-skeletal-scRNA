
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 10"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-10 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.099856429e+09 +1.21271097e+09 6.55e+04 1.9e+02 1.7e+00 0.732 0.546 0.00
   2 -1.081995067e+09 +1.17698824e+09 3.96e+04 7.3e+01 4.5e+00 0.725 0.718 0.00
   3 -1.074014046e+09 +1.16102620e+09 1.17e+04 7.1e+01 5.1e+00 0.726 0.622 0.00
   4 -1.069870011e+09 +1.15273813e+09 6.84e+03 6.2e+01 4.0e+00 0.721 0.628 0.00
   5 -1.067499471e+09 +1.14799705e+09 3.44e+03 4.1e+01 1.0e+00 0.718 0.632 0.00
   6 -1.066038589e+09 +1.14507529e+09 2.94e+03 2.4e+01 8.6e-01 0.716 0.636 0.00
   7 -1.065056788e+09 +1.14311168e+09 2.71e+03 1.4e+01 7.0e-01 0.716 0.640 0.00
   8 -1.064349600e+09 +1.14169731e+09 1.82e+03 9.6e+00 6.2e-01 0.718 0.642 0.00
   9 -1.063813179e+09 +1.14062447e+09 2.77e+03 7.4e+00 5.8e-01 0.719 0.642 0.00
  10 -1.063387164e+09 +1.13977244e+09 3.27e+03 6.3e+00 5.2e-01 0.719 0.640 0.00
  11 -1.063039633e+09 +1.13907737e+09 3.26e+03 5.9e+00 4.7e-01 0.720 0.638 0.00
  12 -1.062747930e+09 +1.13849397e+09 3.17e+03 5.7e+00 4.8e-01 0.721 0.635 0.00
  13 -1.062502962e+09 +1.13800403e+09 5.80e+03 5.6e+00 4.7e-01 0.721 0.634 0.00
  14 -1.062299959e+09 +1.13759803e+09 2.80e+03 5.6e+00 4.1e-01 0.721 0.633 0.00
  15 -1.062138705e+09 +1.13727552e+09 2.37e+03 5.5e+00 3.6e-01 0.721 0.633 0.00
  16 -1.062014091e+09 +1.13702629e+09 2.29e+03 5.6e+00 3.1e-01 0.721 0.633 0.00
  17 -1.061915549e+09 +1.13682920e+09 2.31e+03 5.7e+00 2.6e-01 0.721 0.633 0.00
  18 -1.061835087e+09 +1.13666828e+09 2.41e+03 5.9e+00 2.1e-01 0.721 0.634 0.00
  19 -1.061767173e+09 +1.13653245e+09 1.35e+03 6.2e+00 1.8e-01 0.721 0.635 0.00
  20 -1.061710450e+09 +1.13641901e+09 1.05e+03 5.9e+00 1.5e-01 0.721 0.635 0.00
  21 -1.061661858e+09 +1.13632182e+09 1.11e+03 5.6e+00 1.4e-01 0.721 0.635 0.00
  22 -1.061620064e+09 +1.13623824e+09 1.16e+03 5.4e+00 1.4e-01 0.721 0.636 0.00
  23 -1.061584850e+09 +1.13616781e+09 1.13e+03 4.7e+00 1.4e-01 0.721 0.636 0.00
  24 -1.061554209e+09 +1.13610653e+09 1.07e+03 4.2e+00 1.3e-01 0.722 0.636 0.00
  25 -1.061526914e+09 +1.13605193e+09 1.03e+03 3.9e+00 1.3e-01 0.722 0.636 0.00
  26 -1.061502213e+09 +1.13600253e+09 9.91e+02 3.5e+00 1.3e-01 0.722 0.636 0.00
  27 -1.061479493e+09 +1.13595709e+09 1.02e+03 3.3e+00 1.2e-01 0.722 0.636 0.00
  28 -1.061458363e+09 +1.13591483e+09 1.02e+03 3.0e+00 1.1e-01 0.723 0.636 0.00
  29 -1.061438528e+09 +1.13587516e+09 9.92e+02 2.7e+00 1.2e-01 0.723 0.636 0.00
  30 -1.061420036e+09 +1.13583818e+09 9.40e+02 2.1e+00 1.3e-01 0.723 0.636 0.00
  31 -1.061403063e+09 +1.13580423e+09 7.82e+02 2.1e+00 1.3e-01 0.724 0.635 0.00
  32 -1.061386794e+09 +1.13577170e+09 6.58e+02 2.2e+00 1.3e-01 0.724 0.635 0.00
  33 -1.061370648e+09 +1.13573940e+09 5.67e+02 2.2e+00 1.3e-01 0.724 0.635 0.00
  34 -1.061354118e+09 +1.13570634e+09 5.12e+02 2.3e+00 1.4e-01 0.725 0.635 0.00
  35 -1.061336645e+09 +1.13567140e+09 5.34e+02 2.3e+00 1.3e-01 0.725 0.635 0.00
  36 -1.061317658e+09 +1.13563342e+09 5.53e+02 2.4e+00 1.3e-01 0.726 0.635 0.00
  37 -1.061296552e+09 +1.13559121e+09 5.97e+02 2.5e+00 1.3e-01 0.726 0.635 0.00
  38 -1.061272685e+09 +1.13554348e+09 6.54e+02 2.6e+00 1.2e-01 0.727 0.635 0.00
  39 -1.061245356e+09 +1.13548882e+09 6.69e+02 2.7e+00 1.3e-01 0.727 0.635 0.00
  40 -1.061213868e+09 +1.13542584e+09 6.90e+02 2.9e+00 1.5e-01 0.728 0.635 0.00
  41 -1.061177520e+09 +1.13535315e+09 7.69e+02 3.0e+00 1.7e-01 0.728 0.634 0.00
  42 -1.061135614e+09 +1.13526933e+09 8.46e+02 3.2e+00 1.9e-01 0.728 0.634 0.00
  43 -1.061087703e+09 +1.13517351e+09 9.20e+02 3.3e+00 2.1e-01 0.729 0.634 0.00
  44 -1.061033781e+09 +1.13506567e+09 9.83e+02 3.5e+00 2.2e-01 0.729 0.634 0.00
  45 -1.060974361e+09 +1.13494683e+09 1.03e+03 3.6e+00 2.4e-01 0.729 0.634 0.00
  46 -1.060910891e+09 +1.13481989e+09 1.05e+03 3.7e+00 2.4e-01 0.730 0.634 0.00
  47 -1.060845902e+09 +1.13468991e+09 1.12e+03 3.8e+00 2.4e-01 0.730 0.634 0.00
  48 -1.060782354e+09 +1.13456282e+09 1.17e+03 3.8e+00 2.5e-01 0.731 0.634 0.00
  49 -1.060722738e+09 +1.13444358e+09 1.19e+03 3.7e+00 2.5e-01 0.732 0.634 0.00
  50 -1.060668927e+09 +1.13433596e+09 1.17e+03 3.5e+00 2.5e-01 0.732 0.633 0.00
  51 -1.060621385e+09 +1.13424088e+09 1.42e+03 3.3e+00 2.4e-01 0.732 0.633 0.00
  52 -1.060579707e+09 +1.13415752e+09 1.37e+03 3.0e+00 2.1e-01 0.733 0.633 0.00
  53 -1.060543040e+09 +1.13408419e+09 1.29e+03 2.8e+00 1.9e-01 0.733 0.632 0.00
  54 -1.060509941e+09 +1.13401799e+09 1.21e+03 2.5e+00 1.7e-01 0.733 0.632 0.00
  55 -1.060478936e+09 +1.13395598e+09 1.13e+03 2.2e+00 1.7e-01 0.733 0.632 0.00
  56 -1.060448615e+09 +1.13389534e+09 1.06e+03 2.0e+00 1.6e-01 0.733 0.631 0.00
  57 -1.060417595e+09 +1.13383330e+09 9.85e+02 1.8e+00 1.6e-01 0.734 0.631 0.00
  58 -1.060384464e+09 +1.13376704e+09 9.25e+02 1.7e+00 1.7e-01 0.734 0.631 0.00
  59 -1.060347917e+09 +1.13369394e+09 8.83e+02 1.7e+00 1.7e-01 0.734 0.631 0.00
  60 -1.060306649e+09 +1.13361141e+09 9.45e+02 1.9e+00 1.8e-01 0.734 0.630 0.00
  61 -1.060259166e+09 +1.13351644e+09 1.01e+03 2.2e+00 1.7e-01 0.734 0.630 0.00
  62 -1.060203698e+09 +1.13340550e+09 1.07e+03 2.6e+00 1.7e-01 0.734 0.630 0.00
  63 -1.060137803e+09 +1.13327371e+09 1.11e+03 3.1e+00 1.8e-01 0.734 0.629 0.00
  64 -1.060058397e+09 +1.13311490e+09 1.35e+03 3.7e+00 1.9e-01 0.734 0.629 0.00
  65 -1.059961180e+09 +1.13292047e+09 1.72e+03 4.5e+00 1.9e-01 0.735 0.629 0.00
  66 -1.059840344e+09 +1.13267880e+09 2.13e+03 5.4e+00 2.3e-01 0.735 0.629 0.00
  67 -1.059689029e+09 +1.13237616e+09 2.43e+03 5.8e+00 2.7e-01 0.735 0.630 0.00
  68 -1.059499666e+09 +1.13199744e+09 2.23e+03 6.7e+00 3.2e-01 0.735 0.630 0.00
  69 -1.059267381e+09 +1.13153287e+09 2.82e+03 7.8e+00 3.8e-01 0.735 0.631 0.00
  70 -1.058994994e+09 +1.13098810e+09 3.25e+03 8.5e+00 4.4e-01 0.735 0.632 0.00
  71 -1.058697823e+09 +1.13039375e+09 3.37e+03 8.8e+00 4.9e-01 0.735 0.633 0.00
  72 -1.058401930e+09 +1.12980197e+09 3.13e+03 8.5e+00 4.9e-01 0.735 0.634 0.00
  73 -1.058133923e+09 +1.12926595e+09 3.04e+03 7.6e+00 4.4e-01 0.734 0.636 0.00
  74 -1.057908925e+09 +1.12881596e+09 3.14e+03 6.2e+00 3.9e-01 0.733 0.637 0.00
  75 -1.057729260e+09 +1.12845663e+09 2.98e+03 4.9e+00 3.5e-01 0.733 0.639 0.00
  76 -1.057592186e+09 +1.12818248e+09 2.70e+03 4.1e+00 3.9e-01 0.732 0.641 0.00
  77 -1.057491373e+09 +1.12798085e+09 2.35e+03 3.6e+00 2.3e-01 0.731 0.643 0.00
  78 -1.057416961e+09 +1.12783203e+09 2.02e+03 3.0e+00 1.8e-01 0.730 0.645 0.00
  79 -1.057361237e+09 +1.12772058e+09 1.72e+03 2.5e+00 1.4e-01 0.729 0.646 0.00
  80 -1.057318502e+09 +1.12763511e+09 1.49e+03 2.0e+00 1.2e-01 0.729 0.647 0.00
  81 -1.057284932e+09 +1.12756797e+09 1.32e+03 1.8e+00 1.0e-01 0.728 0.648 0.00
  82 -1.057257876e+09 +1.12751386e+09 1.22e+03 1.6e+00 8.6e-02 0.728 0.649 0.00
  83 -1.057235648e+09 +1.12746940e+09 1.18e+03 1.4e+00 7.6e-02 0.727 0.650 0.00
  84 -1.057217105e+09 +1.12743232e+09 1.15e+03 1.4e+00 6.7e-02 0.727 0.651 0.00
  85 -1.057201409e+09 +1.12740093e+09 1.10e+03 1.3e+00 6.1e-02 0.727 0.651 0.00
  86 -1.057187976e+09 +1.12737406e+09 1.05e+03 1.2e+00 5.5e-02 0.727 0.652 0.00
  87 -1.057176365e+09 +1.12735084e+09 1.00e+03 1.2e+00 5.0e-02 0.727 0.652 0.00
  88 -1.057166232e+09 +1.12733057e+09 9.56e+02 1.1e+00 4.6e-02 0.726 0.653 0.00
  89 -1.057157314e+09 +1.12731274e+09 9.08e+02 1.0e+00 4.2e-02 0.726 0.653 0.00
  90 -1.057149408e+09 +1.12729692e+09 8.66e+02 1.0e+00 3.9e-02 0.726 0.653 0.00
  91 -1.057142351e+09 +1.12728281e+09 8.26e+02 9.6e-01 3.6e-02 0.726 0.653 0.00
  92 -1.057136013e+09 +1.12727013e+09 7.86e+02 9.1e-01 3.3e-02 0.726 0.654 0.00
  93 -1.057130287e+09 +1.12725868e+09 7.47e+02 8.7e-01 3.0e-02 0.726 0.654 0.00
  94 -1.057125087e+09 +1.12724828e+09 7.04e+02 8.4e-01 2.8e-02 0.725 0.654 0.00
  95 -1.057120337e+09 +1.12723878e+09 6.65e+02 8.1e-01 2.6e-02 0.725 0.654 0.00
  96 -1.057115975e+09 +1.12723006e+09 6.30e+02 7.8e-01 2.4e-02 0.725 0.655 0.00
  97 -1.057111957e+09 +1.12722202e+09 5.97e+02 7.5e-01 2.3e-02 0.725 0.655 0.00
  98 -1.057108243e+09 +1.12721459e+09 5.67e+02 7.2e-01 2.1e-02 0.725 0.655 0.00
  99 -1.057104798e+09 +1.12720770e+09 5.39e+02 7.0e-01 2.0e-02 0.725 0.655 0.00
 100 -1.057101596e+09 +1.12720130e+09 5.13e+02 6.7e-01 2.0e-02 0.725 0.655 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
162398.61  10454.76  65619.74 
