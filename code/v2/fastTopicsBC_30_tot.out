
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 30"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-30 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.044437191e+09 +1.10423765e+09 7.34e+04 1.4e+02 2.9e+00 0.568 0.367 0.00
   2 -1.018429029e+09 +1.05222133e+09 3.79e+04 6.3e+01 5.9e+00 0.547 0.462 0.00
   3 -1.010111943e+09 +1.03558715e+09 1.59e+04 3.5e+01 2.8e+00 0.550 0.483 0.00
   4 -1.006158607e+09 +1.02768048e+09 1.45e+04 3.0e+01 1.4e+00 0.557 0.494 0.00
   5 -1.003872747e+09 +1.02310876e+09 1.08e+04 2.2e+01 1.4e+00 0.562 0.500 0.00
   6 -1.002337188e+09 +1.02003764e+09 5.63e+03 1.9e+01 1.3e+00 0.568 0.504 0.00
   7 -1.001149306e+09 +1.01766188e+09 4.33e+03 1.9e+01 9.3e-01 0.573 0.506 0.00
   8 -1.000171404e+09 +1.01570608e+09 5.38e+03 2.1e+01 8.2e-01 0.577 0.506 0.00
   9 -9.993137312e+08 +1.01399073e+09 5.04e+03 2.4e+01 9.0e-01 0.581 0.506 0.00
  10 -9.985374371e+08 +1.01243814e+09 4.42e+03 2.7e+01 9.7e-01 0.585 0.505 0.00
  11 -9.978225898e+08 +1.01100845e+09 3.46e+03 2.9e+01 1.0e+00 0.589 0.504 0.00
  12 -9.971526365e+08 +1.00966854e+09 3.00e+03 2.9e+01 1.0e+00 0.591 0.503 0.00
  13 -9.965357219e+08 +1.00843471e+09 3.09e+03 2.8e+01 1.1e+00 0.594 0.503 0.00
  14 -9.960167987e+08 +1.00739687e+09 2.97e+03 2.5e+01 1.1e+00 0.596 0.502 0.00
  15 -9.956301115e+08 +1.00662349e+09 2.98e+03 2.2e+01 8.2e-01 0.598 0.502 0.00
  16 -9.953533580e+08 +1.00606998e+09 3.08e+03 1.9e+01 5.8e-01 0.599 0.501 0.00
  17 -9.951421925e+08 +1.00564765e+09 3.18e+03 1.8e+01 3.9e-01 0.601 0.501 0.00
  18 -9.949646268e+08 +1.00529252e+09 3.20e+03 1.6e+01 3.7e-01 0.602 0.500 0.00
  19 -9.948023238e+08 +1.00496792e+09 2.64e+03 1.4e+01 3.6e-01 0.603 0.500 0.00
  20 -9.946443636e+08 +1.00465199e+09 2.41e+03 1.2e+01 4.5e-01 0.604 0.499 0.00
  21 -9.944858627e+08 +1.00433499e+09 3.10e+03 1.0e+01 6.4e-01 0.606 0.499 0.00
  22 -9.943268493e+08 +1.00401697e+09 3.73e+03 8.8e+00 7.5e-01 0.607 0.498 0.00
  23 -9.941696016e+08 +1.00370247e+09 4.42e+03 8.6e+00 7.8e-01 0.608 0.498 0.00
  24 -9.940185037e+08 +1.00340028e+09 5.22e+03 9.4e+00 6.4e-01 0.610 0.497 0.00
  25 -9.938770950e+08 +1.00311746e+09 6.10e+03 1.0e+01 5.2e-01 0.611 0.496 0.00
  26 -9.937469415e+08 +1.00285715e+09 6.96e+03 1.1e+01 5.2e-01 0.612 0.495 0.00
  27 -9.936281065e+08 +1.00261948e+09 7.59e+03 1.2e+01 5.0e-01 0.613 0.494 0.00
  28 -9.935195207e+08 +1.00240231e+09 7.70e+03 1.2e+01 4.5e-01 0.613 0.494 0.00
  29 -9.934198971e+08 +1.00220306e+09 6.98e+03 1.2e+01 3.8e-01 0.614 0.493 0.00
  30 -9.933278539e+08 +1.00201898e+09 5.47e+03 1.2e+01 3.2e-01 0.614 0.493 0.00
  31 -9.932423079e+08 +1.00184788e+09 3.66e+03 1.1e+01 2.7e-01 0.614 0.493 0.00
  32 -9.931623140e+08 +1.00168790e+09 2.81e+03 9.5e+00 2.2e-01 0.615 0.493 0.00
  33 -9.930869303e+08 +1.00153713e+09 2.06e+03 8.5e+00 2.1e-01 0.615 0.493 0.00
  34 -9.930153244e+08 +1.00139392e+09 4.00e+03 8.7e+00 2.1e-01 0.615 0.494 0.00
  35 -9.929468646e+08 +1.00125700e+09 5.56e+03 8.7e+00 2.1e-01 0.615 0.494 0.00
  36 -9.928811284e+08 +1.00112552e+09 6.69e+03 8.6e+00 2.2e-01 0.614 0.495 0.00
  37 -9.928175892e+08 +1.00099845e+09 7.74e+03 8.5e+00 2.2e-01 0.614 0.495 0.00
  38 -9.927556506e+08 +1.00087457e+09 9.42e+03 8.3e+00 2.2e-01 0.614 0.495 0.00
  39 -9.926951615e+08 +1.00075359e+09 1.07e+04 8.9e+00 2.2e-01 0.613 0.496 0.00
  40 -9.926357994e+08 +1.00063487e+09 1.16e+04 9.4e+00 2.1e-01 0.613 0.496 0.00
  41 -9.925771706e+08 +1.00051761e+09 1.22e+04 9.7e+00 2.1e-01 0.612 0.497 0.00
  42 -9.925188202e+08 +1.00040091e+09 1.28e+04 9.9e+00 2.0e-01 0.612 0.497 0.00
  43 -9.924604234e+08 +1.00028411e+09 1.31e+04 1.0e+01 2.0e-01 0.611 0.498 0.00
  44 -9.924018473e+08 +1.00016696e+09 1.33e+04 1.0e+01 2.0e-01 0.611 0.498 0.00
  45 -9.923437409e+08 +1.00005075e+09 1.32e+04 1.0e+01 1.9e-01 0.611 0.499 0.00
  46 -9.922906027e+08 +9.99944473e+08 1.36e+04 7.9e+00 1.9e-01 0.610 0.500 0.00
  47 -9.922455270e+08 +9.99854322e+08 1.16e+04 6.0e+00 1.9e-01 0.610 0.500 0.00
  48 -9.922050780e+08 +9.99773424e+08 8.26e+03 4.8e+00 1.9e-01 0.610 0.501 0.00
  49 -9.921675997e+08 +9.99698467e+08 5.25e+03 4.5e+00 1.8e-01 0.609 0.501 0.00
  50 -9.921321591e+08 +9.99627586e+08 2.40e+03 4.3e+00 1.8e-01 0.609 0.502 0.00
  51 -9.920982576e+08 +9.99559783e+08 1.10e+03 4.0e+00 1.7e-01 0.609 0.503 0.00
  52 -9.920654667e+08 +9.99494201e+08 1.04e+03 3.7e+00 1.7e-01 0.608 0.503 0.00
  53 -9.920337886e+08 +9.99430845e+08 9.73e+02 3.6e+00 1.6e-01 0.608 0.504 0.00
  54 -9.920033515e+08 +9.99369971e+08 9.12e+02 3.5e+00 1.6e-01 0.608 0.504 0.00
  55 -9.919741713e+08 +9.99311610e+08 9.52e+02 3.4e+00 1.5e-01 0.607 0.505 0.00
  56 -9.919463232e+08 +9.99255914e+08 1.03e+03 3.3e+00 1.5e-01 0.607 0.505 0.00
  57 -9.919199935e+08 +9.99203255e+08 1.12e+03 3.1e+00 1.4e-01 0.607 0.506 0.00
  58 -9.918953092e+08 +9.99153886e+08 1.17e+03 2.9e+00 1.3e-01 0.606 0.507 0.00
  59 -9.918724436e+08 +9.99108155e+08 1.21e+03 2.8e+00 1.3e-01 0.606 0.507 0.00
  60 -9.918513908e+08 +9.99066049e+08 1.27e+03 2.7e+00 1.2e-01 0.606 0.508 0.00
  61 -9.918320942e+08 +9.99027456e+08 1.35e+03 2.5e+00 1.1e-01 0.605 0.508 0.00
  62 -9.918144817e+08 +9.98992231e+08 1.45e+03 2.3e+00 1.1e-01 0.605 0.509 0.00
  63 -9.917983069e+08 +9.98959882e+08 1.54e+03 2.1e+00 9.8e-02 0.605 0.509 0.00
  64 -9.917833204e+08 +9.98929909e+08 1.65e+03 2.0e+00 9.1e-02 0.605 0.509 0.00
  65 -9.917692864e+08 +9.98901841e+08 1.77e+03 1.8e+00 8.8e-02 0.605 0.509 0.00
  66 -9.917559094e+08 +9.98875087e+08 1.89e+03 1.7e+00 8.3e-02 0.605 0.510 0.00
  67 -9.917429107e+08 +9.98849089e+08 2.02e+03 1.6e+00 9.0e-02 0.604 0.510 0.00
  68 -9.917300411e+08 +9.98823350e+08 2.16e+03 1.6e+00 9.7e-02 0.604 0.510 0.00
  69 -9.917170384e+08 +9.98797345e+08 2.31e+03 1.6e+00 1.0e-01 0.604 0.510 0.00
  70 -9.917036246e+08 +9.98770517e+08 2.48e+03 1.5e+00 1.1e-01 0.604 0.510 0.00
  71 -9.916894987e+08 +9.98742265e+08 2.65e+03 1.6e+00 1.2e-01 0.604 0.510 0.00
  72 -9.916743961e+08 +9.98712060e+08 2.84e+03 1.6e+00 1.2e-01 0.604 0.511 0.00
  73 -9.916580629e+08 +9.98679394e+08 3.05e+03 1.7e+00 1.3e-01 0.604 0.511 0.00
  74 -9.916402956e+08 +9.98643859e+08 3.27e+03 1.7e+00 1.3e-01 0.604 0.511 0.00
  75 -9.916209808e+08 +9.98605229e+08 3.49e+03 1.8e+00 1.3e-01 0.604 0.511 0.00
  76 -9.916000744e+08 +9.98563417e+08 3.71e+03 1.9e+00 1.3e-01 0.603 0.511 0.00
  77 -9.915776609e+08 +9.98518590e+08 3.92e+03 1.9e+00 1.4e-01 0.603 0.511 0.00
  78 -9.915539482e+08 +9.98471164e+08 4.12e+03 1.9e+00 1.4e-01 0.603 0.511 0.00
  79 -9.915292659e+08 +9.98421800e+08 4.31e+03 1.9e+00 1.3e-01 0.603 0.511 0.00
  80 -9.915041100e+08 +9.98371488e+08 4.57e+03 1.9e+00 1.2e-01 0.603 0.511 0.00
  81 -9.914791167e+08 +9.98321501e+08 5.03e+03 1.9e+00 1.1e-01 0.603 0.512 0.00
  82 -9.914547741e+08 +9.98272816e+08 5.27e+03 1.8e+00 1.1e-01 0.603 0.512 0.00
  83 -9.914316202e+08 +9.98226508e+08 5.33e+03 1.8e+00 1.0e-01 0.602 0.512 0.00
  84 -9.914100293e+08 +9.98183326e+08 5.29e+03 1.8e+00 1.0e-01 0.602 0.512 0.00
  85 -9.913902191e+08 +9.98143706e+08 5.21e+03 1.7e+00 7.9e-02 0.602 0.512 0.00
  86 -9.913722762e+08 +9.98107820e+08 5.13e+03 1.6e+00 7.2e-02 0.602 0.512 0.00
  87 -9.913561643e+08 +9.98075596e+08 5.25e+03 1.6e+00 6.6e-02 0.601 0.512 0.00
  88 -9.913418267e+08 +9.98046921e+08 5.07e+03 1.5e+00 6.3e-02 0.601 0.513 0.00
  89 -9.913290898e+08 +9.98021447e+08 4.83e+03 1.4e+00 6.0e-02 0.601 0.513 0.00
  90 -9.913177465e+08 +9.97998761e+08 4.57e+03 1.4e+00 5.7e-02 0.601 0.513 0.00
  91 -9.913076474e+08 +9.97978563e+08 4.31e+03 1.3e+00 5.4e-02 0.601 0.513 0.00
  92 -9.912987104e+08 +9.97960689e+08 4.02e+03 1.2e+00 5.1e-02 0.601 0.513 0.00
  93 -9.912907514e+08 +9.97944771e+08 3.71e+03 1.2e+00 4.8e-02 0.601 0.513 0.00
  94 -9.912836139e+08 +9.97930496e+08 3.47e+03 1.1e+00 4.5e-02 0.600 0.513 0.00
  95 -9.912771728e+08 +9.97917613e+08 3.25e+03 1.1e+00 4.3e-02 0.600 0.513 0.00
  96 -9.912713273e+08 +9.97905922e+08 3.07e+03 1.0e+00 4.0e-02 0.600 0.513 0.00
  97 -9.912659974e+08 +9.97895263e+08 2.91e+03 1.0e+00 3.8e-02 0.600 0.513 0.00
  98 -9.912611202e+08 +9.97885508e+08 2.78e+03 9.7e-01 3.7e-02 0.600 0.513 0.00
  99 -9.912566438e+08 +9.97876555e+08 2.66e+03 9.4e-01 3.6e-02 0.600 0.513 0.00
 100 -9.912525149e+08 +9.97868298e+08 2.56e+03 9.2e-01 3.6e-02 0.600 0.513 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
448679.39  16143.18 142467.23 
