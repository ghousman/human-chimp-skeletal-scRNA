
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 30"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-30 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.053065154e+09 +1.11912841e+09 8.51e+04 2.1e+02 4.0e+00 0.622 0.315 0.00
   2 -1.020024583e+09 +1.05304727e+09 5.38e+04 8.0e+01 7.4e+00 0.599 0.420 0.00
   3 -1.009965398e+09 +1.03292890e+09 5.80e+04 5.3e+01 3.5e+00 0.602 0.446 0.00
   4 -1.005316946e+09 +1.02363200e+09 3.08e+04 3.8e+01 2.1e+00 0.606 0.451 0.00
   5 -1.002610995e+09 +1.01822010e+09 1.49e+04 2.9e+01 1.3e+00 0.610 0.452 0.00
   6 -1.000740880e+09 +1.01447987e+09 1.16e+04 2.8e+01 1.1e+00 0.614 0.453 0.00
   7 -9.993847743e+08 +1.01176766e+09 1.12e+04 2.7e+01 1.2e+00 0.616 0.454 0.00
   8 -9.983678852e+08 +1.00973388e+09 9.19e+03 2.7e+01 1.3e+00 0.619 0.456 0.00
   9 -9.976039699e+08 +1.00820605e+09 7.36e+03 2.5e+01 1.3e+00 0.621 0.457 0.00
  10 -9.970255971e+08 +1.00704930e+09 7.27e+03 2.3e+01 1.3e+00 0.622 0.458 0.00
  11 -9.965728205e+08 +1.00614375e+09 6.81e+03 2.3e+01 1.3e+00 0.624 0.458 0.00
  12 -9.962137026e+08 +1.00542551e+09 5.88e+03 2.3e+01 1.7e+00 0.625 0.458 0.00
  13 -9.959279219e+08 +1.00485395e+09 4.81e+03 2.4e+01 1.3e+00 0.626 0.458 0.00
  14 -9.956974907e+08 +1.00439309e+09 4.70e+03 2.4e+01 5.6e-01 0.627 0.459 0.00
  15 -9.955079749e+08 +1.00401406e+09 5.25e+03 2.3e+01 4.1e-01 0.628 0.459 0.00
  16 -9.953481122e+08 +1.00369433e+09 6.14e+03 2.2e+01 3.6e-01 0.628 0.459 0.00
  17 -9.952088970e+08 +1.00341590e+09 5.88e+03 2.1e+01 3.7e-01 0.628 0.459 0.00
  18 -9.950856097e+08 +1.00316933e+09 5.01e+03 1.9e+01 4.1e-01 0.629 0.460 0.00
  19 -9.949704589e+08 +1.00293903e+09 4.51e+03 1.7e+01 4.7e-01 0.629 0.460 0.00
  20 -9.948463521e+08 +1.00269081e+09 3.74e+03 1.5e+01 1.3e+00 0.629 0.460 0.00
  21 -9.947451665e+08 +1.00248844e+09 3.56e+03 1.4e+01 1.0e+00 0.629 0.461 0.00
  22 -9.946604107e+08 +1.00231893e+09 3.41e+03 1.3e+01 4.9e-01 0.628 0.461 0.00
  23 -9.945861175e+08 +1.00217034e+09 3.30e+03 1.2e+01 3.8e-01 0.628 0.461 0.00
  24 -9.945205462e+08 +1.00203920e+09 3.22e+03 1.1e+01 3.4e-01 0.627 0.462 0.00
  25 -9.944626891e+08 +1.00192349e+09 3.13e+03 1.0e+01 3.0e-01 0.627 0.462 0.00
  26 -9.944114625e+08 +1.00182103e+09 3.04e+03 9.6e+00 2.6e-01 0.626 0.462 0.00
  27 -9.943657304e+08 +1.00172957e+09 2.96e+03 8.9e+00 2.2e-01 0.626 0.462 0.00
  28 -9.943245662e+08 +1.00164724e+09 2.87e+03 8.2e+00 1.9e-01 0.625 0.463 0.00
  29 -9.942873438e+08 +1.00157280e+09 2.78e+03 7.6e+00 1.9e-01 0.625 0.463 0.00
  30 -9.942535233e+08 +1.00150515e+09 2.70e+03 7.0e+00 2.0e-01 0.624 0.464 0.00
  31 -9.942226483e+08 +1.00144340e+09 2.22e+03 6.4e+00 2.0e-01 0.624 0.464 0.00
  32 -9.941944195e+08 +1.00138695e+09 2.32e+03 6.0e+00 2.0e-01 0.624 0.464 0.00
  33 -9.941689315e+08 +1.00133597e+09 2.63e+03 5.2e+00 1.9e-01 0.623 0.465 0.00
  34 -9.941463245e+08 +1.00129076e+09 2.83e+03 4.5e+00 1.8e-01 0.623 0.465 0.00
  35 -9.941259902e+08 +1.00125009e+09 2.91e+03 4.0e+00 1.7e-01 0.623 0.466 0.00
  36 -9.941075540e+08 +1.00121322e+09 2.89e+03 3.6e+00 1.5e-01 0.622 0.466 0.00
  37 -9.940908458e+08 +1.00117980e+09 2.63e+03 3.3e+00 1.5e-01 0.622 0.466 0.00
  38 -9.940754770e+08 +1.00114906e+09 2.38e+03 3.0e+00 1.4e-01 0.621 0.467 0.00
  39 -9.940611755e+08 +1.00112046e+09 2.18e+03 2.8e+00 1.4e-01 0.621 0.467 0.00
  40 -9.940477421e+08 +1.00109359e+09 2.03e+03 2.6e+00 1.4e-01 0.621 0.467 0.00
  41 -9.940350321e+08 +1.00106817e+09 1.92e+03 2.4e+00 1.4e-01 0.621 0.468 0.00
  42 -9.940229074e+08 +1.00104392e+09 1.87e+03 2.5e+00 1.3e-01 0.620 0.468 0.00
  43 -9.940112911e+08 +1.00102069e+09 1.86e+03 2.6e+00 1.3e-01 0.620 0.468 0.00
  44 -9.940000600e+08 +1.00099823e+09 1.88e+03 2.7e+00 1.3e-01 0.620 0.469 0.00
  45 -9.939890929e+08 +1.00097629e+09 1.92e+03 2.9e+00 1.4e-01 0.619 0.469 0.00
  46 -9.939783051e+08 +1.00095472e+09 1.95e+03 3.0e+00 1.4e-01 0.619 0.470 0.00
  47 -9.939676362e+08 +1.00093338e+09 1.99e+03 3.1e+00 1.5e-01 0.619 0.470 0.00
  48 -9.939570302e+08 +1.00091217e+09 2.00e+03 3.2e+00 1.5e-01 0.618 0.470 0.00
  49 -9.939464606e+08 +1.00089103e+09 2.00e+03 3.3e+00 1.6e-01 0.618 0.471 0.00
  50 -9.939359041e+08 +1.00086992e+09 2.08e+03 3.4e+00 1.7e-01 0.618 0.471 0.00
  51 -9.939253472e+08 +1.00084880e+09 2.20e+03 3.5e+00 1.8e-01 0.617 0.471 0.00
  52 -9.939148209e+08 +1.00082775e+09 2.14e+03 3.6e+00 1.9e-01 0.617 0.472 0.00
  53 -9.939044078e+08 +1.00080692e+09 2.11e+03 3.6e+00 1.9e-01 0.617 0.472 0.00
  54 -9.938941074e+08 +1.00078632e+09 1.88e+03 3.7e+00 2.0e-01 0.617 0.472 0.00
  55 -9.938839337e+08 +1.00076597e+09 1.79e+03 3.8e+00 2.0e-01 0.617 0.473 0.00
  56 -9.938738830e+08 +1.00074587e+09 1.78e+03 3.8e+00 2.0e-01 0.616 0.473 0.00
  57 -9.938639613e+08 +1.00072603e+09 1.78e+03 3.9e+00 2.1e-01 0.616 0.473 0.00
  58 -9.938541811e+08 +1.00070647e+09 1.78e+03 4.0e+00 2.2e-01 0.616 0.474 0.00
  59 -9.938445596e+08 +1.00068723e+09 1.78e+03 4.0e+00 2.2e-01 0.615 0.474 0.00
  60 -9.938350843e+08 +1.00066828e+09 1.76e+03 4.0e+00 2.3e-01 0.615 0.475 0.00
  61 -9.938257390e+08 +1.00064959e+09 1.74e+03 4.1e+00 2.4e-01 0.615 0.475 0.00
  62 -9.938165123e+08 +1.00063113e+09 1.72e+03 4.1e+00 2.5e-01 0.615 0.475 0.00
  63 -9.938073766e+08 +1.00061286e+09 1.68e+03 4.1e+00 2.6e-01 0.614 0.475 0.00
  64 -9.937982908e+08 +1.00059469e+09 1.65e+03 4.2e+00 2.8e-01 0.614 0.476 0.00
  65 -9.937891779e+08 +1.00057646e+09 1.61e+03 4.3e+00 3.0e-01 0.614 0.476 0.00
  66 -9.937799850e+08 +1.00055808e+09 1.57e+03 4.5e+00 3.2e-01 0.614 0.476 0.00
  67 -9.937706581e+08 +1.00053942e+09 1.52e+03 4.7e+00 3.4e-01 0.614 0.477 0.00
  68 -9.937611625e+08 +1.00052043e+09 1.48e+03 4.9e+00 3.6e-01 0.613 0.477 0.00
  69 -9.937514430e+08 +1.00050099e+09 1.44e+03 5.1e+00 3.8e-01 0.613 0.477 0.00
  70 -9.937414059e+08 +1.00048092e+09 1.40e+03 5.2e+00 4.1e-01 0.613 0.478 0.00
  71 -9.937309938e+08 +1.00046010e+09 1.34e+03 5.4e+00 4.4e-01 0.613 0.478 0.00
  72 -9.937201545e+08 +1.00043842e+09 1.43e+03 5.6e+00 4.8e-01 0.612 0.478 0.00
  73 -9.937087932e+08 +1.00041569e+09 1.53e+03 5.8e+00 5.2e-01 0.612 0.478 0.00
  74 -9.936968590e+08 +1.00039183e+09 1.62e+03 6.0e+00 5.5e-01 0.612 0.479 0.00
  75 -9.936844272e+08 +1.00036696e+09 1.71e+03 6.2e+00 5.8e-01 0.612 0.479 0.00
  76 -9.936715909e+08 +1.00034129e+09 1.79e+03 6.5e+00 5.9e-01 0.612 0.479 0.00
  77 -9.936585043e+08 +1.00031512e+09 1.83e+03 6.7e+00 5.8e-01 0.612 0.479 0.00
  78 -9.936450936e+08 +1.00028829e+09 1.86e+03 6.9e+00 5.7e-01 0.611 0.480 0.00
  79 -9.936313216e+08 +1.00026075e+09 1.88e+03 7.0e+00 5.5e-01 0.611 0.480 0.00
  80 -9.936171901e+08 +1.00023249e+09 1.88e+03 7.0e+00 5.4e-01 0.611 0.480 0.00
  81 -9.936027951e+08 +1.00020370e+09 1.87e+03 7.0e+00 5.2e-01 0.611 0.480 0.00
  82 -9.935884297e+08 +1.00017497e+09 1.84e+03 6.8e+00 5.0e-01 0.611 0.480 0.00
  83 -9.935743360e+08 +1.00014678e+09 1.79e+03 6.5e+00 4.7e-01 0.611 0.480 0.00
  84 -9.935607485e+08 +1.00011960e+09 1.72e+03 6.2e+00 4.2e-01 0.611 0.480 0.00
  85 -9.935478184e+08 +1.00009374e+09 1.63e+03 5.7e+00 3.7e-01 0.611 0.480 0.00
  86 -9.935356339e+08 +1.00006938e+09 1.53e+03 5.2e+00 3.2e-01 0.611 0.480 0.00
  87 -9.935241807e+08 +1.00004647e+09 1.43e+03 4.6e+00 2.6e-01 0.610 0.480 0.00
  88 -9.935133219e+08 +1.00002475e+09 1.33e+03 4.0e+00 2.2e-01 0.610 0.480 0.00
  89 -9.935028730e+08 +1.00000385e+09 1.26e+03 3.4e+00 1.8e-01 0.610 0.479 0.00
  90 -9.934926408e+08 +9.99983389e+08 1.22e+03 2.9e+00 1.4e-01 0.610 0.479 0.00
  91 -9.934824620e+08 +9.99963032e+08 1.19e+03 2.6e+00 1.2e-01 0.609 0.479 0.00
  92 -9.934721642e+08 +9.99942436e+08 1.16e+03 2.8e+00 9.4e-02 0.609 0.479 0.00
  93 -9.934616006e+08 +9.99921309e+08 1.13e+03 3.0e+00 7.8e-02 0.609 0.479 0.00
  94 -9.934506862e+08 +9.99899480e+08 1.11e+03 3.2e+00 6.9e-02 0.609 0.478 0.00
  95 -9.934393944e+08 +9.99876896e+08 1.24e+03 3.3e+00 7.2e-02 0.609 0.478 0.00
  96 -9.934277710e+08 +9.99853650e+08 1.36e+03 3.3e+00 7.5e-02 0.609 0.478 0.00
  97 -9.934158852e+08 +9.99829878e+08 1.45e+03 3.3e+00 7.8e-02 0.608 0.478 0.00
  98 -9.934038353e+08 +9.99805778e+08 1.56e+03 3.2e+00 8.4e-02 0.608 0.478 0.00
  99 -9.933917450e+08 +9.99781598e+08 1.67e+03 3.1e+00 8.6e-02 0.608 0.478 0.00
 100 -9.933796909e+08 +9.99757489e+08 1.80e+03 2.9e+00 8.7e-02 0.608 0.478 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
420976.92  14106.78 132098.83 
