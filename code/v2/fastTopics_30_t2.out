
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 30"
> print(paste0("data source: ",data.source))
[1] "data source: t2"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-30 Poisson NMF to 27151 x 17304 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -2.351815727e+08 +2.62168967e+08 3.65e+04 4.8e+02 4.7e+00 0.544 0.356 0.00
   2 -2.254030798e+08 +2.42611981e+08 9.66e+03 1.6e+02 6.0e+00 0.528 0.437 0.00
   3 -2.233019771e+08 +2.38409776e+08 2.99e+03 9.5e+01 2.1e+00 0.524 0.468 0.00
   4 -2.222668052e+08 +2.36339432e+08 2.70e+03 8.9e+01 2.2e+00 0.525 0.487 0.00
   5 -2.215222958e+08 +2.34850413e+08 3.08e+03 7.1e+01 1.8e+00 0.529 0.502 0.00
   6 -2.210292607e+08 +2.33864343e+08 3.16e+03 6.1e+01 1.3e+00 0.532 0.512 0.00
   7 -2.207076421e+08 +2.33221106e+08 2.11e+03 5.0e+01 1.1e+00 0.535 0.519 0.00
   8 -2.204899499e+08 +2.32785722e+08 1.13e+03 3.8e+01 9.8e-01 0.538 0.523 0.00
   9 -2.203315339e+08 +2.32468890e+08 1.24e+03 3.0e+01 5.8e-01 0.540 0.526 0.00
  10 -2.202080155e+08 +2.32221853e+08 6.61e+02 2.8e+01 5.6e-01 0.542 0.529 0.00
  11 -2.201046748e+08 +2.32015172e+08 5.84e+02 2.7e+01 5.2e-01 0.543 0.531 0.00
  12 -2.200118962e+08 +2.31829614e+08 7.31e+02 2.8e+01 5.3e-01 0.544 0.533 0.00
  13 -2.199239231e+08 +2.31653668e+08 8.18e+02 2.9e+01 5.2e-01 0.544 0.536 0.00
  14 -2.198375607e+08 +2.31480943e+08 8.81e+02 3.0e+01 5.0e-01 0.545 0.538 0.00
  15 -2.197504401e+08 +2.31306702e+08 7.65e+02 2.8e+01 5.4e-01 0.545 0.541 0.00
  16 -2.196577872e+08 +2.31121396e+08 7.38e+02 2.4e+01 5.5e-01 0.545 0.543 0.00
  17 -2.195536496e+08 +2.30913121e+08 5.74e+02 1.9e+01 6.9e-01 0.545 0.546 0.00
  18 -2.194361350e+08 +2.30678092e+08 6.33e+02 1.5e+01 9.0e-01 0.545 0.547 0.00
  19 -2.193149260e+08 +2.30435674e+08 7.13e+02 1.3e+01 1.1e+00 0.545 0.549 0.00
  20 -2.192135540e+08 +2.30232930e+08 7.27e+02 1.2e+01 8.3e-01 0.545 0.551 0.00
  21 -2.191374686e+08 +2.30080759e+08 7.62e+02 9.0e+00 5.5e-01 0.545 0.552 0.00
  22 -2.190828638e+08 +2.29971550e+08 8.28e+02 6.5e+00 5.0e-01 0.545 0.553 0.00
  23 -2.190422279e+08 +2.29890278e+08 9.07e+02 5.1e+00 5.0e-01 0.546 0.553 0.00
  24 -2.190085226e+08 +2.29822867e+08 9.80e+02 5.2e+00 4.6e-01 0.546 0.553 0.00
  25 -2.189772592e+08 +2.29760340e+08 1.04e+03 5.6e+00 4.9e-01 0.546 0.553 0.00
  26 -2.189436542e+08 +2.29693130e+08 1.11e+03 6.2e+00 6.7e-01 0.547 0.553 0.00
  27 -2.189123741e+08 +2.29630570e+08 8.10e+02 6.2e+00 6.5e-01 0.547 0.553 0.00
  28 -2.188894182e+08 +2.29584658e+08 4.02e+02 5.5e+00 2.9e-01 0.548 0.553 0.00
  29 -2.188713511e+08 +2.29548524e+08 3.87e+02 4.6e+00 2.0e-01 0.548 0.553 0.00
  30 -2.188560950e+08 +2.29518012e+08 4.80e+02 4.0e+00 1.9e-01 0.549 0.554 0.00
  31 -2.188427415e+08 +2.29491305e+08 4.94e+02 3.5e+00 2.0e-01 0.549 0.554 0.00
  32 -2.188307132e+08 +2.29467248e+08 4.74e+02 3.5e+00 2.2e-01 0.550 0.554 0.00
  33 -2.188195356e+08 +2.29444893e+08 4.00e+02 3.4e+00 2.4e-01 0.550 0.554 0.00
  34 -2.188088098e+08 +2.29423442e+08 2.78e+02 3.2e+00 2.7e-01 0.551 0.554 0.00
  35 -2.187982239e+08 +2.29402270e+08 2.89e+02 3.0e+00 3.0e-01 0.551 0.554 0.00
  36 -2.187875111e+08 +2.29380844e+08 3.02e+02 2.8e+00 3.4e-01 0.551 0.554 0.00
  37 -2.187765036e+08 +2.29358829e+08 3.18e+02 2.6e+00 3.9e-01 0.552 0.554 0.00
  38 -2.187650457e+08 +2.29335913e+08 3.32e+02 2.4e+00 4.3e-01 0.552 0.553 0.00
  39 -2.187530842e+08 +2.29311990e+08 3.43e+02 2.2e+00 4.8e-01 0.553 0.553 0.00
  40 -2.187408224e+08 +2.29287467e+08 3.45e+02 1.9e+00 5.8e-01 0.553 0.553 0.00
  41 -2.187287548e+08 +2.29263331e+08 3.31e+02 2.0e+00 6.8e-01 0.553 0.552 0.00
  42 -2.187175663e+08 +2.29240954e+08 2.99e+02 2.1e+00 7.4e-01 0.554 0.552 0.00
  43 -2.187079610e+08 +2.29221744e+08 2.57e+02 2.0e+00 7.5e-01 0.554 0.551 0.00
  44 -2.187003518e+08 +2.29206525e+08 2.09e+02 1.9e+00 6.8e-01 0.554 0.550 0.00
  45 -2.186947472e+08 +2.29195316e+08 1.66e+02 1.9e+00 5.3e-01 0.554 0.549 0.00
  46 -2.186907853e+08 +2.29187393e+08 1.31e+02 1.9e+00 3.3e-01 0.554 0.548 0.00
  47 -2.186879873e+08 +2.29181797e+08 1.01e+02 1.8e+00 2.3e-01 0.554 0.548 0.00
  48 -2.186859643e+08 +2.29177751e+08 7.91e+01 1.8e+00 1.5e-01 0.554 0.547 0.00
  49 -2.186844510e+08 +2.29174724e+08 6.48e+01 1.8e+00 1.0e-01 0.554 0.547 0.00
  50 -2.186832748e+08 +2.29172371e+08 5.37e+01 1.7e+00 7.4e-02 0.554 0.547 0.00
  51 -2.186823309e+08 +2.29170484e+08 5.09e+01 1.7e+00 5.5e-02 0.554 0.546 0.00
  52 -2.186815545e+08 +2.29168931e+08 4.85e+01 1.6e+00 4.9e-02 0.553 0.546 0.00
  53 -2.186809062e+08 +2.29167634e+08 4.61e+01 1.6e+00 4.2e-02 0.553 0.546 0.00
  54 -2.186803593e+08 +2.29166541e+08 4.36e+01 1.5e+00 3.8e-02 0.553 0.546 0.00
  55 -2.186798901e+08 +2.29165602e+08 4.13e+01 1.5e+00 3.7e-02 0.553 0.546 0.00
  56 -2.186794830e+08 +2.29164788e+08 3.91e+01 1.4e+00 3.4e-02 0.553 0.546 0.00
  57 -2.186791267e+08 +2.29164075e+08 3.70e+01 1.4e+00 3.1e-02 0.553 0.546 0.00
  58 -2.186788123e+08 +2.29163447e+08 3.50e+01 1.3e+00 2.8e-02 0.553 0.546 0.00
  59 -2.186785332e+08 +2.29162888e+08 3.31e+01 1.2e+00 2.4e-02 0.553 0.546 0.00
  60 -2.186782837e+08 +2.29162389e+08 3.13e+01 1.2e+00 2.2e-02 0.553 0.546 0.00
  61 -2.186780593e+08 +2.29161941e+08 2.96e+01 1.1e+00 2.0e-02 0.553 0.546 0.00
  62 -2.186778566e+08 +2.29161535e+08 2.80e+01 1.0e+00 1.8e-02 0.553 0.546 0.00
  63 -2.186776740e+08 +2.29161170e+08 2.65e+01 9.7e-01 1.6e-02 0.553 0.546 0.00
  64 -2.186775098e+08 +2.29160841e+08 2.54e+01 8.8e-01 1.5e-02 0.553 0.546 0.00
  65 -2.186773611e+08 +2.29160544e+08 2.44e+01 7.4e-01 1.4e-02 0.553 0.546 0.00
  66 -2.186772255e+08 +2.29160273e+08 2.33e+01 6.4e-01 1.3e-02 0.553 0.546 0.00
  67 -2.186771016e+08 +2.29160025e+08 2.21e+01 5.5e-01 1.2e-02 0.553 0.546 0.00
  68 -2.186769883e+08 +2.29159798e+08 2.11e+01 4.7e-01 1.1e-02 0.553 0.546 0.00
  69 -2.186768844e+08 +2.29159591e+08 2.01e+01 4.1e-01 1.0e-02 0.553 0.546 0.00
  70 -2.186767890e+08 +2.29159400e+08 1.92e+01 3.6e-01 9.3e-03 0.553 0.546 0.00
  71 -2.186767011e+08 +2.29159224e+08 2.00e+01 3.1e-01 8.8e-03 0.553 0.546 0.00
  72 -2.186766200e+08 +2.29159062e+08 1.97e+01 2.9e-01 8.5e-03 0.553 0.546 0.00
  73 -2.186765448e+08 +2.29158911e+08 1.87e+01 2.8e-01 8.1e-03 0.553 0.546 0.00
  74 -2.186764749e+08 +2.29158772e+08 1.77e+01 2.8e-01 7.8e-03 0.553 0.546 0.00
  75 -2.186764098e+08 +2.29158641e+08 1.68e+01 2.8e-01 7.6e-03 0.553 0.546 0.00
  76 -2.186763489e+08 +2.29158520e+08 1.60e+01 2.7e-01 7.3e-03 0.553 0.546 0.00
  77 -2.186762919e+08 +2.29158406e+08 1.53e+01 2.7e-01 7.0e-03 0.553 0.546 0.00
  78 -2.186762384e+08 +2.29158299e+08 1.46e+01 2.6e-01 6.7e-03 0.553 0.546 0.00
  79 -2.186761881e+08 +2.29158198e+08 1.39e+01 2.6e-01 6.5e-03 0.553 0.546 0.00
  80 -2.186761408e+08 +2.29158103e+08 1.32e+01 2.6e-01 6.3e-03 0.553 0.546 0.00
  81 -2.186760961e+08 +2.29158014e+08 1.26e+01 2.5e-01 6.0e-03 0.553 0.546 0.00
  82 -2.186760540e+08 +2.29157930e+08 1.20e+01 2.5e-01 5.8e-03 0.553 0.546 0.00
  83 -2.186760142e+08 +2.29157850e+08 1.14e+01 2.5e-01 5.6e-03 0.553 0.546 0.00
  84 -2.186759764e+08 +2.29157775e+08 1.08e+01 2.4e-01 5.4e-03 0.553 0.546 0.00
  85 -2.186759407e+08 +2.29157703e+08 1.03e+01 2.4e-01 5.2e-03 0.553 0.546 0.00
  86 -2.186759067e+08 +2.29157635e+08 9.84e+00 2.4e-01 5.0e-03 0.553 0.546 0.00
  87 -2.186758745e+08 +2.29157571e+08 9.44e+00 2.3e-01 4.9e-03 0.553 0.546 0.00
  88 -2.186758439e+08 +2.29157510e+08 1.84e+01 2.3e-01 4.7e-03 0.553 0.546 0.00
  89 -2.186758149e+08 +2.29157452e+08 2.50e+01 2.3e-01 4.6e-03 0.553 0.546 0.00
  90 -2.186757874e+08 +2.29157397e+08 2.57e+01 2.2e-01 4.5e-03 0.553 0.546 0.00
  91 -2.186757611e+08 +2.29157344e+08 2.43e+01 2.2e-01 4.5e-03 0.553 0.546 0.00
  92 -2.186757361e+08 +2.29157294e+08 2.26e+01 2.2e-01 4.4e-03 0.553 0.546 0.00
  93 -2.186757123e+08 +2.29157247e+08 2.10e+01 2.1e-01 4.3e-03 0.553 0.546 0.00
  94 -2.186756896e+08 +2.29157201e+08 1.96e+01 2.1e-01 4.3e-03 0.553 0.546 0.00
  95 -2.186756680e+08 +2.29157158e+08 1.83e+01 2.1e-01 4.2e-03 0.553 0.546 0.00
  96 -2.186756473e+08 +2.29157116e+08 1.71e+01 2.0e-01 4.2e-03 0.553 0.546 0.00
  97 -2.186756275e+08 +2.29157077e+08 1.59e+01 2.0e-01 4.1e-03 0.553 0.546 0.00
  98 -2.186756086e+08 +2.29157039e+08 1.48e+01 2.0e-01 4.1e-03 0.553 0.546 0.00
  99 -2.186755905e+08 +2.29157003e+08 1.38e+01 2.0e-01 4.1e-03 0.553 0.546 0.00
 100 -2.186755731e+08 +2.29156968e+08 1.28e+01 1.9e-01 4.0e-03 0.553 0.546 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
87038.572  1962.851 28182.253 
