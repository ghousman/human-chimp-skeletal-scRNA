
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 20"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-20 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.069561014e+09 +1.15448530e+09 7.47e+04 3.1e+02 7.7e+00 0.633 0.313 0.00
   2 -1.039178733e+09 +1.09372073e+09 2.30e+04 9.1e+01 9.6e+00 0.614 0.431 0.00
   3 -1.029520606e+09 +1.07440448e+09 9.21e+03 4.9e+01 4.1e+00 0.615 0.476 0.00
   4 -1.024246191e+09 +1.06385565e+09 9.58e+03 6.4e+01 2.9e+00 0.616 0.507 0.00
   5 -1.020524993e+09 +1.05641325e+09 7.37e+03 7.2e+01 2.0e+00 0.617 0.524 0.00
   6 -1.017783692e+09 +1.05093065e+09 6.47e+03 7.7e+01 1.2e+00 0.618 0.536 0.00
   7 -1.015880531e+09 +1.04712433e+09 7.30e+03 6.2e+01 9.1e-01 0.619 0.544 0.00
   8 -1.014570590e+09 +1.04450445e+09 6.98e+03 4.3e+01 9.3e-01 0.622 0.550 0.00
   9 -1.013673223e+09 +1.04270971e+09 6.45e+03 2.7e+01 8.1e-01 0.624 0.554 0.00
  10 -1.013048266e+09 +1.04145980e+09 5.72e+03 1.5e+01 7.1e-01 0.626 0.557 0.00
  11 -1.012601726e+09 +1.04056672e+09 5.51e+03 1.3e+01 6.7e-01 0.627 0.559 0.00
  12 -1.012274042e+09 +1.03991135e+09 5.70e+03 1.0e+01 4.7e-01 0.628 0.561 0.00
  13 -1.012025886e+09 +1.03941504e+09 5.23e+03 8.5e+00 4.1e-01 0.629 0.563 0.00
  14 -1.011830814e+09 +1.03902490e+09 5.04e+03 7.2e+00 3.9e-01 0.630 0.565 0.00
  15 -1.011674003e+09 +1.03871127e+09 4.86e+03 6.3e+00 3.3e-01 0.631 0.566 0.00
  16 -1.011546911e+09 +1.03845709e+09 4.34e+03 6.5e+00 3.0e-01 0.631 0.567 0.00
  17 -1.011442828e+09 +1.03824892e+09 3.80e+03 7.0e+00 2.7e-01 0.632 0.567 0.00
  18 -1.011356184e+09 +1.03807563e+09 3.28e+03 7.6e+00 2.5e-01 0.632 0.568 0.00
  19 -1.011283661e+09 +1.03793059e+09 2.90e+03 8.2e+00 2.2e-01 0.632 0.568 0.00
  20 -1.011222465e+09 +1.03780820e+09 2.59e+03 8.7e+00 2.3e-01 0.632 0.568 0.00
  21 -1.011170423e+09 +1.03770411e+09 2.35e+03 9.3e+00 2.4e-01 0.632 0.568 0.00
  22 -1.011125311e+09 +1.03761389e+09 2.15e+03 9.9e+00 2.6e-01 0.633 0.568 0.00
  23 -1.011085417e+09 +1.03753410e+09 1.04e+03 1.0e+01 2.7e-01 0.633 0.568 0.00
  24 -1.011049439e+09 +1.03746215e+09 9.88e+02 1.1e+01 2.9e-01 0.633 0.568 0.00
  25 -1.011016413e+09 +1.03739609e+09 8.01e+02 1.1e+01 3.0e-01 0.633 0.568 0.00
  26 -1.010985765e+09 +1.03733480e+09 6.46e+02 1.1e+01 3.1e-01 0.633 0.568 0.00
  27 -1.010957029e+09 +1.03727733e+09 4.85e+02 1.1e+01 3.4e-01 0.633 0.568 0.00
  28 -1.010929715e+09 +1.03722270e+09 3.58e+02 1.1e+01 3.6e-01 0.633 0.568 0.00
  29 -1.010903282e+09 +1.03716983e+09 2.84e+02 1.2e+01 3.5e-01 0.633 0.568 0.00
  30 -1.010877244e+09 +1.03711776e+09 2.55e+02 1.2e+01 3.3e-01 0.633 0.568 0.00
  31 -1.010851234e+09 +1.03706574e+09 2.44e+02 1.3e+01 3.0e-01 0.633 0.569 0.00
  32 -1.010825265e+09 +1.03701380e+09 2.41e+02 1.3e+01 3.0e-01 0.634 0.569 0.00
  33 -1.010799516e+09 +1.03696230e+09 2.36e+02 1.4e+01 3.0e-01 0.634 0.569 0.00
  34 -1.010774341e+09 +1.03691195e+09 2.32e+02 1.5e+01 2.9e-01 0.634 0.570 0.00
  35 -1.010749988e+09 +1.03686324e+09 2.27e+02 1.5e+01 2.7e-01 0.634 0.570 0.00
  36 -1.010726584e+09 +1.03681644e+09 2.73e+02 1.6e+01 2.4e-01 0.634 0.571 0.00
  37 -1.010704154e+09 +1.03677158e+09 3.09e+02 1.6e+01 2.4e-01 0.633 0.571 0.00
  38 -1.010682532e+09 +1.03672833e+09 3.38e+02 1.6e+01 2.3e-01 0.633 0.571 0.00
  39 -1.010661590e+09 +1.03668645e+09 3.66e+02 1.6e+01 2.1e-01 0.633 0.572 0.00
  40 -1.010641242e+09 +1.03664575e+09 3.89e+02 1.6e+01 1.9e-01 0.633 0.572 0.00
  41 -1.010621318e+09 +1.03660590e+09 4.05e+02 1.5e+01 1.8e-01 0.633 0.573 0.00
  42 -1.010601625e+09 +1.03656652e+09 4.28e+02 1.4e+01 1.9e-01 0.632 0.573 0.00
  43 -1.010581974e+09 +1.03652722e+09 4.31e+02 1.4e+01 2.1e-01 0.632 0.573 0.00
  44 -1.010562124e+09 +1.03648752e+09 4.29e+02 1.3e+01 2.3e-01 0.632 0.574 0.00
  45 -1.010541799e+09 +1.03644687e+09 4.19e+02 1.2e+01 2.6e-01 0.632 0.574 0.00
  46 -1.010520641e+09 +1.03640455e+09 4.02e+02 1.0e+01 2.8e-01 0.631 0.574 0.00
  47 -1.010498429e+09 +1.03636013e+09 3.81e+02 9.2e+00 3.0e-01 0.631 0.575 0.00
  48 -1.010474695e+09 +1.03631266e+09 3.60e+02 8.0e+00 3.2e-01 0.631 0.575 0.00
  49 -1.010448901e+09 +1.03626107e+09 3.49e+02 6.9e+00 3.4e-01 0.631 0.575 0.00
  50 -1.010420647e+09 +1.03620456e+09 3.52e+02 6.3e+00 3.6e-01 0.631 0.575 0.00
  51 -1.010389532e+09 +1.03614233e+09 3.50e+02 6.6e+00 3.5e-01 0.632 0.575 0.00
  52 -1.010355609e+09 +1.03607449e+09 3.39e+02 6.8e+00 3.4e-01 0.632 0.575 0.00
  53 -1.010319574e+09 +1.03600242e+09 3.27e+02 6.7e+00 3.7e-01 0.632 0.575 0.00
  54 -1.010282993e+09 +1.03592925e+09 3.14e+02 6.3e+00 4.0e-01 0.632 0.575 0.00
  55 -1.010248028e+09 +1.03585932e+09 3.34e+02 5.6e+00 4.3e-01 0.633 0.574 0.00
  56 -1.010216822e+09 +1.03579691e+09 4.54e+02 4.7e+00 4.3e-01 0.633 0.574 0.00
  57 -1.010190509e+09 +1.03574429e+09 5.33e+02 3.7e+00 3.9e-01 0.633 0.573 0.00
  58 -1.010169063e+09 +1.03570139e+09 5.77e+02 2.8e+00 3.0e-01 0.633 0.573 0.00
  59 -1.010151905e+09 +1.03566708e+09 6.10e+02 2.0e+00 2.6e-01 0.633 0.573 0.00
  60 -1.010138048e+09 +1.03563936e+09 6.33e+02 1.5e+00 2.4e-01 0.633 0.572 0.00
  61 -1.010126755e+09 +1.03561678e+09 6.40e+02 1.5e+00 2.2e-01 0.633 0.572 0.00
  62 -1.010117481e+09 +1.03559823e+09 6.32e+02 1.4e+00 1.8e-01 0.633 0.572 0.00
  63 -1.010109733e+09 +1.03558273e+09 6.15e+02 1.3e+00 1.5e-01 0.633 0.571 0.00
  64 -1.010103127e+09 +1.03556952e+09 5.91e+02 1.2e+00 1.2e-01 0.633 0.571 0.00
  65 -1.010097394e+09 +1.03555806e+09 5.63e+02 1.1e+00 1.3e-01 0.633 0.571 0.00
  66 -1.010092346e+09 +1.03554796e+09 6.01e+02 9.9e-01 1.3e-01 0.633 0.571 0.00
  67 -1.010087856e+09 +1.03553898e+09 6.01e+02 9.0e-01 1.1e-01 0.633 0.571 0.00
  68 -1.010083835e+09 +1.03553094e+09 5.89e+02 8.2e-01 9.4e-02 0.633 0.571 0.00
  69 -1.010080212e+09 +1.03552369e+09 5.71e+02 7.5e-01 8.3e-02 0.633 0.571 0.00
  70 -1.010076925e+09 +1.03551712e+09 5.41e+02 6.9e-01 7.9e-02 0.633 0.571 0.00
  71 -1.010073919e+09 +1.03551111e+09 4.98e+02 6.3e-01 7.4e-02 0.633 0.571 0.00
  72 -1.010071148e+09 +1.03550556e+09 4.55e+02 5.8e-01 7.0e-02 0.633 0.571 0.00
  73 -1.010068577e+09 +1.03550042e+09 4.13e+02 5.3e-01 6.5e-02 0.633 0.571 0.00
  74 -1.010066177e+09 +1.03549562e+09 3.74e+02 4.9e-01 6.1e-02 0.633 0.571 0.00
  75 -1.010063923e+09 +1.03549111e+09 3.37e+02 4.8e-01 5.7e-02 0.633 0.571 0.00
  76 -1.010061798e+09 +1.03548686e+09 3.01e+02 4.8e-01 5.3e-02 0.633 0.571 0.00
  77 -1.010059783e+09 +1.03548283e+09 2.68e+02 4.9e-01 5.0e-02 0.633 0.571 0.00
  78 -1.010057863e+09 +1.03547899e+09 2.36e+02 4.9e-01 4.7e-02 0.632 0.571 0.00
  79 -1.010056022e+09 +1.03547531e+09 2.05e+02 4.9e-01 4.4e-02 0.632 0.571 0.00
  80 -1.010054249e+09 +1.03547177e+09 1.76e+02 4.9e-01 4.1e-02 0.632 0.571 0.00
  81 -1.010052538e+09 +1.03546834e+09 1.54e+02 4.9e-01 3.8e-02 0.632 0.571 0.00
  82 -1.010050878e+09 +1.03546502e+09 1.61e+02 4.9e-01 3.8e-02 0.632 0.571 0.00
  83 -1.010049264e+09 +1.03546180e+09 1.67e+02 5.0e-01 3.8e-02 0.632 0.571 0.00
  84 -1.010047687e+09 +1.03545864e+09 1.75e+02 5.0e-01 3.8e-02 0.632 0.571 0.00
  85 -1.010046140e+09 +1.03545555e+09 1.82e+02 5.0e-01 3.8e-02 0.632 0.571 0.00
  86 -1.010044614e+09 +1.03545250e+09 1.89e+02 5.1e-01 3.8e-02 0.632 0.571 0.00
  87 -1.010043113e+09 +1.03544949e+09 1.93e+02 5.3e-01 3.8e-02 0.631 0.571 0.00
  88 -1.010041632e+09 +1.03544653e+09 1.94e+02 5.5e-01 3.8e-02 0.631 0.571 0.00
  89 -1.010040171e+09 +1.03544361e+09 2.08e+02 5.7e-01 3.8e-02 0.631 0.571 0.00
  90 -1.010038724e+09 +1.03544072e+09 2.23e+02 6.0e-01 3.7e-02 0.631 0.571 0.00
  91 -1.010037286e+09 +1.03543784e+09 2.38e+02 6.2e-01 3.7e-02 0.631 0.571 0.00
  92 -1.010035857e+09 +1.03543498e+09 2.54e+02 6.4e-01 3.7e-02 0.631 0.571 0.00
  93 -1.010034434e+09 +1.03543214e+09 2.70e+02 6.5e-01 3.7e-02 0.631 0.571 0.00
  94 -1.010033017e+09 +1.03542930e+09 2.87e+02 6.7e-01 3.7e-02 0.631 0.571 0.00
  95 -1.010031606e+09 +1.03542648e+09 3.03e+02 6.9e-01 3.7e-02 0.630 0.571 0.00
  96 -1.010030204e+09 +1.03542368e+09 3.19e+02 7.0e-01 3.6e-02 0.630 0.571 0.00
  97 -1.010028813e+09 +1.03542089e+09 3.35e+02 7.1e-01 3.6e-02 0.630 0.571 0.00
  98 -1.010027431e+09 +1.03541813e+09 3.51e+02 7.3e-01 3.6e-02 0.630 0.571 0.00
  99 -1.010026055e+09 +1.03541538e+09 3.67e+02 7.4e-01 3.5e-02 0.630 0.571 0.00
 100 -1.010024682e+09 +1.03541263e+09 3.83e+02 7.5e-01 3.5e-02 0.630 0.571 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
297806.93  12637.04 103471.38 
