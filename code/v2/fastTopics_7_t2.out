
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 7"
> print(paste0("data source: ",data.source))
[1] "data source: t2"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-7 Poisson NMF to 27151 x 17304 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -2.510257022e+08 +2.93857226e+08 2.74e+04 1.3e+02 3.6e+00 0.753 0.592 0.00
   2 -2.443132795e+08 +2.80432381e+08 3.71e+04 7.4e+01 4.0e+00 0.766 0.761 0.00
   3 -2.417032461e+08 +2.75212314e+08 1.03e+04 5.7e+01 2.7e+00 0.754 0.707 0.00
   4 -2.407222007e+08 +2.73250223e+08 3.11e+03 3.6e+01 1.7e+00 0.751 0.722 0.00
   5 -2.403935514e+08 +2.72592925e+08 7.08e+02 2.6e+01 6.6e-01 0.749 0.724 0.00
   6 -2.402446629e+08 +2.72295148e+08 6.17e+02 2.0e+01 3.2e-01 0.748 0.724 0.00
   7 -2.401487393e+08 +2.72103301e+08 8.67e+02 1.6e+01 2.2e-01 0.747 0.723 0.00
   8 -2.400546966e+08 +2.71915215e+08 6.86e+03 1.3e+01 2.1e-01 0.748 0.724 0.00
   9 -2.399094032e+08 +2.71624628e+08 5.12e+02 1.7e+01 2.3e-01 0.749 0.726 0.00
  10 -2.397250085e+08 +2.71255839e+08 5.38e+02 1.2e+01 2.8e-01 0.750 0.731 0.00
  11 -2.395516131e+08 +2.70909048e+08 5.24e+02 1.1e+01 3.1e-01 0.752 0.735 0.00
  12 -2.393850458e+08 +2.70575913e+08 5.01e+02 1.0e+01 3.2e-01 0.755 0.738 0.00
  13 -2.392307901e+08 +2.70267402e+08 4.65e+02 8.2e+00 3.3e-01 0.759 0.740 0.00
  14 -2.390937247e+08 +2.69993271e+08 4.12e+02 7.0e+00 3.5e-01 0.762 0.742 0.00
  15 -2.389808248e+08 +2.69767471e+08 3.61e+02 6.8e+00 4.6e-01 0.765 0.742 0.00
  16 -2.388938524e+08 +2.69593527e+08 3.55e+02 6.5e+00 5.7e-01 0.767 0.740 0.00
  17 -2.388292462e+08 +2.69464314e+08 2.99e+02 6.2e+00 6.3e-01 0.769 0.737 0.00
  18 -2.387817501e+08 +2.69369322e+08 2.34e+02 5.7e+00 6.1e-01 0.771 0.734 0.00
  19 -2.387482704e+08 +2.69302363e+08 2.53e+02 5.2e+00 6.0e-01 0.771 0.731 0.00
  20 -2.387275764e+08 +2.69260975e+08 1.60e+02 4.6e+00 6.8e-01 0.772 0.728 0.00
  21 -2.387164130e+08 +2.69238648e+08 1.44e+02 4.1e+00 2.8e-01 0.772 0.725 0.00
  22 -2.387097970e+08 +2.69225416e+08 1.29e+02 3.6e+00 1.8e-01 0.773 0.723 0.00
  23 -2.387054176e+08 +2.69216657e+08 1.15e+02 3.1e+00 1.2e-01 0.773 0.721 0.00
  24 -2.387022506e+08 +2.69210323e+08 8.77e+01 2.7e+00 6.1e-02 0.773 0.719 0.00
  25 -2.386997950e+08 +2.69205412e+08 8.47e+01 2.3e+00 3.9e-02 0.772 0.718 0.00
  26 -2.386977800e+08 +2.69201382e+08 8.18e+01 2.1e+00 2.3e-02 0.772 0.717 0.00
  27 -2.386960667e+08 +2.69197955e+08 7.89e+01 1.8e+00 2.2e-02 0.772 0.717 0.00
  28 -2.386945750e+08 +2.69194972e+08 7.60e+01 1.6e+00 2.2e-02 0.772 0.717 0.00
  29 -2.386932531e+08 +2.69192328e+08 7.30e+01 1.4e+00 2.2e-02 0.772 0.717 0.00
  30 -2.386920701e+08 +2.69189962e+08 7.01e+01 1.2e+00 2.2e-02 0.771 0.717 0.00
  31 -2.386910064e+08 +2.69187835e+08 6.73e+01 1.0e+00 2.1e-02 0.771 0.717 0.00
  32 -2.386900435e+08 +2.69185909e+08 6.45e+01 9.0e-01 2.1e-02 0.771 0.717 0.00
  33 -2.386891712e+08 +2.69184164e+08 6.18e+01 7.6e-01 2.1e-02 0.771 0.716 0.00
  34 -2.386883789e+08 +2.69182580e+08 5.91e+01 7.1e-01 2.0e-02 0.771 0.717 0.00
  35 -2.386876551e+08 +2.69181132e+08 5.64e+01 7.0e-01 2.0e-02 0.770 0.716 0.00
  36 -2.386869904e+08 +2.69179803e+08 5.39e+01 6.8e-01 1.9e-02 0.770 0.717 0.00
  37 -2.386863782e+08 +2.69178578e+08 5.16e+01 6.6e-01 1.9e-02 0.770 0.717 0.00
  38 -2.386858143e+08 +2.69177451e+08 4.92e+01 6.4e-01 1.8e-02 0.770 0.717 0.00
  39 -2.386852952e+08 +2.69176412e+08 4.68e+01 6.1e-01 1.8e-02 0.770 0.717 0.00
  40 -2.386848170e+08 +2.69175456e+08 4.46e+01 5.9e-01 1.7e-02 0.770 0.717 0.00
  41 -2.386843758e+08 +2.69174573e+08 4.25e+01 5.7e-01 1.6e-02 0.770 0.717 0.00
  42 -2.386839683e+08 +2.69173758e+08 4.05e+01 5.4e-01 1.6e-02 0.770 0.717 0.00
  43 -2.386835919e+08 +2.69173006e+08 3.86e+01 5.2e-01 1.5e-02 0.770 0.717 0.00
  44 -2.386832444e+08 +2.69172311e+08 3.67e+01 5.0e-01 1.5e-02 0.770 0.717 0.00
  45 -2.386829235e+08 +2.69171669e+08 3.50e+01 4.8e-01 1.4e-02 0.770 0.717 0.00
  46 -2.386826273e+08 +2.69171076e+08 3.33e+01 4.6e-01 1.4e-02 0.770 0.717 0.00
  47 -2.386823538e+08 +2.69170529e+08 3.17e+01 4.4e-01 1.3e-02 0.770 0.717 0.00
  48 -2.386821012e+08 +2.69170024e+08 3.02e+01 4.3e-01 1.3e-02 0.770 0.717 0.00
  49 -2.386818680e+08 +2.69169558e+08 2.88e+01 4.1e-01 1.2e-02 0.770 0.717 0.00
  50 -2.386816527e+08 +2.69169127e+08 2.74e+01 3.9e-01 1.2e-02 0.770 0.717 0.00
  51 -2.386814545e+08 +2.69168731e+08 2.61e+01 3.8e-01 1.1e-02 0.770 0.717 0.00
  52 -2.386812723e+08 +2.69168367e+08 2.47e+01 3.6e-01 1.1e-02 0.769 0.717 0.00
  53 -2.386811051e+08 +2.69168032e+08 2.35e+01 3.4e-01 1.0e-02 0.770 0.717 0.00
  54 -2.386809519e+08 +2.69167726e+08 2.23e+01 3.2e-01 9.7e-03 0.769 0.716 0.00
  55 -2.386808118e+08 +2.69167445e+08 2.12e+01 3.1e-01 9.2e-03 0.769 0.716 0.00
  56 -2.386806836e+08 +2.69167189e+08 2.01e+01 2.9e-01 8.8e-03 0.769 0.716 0.00
  57 -2.386805664e+08 +2.69166955e+08 1.91e+01 2.8e-01 8.4e-03 0.769 0.717 0.00
  58 -2.386804592e+08 +2.69166740e+08 1.81e+01 2.7e-01 8.0e-03 0.769 0.717 0.00
  59 -2.386803613e+08 +2.69166544e+08 1.72e+01 2.5e-01 7.6e-03 0.769 0.717 0.00
  60 -2.386802716e+08 +2.69166365e+08 1.64e+01 2.4e-01 7.3e-03 0.769 0.717 0.00
  61 -2.386801895e+08 +2.69166201e+08 1.56e+01 2.3e-01 6.9e-03 0.769 0.717 0.00
  62 -2.386801143e+08 +2.69166050e+08 1.48e+01 2.2e-01 6.6e-03 0.769 0.717 0.00
  63 -2.386800455e+08 +2.69165913e+08 1.41e+01 2.1e-01 6.4e-03 0.769 0.717 0.00
  64 -2.386799827e+08 +2.69165787e+08 1.34e+01 2.0e-01 6.1e-03 0.769 0.717 0.00
  65 -2.386799252e+08 +2.69165672e+08 1.28e+01 1.9e-01 5.8e-03 0.769 0.717 0.00
  66 -2.386798727e+08 +2.69165567e+08 1.21e+01 1.8e-01 5.6e-03 0.769 0.717 0.00
  67 -2.386798248e+08 +2.69165472e+08 1.15e+01 1.7e-01 5.3e-03 0.769 0.717 0.00
  68 -2.386797811e+08 +2.69165384e+08 1.10e+01 1.6e-01 5.1e-03 0.769 0.717 0.00
  69 -2.386797413e+08 +2.69165305e+08 1.05e+01 1.6e-01 4.8e-03 0.769 0.717 0.00
  70 -2.386797050e+08 +2.69165232e+08 9.95e+00 1.5e-01 4.6e-03 0.769 0.717 0.00
  71 -2.386796719e+08 +2.69165166e+08 9.47e+00 1.4e-01 4.4e-03 0.769 0.717 0.00
  72 -2.386796417e+08 +2.69165105e+08 9.00e+00 1.4e-01 4.2e-03 0.769 0.717 0.00
  73 -2.386796142e+08 +2.69165050e+08 8.56e+00 1.3e-01 4.0e-03 0.769 0.717 0.00
  74 -2.386795892e+08 +2.69165000e+08 8.02e+00 1.2e-01 3.8e-03 0.769 0.717 0.00
  75 -2.386795666e+08 +2.69164955e+08 7.57e+00 1.1e-01 3.7e-03 0.769 0.717 0.00
  76 -2.386795460e+08 +2.69164914e+08 7.16e+00 1.0e-01 3.5e-03 0.769 0.717 0.00
  77 -2.386795274e+08 +2.69164877e+08 6.78e+00 9.9e-02 3.3e-03 0.769 0.717 0.00
  78 -2.386795106e+08 +2.69164843e+08 6.42e+00 9.4e-02 3.4e-03 0.769 0.717 0.00
  79 -2.386794954e+08 +2.69164813e+08 6.08e+00 8.9e-02 3.3e-03 0.769 0.717 0.00
  80 -2.386794816e+08 +2.69164785e+08 5.76e+00 8.5e-02 3.1e-03 0.769 0.717 0.00
  81 -2.386794690e+08 +2.69164760e+08 5.46e+00 8.1e-02 3.0e-03 0.769 0.717 0.00
  82 -2.386794577e+08 +2.69164737e+08 5.20e+00 7.6e-02 2.9e-03 0.769 0.717 0.00
  83 -2.386794475e+08 +2.69164717e+08 4.94e+00 7.2e-02 2.7e-03 0.769 0.717 0.00
  84 -2.386794382e+08 +2.69164698e+08 4.70e+00 6.9e-02 2.6e-03 0.769 0.717 0.00
  85 -2.386794298e+08 +2.69164682e+08 4.47e+00 6.5e-02 2.5e-03 0.769 0.717 0.00
  86 -2.386794223e+08 +2.69164666e+08 4.25e+00 6.2e-02 2.4e-03 0.769 0.717 0.00
  87 -2.386794154e+08 +2.69164653e+08 4.04e+00 5.9e-02 2.2e-03 0.769 0.717 0.00
  88 -2.386794093e+08 +2.69164640e+08 3.84e+00 5.6e-02 2.1e-03 0.769 0.717 0.00
  89 -2.386794037e+08 +2.69164629e+08 3.65e+00 5.3e-02 2.0e-03 0.769 0.717 0.00
  90 -2.386793986e+08 +2.69164619e+08 3.47e+00 5.0e-02 1.9e-03 0.769 0.717 0.00
  91 -2.386793941e+08 +2.69164610e+08 3.30e+00 4.8e-02 1.8e-03 0.769 0.717 0.00
  92 -2.386793900e+08 +2.69164602e+08 3.13e+00 4.5e-02 1.7e-03 0.769 0.717 0.00
  93 -2.386793863e+08 +2.69164594e+08 2.98e+00 4.3e-02 1.6e-03 0.769 0.717 0.00
  94 -2.386793829e+08 +2.69164588e+08 2.83e+00 4.1e-02 1.6e-03 0.769 0.717 0.00
  95 -2.386793799e+08 +2.69164582e+08 2.69e+00 3.9e-02 1.5e-03 0.769 0.717 0.00
  96 -2.386793771e+08 +2.69164576e+08 2.55e+00 3.7e-02 1.4e-03 0.769 0.717 0.00
  97 -2.386793747e+08 +2.69164571e+08 2.43e+00 3.5e-02 1.3e-03 0.769 0.717 0.00
  98 -2.386793725e+08 +2.69164567e+08 2.30e+00 3.3e-02 1.3e-03 0.769 0.717 0.00
  99 -2.386793704e+08 +2.69164563e+08 2.19e+00 3.2e-02 1.2e-03 0.769 0.717 0.00
 100 -2.386793686e+08 +2.69164559e+08 2.08e+00 3.0e-02 1.1e-03 0.769 0.717 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
20803.748  1675.479 11987.737 
