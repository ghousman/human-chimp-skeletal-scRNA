
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 6"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-6 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.102032691e+09 +1.21942865e+09 3.83e+04 7.9e+01 1.1e+00 0.764 0.718 0.00
   2 -1.089766635e+09 +1.19489654e+09 1.12e+05 5.5e+01 2.1e+00 0.775 0.826 0.00
   3 -1.083624150e+09 +1.18261157e+09 2.16e+04 4.3e+01 2.2e+00 0.782 0.792 0.00
   4 -1.080311350e+09 +1.17598597e+09 1.84e+04 2.8e+01 1.5e+00 0.777 0.786 0.00
   5 -1.078758268e+09 +1.17287980e+09 8.42e+03 2.1e+01 1.4e+00 0.773 0.777 0.00
   6 -1.078046173e+09 +1.17145561e+09 6.55e+03 1.4e+01 6.1e-01 0.771 0.774 0.00
   7 -1.077680008e+09 +1.17072328e+09 5.32e+03 9.1e+00 4.0e-01 0.770 0.772 0.00
   8 -1.077472934e+09 +1.17030913e+09 4.38e+03 5.9e+00 2.7e-01 0.770 0.770 0.00
   9 -1.077350174e+09 +1.17006362e+09 3.52e+03 4.0e+00 1.8e-01 0.770 0.768 0.00
  10 -1.077272063e+09 +1.16990739e+09 2.78e+03 2.8e+00 1.3e-01 0.769 0.767 0.00
  11 -1.077218845e+09 +1.16980096e+09 2.24e+03 2.2e+00 1.0e-01 0.769 0.767 0.00
  12 -1.077179843e+09 +1.16972295e+09 1.82e+03 1.9e+00 8.8e-02 0.768 0.767 0.00
  13 -1.077149217e+09 +1.16966170e+09 1.49e+03 1.7e+00 7.8e-02 0.768 0.767 0.00
  14 -1.077123566e+09 +1.16961040e+09 1.23e+03 1.6e+00 7.1e-02 0.768 0.767 0.00
  15 -1.077100776e+09 +1.16956482e+09 1.03e+03 1.5e+00 6.8e-02 0.767 0.767 0.00
  16 -1.077079542e+09 +1.16952235e+09 8.72e+02 1.4e+00 6.6e-02 0.767 0.767 0.00
  17 -1.077059000e+09 +1.16948127e+09 7.54e+02 1.4e+00 6.5e-02 0.766 0.767 0.00
  18 -1.077038551e+09 +1.16944037e+09 6.63e+02 1.4e+00 6.6e-02 0.766 0.768 0.00
  19 -1.077017739e+09 +1.16939875e+09 5.94e+02 1.4e+00 6.7e-02 0.766 0.768 0.00
  20 -1.076996073e+09 +1.16935541e+09 5.79e+02 1.4e+00 6.9e-02 0.765 0.768 0.00
  21 -1.076973105e+09 +1.16930948e+09 6.05e+02 1.5e+00 7.4e-02 0.765 0.769 0.00
  22 -1.076948373e+09 +1.16926001e+09 6.50e+02 1.5e+00 8.0e-02 0.765 0.769 0.00
  23 -1.076921389e+09 +1.16920605e+09 7.03e+02 1.6e+00 8.7e-02 0.764 0.769 0.00
  24 -1.076891654e+09 +1.16914658e+09 6.70e+02 1.6e+00 9.3e-02 0.764 0.770 0.00
  25 -1.076858738e+09 +1.16908074e+09 6.99e+02 1.6e+00 9.8e-02 0.764 0.770 0.00
  26 -1.076822217e+09 +1.16900770e+09 7.25e+02 1.5e+00 1.1e-01 0.763 0.770 0.00
  27 -1.076781770e+09 +1.16892681e+09 7.80e+02 1.6e+00 1.2e-01 0.762 0.771 0.00
  28 -1.076736992e+09 +1.16883725e+09 8.88e+02 1.6e+00 1.2e-01 0.762 0.771 0.00
  29 -1.076687407e+09 +1.16873808e+09 1.03e+03 1.7e+00 1.3e-01 0.762 0.771 0.00
  30 -1.076632070e+09 +1.16862741e+09 1.21e+03 2.0e+00 1.4e-01 0.761 0.772 0.00
  31 -1.076568604e+09 +1.16850048e+09 3.08e+03 2.3e+00 1.5e-01 0.761 0.772 0.00
  32 -1.076484368e+09 +1.16833200e+09 2.84e+03 2.5e+00 1.6e-01 0.761 0.773 0.00
  33 -1.076370034e+09 +1.16810334e+09 1.57e+03 2.8e+00 1.9e-01 0.761 0.773 0.00
  34 -1.076260048e+09 +1.16788336e+09 1.76e+03 3.0e+00 1.8e-01 0.760 0.774 0.00
  35 -1.076150092e+09 +1.16766345e+09 2.78e+03 3.8e+00 1.9e-01 0.760 0.775 0.00
  36 -1.076031949e+09 +1.16742717e+09 3.39e+03 4.7e+00 2.8e-01 0.759 0.775 0.00
  37 -1.075913272e+09 +1.16718981e+09 3.74e+03 5.3e+00 2.9e-01 0.759 0.776 0.00
  38 -1.075802070e+09 +1.16696741e+09 3.86e+03 5.5e+00 2.5e-01 0.759 0.777 0.00
  39 -1.075702875e+09 +1.16676902e+09 3.76e+03 5.3e+00 2.3e-01 0.759 0.777 0.00
  40 -1.075618227e+09 +1.16659972e+09 3.48e+03 4.9e+00 2.2e-01 0.759 0.777 0.00
  41 -1.075548397e+09 +1.16646006e+09 3.09e+03 4.4e+00 2.1e-01 0.759 0.778 0.00
  42 -1.075491946e+09 +1.16634716e+09 2.62e+03 3.8e+00 2.0e-01 0.759 0.778 0.00
  43 -1.075446426e+09 +1.16625612e+09 2.15e+03 3.3e+00 1.8e-01 0.759 0.779 0.00
  44 -1.075409140e+09 +1.16618155e+09 1.72e+03 2.8e+00 1.7e-01 0.759 0.779 0.00
  45 -1.075377927e+09 +1.16611912e+09 1.35e+03 2.5e+00 1.5e-01 0.759 0.779 0.00
  46 -1.075351317e+09 +1.16606590e+09 1.05e+03 2.2e+00 1.4e-01 0.759 0.779 0.00
  47 -1.075328104e+09 +1.16601948e+09 8.10e+02 1.9e+00 1.3e-01 0.759 0.780 0.00
  48 -1.075307441e+09 +1.16597815e+09 6.21e+02 1.8e+00 1.2e-01 0.759 0.780 0.00
  49 -1.075288855e+09 +1.16594098e+09 5.19e+02 1.6e+00 1.1e-01 0.759 0.781 0.00
  50 -1.075272036e+09 +1.16590734e+09 5.24e+02 1.5e+00 1.0e-01 0.758 0.781 0.00
  51 -1.075256758e+09 +1.16587678e+09 1.28e+03 1.4e+00 9.9e-02 0.758 0.781 0.00
  52 -1.075242821e+09 +1.16584891e+09 5.13e+02 1.3e+00 9.4e-02 0.758 0.782 0.00
  53 -1.075229940e+09 +1.16582315e+09 9.12e+02 1.2e+00 9.0e-02 0.758 0.782 0.00
  54 -1.075217998e+09 +1.16579926e+09 5.46e+02 1.2e+00 8.6e-02 0.758 0.782 0.00
  55 -1.075206827e+09 +1.16577692e+09 5.59e+02 1.2e+00 8.3e-02 0.757 0.783 0.00
  56 -1.075196316e+09 +1.16575590e+09 5.72e+02 1.2e+00 8.0e-02 0.757 0.783 0.00
  57 -1.075186387e+09 +1.16573604e+09 5.82e+02 1.1e+00 7.7e-02 0.757 0.783 0.00
  58 -1.075176986e+09 +1.16571724e+09 5.90e+02 1.1e+00 7.4e-02 0.757 0.784 0.00
  59 -1.075168057e+09 +1.16569938e+09 5.96e+02 1.0e+00 7.2e-02 0.757 0.784 0.00
  60 -1.075159553e+09 +1.16568237e+09 6.01e+02 1.0e+00 6.9e-02 0.757 0.784 0.00
  61 -1.075151432e+09 +1.16566613e+09 6.06e+02 9.7e-01 6.7e-02 0.757 0.784 0.00
  62 -1.075143660e+09 +1.16565059e+09 6.11e+02 9.4e-01 6.5e-02 0.757 0.784 0.00
  63 -1.075136206e+09 +1.16563568e+09 6.15e+02 9.1e-01 6.3e-02 0.757 0.784 0.00
  64 -1.075129047e+09 +1.16562136e+09 6.17e+02 8.8e-01 6.2e-02 0.757 0.784 0.00
  65 -1.075122164e+09 +1.16560760e+09 6.19e+02 8.5e-01 6.0e-02 0.757 0.785 0.00
  66 -1.075115555e+09 +1.16559438e+09 6.19e+02 8.3e-01 5.8e-02 0.757 0.785 0.00
  67 -1.075109203e+09 +1.16558167e+09 6.17e+02 8.1e-01 5.7e-02 0.757 0.785 0.00
  68 -1.075103093e+09 +1.16556945e+09 6.15e+02 7.9e-01 5.6e-02 0.757 0.785 0.00
  69 -1.075097212e+09 +1.16555769e+09 6.12e+02 7.7e-01 5.4e-02 0.757 0.785 0.00
  70 -1.075091550e+09 +1.16554637e+09 6.08e+02 7.5e-01 5.3e-02 0.757 0.785 0.00
  71 -1.075086099e+09 +1.16553547e+09 6.04e+02 7.3e-01 5.2e-02 0.757 0.785 0.00
  72 -1.075080855e+09 +1.16552498e+09 6.01e+02 7.2e-01 5.1e-02 0.757 0.785 0.00
  73 -1.075075804e+09 +1.16551488e+09 5.96e+02 7.0e-01 5.0e-02 0.756 0.785 0.00
  74 -1.075070941e+09 +1.16550515e+09 5.91e+02 6.8e-01 4.9e-02 0.756 0.786 0.00
  75 -1.075066258e+09 +1.16549578e+09 5.86e+02 6.7e-01 4.8e-02 0.756 0.786 0.00
  76 -1.075061757e+09 +1.16548678e+09 5.81e+02 6.6e-01 4.7e-02 0.756 0.786 0.00
  77 -1.075057438e+09 +1.16547814e+09 5.76e+02 6.4e-01 4.6e-02 0.756 0.786 0.00
  78 -1.075053297e+09 +1.16546986e+09 5.71e+02 6.3e-01 4.5e-02 0.756 0.786 0.00
  79 -1.075049331e+09 +1.16546193e+09 5.65e+02 6.1e-01 4.4e-02 0.756 0.786 0.00
  80 -1.075045540e+09 +1.16545435e+09 5.57e+02 6.0e-01 4.3e-02 0.756 0.786 0.00
  81 -1.075041917e+09 +1.16544710e+09 5.49e+02 5.9e-01 4.2e-02 0.756 0.786 0.00
  82 -1.075038456e+09 +1.16544018e+09 5.40e+02 5.7e-01 4.1e-02 0.756 0.786 0.00
  83 -1.075035149e+09 +1.16543357e+09 5.31e+02 5.6e-01 4.0e-02 0.756 0.786 0.00
  84 -1.075031992e+09 +1.16542725e+09 5.22e+02 5.5e-01 3.9e-02 0.756 0.786 0.00
  85 -1.075028978e+09 +1.16542122e+09 5.13e+02 5.4e-01 3.9e-02 0.756 0.786 0.00
  86 -1.075026098e+09 +1.16541546e+09 5.05e+02 5.2e-01 3.8e-02 0.756 0.786 0.00
  87 -1.075023347e+09 +1.16540996e+09 4.97e+02 5.1e-01 3.7e-02 0.756 0.786 0.00
  88 -1.075020719e+09 +1.16540471e+09 4.91e+02 5.0e-01 3.6e-02 0.756 0.787 0.00
  89 -1.075018208e+09 +1.16539968e+09 4.84e+02 4.9e-01 3.6e-02 0.756 0.787 0.00
  90 -1.075015810e+09 +1.16539489e+09 4.77e+02 4.8e-01 3.5e-02 0.756 0.787 0.00
  91 -1.075013523e+09 +1.16539031e+09 4.70e+02 4.7e-01 3.4e-02 0.756 0.787 0.00
  92 -1.075011339e+09 +1.16538595e+09 4.63e+02 4.6e-01 3.4e-02 0.756 0.787 0.00
  93 -1.075009256e+09 +1.16538178e+09 4.57e+02 4.5e-01 3.3e-02 0.756 0.787 0.00
  94 -1.075007269e+09 +1.16537781e+09 4.49e+02 4.4e-01 3.2e-02 0.756 0.787 0.00
  95 -1.075005372e+09 +1.16537401e+09 4.42e+02 4.3e-01 3.2e-02 0.756 0.787 0.00
  96 -1.075003561e+09 +1.16537039e+09 4.34e+02 4.2e-01 3.1e-02 0.756 0.787 0.00
  97 -1.075001834e+09 +1.16536694e+09 4.28e+02 4.1e-01 3.0e-02 0.756 0.787 0.00
  98 -1.075000185e+09 +1.16536364e+09 4.22e+02 4.0e-01 3.0e-02 0.755 0.787 0.00
  99 -1.074998613e+09 +1.16536049e+09 4.16e+02 3.9e-01 2.9e-02 0.755 0.787 0.00
 100 -1.074997114e+09 +1.16535750e+09 4.10e+02 3.8e-01 2.9e-02 0.755 0.787 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
      user     system    elapsed 
100704.595   8640.572  52603.144 
