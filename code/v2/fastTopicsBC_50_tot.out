
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 50"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-50 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.034281903e+09 +1.08392707e+09 9.17e+04 1.4e+02 1.4e+01 0.501 0.263 0.00
   2 -9.988319192e+08 +1.01302711e+09 1.16e+05 1.5e+02 1.7e+01 0.495 0.358 0.00
   3 -9.889725232e+08 +9.93308314e+08 5.75e+04 1.4e+02 6.1e+00 0.497 0.398 0.00
   4 -9.845272391e+08 +9.84417746e+08 2.73e+04 9.0e+01 3.0e+00 0.500 0.421 0.00
   5 -9.819840457e+08 +9.79331359e+08 1.80e+04 5.7e+01 1.2e+00 0.503 0.436 0.00
   6 -9.801875029e+08 +9.75738274e+08 1.09e+04 3.7e+01 1.4e+00 0.506 0.446 0.00
   7 -9.788327691e+08 +9.73028806e+08 9.26e+03 3.2e+01 1.2e+00 0.510 0.453 0.00
   8 -9.777757978e+08 +9.70914863e+08 8.31e+03 2.5e+01 1.3e+00 0.513 0.457 0.00
   9 -9.769484980e+08 +9.69260264e+08 8.22e+03 2.7e+01 1.3e+00 0.516 0.460 0.00
  10 -9.762740508e+08 +9.67911369e+08 9.91e+03 2.9e+01 8.1e-01 0.519 0.461 0.00
  11 -9.757062736e+08 +9.66775815e+08 1.01e+04 2.9e+01 7.8e-01 0.521 0.462 0.00
  12 -9.752217654e+08 +9.65806799e+08 8.54e+03 2.9e+01 7.6e-01 0.523 0.463 0.00
  13 -9.748088755e+08 +9.64981019e+08 9.79e+03 2.5e+01 7.5e-01 0.525 0.463 0.00
  14 -9.744521508e+08 +9.64267569e+08 7.33e+03 2.0e+01 7.0e-01 0.527 0.463 0.00
  15 -9.741477311e+08 +9.63658730e+08 5.18e+03 1.8e+01 7.5e-01 0.528 0.463 0.00
  16 -9.738941131e+08 +9.63151494e+08 7.26e+03 1.8e+01 9.3e-01 0.529 0.462 0.00
  17 -9.736804456e+08 +9.62724159e+08 8.23e+03 1.7e+01 1.1e+00 0.530 0.462 0.00
  18 -9.734992962e+08 +9.62361860e+08 8.65e+03 1.6e+01 1.2e+00 0.531 0.462 0.00
  19 -9.733444780e+08 +9.62052224e+08 8.84e+03 1.4e+01 1.2e+00 0.532 0.461 0.00
  20 -9.732108760e+08 +9.61785020e+08 7.43e+03 1.3e+01 1.1e+00 0.533 0.461 0.00
  21 -9.730915625e+08 +9.61546393e+08 7.05e+03 1.1e+01 9.3e-01 0.534 0.461 0.00
  22 -9.729795210e+08 +9.61322310e+08 7.23e+03 1.0e+01 7.9e-01 0.534 0.460 0.00
  23 -9.728669127e+08 +9.61097093e+08 5.46e+03 9.3e+00 7.0e-01 0.535 0.460 0.00
  24 -9.727484924e+08 +9.60860253e+08 4.89e+03 8.4e+00 8.4e-01 0.536 0.460 0.00
  25 -9.726246455e+08 +9.60612559e+08 5.26e+03 8.2e+00 9.4e-01 0.537 0.459 0.00
  26 -9.725044373e+08 +9.60372142e+08 5.25e+03 7.6e+00 9.3e-01 0.538 0.459 0.00
  27 -9.724031436e+08 +9.60169555e+08 5.09e+03 6.4e+00 8.0e-01 0.539 0.460 0.00
  28 -9.723283315e+08 +9.60019931e+08 5.36e+03 5.7e+00 5.7e-01 0.539 0.459 0.00
  29 -9.722727484e+08 +9.59908765e+08 5.75e+03 5.5e+00 3.7e-01 0.540 0.459 0.00
  30 -9.722273572e+08 +9.59817982e+08 5.85e+03 5.3e+00 2.7e-01 0.540 0.459 0.00
  31 -9.721876587e+08 +9.59738585e+08 5.90e+03 5.0e+00 2.1e-01 0.541 0.459 0.00
  32 -9.721509554e+08 +9.59665179e+08 5.94e+03 4.9e+00 1.9e-01 0.541 0.459 0.00
  33 -9.721155019e+08 +9.59594272e+08 5.93e+03 4.9e+00 1.8e-01 0.541 0.459 0.00
  34 -9.720801321e+08 +9.59523532e+08 5.87e+03 4.5e+00 1.8e-01 0.542 0.459 0.00
  35 -9.720440112e+08 +9.59451290e+08 5.76e+03 4.3e+00 1.8e-01 0.542 0.459 0.00
  36 -9.720070477e+08 +9.59377363e+08 5.46e+03 4.1e+00 1.9e-01 0.542 0.459 0.00
  37 -9.719710051e+08 +9.59305278e+08 2.51e+03 4.0e+00 1.8e-01 0.543 0.460 0.00
  38 -9.719353746e+08 +9.59234017e+08 2.07e+03 3.9e+00 1.8e-01 0.543 0.460 0.00
  39 -9.718999053e+08 +9.59163078e+08 1.75e+03 3.8e+00 1.7e-01 0.544 0.460 0.00
  40 -9.718652648e+08 +9.59093797e+08 1.62e+03 3.6e+00 1.7e-01 0.544 0.460 0.00
  41 -9.718314842e+08 +9.59026236e+08 1.49e+03 3.5e+00 1.6e-01 0.545 0.460 0.00
  42 -9.717994614e+08 +9.58962191e+08 1.37e+03 3.3e+00 1.5e-01 0.545 0.459 0.00
  43 -9.717697292e+08 +9.58902726e+08 1.27e+03 3.3e+00 1.6e-01 0.546 0.459 0.00
  44 -9.717421642e+08 +9.58847596e+08 1.19e+03 3.5e+00 1.6e-01 0.546 0.459 0.00
  45 -9.717164500e+08 +9.58796168e+08 1.06e+03 3.5e+00 1.6e-01 0.547 0.459 0.00
  46 -9.716931949e+08 +9.58749658e+08 1.20e+03 3.7e+00 1.7e-01 0.548 0.458 0.00
  47 -9.716728718e+08 +9.58709011e+08 1.21e+03 3.8e+00 1.7e-01 0.548 0.458 0.00
  48 -9.716552292e+08 +9.58673726e+08 1.22e+03 4.0e+00 1.7e-01 0.548 0.458 0.00
  49 -9.716397543e+08 +9.58642777e+08 1.21e+03 4.1e+00 1.7e-01 0.549 0.458 0.00
  50 -9.716259881e+08 +9.58615244e+08 1.17e+03 4.2e+00 1.7e-01 0.549 0.458 0.00
  51 -9.716135845e+08 +9.58590437e+08 1.13e+03 4.3e+00 1.7e-01 0.549 0.458 0.00
  52 -9.716023325e+08 +9.58567933e+08 1.10e+03 4.4e+00 1.7e-01 0.550 0.457 0.00
  53 -9.715920992e+08 +9.58547466e+08 1.08e+03 4.5e+00 1.7e-01 0.550 0.457 0.00
  54 -9.715827457e+08 +9.58528759e+08 1.06e+03 4.4e+00 1.7e-01 0.550 0.457 0.00
  55 -9.715741601e+08 +9.58511588e+08 1.02e+03 4.3e+00 1.6e-01 0.550 0.457 0.00
  56 -9.715662443e+08 +9.58495756e+08 1.08e+03 4.3e+00 1.6e-01 0.550 0.457 0.00
  57 -9.715589262e+08 +9.58481120e+08 1.11e+03 4.1e+00 1.5e-01 0.550 0.457 0.00
  58 -9.715521471e+08 +9.58467562e+08 1.14e+03 4.0e+00 1.4e-01 0.551 0.457 0.00
  59 -9.715458473e+08 +9.58454962e+08 1.14e+03 3.9e+00 1.4e-01 0.551 0.457 0.00
  60 -9.715399710e+08 +9.58443210e+08 1.15e+03 3.7e+00 1.4e-01 0.551 0.457 0.00
  61 -9.715344732e+08 +9.58432214e+08 1.15e+03 3.6e+00 1.3e-01 0.551 0.457 0.00
  62 -9.715293200e+08 +9.58421908e+08 1.15e+03 3.5e+00 1.2e-01 0.551 0.457 0.00
  63 -9.715244788e+08 +9.58412225e+08 1.15e+03 3.4e+00 1.2e-01 0.551 0.457 0.00
  64 -9.715199190e+08 +9.58403106e+08 1.15e+03 3.3e+00 1.1e-01 0.551 0.457 0.00
  65 -9.715156149e+08 +9.58394498e+08 1.15e+03 3.2e+00 1.0e-01 0.551 0.457 0.00
  66 -9.715115403e+08 +9.58386348e+08 1.15e+03 3.1e+00 9.2e-02 0.551 0.456 0.00
  67 -9.715076693e+08 +9.58378606e+08 1.16e+03 3.0e+00 8.7e-02 0.552 0.456 0.00
  68 -9.715039817e+08 +9.58371231e+08 1.17e+03 3.0e+00 8.1e-02 0.552 0.456 0.00
  69 -9.715004543e+08 +9.58364176e+08 1.17e+03 2.9e+00 7.5e-02 0.552 0.456 0.00
  70 -9.714970666e+08 +9.58357401e+08 1.17e+03 2.8e+00 7.1e-02 0.552 0.456 0.00
  71 -9.714938017e+08 +9.58350871e+08 1.17e+03 2.7e+00 7.1e-02 0.552 0.456 0.00
  72 -9.714906445e+08 +9.58344557e+08 1.17e+03 2.6e+00 7.1e-02 0.552 0.456 0.00
  73 -9.714875779e+08 +9.58338424e+08 1.17e+03 2.5e+00 7.1e-02 0.552 0.456 0.00
  74 -9.714845864e+08 +9.58332441e+08 1.17e+03 2.4e+00 7.1e-02 0.552 0.456 0.00
  75 -9.714816548e+08 +9.58326577e+08 1.17e+03 2.3e+00 7.1e-02 0.552 0.456 0.00
  76 -9.714787723e+08 +9.58320812e+08 1.17e+03 2.2e+00 7.1e-02 0.552 0.455 0.00
  77 -9.714759332e+08 +9.58315134e+08 8.26e+02 2.1e+00 7.1e-02 0.552 0.455 0.00
  78 -9.714731349e+08 +9.58309538e+08 7.74e+02 2.1e+00 7.2e-02 0.552 0.455 0.00
  79 -9.714703687e+08 +9.58304005e+08 7.34e+02 2.0e+00 7.1e-02 0.553 0.455 0.00
  80 -9.714676231e+08 +9.58298514e+08 7.34e+02 1.9e+00 7.1e-02 0.553 0.455 0.00
  81 -9.714648888e+08 +9.58293046e+08 7.48e+02 1.9e+00 7.2e-02 0.553 0.455 0.00
  82 -9.714621603e+08 +9.58287588e+08 7.74e+02 1.9e+00 7.2e-02 0.553 0.455 0.00
  83 -9.714594423e+08 +9.58282152e+08 8.11e+02 2.0e+00 7.2e-02 0.553 0.455 0.00
  84 -9.714567308e+08 +9.58276729e+08 8.44e+02 2.1e+00 7.1e-02 0.553 0.454 0.00
  85 -9.714540196e+08 +9.58271307e+08 8.79e+02 2.1e+00 7.1e-02 0.553 0.454 0.00
  86 -9.714513077e+08 +9.58265883e+08 9.07e+02 2.2e+00 7.0e-02 0.553 0.454 0.00
  87 -9.714485943e+08 +9.58260457e+08 8.26e+02 2.2e+00 7.0e-02 0.553 0.454 0.00
  88 -9.714458998e+08 +9.58255067e+08 7.83e+02 2.1e+00 7.1e-02 0.554 0.454 0.00
  89 -9.714432359e+08 +9.58249740e+08 7.07e+02 2.1e+00 7.0e-02 0.554 0.454 0.00
  90 -9.714405899e+08 +9.58244448e+08 7.26e+02 2.0e+00 7.0e-02 0.554 0.454 0.00
  91 -9.714379591e+08 +9.58239186e+08 7.39e+02 2.0e+00 6.9e-02 0.554 0.453 0.00
  92 -9.714353423e+08 +9.58233952e+08 7.75e+02 1.9e+00 6.7e-02 0.554 0.453 0.00
  93 -9.714327375e+08 +9.58228743e+08 8.07e+02 1.9e+00 6.6e-02 0.554 0.453 0.00
  94 -9.714301472e+08 +9.58223562e+08 8.16e+02 1.8e+00 6.5e-02 0.554 0.453 0.00
  95 -9.714275643e+08 +9.58218396e+08 8.16e+02 1.7e+00 6.5e-02 0.554 0.453 0.00
  96 -9.714249806e+08 +9.58213229e+08 8.10e+02 1.7e+00 6.4e-02 0.554 0.453 0.00
  97 -9.714224078e+08 +9.58208084e+08 7.98e+02 1.6e+00 6.3e-02 0.555 0.453 0.00
  98 -9.714198462e+08 +9.58202960e+08 7.79e+02 1.5e+00 6.2e-02 0.555 0.453 0.00
  99 -9.714172965e+08 +9.58197861e+08 7.59e+02 1.4e+00 6.2e-02 0.555 0.452 0.00
 100 -9.714147669e+08 +9.58192802e+08 7.40e+02 1.3e+00 6.3e-02 0.555 0.452 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
768005.44  21677.56 225866.29 
