
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 10"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-10 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.067159231e+09 +1.14968173e+09 2.23e+04 8.8e+01 1.5e+00 0.740 0.570 0.00
   2 -1.056754281e+09 +1.12887183e+09 2.24e+04 1.1e+02 2.2e+00 0.730 0.693 0.00
   3 -1.052700555e+09 +1.12076438e+09 2.05e+04 6.3e+01 2.3e+00 0.736 0.660 0.00
   4 -1.050510667e+09 +1.11638460e+09 1.13e+04 3.5e+01 1.0e+00 0.738 0.667 0.00
   5 -1.049124574e+09 +1.11361242e+09 7.22e+03 2.4e+01 6.6e-01 0.739 0.673 0.00
   6 -1.048370518e+09 +1.11210430e+09 4.59e+03 1.6e+01 5.5e-01 0.739 0.677 0.00
   7 -1.047964253e+09 +1.11129177e+09 3.02e+03 1.0e+01 4.0e-01 0.740 0.677 0.00
   8 -1.047712902e+09 +1.11078907e+09 2.06e+03 6.7e+00 2.7e-01 0.740 0.676 0.00
   9 -1.047537177e+09 +1.11043762e+09 1.39e+03 4.3e+00 2.1e-01 0.740 0.673 0.00
  10 -1.047401282e+09 +1.11016583e+09 9.63e+02 3.5e+00 1.8e-01 0.740 0.671 0.00
  11 -1.047292102e+09 +1.10994747e+09 6.53e+02 3.3e+00 1.6e-01 0.740 0.670 0.00
  12 -1.047198450e+09 +1.10976017e+09 6.42e+02 3.2e+00 1.5e-01 0.740 0.668 0.00
  13 -1.047115018e+09 +1.10959330e+09 7.44e+02 3.1e+00 1.6e-01 0.740 0.668 0.00
  14 -1.047038730e+09 +1.10944073e+09 8.62e+02 3.1e+00 1.7e-01 0.740 0.668 0.00
  15 -1.046967337e+09 +1.10929794e+09 9.89e+02 3.1e+00 1.7e-01 0.740 0.667 0.00
  16 -1.046899178e+09 +1.10916162e+09 1.13e+03 3.3e+00 1.8e-01 0.740 0.668 0.00
  17 -1.046833044e+09 +1.10902936e+09 1.26e+03 3.2e+00 1.8e-01 0.740 0.668 0.00
  18 -1.046768109e+09 +1.10889949e+09 1.43e+03 3.0e+00 1.8e-01 0.740 0.668 0.00
  19 -1.046703707e+09 +1.10877068e+09 1.65e+03 2.9e+00 1.8e-01 0.739 0.668 0.00
  20 -1.046639258e+09 +1.10864178e+09 1.87e+03 2.9e+00 1.8e-01 0.739 0.668 0.00
  21 -1.046574312e+09 +1.10851189e+09 2.07e+03 2.9e+00 1.8e-01 0.739 0.668 0.00
  22 -1.046508469e+09 +1.10838021e+09 1.46e+03 2.8e+00 1.9e-01 0.738 0.669 0.00
  23 -1.046441946e+09 +1.10824716e+09 1.37e+03 2.8e+00 1.8e-01 0.738 0.669 0.00
  24 -1.046374810e+09 +1.10811289e+09 1.47e+03 2.8e+00 1.8e-01 0.738 0.669 0.00
  25 -1.046307164e+09 +1.10797760e+09 1.58e+03 3.0e+00 1.7e-01 0.738 0.669 0.00
  26 -1.046239309e+09 +1.10784189e+09 1.71e+03 3.1e+00 1.7e-01 0.738 0.669 0.00
  27 -1.046171694e+09 +1.10770665e+09 1.83e+03 3.2e+00 1.6e-01 0.737 0.669 0.00
  28 -1.046104760e+09 +1.10757279e+09 1.95e+03 3.3e+00 1.5e-01 0.737 0.669 0.00
  29 -1.046038997e+09 +1.10744126e+09 2.08e+03 3.4e+00 1.5e-01 0.737 0.669 0.00
  30 -1.045975046e+09 +1.10731336e+09 2.18e+03 3.4e+00 1.5e-01 0.737 0.669 0.00
  31 -1.045913583e+09 +1.10719043e+09 2.26e+03 3.4e+00 1.5e-01 0.737 0.669 0.00
  32 -1.045855165e+09 +1.10707360e+09 2.33e+03 3.4e+00 1.6e-01 0.736 0.669 0.00
  33 -1.045800274e+09 +1.10696382e+09 2.37e+03 3.4e+00 1.6e-01 0.736 0.669 0.00
  34 -1.045749193e+09 +1.10686165e+09 2.39e+03 3.4e+00 1.6e-01 0.736 0.669 0.00
  35 -1.045702076e+09 +1.10676742e+09 1.82e+03 3.3e+00 1.6e-01 0.736 0.669 0.00
  36 -1.045658982e+09 +1.10668123e+09 1.76e+03 3.3e+00 1.6e-01 0.736 0.669 0.00
  37 -1.045619816e+09 +1.10660290e+09 1.71e+03 3.2e+00 1.5e-01 0.735 0.669 0.00
  38 -1.045584376e+09 +1.10653202e+09 1.66e+03 3.0e+00 1.5e-01 0.735 0.668 0.00
  39 -1.045552451e+09 +1.10646817e+09 1.58e+03 2.9e+00 1.4e-01 0.735 0.669 0.00
  40 -1.045523747e+09 +1.10641076e+09 1.50e+03 2.7e+00 1.3e-01 0.735 0.669 0.00
  41 -1.045497922e+09 +1.10635911e+09 1.41e+03 2.6e+00 1.3e-01 0.734 0.669 0.00
  42 -1.045474675e+09 +1.10631262e+09 1.32e+03 2.4e+00 1.2e-01 0.734 0.669 0.00
  43 -1.045453711e+09 +1.10627069e+09 1.23e+03 2.2e+00 1.1e-01 0.734 0.669 0.00
  44 -1.045434748e+09 +1.10623276e+09 1.14e+03 2.1e+00 1.0e-01 0.734 0.670 0.00
  45 -1.045417545e+09 +1.10619836e+09 1.05e+03 1.9e+00 9.4e-02 0.733 0.670 0.00
  46 -1.045401866e+09 +1.10616700e+09 9.56e+02 1.8e+00 8.6e-02 0.733 0.670 0.00
  47 -1.045387499e+09 +1.10613827e+09 8.73e+02 1.6e+00 7.9e-02 0.733 0.670 0.00
  48 -1.045374249e+09 +1.10611177e+09 7.94e+02 1.5e+00 7.3e-02 0.732 0.671 0.00
  49 -1.045361946e+09 +1.10608716e+09 7.21e+02 1.4e+00 6.7e-02 0.732 0.671 0.00
  50 -1.045350445e+09 +1.10606416e+09 6.56e+02 1.3e+00 6.2e-02 0.732 0.671 0.00
  51 -1.045339620e+09 +1.10604251e+09 5.97e+02 1.2e+00 5.7e-02 0.732 0.671 0.00
  52 -1.045329353e+09 +1.10602197e+09 5.41e+02 1.1e+00 5.3e-02 0.732 0.672 0.00
  53 -1.045319547e+09 +1.10600236e+09 4.91e+02 1.0e+00 4.8e-02 0.732 0.672 0.00
  54 -1.045310124e+09 +1.10598352e+09 4.43e+02 9.3e-01 4.5e-02 0.731 0.672 0.00
  55 -1.045300998e+09 +1.10596526e+09 4.02e+02 9.4e-01 4.1e-02 0.731 0.672 0.00
  56 -1.045292107e+09 +1.10594748e+09 3.65e+02 1.0e+00 3.8e-02 0.731 0.672 0.00
  57 -1.045283396e+09 +1.10593006e+09 3.32e+02 1.0e+00 3.7e-02 0.731 0.673 0.00
  58 -1.045274820e+09 +1.10591291e+09 3.30e+02 1.1e+00 3.6e-02 0.731 0.673 0.00
  59 -1.045266337e+09 +1.10589594e+09 3.31e+02 1.1e+00 3.6e-02 0.730 0.673 0.00
  60 -1.045257926e+09 +1.10587912e+09 3.35e+02 1.2e+00 3.6e-02 0.730 0.673 0.00
  61 -1.045249577e+09 +1.10586242e+09 3.60e+02 1.2e+00 3.6e-02 0.730 0.674 0.00
  62 -1.045241280e+09 +1.10584583e+09 3.85e+02 1.3e+00 3.6e-02 0.730 0.674 0.00
  63 -1.045233037e+09 +1.10582934e+09 4.11e+02 1.3e+00 3.6e-02 0.730 0.674 0.00
  64 -1.045224862e+09 +1.10581299e+09 4.36e+02 1.3e+00 3.5e-02 0.730 0.674 0.00
  65 -1.045216760e+09 +1.10579679e+09 4.59e+02 1.4e+00 3.5e-02 0.729 0.674 0.00
  66 -1.045208724e+09 +1.10578072e+09 4.83e+02 1.4e+00 3.5e-02 0.729 0.674 0.00
  67 -1.045200757e+09 +1.10576478e+09 5.07e+02 1.4e+00 3.5e-02 0.729 0.675 0.00
  68 -1.045192863e+09 +1.10574899e+09 5.31e+02 1.5e+00 3.5e-02 0.729 0.675 0.00
  69 -1.045185051e+09 +1.10573337e+09 5.56e+02 1.5e+00 3.4e-02 0.728 0.675 0.00
  70 -1.045177340e+09 +1.10571795e+09 5.78e+02 1.5e+00 3.4e-02 0.728 0.675 0.00
  71 -1.045169750e+09 +1.10570277e+09 6.01e+02 1.5e+00 3.4e-02 0.728 0.675 0.00
  72 -1.045162287e+09 +1.10568784e+09 6.24e+02 1.5e+00 3.3e-02 0.728 0.675 0.00
  73 -1.045154957e+09 +1.10567318e+09 6.46e+02 1.5e+00 3.3e-02 0.728 0.675 0.00
  74 -1.045147768e+09 +1.10565880e+09 6.67e+02 1.5e+00 3.2e-02 0.728 0.675 0.00
  75 -1.045140730e+09 +1.10564473e+09 6.87e+02 1.5e+00 3.1e-02 0.728 0.675 0.00
  76 -1.045133856e+09 +1.10563098e+09 7.05e+02 1.5e+00 3.1e-02 0.728 0.675 0.00
  77 -1.045127156e+09 +1.10561758e+09 7.21e+02 1.5e+00 3.0e-02 0.727 0.675 0.00
  78 -1.045120645e+09 +1.10560456e+09 7.37e+02 1.5e+00 2.9e-02 0.727 0.675 0.00
  79 -1.045114314e+09 +1.10559190e+09 7.53e+02 1.5e+00 2.9e-02 0.727 0.676 0.00
  80 -1.045108176e+09 +1.10557962e+09 7.67e+02 1.5e+00 2.9e-02 0.727 0.676 0.00
  81 -1.045102226e+09 +1.10556772e+09 7.80e+02 1.5e+00 3.0e-02 0.727 0.676 0.00
  82 -1.045096463e+09 +1.10555619e+09 7.92e+02 1.4e+00 3.0e-02 0.727 0.676 0.00
  83 -1.045090890e+09 +1.10554505e+09 8.02e+02 1.4e+00 3.0e-02 0.727 0.676 0.00
  84 -1.045085508e+09 +1.10553428e+09 8.10e+02 1.4e+00 3.0e-02 0.727 0.676 0.00
  85 -1.045080344e+09 +1.10552396e+09 8.17e+02 1.4e+00 3.1e-02 0.727 0.676 0.00
  86 -1.045075486e+09 +1.10551424e+09 8.07e+02 1.3e+00 3.0e-02 0.727 0.676 0.00
  87 -1.045070911e+09 +1.10550509e+09 7.94e+02 1.3e+00 2.9e-02 0.727 0.676 0.00
  88 -1.045066598e+09 +1.10549646e+09 7.82e+02 1.3e+00 2.9e-02 0.727 0.676 0.00
  89 -1.045062530e+09 +1.10548833e+09 7.69e+02 1.3e+00 2.8e-02 0.727 0.676 0.00
  90 -1.045058691e+09 +1.10548065e+09 7.56e+02 1.3e+00 2.7e-02 0.727 0.676 0.00
  91 -1.045055066e+09 +1.10547340e+09 7.43e+02 1.2e+00 2.7e-02 0.727 0.676 0.00
  92 -1.045051643e+09 +1.10546655e+09 7.29e+02 1.2e+00 2.6e-02 0.727 0.676 0.00
  93 -1.045048408e+09 +1.10546008e+09 7.15e+02 1.2e+00 2.5e-02 0.727 0.676 0.00
  94 -1.045045348e+09 +1.10545396e+09 7.01e+02 1.2e+00 2.5e-02 0.727 0.676 0.00
  95 -1.045042452e+09 +1.10544817e+09 6.86e+02 1.1e+00 2.4e-02 0.727 0.676 0.00
  96 -1.045039709e+09 +1.10544269e+09 6.70e+02 1.1e+00 2.3e-02 0.727 0.676 0.00
  97 -1.045037105e+09 +1.10543748e+09 6.54e+02 1.1e+00 2.2e-02 0.727 0.676 0.00
  98 -1.045034632e+09 +1.10543253e+09 6.39e+02 1.1e+00 2.2e-02 0.727 0.676 0.00
  99 -1.045032280e+09 +1.10542783e+09 6.23e+02 1.0e+00 2.1e-02 0.727 0.676 0.00
 100 -1.045030043e+09 +1.10542335e+09 5.98e+02 1.0e+00 2.0e-02 0.727 0.676 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
163527.66  10204.59  69777.43 
