
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 20"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-20 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.090584314e+09 +1.19416674e+09 9.46e+04 3.1e+02 2.1e+01 0.643 0.323 0.00
   2 -1.047020708e+09 +1.10703952e+09 9.19e+04 1.1e+02 2.7e+01 0.626 0.489 0.00
   3 -1.035251400e+09 +1.08350091e+09 6.98e+04 6.5e+01 5.1e+00 0.627 0.501 0.00
   4 -1.029908174e+09 +1.07281446e+09 3.88e+04 6.1e+01 3.7e+00 0.626 0.525 0.00
   5 -1.026883567e+09 +1.06676524e+09 1.42e+04 5.1e+01 1.4e+00 0.627 0.538 0.00
   6 -1.025031599e+09 +1.06306131e+09 1.41e+04 3.3e+01 1.2e+00 0.627 0.546 0.00
   7 -1.023809479e+09 +1.06061706e+09 1.02e+04 2.3e+01 1.1e+00 0.626 0.552 0.00
   8 -1.022906611e+09 +1.05881133e+09 1.10e+04 2.0e+01 9.3e-01 0.625 0.556 0.00
   9 -1.022214036e+09 +1.05742618e+09 6.35e+03 2.0e+01 7.2e-01 0.625 0.558 0.00
  10 -1.021657150e+09 +1.05631241e+09 6.62e+03 1.9e+01 7.8e-01 0.624 0.560 0.00
  11 -1.021189373e+09 +1.05537685e+09 6.64e+03 1.8e+01 1.0e+00 0.624 0.562 0.00
  12 -1.020797525e+09 +1.05459316e+09 5.24e+03 1.6e+01 7.7e-01 0.624 0.563 0.00
  13 -1.020463456e+09 +1.05392502e+09 4.53e+03 1.3e+01 6.4e-01 0.625 0.564 0.00
  14 -1.020172409e+09 +1.05334293e+09 3.82e+03 1.0e+01 5.5e-01 0.626 0.565 0.00
  15 -1.019917125e+09 +1.05283236e+09 3.29e+03 8.2e+00 5.1e-01 0.627 0.566 0.00
  16 -1.019691118e+09 +1.05238034e+09 2.73e+03 6.9e+00 4.4e-01 0.628 0.566 0.00
  17 -1.019490596e+09 +1.05197930e+09 2.16e+03 6.3e+00 4.3e-01 0.630 0.566 0.00
  18 -1.019311614e+09 +1.05162134e+09 3.04e+03 5.7e+00 3.5e-01 0.631 0.566 0.00
  19 -1.019151070e+09 +1.05130025e+09 4.23e+03 5.2e+00 3.1e-01 0.632 0.565 0.00
  20 -1.019004439e+09 +1.05100699e+09 4.86e+03 4.7e+00 2.9e-01 0.633 0.564 0.00
  21 -1.018867156e+09 +1.05073242e+09 5.07e+03 4.5e+00 2.6e-01 0.634 0.563 0.00
  22 -1.018735988e+09 +1.05047008e+09 5.80e+03 4.4e+00 2.4e-01 0.635 0.562 0.00
  23 -1.018608726e+09 +1.05021556e+09 6.20e+03 4.4e+00 2.2e-01 0.636 0.561 0.00
  24 -1.018484947e+09 +1.04996800e+09 6.43e+03 4.3e+00 2.0e-01 0.636 0.561 0.00
  25 -1.018363341e+09 +1.04972479e+09 6.43e+03 4.3e+00 1.9e-01 0.637 0.560 0.00
  26 -1.018240136e+09 +1.04947838e+09 6.20e+03 4.3e+00 2.1e-01 0.638 0.559 0.00
  27 -1.018110795e+09 +1.04921970e+09 5.83e+03 5.3e+00 2.3e-01 0.638 0.559 0.00
  28 -1.017971431e+09 +1.04894097e+09 5.46e+03 6.6e+00 2.7e-01 0.639 0.558 0.00
  29 -1.017821555e+09 +1.04864122e+09 5.08e+03 7.3e+00 3.5e-01 0.639 0.558 0.00
  30 -1.017666431e+09 +1.04833097e+09 4.67e+03 7.2e+00 4.5e-01 0.640 0.557 0.00
  31 -1.017514453e+09 +1.04802701e+09 4.27e+03 6.5e+00 5.4e-01 0.640 0.557 0.00
  32 -1.017371289e+09 +1.04774069e+09 3.88e+03 5.6e+00 5.9e-01 0.640 0.556 0.00
  33 -1.017238337e+09 +1.04747478e+09 3.47e+03 4.7e+00 6.0e-01 0.640 0.556 0.00
  34 -1.017111854e+09 +1.04722181e+09 2.91e+03 4.3e+00 5.7e-01 0.640 0.556 0.00
  35 -1.016988269e+09 +1.04697464e+09 2.53e+03 4.1e+00 6.3e-01 0.640 0.555 0.00
  36 -1.016870320e+09 +1.04673875e+09 2.25e+03 3.9e+00 7.0e-01 0.640 0.555 0.00
  37 -1.016764424e+09 +1.04652695e+09 2.02e+03 3.7e+00 6.2e-01 0.640 0.555 0.00
  38 -1.016673088e+09 +1.04634428e+09 2.19e+03 3.8e+00 4.9e-01 0.641 0.555 0.00
  39 -1.016596603e+09 +1.04619131e+09 2.30e+03 3.8e+00 4.1e-01 0.641 0.555 0.00
  40 -1.016533143e+09 +1.04606439e+09 2.37e+03 3.8e+00 3.5e-01 0.641 0.554 0.00
  41 -1.016480461e+09 +1.04595903e+09 2.39e+03 3.8e+00 2.8e-01 0.641 0.554 0.00
  42 -1.016435516e+09 +1.04586914e+09 2.38e+03 3.7e+00 2.1e-01 0.641 0.554 0.00
  43 -1.016395910e+09 +1.04578993e+09 2.35e+03 3.5e+00 2.1e-01 0.641 0.554 0.00
  44 -1.016360300e+09 +1.04571871e+09 2.30e+03 3.4e+00 2.1e-01 0.641 0.554 0.00
  45 -1.016327901e+09 +1.04565391e+09 2.23e+03 3.3e+00 2.2e-01 0.640 0.554 0.00
  46 -1.016298427e+09 +1.04559496e+09 2.12e+03 3.1e+00 2.2e-01 0.640 0.554 0.00
  47 -1.016271698e+09 +1.04554150e+09 2.02e+03 3.0e+00 2.2e-01 0.640 0.554 0.00
  48 -1.016247711e+09 +1.04549353e+09 1.89e+03 2.8e+00 2.2e-01 0.640 0.554 0.00
  49 -1.016226520e+09 +1.04545115e+09 1.74e+03 2.5e+00 2.1e-01 0.640 0.554 0.00
  50 -1.016207824e+09 +1.04541376e+09 1.58e+03 2.3e+00 2.0e-01 0.640 0.554 0.00
  51 -1.016191381e+09 +1.04538087e+09 1.42e+03 2.2e+00 1.9e-01 0.640 0.554 0.00
  52 -1.016176855e+09 +1.04535182e+09 1.28e+03 2.0e+00 1.7e-01 0.640 0.554 0.00
  53 -1.016163934e+09 +1.04532598e+09 1.14e+03 2.0e+00 1.6e-01 0.639 0.554 0.00
  54 -1.016152333e+09 +1.04530277e+09 1.03e+03 2.0e+00 1.5e-01 0.639 0.554 0.00
  55 -1.016141861e+09 +1.04528183e+09 9.21e+02 2.0e+00 1.3e-01 0.639 0.554 0.00
  56 -1.016132359e+09 +1.04526282e+09 8.27e+02 2.0e+00 1.2e-01 0.639 0.554 0.00
  57 -1.016123685e+09 +1.04524548e+09 8.07e+02 1.9e+00 1.1e-01 0.639 0.554 0.00
  58 -1.016115733e+09 +1.04522957e+09 7.97e+02 1.9e+00 1.0e-01 0.639 0.554 0.00
  59 -1.016108419e+09 +1.04521495e+09 7.80e+02 1.8e+00 9.4e-02 0.639 0.554 0.00
  60 -1.016101665e+09 +1.04520144e+09 7.56e+02 1.8e+00 8.6e-02 0.639 0.554 0.00
  61 -1.016095377e+09 +1.04518886e+09 7.33e+02 1.7e+00 8.1e-02 0.638 0.554 0.00
  62 -1.016089503e+09 +1.04517711e+09 7.09e+02 1.7e+00 7.5e-02 0.638 0.554 0.00
  63 -1.016084001e+09 +1.04516611e+09 6.80e+02 1.6e+00 7.0e-02 0.638 0.554 0.00
  64 -1.016078819e+09 +1.04515575e+09 6.52e+02 1.6e+00 6.5e-02 0.638 0.554 0.00
  65 -1.016073914e+09 +1.04514594e+09 6.21e+02 1.5e+00 6.0e-02 0.638 0.554 0.00
  66 -1.016069259e+09 +1.04513663e+09 5.90e+02 1.4e+00 5.6e-02 0.638 0.554 0.00
  67 -1.016064825e+09 +1.04512776e+09 5.59e+02 1.4e+00 5.2e-02 0.638 0.554 0.00
  68 -1.016060560e+09 +1.04511923e+09 5.33e+02 1.3e+00 4.8e-02 0.638 0.554 0.00
  69 -1.016056415e+09 +1.04511094e+09 5.33e+02 1.3e+00 4.5e-02 0.637 0.554 0.00
  70 -1.016052365e+09 +1.04510284e+09 5.37e+02 1.2e+00 4.1e-02 0.637 0.554 0.00
  71 -1.016048391e+09 +1.04509489e+09 5.41e+02 1.2e+00 3.9e-02 0.637 0.554 0.00
  72 -1.016044484e+09 +1.04508708e+09 5.44e+02 1.2e+00 3.8e-02 0.637 0.554 0.00
  73 -1.016040636e+09 +1.04507938e+09 5.47e+02 1.1e+00 3.7e-02 0.637 0.554 0.00
  74 -1.016036842e+09 +1.04507179e+09 5.53e+02 1.1e+00 3.6e-02 0.637 0.554 0.00
  75 -1.016033094e+09 +1.04506430e+09 5.60e+02 1.1e+00 3.6e-02 0.637 0.554 0.00
  76 -1.016029388e+09 +1.04505688e+09 5.66e+02 1.0e+00 3.6e-02 0.637 0.554 0.00
  77 -1.016025726e+09 +1.04504956e+09 5.72e+02 9.8e-01 3.5e-02 0.637 0.554 0.00
  78 -1.016022101e+09 +1.04504231e+09 5.77e+02 9.4e-01 3.5e-02 0.637 0.554 0.00
  79 -1.016018513e+09 +1.04503513e+09 5.81e+02 9.5e-01 3.4e-02 0.637 0.554 0.00
  80 -1.016014960e+09 +1.04502803e+09 5.85e+02 9.6e-01 3.5e-02 0.637 0.554 0.00
  81 -1.016011439e+09 +1.04502099e+09 5.87e+02 9.6e-01 3.5e-02 0.637 0.554 0.00
  82 -1.016007948e+09 +1.04501400e+09 5.88e+02 9.6e-01 3.5e-02 0.637 0.554 0.00
  83 -1.016004510e+09 +1.04500713e+09 5.91e+02 9.6e-01 3.5e-02 0.636 0.554 0.00
  84 -1.016001134e+09 +1.04500038e+09 5.83e+02 9.0e-01 3.5e-02 0.636 0.554 0.00
  85 -1.015997797e+09 +1.04499370e+09 5.74e+02 8.4e-01 3.6e-02 0.636 0.554 0.00
  86 -1.015994493e+09 +1.04498709e+09 5.67e+02 8.0e-01 3.6e-02 0.636 0.554 0.00
  87 -1.015991230e+09 +1.04498057e+09 5.61e+02 7.6e-01 3.7e-02 0.636 0.554 0.00
  88 -1.015988002e+09 +1.04497411e+09 5.53e+02 7.3e-01 3.7e-02 0.636 0.554 0.00
  89 -1.015984807e+09 +1.04496772e+09 5.45e+02 7.1e-01 3.8e-02 0.636 0.554 0.00
  90 -1.015981642e+09 +1.04496139e+09 5.38e+02 6.9e-01 3.8e-02 0.636 0.554 0.00
  91 -1.015978511e+09 +1.04495513e+09 5.32e+02 7.3e-01 3.8e-02 0.636 0.554 0.00
  92 -1.015975418e+09 +1.04494894e+09 5.25e+02 7.6e-01 3.8e-02 0.636 0.554 0.00
  93 -1.015972354e+09 +1.04494282e+09 5.17e+02 7.9e-01 3.9e-02 0.636 0.554 0.00
  94 -1.015969304e+09 +1.04493672e+09 5.11e+02 8.2e-01 3.9e-02 0.636 0.554 0.00
  95 -1.015966246e+09 +1.04493060e+09 5.06e+02 8.4e-01 4.0e-02 0.636 0.553 0.00
  96 -1.015963161e+09 +1.04492443e+09 5.02e+02 8.7e-01 4.1e-02 0.636 0.553 0.00
  97 -1.015960034e+09 +1.04491818e+09 4.97e+02 9.1e-01 4.2e-02 0.636 0.553 0.00
  98 -1.015956855e+09 +1.04491182e+09 4.90e+02 9.3e-01 4.4e-02 0.636 0.553 0.00
  99 -1.015953611e+09 +1.04490533e+09 4.83e+02 9.6e-01 4.5e-02 0.636 0.553 0.00
 100 -1.015950288e+09 +1.04489868e+09 4.77e+02 9.8e-01 4.7e-02 0.637 0.553 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
303383.67  13007.97 102056.40 
