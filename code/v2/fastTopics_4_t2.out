
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 4"
> print(paste0("data source: ",data.source))
[1] "data source: t2"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-4 Poisson NMF to 27151 x 17304 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -2.566345827e+08 +3.05074987e+08 5.59e+03 1.1e+02 7.8e-01 0.857 0.736 0.00
   2 -2.551412730e+08 +3.02088368e+08 1.81e+03 3.5e+01 2.4e+00 0.865 0.814 0.00
   3 -2.545452267e+08 +3.00896275e+08 2.77e+03 1.5e+01 1.8e+00 0.861 0.828 0.00
   4 -2.543107790e+08 +3.00427380e+08 4.09e+02 6.1e+00 1.2e+00 0.858 0.837 0.00
   5 -2.541764441e+08 +3.00158710e+08 4.34e+02 7.2e+00 3.4e-01 0.854 0.840 0.00
   6 -2.540780943e+08 +2.99962011e+08 6.54e+02 8.0e+00 3.0e-01 0.850 0.842 0.00
   7 -2.540001941e+08 +2.99806210e+08 8.74e+02 8.2e+00 2.6e-01 0.845 0.844 0.00
   8 -2.539356949e+08 +2.99677212e+08 1.08e+03 8.1e+00 2.3e-01 0.841 0.846 0.00
   9 -2.538832021e+08 +2.99572226e+08 1.19e+03 7.7e+00 2.0e-01 0.836 0.848 0.00
  10 -2.538403344e+08 +2.99486491e+08 1.26e+03 7.2e+00 1.8e-01 0.831 0.851 0.00
  11 -2.538058360e+08 +2.99417494e+08 1.26e+03 6.7e+00 1.5e-01 0.826 0.853 0.00
  12 -2.537790691e+08 +2.99363960e+08 1.20e+03 6.1e+00 1.2e-01 0.822 0.855 0.00
  13 -2.537588859e+08 +2.99323594e+08 1.06e+03 5.4e+00 1.0e-01 0.817 0.858 0.00
  14 -2.537439861e+08 +2.99293794e+08 8.65e+02 4.6e+00 8.4e-02 0.813 0.860 0.00
  15 -2.537330438e+08 +2.99271910e+08 6.47e+02 4.0e+00 6.8e-02 0.809 0.862 0.00
  16 -2.537248475e+08 +2.99255517e+08 4.72e+02 3.4e+00 5.7e-02 0.806 0.863 0.00
  17 -2.537186331e+08 +2.99243088e+08 3.42e+02 2.9e+00 4.8e-02 0.804 0.864 0.00
  18 -2.537138805e+08 +2.99233583e+08 2.48e+02 2.5e+00 4.1e-02 0.801 0.866 0.00
  19 -2.537102097e+08 +2.99226241e+08 2.19e+02 2.1e+00 3.5e-02 0.800 0.866 0.00
  20 -2.537073497e+08 +2.99220521e+08 1.95e+02 1.8e+00 3.0e-02 0.798 0.867 0.00
  21 -2.537051172e+08 +2.99216056e+08 1.72e+02 1.6e+00 2.6e-02 0.797 0.868 0.00
  22 -2.537033560e+08 +2.99212534e+08 1.52e+02 1.4e+00 2.2e-02 0.796 0.869 0.00
  23 -2.537019540e+08 +2.99209730e+08 1.33e+02 1.2e+00 1.9e-02 0.795 0.870 0.00
  24 -2.537008313e+08 +2.99207484e+08 1.17e+02 1.1e+00 1.7e-02 0.794 0.870 0.00
  25 -2.536999257e+08 +2.99205673e+08 1.03e+02 9.4e-01 1.5e-02 0.794 0.870 0.00
  26 -2.536991879e+08 +2.99204198e+08 9.08e+01 8.4e-01 1.3e-02 0.793 0.871 0.00
  27 -2.536985814e+08 +2.99202985e+08 8.04e+01 7.4e-01 1.2e-02 0.792 0.871 0.00
  28 -2.536980810e+08 +2.99201984e+08 7.14e+01 6.6e-01 1.0e-02 0.792 0.871 0.00
  29 -2.536976658e+08 +2.99201154e+08 6.36e+01 5.9e-01 9.2e-03 0.792 0.871 0.00
  30 -2.536973530e+08 +2.99200528e+08 5.66e+01 5.3e-01 8.3e-03 0.792 0.871 0.00
  31 -2.536971185e+08 +2.99200059e+08 4.98e+01 4.7e-01 7.3e-03 0.791 0.871 0.00
  32 -2.536969361e+08 +2.99199694e+08 4.36e+01 4.1e-01 6.5e-03 0.791 0.871 0.00
  33 -2.536967937e+08 +2.99199409e+08 3.82e+01 3.6e-01 5.7e-03 0.791 0.871 0.00
  34 -2.536966823e+08 +2.99199186e+08 3.35e+01 3.2e-01 5.1e-03 0.791 0.871 0.00
  35 -2.536965949e+08 +2.99199012e+08 2.94e+01 2.8e-01 4.5e-03 0.791 0.871 0.00
  36 -2.536965262e+08 +2.99198874e+08 2.58e+01 2.5e-01 4.0e-03 0.791 0.871 0.00
  37 -2.536964720e+08 +2.99198766e+08 2.27e+01 2.2e-01 3.5e-03 0.791 0.871 0.00
  38 -2.536964293e+08 +2.99198681e+08 2.00e+01 1.9e-01 3.1e-03 0.791 0.871 0.00
  39 -2.536963956e+08 +2.99198613e+08 1.76e+01 1.7e-01 2.8e-03 0.791 0.871 0.00
  40 -2.536963689e+08 +2.99198560e+08 1.55e+01 1.5e-01 2.5e-03 0.791 0.871 0.00
  41 -2.536963478e+08 +2.99198518e+08 1.37e+01 1.4e-01 2.2e-03 0.791 0.871 0.00
  42 -2.536963311e+08 +2.99198484e+08 1.21e+01 1.2e-01 1.9e-03 0.791 0.871 0.00
  43 -2.536963178e+08 +2.99198458e+08 1.08e+01 1.1e-01 1.7e-03 0.790 0.871 0.00
  44 -2.536963073e+08 +2.99198436e+08 9.75e+00 9.6e-02 1.5e-03 0.790 0.871 0.00
  45 -2.536962989e+08 +2.99198420e+08 8.86e+00 8.6e-02 1.4e-03 0.790 0.871 0.00
  46 -2.536962922e+08 +2.99198406e+08 8.05e+00 7.6e-02 1.2e-03 0.790 0.871 0.00
  47 -2.536962869e+08 +2.99198396e+08 7.26e+00 6.8e-02 1.1e-03 0.790 0.871 0.00
  48 -2.536962827e+08 +2.99198387e+08 6.53e+00 6.1e-02 1.0e-03 0.790 0.871 0.00
  49 -2.536962793e+08 +2.99198381e+08 5.88e+00 5.5e-02 9.5e-04 0.790 0.871 0.00
  50 -2.536962766e+08 +2.99198375e+08 5.30e+00 4.9e-02 8.7e-04 0.790 0.871 0.00
  51 -2.536962745e+08 +2.99198371e+08 4.79e+00 4.4e-02 8.0e-04 0.790 0.870 0.00
  52 -2.536962728e+08 +2.99198367e+08 4.32e+00 3.9e-02 7.3e-04 0.790 0.871 0.00
  53 -2.536962714e+08 +2.99198365e+08 3.89e+00 3.5e-02 6.7e-04 0.790 0.871 0.00
  54 -2.536962703e+08 +2.99198363e+08 3.51e+00 3.1e-02 6.1e-04 0.790 0.871 0.00
  55 -2.536962694e+08 +2.99198361e+08 3.16e+00 2.8e-02 5.5e-04 0.790 0.871 0.00
  56 -2.536962687e+08 +2.99198359e+08 2.85e+00 2.5e-02 5.1e-04 0.790 0.870 0.00
  57 -2.536962682e+08 +2.99198358e+08 2.57e+00 2.3e-02 4.6e-04 0.790 0.870 0.00
  58 -2.536962677e+08 +2.99198357e+08 2.31e+00 2.1e-02 4.2e-04 0.790 0.870 0.00
  59 -2.536962674e+08 +2.99198357e+08 2.08e+00 1.9e-02 3.8e-04 0.790 0.870 0.00
  60 -2.536962671e+08 +2.99198356e+08 1.87e+00 1.7e-02 3.5e-04 0.790 0.870 0.00
  61 -2.536962668e+08 +2.99198356e+08 1.68e+00 1.6e-02 3.2e-04 0.790 0.870 0.00
  62 -2.536962667e+08 +2.99198355e+08 1.51e+00 1.4e-02 2.9e-04 0.790 0.870 0.00
  63 -2.536962665e+08 +2.99198355e+08 1.36e+00 1.3e-02 2.6e-04 0.790 0.870 0.00
  64 -2.536962664e+08 +2.99198355e+08 1.23e+00 1.2e-02 2.4e-04 0.790 0.870 0.00
  65 -2.536962663e+08 +2.99198354e+08 1.10e+00 1.1e-02 2.2e-04 0.790 0.870 0.00
  66 -2.536962662e+08 +2.99198354e+08 9.91e-01 9.6e-03 2.0e-04 0.790 0.870 0.00
  67 -2.536962661e+08 +2.99198354e+08 8.92e-01 8.7e-03 1.8e-04 0.790 0.870 0.00
  68 -2.536962661e+08 +2.99198354e+08 8.02e-01 7.9e-03 1.6e-04 0.790 0.870 0.00
  69 -2.536962660e+08 +2.99198354e+08 7.21e-01 7.1e-03 1.5e-04 0.790 0.870 0.00
  70 -2.536962660e+08 +2.99198354e+08 6.48e-01 6.5e-03 1.3e-04 0.790 0.870 0.00
  71 -2.536962660e+08 +2.99198354e+08 5.83e-01 5.9e-03 1.2e-04 0.790 0.870 0.00
  72 -2.536962660e+08 +2.99198354e+08 5.24e-01 5.3e-03 1.1e-04 0.790 0.870 0.00
  73 -2.536962659e+08 +2.99198354e+08 4.71e-01 4.8e-03 1.0e-04 0.790 0.870 0.00
  74 -2.536962659e+08 +2.99198354e+08 4.24e-01 4.3e-03 9.1e-05 0.790 0.870 0.00
  75 -2.536962659e+08 +2.99198354e+08 3.81e-01 3.9e-03 8.2e-05 0.790 0.870 0.00
  76 -2.536962659e+08 +2.99198354e+08 3.43e-01 3.6e-03 7.5e-05 0.790 0.870 0.00
  77 -2.536962659e+08 +2.99198354e+08 3.08e-01 3.2e-03 6.8e-05 0.790 0.870 0.00
  78 -2.536962659e+08 +2.99198354e+08 2.77e-01 2.9e-03 6.1e-05 0.790 0.870 0.00
  79 -2.536962659e+08 +2.99198354e+08 2.50e-01 2.6e-03 5.5e-05 0.790 0.870 0.00
  80 -2.536962659e+08 +2.99198354e+08 2.25e-01 2.4e-03 5.0e-05 0.790 0.870 0.00
  81 -2.536962659e+08 +2.99198354e+08 2.02e-01 2.2e-03 4.5e-05 0.790 0.870 0.00
  82 -2.536962659e+08 +2.99198354e+08 1.82e-01 2.0e-03 4.1e-05 0.790 0.870 0.00
  83 -2.536962659e+08 +2.99198354e+08 1.64e-01 1.8e-03 3.7e-05 0.790 0.870 0.00
  84 -2.536962659e+08 +2.99198354e+08 1.47e-01 1.6e-03 3.4e-05 0.790 0.870 0.00
  85 -2.536962659e+08 +2.99198354e+08 1.32e-01 1.4e-03 3.0e-05 0.790 0.870 0.00
  86 -2.536962659e+08 +2.99198354e+08 1.19e-01 1.3e-03 2.8e-05 0.790 0.870 0.00
  87 -2.536962659e+08 +2.99198354e+08 1.08e-01 1.2e-03 2.5e-05 0.790 0.870 0.00
  88 -2.536962659e+08 +2.99198354e+08 9.73e-02 1.1e-03 2.3e-05 0.790 0.870 0.00
  89 -2.536962659e+08 +2.99198354e+08 8.78e-02 9.7e-04 2.0e-05 0.790 0.870 0.00
  90 -2.536962659e+08 +2.99198354e+08 7.93e-02 8.7e-04 1.8e-05 0.790 0.870 0.00
  91 -2.536962659e+08 +2.99198354e+08 7.15e-02 7.9e-04 1.7e-05 0.790 0.870 0.00
  92 -2.536962659e+08 +2.99198354e+08 6.46e-02 7.1e-04 1.5e-05 0.790 0.870 0.00
  93 -2.536962659e+08 +2.99198354e+08 5.83e-02 6.4e-04 1.4e-05 0.790 0.870 0.00
  94 -2.536962659e+08 +2.99198354e+08 5.26e-02 5.8e-04 1.2e-05 0.790 0.870 0.00
  95 -2.536962659e+08 +2.99198354e+08 4.74e-02 5.3e-04 1.1e-05 0.790 0.870 0.00
  96 -2.536962659e+08 +2.99198354e+08 4.28e-02 4.8e-04 1.0e-05 0.790 0.870 0.00
  97 -2.536962659e+08 +2.99198354e+08 3.86e-02 4.3e-04 9.1e-06 0.790 0.870 0.00
  98 -2.536962659e+08 +2.99198354e+08 3.48e-02 3.9e-04 8.2e-06 0.790 0.870 0.00
  99 -2.536962659e+08 +2.99198354e+08 3.14e-02 3.5e-04 7.5e-06 0.790 0.870 0.00
 100 -2.536962659e+08 +2.99198354e+08 2.83e-02 3.2e-04 6.7e-06 0.790 0.870 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
14006.969  1634.955 10017.855 
