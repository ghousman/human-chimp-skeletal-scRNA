
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 7"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-7 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.082625293e+09 +1.18061385e+09 1.90e+04 2.0e+02 1.4e+00 0.769 0.672 0.00
   2 -1.074096139e+09 +1.16355555e+09 1.16e+04 6.3e+01 2.5e+00 0.771 0.766 0.00
   3 -1.071316767e+09 +1.15799680e+09 1.64e+04 3.9e+01 1.1e+00 0.774 0.731 0.00
   4 -1.070015169e+09 +1.15539361e+09 2.79e+03 3.3e+01 1.0e+00 0.778 0.725 0.00
   5 -1.069277760e+09 +1.15391879e+09 3.29e+03 2.4e+01 7.3e-01 0.780 0.719 0.00
   6 -1.068835326e+09 +1.15303392e+09 3.48e+03 1.7e+01 5.4e-01 0.781 0.716 0.00
   7 -1.068539898e+09 +1.15244306e+09 3.52e+03 1.2e+01 3.4e-01 0.782 0.715 0.00
   8 -1.068323237e+09 +1.15200974e+09 3.07e+03 1.0e+01 2.2e-01 0.782 0.715 0.00
   9 -1.068153213e+09 +1.15166969e+09 2.64e+03 8.6e+00 1.9e-01 0.782 0.715 0.00
  10 -1.068015808e+09 +1.15139488e+09 2.29e+03 7.5e+00 1.8e-01 0.782 0.716 0.00
  11 -1.067901062e+09 +1.15116539e+09 2.05e+03 6.5e+00 1.6e-01 0.782 0.717 0.00
  12 -1.067802720e+09 +1.15096871e+09 1.93e+03 6.2e+00 1.5e-01 0.781 0.719 0.00
  13 -1.067717286e+09 +1.15079784e+09 1.94e+03 5.9e+00 1.5e-01 0.781 0.720 0.00
  14 -1.067641595e+09 +1.15064646e+09 2.09e+03 5.6e+00 1.4e-01 0.780 0.722 0.00
  15 -1.067573497e+09 +1.15051026e+09 2.38e+03 5.4e+00 1.3e-01 0.779 0.724 0.00
  16 -1.067511301e+09 +1.15038587e+09 2.78e+03 5.1e+00 1.3e-01 0.778 0.726 0.00
  17 -1.067453794e+09 +1.15027086e+09 3.27e+03 4.9e+00 1.2e-01 0.778 0.727 0.00
  18 -1.067400167e+09 +1.15016360e+09 3.93e+03 4.7e+00 1.2e-01 0.777 0.729 0.00
  19 -1.067350253e+09 +1.15006377e+09 5.28e+03 4.5e+00 1.1e-01 0.776 0.730 0.00
  20 -1.067303701e+09 +1.14997067e+09 5.29e+03 4.3e+00 1.1e-01 0.775 0.732 0.00
  21 -1.067259643e+09 +1.14988255e+09 5.90e+03 4.1e+00 1.1e-01 0.774 0.733 0.00
  22 -1.067217702e+09 +1.14979867e+09 6.65e+03 4.0e+00 1.0e-01 0.773 0.735 0.00
  23 -1.067177778e+09 +1.14971882e+09 7.41e+03 3.8e+00 1.0e-01 0.772 0.736 0.00
  24 -1.067140019e+09 +1.14964331e+09 8.01e+03 3.3e+00 9.8e-02 0.771 0.737 0.00
  25 -1.067104737e+09 +1.14957274e+09 8.05e+03 2.9e+00 9.5e-02 0.770 0.738 0.00
  26 -1.067072111e+09 +1.14950749e+09 7.33e+03 2.4e+00 9.1e-02 0.770 0.739 0.00
  27 -1.067042149e+09 +1.14944757e+09 6.61e+03 2.1e+00 8.8e-02 0.769 0.740 0.00
  28 -1.067014791e+09 +1.14939285e+09 6.56e+03 1.8e+00 8.5e-02 0.769 0.741 0.00
  29 -1.066990048e+09 +1.14934336e+09 6.27e+03 2.6e+00 8.3e-02 0.768 0.742 0.00
  30 -1.066967789e+09 +1.14929885e+09 5.80e+03 3.8e+00 8.0e-02 0.767 0.743 0.00
  31 -1.066947893e+09 +1.14925905e+09 5.15e+03 3.6e+00 7.7e-02 0.767 0.744 0.00
  32 -1.066929964e+09 +1.14922320e+09 4.68e+03 3.4e+00 7.4e-02 0.766 0.745 0.00
  33 -1.066913784e+09 +1.14919084e+09 4.31e+03 3.1e+00 7.1e-02 0.766 0.745 0.00
  34 -1.066899184e+09 +1.14916164e+09 4.00e+03 2.9e+00 6.8e-02 0.765 0.746 0.00
  35 -1.066886013e+09 +1.14913529e+09 3.73e+03 2.7e+00 6.5e-02 0.765 0.746 0.00
  36 -1.066874132e+09 +1.14911153e+09 3.49e+03 2.5e+00 6.2e-02 0.765 0.747 0.00
  37 -1.066863420e+09 +1.14909011e+09 3.28e+03 2.4e+00 5.9e-02 0.764 0.747 0.00
  38 -1.066853773e+09 +1.14907081e+09 3.16e+03 2.2e+00 5.6e-02 0.764 0.747 0.00
  39 -1.066845052e+09 +1.14905337e+09 3.13e+03 2.1e+00 5.3e-02 0.764 0.748 0.00
  40 -1.066837098e+09 +1.14903746e+09 3.00e+03 2.0e+00 5.0e-02 0.764 0.748 0.00
  41 -1.066829833e+09 +1.14902293e+09 2.88e+03 1.9e+00 4.8e-02 0.763 0.748 0.00
  42 -1.066823188e+09 +1.14900964e+09 2.77e+03 1.8e+00 4.5e-02 0.763 0.748 0.00
  43 -1.066817102e+09 +1.14899747e+09 2.67e+03 1.7e+00 4.3e-02 0.763 0.748 0.00
  44 -1.066811522e+09 +1.14898631e+09 2.59e+03 1.6e+00 4.1e-02 0.763 0.749 0.00
  45 -1.066806398e+09 +1.14897606e+09 2.51e+03 1.5e+00 3.9e-02 0.763 0.749 0.00
  46 -1.066801679e+09 +1.14896662e+09 2.44e+03 1.5e+00 3.6e-02 0.763 0.749 0.00
  47 -1.066797322e+09 +1.14895791e+09 2.37e+03 1.4e+00 3.4e-02 0.762 0.749 0.00
  48 -1.066793294e+09 +1.14894986e+09 2.30e+03 1.4e+00 3.3e-02 0.762 0.749 0.00
  49 -1.066789573e+09 +1.14894241e+09 2.25e+03 1.3e+00 3.1e-02 0.762 0.749 0.00
  50 -1.066786130e+09 +1.14893553e+09 2.19e+03 1.3e+00 2.9e-02 0.762 0.749 0.00
  51 -1.066782942e+09 +1.14892915e+09 2.13e+03 1.2e+00 2.8e-02 0.762 0.749 0.00
  52 -1.066779983e+09 +1.14892323e+09 2.07e+03 1.2e+00 2.6e-02 0.762 0.749 0.00
  53 -1.066777231e+09 +1.14891773e+09 2.02e+03 1.2e+00 2.5e-02 0.762 0.749 0.00
  54 -1.066774664e+09 +1.14891260e+09 1.96e+03 1.1e+00 2.3e-02 0.762 0.749 0.00
  55 -1.066772261e+09 +1.14890779e+09 1.91e+03 1.1e+00 2.2e-02 0.762 0.749 0.00
  56 -1.066770008e+09 +1.14890328e+09 1.86e+03 1.1e+00 2.1e-02 0.761 0.749 0.00
  57 -1.066767888e+09 +1.14889904e+09 1.80e+03 1.1e+00 2.0e-02 0.761 0.749 0.00
  58 -1.066765887e+09 +1.14889504e+09 1.75e+03 1.0e+00 1.8e-02 0.761 0.749 0.00
  59 -1.066763993e+09 +1.14889125e+09 1.69e+03 1.0e+00 1.7e-02 0.761 0.749 0.00
  60 -1.066762195e+09 +1.14888766e+09 1.64e+03 1.0e+00 1.7e-02 0.761 0.749 0.00
  61 -1.066760483e+09 +1.14888423e+09 1.59e+03 9.8e-01 1.7e-02 0.761 0.749 0.00
  62 -1.066758847e+09 +1.14888096e+09 1.53e+03 9.6e-01 1.7e-02 0.761 0.749 0.00
  63 -1.066757276e+09 +1.14887782e+09 1.48e+03 9.4e-01 1.7e-02 0.761 0.749 0.00
  64 -1.066755764e+09 +1.14887480e+09 1.42e+03 9.3e-01 1.7e-02 0.761 0.749 0.00
  65 -1.066754301e+09 +1.14887187e+09 1.37e+03 9.1e-01 1.7e-02 0.761 0.749 0.00
  66 -1.066752879e+09 +1.14886903e+09 1.32e+03 9.0e-01 1.7e-02 0.761 0.749 0.00
  67 -1.066751491e+09 +1.14886625e+09 1.27e+03 8.9e-01 1.7e-02 0.761 0.749 0.00
  68 -1.066750129e+09 +1.14886353e+09 1.21e+03 8.8e-01 1.7e-02 0.761 0.749 0.00
  69 -1.066748785e+09 +1.14886084e+09 1.16e+03 8.7e-01 1.7e-02 0.760 0.749 0.00
  70 -1.066747452e+09 +1.14885817e+09 1.12e+03 8.7e-01 1.7e-02 0.760 0.749 0.00
  71 -1.066746123e+09 +1.14885551e+09 1.07e+03 8.6e-01 1.7e-02 0.760 0.749 0.00
  72 -1.066744794e+09 +1.14885286e+09 1.05e+03 8.6e-01 1.7e-02 0.760 0.749 0.00
  73 -1.066743460e+09 +1.14885019e+09 1.03e+03 8.6e-01 1.7e-02 0.760 0.749 0.00
  74 -1.066742116e+09 +1.14884750e+09 1.02e+03 8.6e-01 1.7e-02 0.760 0.749 0.00
  75 -1.066740761e+09 +1.14884479e+09 1.00e+03 8.6e-01 1.7e-02 0.760 0.749 0.00
  76 -1.066739404e+09 +1.14884208e+09 9.86e+02 8.7e-01 1.7e-02 0.760 0.749 0.00
  77 -1.066738042e+09 +1.14883935e+09 9.70e+02 8.8e-01 1.7e-02 0.760 0.749 0.00
  78 -1.066736672e+09 +1.14883661e+09 9.55e+02 8.9e-01 1.7e-02 0.760 0.749 0.00
  79 -1.066735292e+09 +1.14883385e+09 9.41e+02 8.9e-01 1.7e-02 0.760 0.749 0.00
  80 -1.066733899e+09 +1.14883107e+09 9.28e+02 9.0e-01 1.7e-02 0.760 0.749 0.00
  81 -1.066732494e+09 +1.14882825e+09 9.16e+02 9.1e-01 1.7e-02 0.760 0.749 0.00
  82 -1.066731073e+09 +1.14882541e+09 9.04e+02 9.2e-01 1.7e-02 0.760 0.749 0.00
  83 -1.066729635e+09 +1.14882254e+09 8.92e+02 9.3e-01 1.7e-02 0.759 0.749 0.00
  84 -1.066728180e+09 +1.14881963e+09 8.79e+02 9.4e-01 1.8e-02 0.759 0.749 0.00
  85 -1.066726709e+09 +1.14881669e+09 8.66e+02 9.4e-01 1.8e-02 0.759 0.749 0.00
  86 -1.066725222e+09 +1.14881371e+09 8.52e+02 9.5e-01 1.8e-02 0.760 0.749 0.00
  87 -1.066723721e+09 +1.14881071e+09 8.38e+02 9.6e-01 1.8e-02 0.760 0.749 0.00
  88 -1.066722207e+09 +1.14880768e+09 8.25e+02 9.7e-01 1.8e-02 0.760 0.749 0.00
  89 -1.066720681e+09 +1.14880463e+09 8.12e+02 9.8e-01 1.8e-02 0.760 0.749 0.00
  90 -1.066719147e+09 +1.14880156e+09 7.99e+02 9.9e-01 1.8e-02 0.760 0.749 0.00
  91 -1.066717606e+09 +1.14879848e+09 7.86e+02 1.0e+00 1.8e-02 0.759 0.749 0.00
  92 -1.066716059e+09 +1.14879539e+09 7.74e+02 1.0e+00 1.8e-02 0.759 0.749 0.00
  93 -1.066714507e+09 +1.14879228e+09 7.64e+02 1.0e+00 1.8e-02 0.759 0.749 0.00
  94 -1.066712952e+09 +1.14878917e+09 7.54e+02 1.0e+00 1.8e-02 0.760 0.749 0.00
  95 -1.066711401e+09 +1.14878607e+09 7.11e+02 1.0e+00 1.8e-02 0.760 0.749 0.00
  96 -1.066709857e+09 +1.14878298e+09 6.81e+02 1.0e+00 1.7e-02 0.760 0.749 0.00
  97 -1.066708333e+09 +1.14877993e+09 6.59e+02 1.0e+00 1.7e-02 0.760 0.749 0.00
  98 -1.066706829e+09 +1.14877693e+09 6.35e+02 1.0e+00 1.7e-02 0.760 0.749 0.00
  99 -1.066705370e+09 +1.14877401e+09 5.98e+02 1.0e+00 1.6e-02 0.760 0.749 0.00
 100 -1.066703951e+09 +1.14877117e+09 5.70e+02 1.0e+00 1.6e-02 0.760 0.749 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
      user     system    elapsed 
120122.154   9036.894  58249.499 
