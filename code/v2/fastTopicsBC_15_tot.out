
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 15"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-15 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.068106826e+09 +1.15157692e+09 5.46e+04 2.4e+02 4.9e+00 0.670 0.436 0.00
   2 -1.043758077e+09 +1.10287942e+09 2.56e+04 5.6e+01 4.2e+00 0.640 0.569 0.00
   3 -1.037223972e+09 +1.08981121e+09 1.40e+04 3.8e+01 4.0e+00 0.641 0.577 0.00
   4 -1.033777723e+09 +1.08291871e+09 8.71e+03 2.7e+01 1.8e+00 0.648 0.598 0.00
   5 -1.031564193e+09 +1.07849165e+09 6.54e+03 2.0e+01 1.5e+00 0.655 0.607 0.00
   6 -1.030083106e+09 +1.07552948e+09 6.09e+03 1.4e+01 2.2e+00 0.660 0.611 0.00
   7 -1.029019233e+09 +1.07340173e+09 5.28e+03 1.1e+01 2.8e+00 0.663 0.612 0.00
   8 -1.028238055e+09 +1.07183938e+09 4.31e+03 1.1e+01 2.5e+00 0.666 0.612 0.00
   9 -1.027672730e+09 +1.07070873e+09 4.94e+03 1.2e+01 1.7e+00 0.668 0.612 0.00
  10 -1.027248660e+09 +1.06986059e+09 5.57e+03 1.2e+01 9.5e-01 0.670 0.613 0.00
  11 -1.026913054e+09 +1.06918938e+09 4.35e+03 1.3e+01 5.5e-01 0.671 0.614 0.00
  12 -1.026640063e+09 +1.06864339e+09 4.19e+03 1.4e+01 3.6e-01 0.672 0.615 0.00
  13 -1.026408770e+09 +1.06818081e+09 4.17e+03 1.4e+01 2.9e-01 0.673 0.616 0.00
  14 -1.026208097e+09 +1.06777946e+09 4.07e+03 1.3e+01 2.8e-01 0.674 0.618 0.00
  15 -1.026032259e+09 +1.06742779e+09 3.89e+03 1.2e+01 2.6e-01 0.675 0.618 0.00
  16 -1.025878219e+09 +1.06711971e+09 3.67e+03 1.2e+01 2.4e-01 0.675 0.619 0.00
  17 -1.025743912e+09 +1.06685109e+09 3.42e+03 1.1e+01 2.3e-01 0.675 0.620 0.00
  18 -1.025627635e+09 +1.06661854e+09 3.11e+03 9.5e+00 2.3e-01 0.675 0.620 0.00
  19 -1.025526744e+09 +1.06641676e+09 2.75e+03 8.4e+00 2.4e-01 0.674 0.621 0.00
  20 -1.025438612e+09 +1.06624049e+09 2.40e+03 7.4e+00 2.3e-01 0.674 0.621 0.00
  21 -1.025360865e+09 +1.06608500e+09 2.08e+03 6.5e+00 2.2e-01 0.673 0.621 0.00
  22 -1.025291671e+09 +1.06594661e+09 1.87e+03 5.7e+00 2.1e-01 0.673 0.621 0.00
  23 -1.025229758e+09 +1.06582278e+09 1.78e+03 4.9e+00 2.0e-01 0.672 0.621 0.00
  24 -1.025174003e+09 +1.06571127e+09 1.51e+03 4.2e+00 2.0e-01 0.672 0.621 0.00
  25 -1.025123492e+09 +1.06561025e+09 1.29e+03 3.6e+00 1.9e-01 0.671 0.621 0.00
  26 -1.025077528e+09 +1.06551832e+09 1.10e+03 3.2e+00 1.9e-01 0.671 0.621 0.00
  27 -1.025035544e+09 +1.06543436e+09 9.79e+02 2.8e+00 1.8e-01 0.670 0.620 0.00
  28 -1.024996967e+09 +1.06535720e+09 1.02e+03 2.6e+00 1.7e-01 0.669 0.620 0.00
  29 -1.024961330e+09 +1.06528593e+09 1.06e+03 2.3e+00 1.6e-01 0.669 0.620 0.00
  30 -1.024928095e+09 +1.06521946e+09 1.08e+03 2.3e+00 1.5e-01 0.668 0.620 0.00
  31 -1.024896613e+09 +1.06515649e+09 1.08e+03 2.5e+00 1.4e-01 0.667 0.620 0.00
  32 -1.024866532e+09 +1.06509633e+09 1.06e+03 2.6e+00 1.4e-01 0.667 0.620 0.00
  33 -1.024837439e+09 +1.06503815e+09 1.03e+03 2.7e+00 1.3e-01 0.666 0.620 0.00
  34 -1.024808922e+09 +1.06498111e+09 1.00e+03 2.8e+00 1.2e-01 0.665 0.620 0.00
  35 -1.024780615e+09 +1.06492450e+09 9.70e+02 2.9e+00 1.2e-01 0.665 0.619 0.00
  36 -1.024752238e+09 +1.06486774e+09 9.43e+02 3.0e+00 1.2e-01 0.664 0.620 0.00
  37 -1.024723510e+09 +1.06481029e+09 9.24e+02 3.1e+00 1.2e-01 0.664 0.620 0.00
  38 -1.024694186e+09 +1.06475164e+09 9.07e+02 3.1e+00 1.2e-01 0.663 0.620 0.00
  39 -1.024664069e+09 +1.06469141e+09 9.19e+02 3.2e+00 1.3e-01 0.663 0.620 0.00
  40 -1.024632952e+09 +1.06462917e+09 9.52e+02 3.2e+00 1.4e-01 0.662 0.620 0.00
  41 -1.024600644e+09 +1.06456456e+09 9.86e+02 3.3e+00 1.4e-01 0.662 0.621 0.00
  42 -1.024567022e+09 +1.06449731e+09 1.02e+03 3.3e+00 1.5e-01 0.661 0.621 0.00
  43 -1.024532047e+09 +1.06442736e+09 1.06e+03 3.3e+00 1.6e-01 0.661 0.621 0.00
  44 -1.024495767e+09 +1.06435480e+09 1.09e+03 3.3e+00 1.6e-01 0.661 0.622 0.00
  45 -1.024458321e+09 +1.06427991e+09 1.12e+03 3.3e+00 1.7e-01 0.660 0.622 0.00
  46 -1.024419898e+09 +1.06420306e+09 1.15e+03 3.3e+00 1.6e-01 0.660 0.622 0.00
  47 -1.024380758e+09 +1.06412478e+09 1.23e+03 3.3e+00 1.6e-01 0.660 0.623 0.00
  48 -1.024341401e+09 +1.06404607e+09 1.34e+03 3.4e+00 1.6e-01 0.659 0.623 0.00
  49 -1.024302380e+09 +1.06396803e+09 1.45e+03 3.4e+00 1.5e-01 0.659 0.624 0.00
  50 -1.024264349e+09 +1.06389197e+09 1.56e+03 3.5e+00 1.4e-01 0.658 0.624 0.00
  51 -1.024228149e+09 +1.06381957e+09 1.61e+03 3.5e+00 1.3e-01 0.658 0.625 0.00
  52 -1.024194283e+09 +1.06375183e+09 1.58e+03 3.5e+00 1.2e-01 0.657 0.625 0.00
  53 -1.024162500e+09 +1.06368827e+09 1.51e+03 3.6e+00 1.1e-01 0.657 0.626 0.00
  54 -1.024132680e+09 +1.06362863e+09 1.44e+03 3.5e+00 1.0e-01 0.657 0.626 0.00
  55 -1.024104649e+09 +1.06357257e+09 1.37e+03 3.5e+00 1.0e-01 0.657 0.627 0.00
  56 -1.024078246e+09 +1.06351976e+09 1.30e+03 3.5e+00 9.8e-02 0.657 0.627 0.00
  57 -1.024053376e+09 +1.06347002e+09 1.23e+03 3.5e+00 9.5e-02 0.657 0.627 0.00
  58 -1.024029806e+09 +1.06342288e+09 1.17e+03 3.5e+00 9.1e-02 0.657 0.628 0.00
  59 -1.024007222e+09 +1.06337771e+09 1.11e+03 3.5e+00 8.8e-02 0.657 0.628 0.00
  60 -1.023985398e+09 +1.06333406e+09 1.05e+03 3.5e+00 8.5e-02 0.656 0.628 0.00
  61 -1.023964213e+09 +1.06329169e+09 9.49e+02 3.6e+00 8.3e-02 0.656 0.628 0.00
  62 -1.023943663e+09 +1.06325059e+09 8.41e+02 3.6e+00 8.0e-02 0.656 0.628 0.00
  63 -1.023923778e+09 +1.06321082e+09 7.62e+02 3.6e+00 7.8e-02 0.656 0.628 0.00
  64 -1.023904511e+09 +1.06317229e+09 5.01e+02 3.7e+00 7.5e-02 0.657 0.629 0.00
  65 -1.023885825e+09 +1.06313492e+09 4.70e+02 3.7e+00 9.4e-02 0.657 0.629 0.00
  66 -1.023867676e+09 +1.06309862e+09 4.38e+02 3.7e+00 7.2e-02 0.657 0.629 0.00
  67 -1.023849980e+09 +1.06306323e+09 4.07e+02 3.7e+00 7.4e-02 0.657 0.629 0.00
  68 -1.023832631e+09 +1.06302853e+09 3.77e+02 3.6e+00 7.6e-02 0.657 0.629 0.00
  69 -1.023815450e+09 +1.06299417e+09 3.52e+02 3.6e+00 7.7e-02 0.657 0.629 0.00
  70 -1.023798323e+09 +1.06295991e+09 3.29e+02 3.6e+00 7.9e-02 0.657 0.629 0.00
  71 -1.023781118e+09 +1.06292550e+09 3.15e+02 3.6e+00 8.2e-02 0.658 0.629 0.00
  72 -1.023763762e+09 +1.06289079e+09 3.15e+02 3.6e+00 8.4e-02 0.658 0.629 0.00
  73 -1.023746202e+09 +1.06285567e+09 3.14e+02 3.6e+00 8.6e-02 0.658 0.628 0.00
  74 -1.023728428e+09 +1.06282012e+09 3.11e+02 3.6e+00 8.7e-02 0.658 0.628 0.00
  75 -1.023710440e+09 +1.06278415e+09 3.07e+02 3.5e+00 8.8e-02 0.658 0.628 0.00
  76 -1.023692266e+09 +1.06274780e+09 3.02e+02 3.4e+00 8.9e-02 0.658 0.628 0.00
  77 -1.023673964e+09 +1.06271120e+09 3.07e+02 3.3e+00 9.2e-02 0.659 0.628 0.00
  78 -1.023655586e+09 +1.06267444e+09 3.22e+02 3.2e+00 9.5e-02 0.659 0.628 0.00
  79 -1.023637187e+09 +1.06263764e+09 3.38e+02 3.1e+00 1.0e-01 0.659 0.628 0.00
  80 -1.023618823e+09 +1.06260091e+09 3.53e+02 3.0e+00 1.1e-01 0.659 0.628 0.00
  81 -1.023600588e+09 +1.06256444e+09 2.84e+02 2.8e+00 1.1e-01 0.659 0.628 0.00
  82 -1.023582595e+09 +1.06252846e+09 2.65e+02 2.7e+00 1.2e-01 0.659 0.628 0.00
  83 -1.023564968e+09 +1.06249320e+09 2.69e+02 2.6e+00 1.2e-01 0.659 0.628 0.00
  84 -1.023547818e+09 +1.06245890e+09 2.85e+02 2.4e+00 1.3e-01 0.659 0.627 0.00
  85 -1.023531236e+09 +1.06242574e+09 3.03e+02 2.2e+00 1.3e-01 0.659 0.627 0.00
  86 -1.023515223e+09 +1.06239371e+09 3.21e+02 2.1e+00 1.3e-01 0.659 0.627 0.00
  87 -1.023499732e+09 +1.06236273e+09 3.40e+02 2.0e+00 1.3e-01 0.659 0.627 0.00
  88 -1.023484779e+09 +1.06233283e+09 3.58e+02 1.9e+00 1.2e-01 0.659 0.627 0.00
  89 -1.023470395e+09 +1.06230406e+09 3.74e+02 1.7e+00 1.2e-01 0.659 0.627 0.00
  90 -1.023456609e+09 +1.06227649e+09 3.87e+02 1.7e+00 1.2e-01 0.659 0.627 0.00
  91 -1.023443404e+09 +1.06225008e+09 3.98e+02 1.7e+00 1.2e-01 0.659 0.627 0.00
  92 -1.023430783e+09 +1.06222483e+09 4.06e+02 1.7e+00 1.2e-01 0.659 0.627 0.00
  93 -1.023418778e+09 +1.06220082e+09 4.12e+02 1.6e+00 1.2e-01 0.660 0.627 0.00
  94 -1.023407444e+09 +1.06217816e+09 4.15e+02 1.6e+00 1.2e-01 0.660 0.627 0.00
  95 -1.023396834e+09 +1.06215694e+09 4.16e+02 1.5e+00 1.1e-01 0.660 0.627 0.00
  96 -1.023386980e+09 +1.06213723e+09 4.14e+02 1.4e+00 1.1e-01 0.660 0.627 0.00
  97 -1.023377924e+09 +1.06211912e+09 4.10e+02 1.3e+00 1.0e-01 0.660 0.627 0.00
  98 -1.023369694e+09 +1.06210266e+09 4.03e+02 1.2e+00 9.6e-02 0.660 0.627 0.00
  99 -1.023362288e+09 +1.06208784e+09 3.92e+02 1.2e+00 9.1e-02 0.660 0.627 0.00
 100 -1.023355685e+09 +1.06207464e+09 3.76e+02 1.2e+00 8.5e-02 0.660 0.627 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
226509.25  11044.32  85183.73 
