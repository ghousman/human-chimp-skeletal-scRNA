
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 6"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-6 Poisson NMF to 101534 x 18454 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.115398364e+09 +1.24379484e+09 1.51e+04 1.9e+02 9.3e-01 0.806 0.647 0.00
   2 -1.105851656e+09 +1.22470142e+09 1.01e+04 5.7e+01 2.7e+00 0.825 0.764 0.00
   3 -1.101579716e+09 +1.21615754e+09 4.08e+04 3.6e+01 1.7e+00 0.825 0.720 0.00
   4 -1.099242868e+09 +1.21148384e+09 2.73e+03 2.6e+01 1.6e+00 0.827 0.714 0.00
   5 -1.098063311e+09 +1.20912473e+09 1.02e+03 1.6e+01 1.4e+00 0.829 0.712 0.00
   6 -1.097268392e+09 +1.20753489e+09 2.30e+03 1.1e+01 1.3e+00 0.830 0.707 0.00
   7 -1.096609941e+09 +1.20621799e+09 1.45e+03 9.0e+00 1.0e+00 0.831 0.698 0.00
   8 -1.096024688e+09 +1.20504748e+09 6.09e+02 8.0e+00 7.2e-01 0.832 0.692 0.00
   9 -1.095506383e+09 +1.20401087e+09 5.88e+02 7.2e+00 6.0e-01 0.833 0.688 0.00
  10 -1.095060092e+09 +1.20311829e+09 5.62e+02 6.6e+00 5.7e-01 0.833 0.687 0.00
  11 -1.094685743e+09 +1.20236959e+09 4.98e+02 6.1e+00 5.2e-01 0.833 0.686 0.00
  12 -1.094378554e+09 +1.20175522e+09 4.21e+02 5.6e+00 4.5e-01 0.833 0.686 0.00
  13 -1.094132659e+09 +1.20126342e+09 3.92e+02 4.8e+00 4.1e-01 0.832 0.686 0.00
  14 -1.093940247e+09 +1.20087860e+09 3.44e+02 3.7e+00 3.6e-01 0.832 0.686 0.00
  15 -1.093788434e+09 +1.20057498e+09 3.68e+02 2.9e+00 2.9e-01 0.831 0.687 0.00
  16 -1.093664789e+09 +1.20032769e+09 3.95e+02 2.7e+00 2.4e-01 0.829 0.687 0.00
  17 -1.093559824e+09 +1.20011775e+09 4.27e+02 2.5e+00 1.9e-01 0.828 0.688 0.00
  18 -1.093467764e+09 +1.19993363e+09 4.56e+02 2.4e+00 1.6e-01 0.826 0.689 0.00
  19 -1.093384506e+09 +1.19976712e+09 4.81e+02 2.3e+00 1.3e-01 0.825 0.691 0.00
  20 -1.093307530e+09 +1.19961317e+09 5.00e+02 2.5e+00 1.4e-01 0.823 0.692 0.00
  21 -1.093235926e+09 +1.19946996e+09 5.11e+02 2.7e+00 1.4e-01 0.822 0.694 0.00
  22 -1.093168755e+09 +1.19933562e+09 5.14e+02 2.8e+00 1.4e-01 0.820 0.696 0.00
  23 -1.093105614e+09 +1.19920934e+09 4.92e+02 2.9e+00 1.4e-01 0.819 0.697 0.00
  24 -1.093046198e+09 +1.19909050e+09 4.89e+02 2.9e+00 1.4e-01 0.817 0.699 0.00
  25 -1.092990228e+09 +1.19897856e+09 5.05e+02 3.0e+00 1.4e-01 0.816 0.701 0.00
  26 -1.092937593e+09 +1.19887329e+09 5.13e+02 3.0e+00 1.4e-01 0.815 0.702 0.00
  27 -1.092888258e+09 +1.19877462e+09 5.13e+02 3.0e+00 1.3e-01 0.814 0.704 0.00
  28 -1.092842270e+09 +1.19868265e+09 5.08e+02 2.9e+00 1.3e-01 0.813 0.705 0.00
  29 -1.092799619e+09 +1.19859735e+09 4.97e+02 2.9e+00 1.2e-01 0.811 0.707 0.00
  30 -1.092760270e+09 +1.19851865e+09 4.83e+02 2.9e+00 1.2e-01 0.810 0.708 0.00
  31 -1.092724230e+09 +1.19844657e+09 4.76e+02 2.9e+00 1.1e-01 0.809 0.710 0.00
  32 -1.092691333e+09 +1.19838077e+09 4.89e+02 2.9e+00 1.1e-01 0.808 0.711 0.00
  33 -1.092661501e+09 +1.19832111e+09 4.95e+02 2.9e+00 1.0e-01 0.807 0.712 0.00
  34 -1.092634667e+09 +1.19826744e+09 4.95e+02 2.8e+00 9.7e-02 0.806 0.713 0.00
  35 -1.092610693e+09 +1.19821949e+09 4.81e+02 2.7e+00 9.2e-02 0.805 0.714 0.00
  36 -1.092589368e+09 +1.19817684e+09 4.60e+02 2.5e+00 8.6e-02 0.804 0.714 0.00
  37 -1.092570590e+09 +1.19813929e+09 4.49e+02 2.4e+00 8.0e-02 0.803 0.715 0.00
  38 -1.092553894e+09 +1.19810590e+09 4.33e+02 2.2e+00 7.8e-02 0.802 0.716 0.00
  39 -1.092539291e+09 +1.19807669e+09 4.14e+02 2.0e+00 7.7e-02 0.802 0.717 0.00
  40 -1.092526468e+09 +1.19805104e+09 3.93e+02 1.9e+00 7.5e-02 0.801 0.717 0.00
  41 -1.092515154e+09 +1.19802842e+09 3.70e+02 1.8e+00 7.1e-02 0.801 0.718 0.00
  42 -1.092505126e+09 +1.19800836e+09 3.48e+02 1.7e+00 6.6e-02 0.800 0.718 0.00
  43 -1.092496194e+09 +1.19799050e+09 3.26e+02 1.6e+00 6.0e-02 0.800 0.719 0.00
  44 -1.092488225e+09 +1.19797456e+09 3.05e+02 1.5e+00 5.4e-02 0.799 0.719 0.00
  45 -1.092481086e+09 +1.19796028e+09 2.85e+02 1.4e+00 4.9e-02 0.799 0.719 0.00
  46 -1.092474664e+09 +1.19794744e+09 2.66e+02 1.3e+00 4.5e-02 0.798 0.720 0.00
  47 -1.092468867e+09 +1.19793584e+09 2.48e+02 1.2e+00 4.3e-02 0.798 0.720 0.00
  48 -1.092463612e+09 +1.19792533e+09 2.34e+02 1.1e+00 4.2e-02 0.798 0.720 0.00
  49 -1.092458834e+09 +1.19791578e+09 2.26e+02 1.1e+00 4.1e-02 0.797 0.720 0.00
  50 -1.092454485e+09 +1.19790708e+09 2.18e+02 1.0e+00 4.0e-02 0.797 0.721 0.00
  51 -1.092450527e+09 +1.19789916e+09 2.11e+02 9.4e-01 3.9e-02 0.797 0.721 0.00
  52 -1.092446928e+09 +1.19789196e+09 2.03e+02 8.9e-01 3.8e-02 0.797 0.721 0.00
  53 -1.092443657e+09 +1.19788542e+09 1.96e+02 8.4e-01 3.7e-02 0.796 0.721 0.00
  54 -1.092440687e+09 +1.19787948e+09 1.87e+02 8.0e-01 3.6e-02 0.796 0.721 0.00
  55 -1.092437994e+09 +1.19787409e+09 1.80e+02 7.5e-01 3.4e-02 0.796 0.721 0.00
  56 -1.092435558e+09 +1.19786922e+09 1.72e+02 7.1e-01 3.3e-02 0.796 0.721 0.00
  57 -1.092433358e+09 +1.19786482e+09 1.64e+02 6.7e-01 3.2e-02 0.796 0.722 0.00
  58 -1.092431374e+09 +1.19786086e+09 1.57e+02 6.3e-01 3.0e-02 0.796 0.722 0.00
  59 -1.092429588e+09 +1.19785728e+09 1.50e+02 6.0e-01 2.9e-02 0.796 0.722 0.00
  60 -1.092427981e+09 +1.19785407e+09 1.43e+02 5.6e-01 2.7e-02 0.796 0.722 0.00
  61 -1.092426537e+09 +1.19785118e+09 1.36e+02 5.3e-01 2.6e-02 0.795 0.722 0.00
  62 -1.092425242e+09 +1.19784859e+09 1.29e+02 5.0e-01 2.5e-02 0.795 0.722 0.00
  63 -1.092424082e+09 +1.19784627e+09 1.22e+02 4.7e-01 2.4e-02 0.795 0.722 0.00
  64 -1.092423043e+09 +1.19784419e+09 1.16e+02 4.4e-01 2.2e-02 0.795 0.722 0.00
  65 -1.092422114e+09 +1.19784234e+09 1.10e+02 4.2e-01 2.1e-02 0.795 0.722 0.00
  66 -1.092421284e+09 +1.19784068e+09 1.04e+02 3.9e-01 2.0e-02 0.795 0.722 0.00
  67 -1.092420543e+09 +1.19783919e+09 9.83e+01 3.7e-01 1.9e-02 0.795 0.723 0.00
  68 -1.092419880e+09 +1.19783787e+09 9.30e+01 3.5e-01 1.8e-02 0.795 0.723 0.00
  69 -1.092419289e+09 +1.19783668e+09 8.81e+01 3.3e-01 1.7e-02 0.795 0.723 0.00
  70 -1.092418761e+09 +1.19783563e+09 8.33e+01 3.1e-01 1.6e-02 0.795 0.723 0.00
  71 -1.092418291e+09 +1.19783469e+09 7.88e+01 2.9e-01 1.5e-02 0.795 0.723 0.00
  72 -1.092417872e+09 +1.19783385e+09 7.44e+01 2.7e-01 1.4e-02 0.794 0.723 0.00
  73 -1.092417500e+09 +1.19783311e+09 7.03e+01 2.5e-01 1.3e-02 0.794 0.723 0.00
  74 -1.092417168e+09 +1.19783244e+09 6.64e+01 2.4e-01 1.3e-02 0.794 0.723 0.00
  75 -1.092416873e+09 +1.19783185e+09 6.26e+01 2.3e-01 1.2e-02 0.794 0.723 0.00
  76 -1.092416611e+09 +1.19783133e+09 5.91e+01 2.1e-01 1.1e-02 0.794 0.723 0.00
  77 -1.092416377e+09 +1.19783086e+09 5.58e+01 2.0e-01 1.0e-02 0.794 0.723 0.00
  78 -1.092416169e+09 +1.19783045e+09 5.27e+01 1.9e-01 9.9e-03 0.794 0.723 0.00
  79 -1.092415984e+09 +1.19783008e+09 4.99e+01 1.8e-01 9.3e-03 0.794 0.723 0.00
  80 -1.092415819e+09 +1.19782975e+09 4.71e+01 1.7e-01 8.8e-03 0.794 0.723 0.00
  81 -1.092415673e+09 +1.19782945e+09 4.45e+01 1.6e-01 8.3e-03 0.794 0.724 0.00
  82 -1.092415543e+09 +1.19782919e+09 4.20e+01 1.5e-01 7.8e-03 0.794 0.724 0.00
  83 -1.092415428e+09 +1.19782896e+09 3.99e+01 1.4e-01 7.3e-03 0.794 0.724 0.00
  84 -1.092415325e+09 +1.19782876e+09 3.81e+01 1.3e-01 6.9e-03 0.794 0.724 0.00
  85 -1.092415233e+09 +1.19782857e+09 3.63e+01 1.2e-01 6.5e-03 0.794 0.724 0.00
  86 -1.092415152e+09 +1.19782841e+09 3.45e+01 1.2e-01 6.2e-03 0.794 0.724 0.00
  87 -1.092415079e+09 +1.19782827e+09 3.27e+01 1.1e-01 5.8e-03 0.794 0.724 0.00
  88 -1.092415015e+09 +1.19782814e+09 3.10e+01 1.0e-01 5.5e-03 0.794 0.724 0.00
  89 -1.092414957e+09 +1.19782802e+09 2.93e+01 9.7e-02 5.2e-03 0.794 0.724 0.00
  90 -1.092414906e+09 +1.19782792e+09 2.77e+01 9.2e-02 4.9e-03 0.794 0.724 0.00
  91 -1.092414861e+09 +1.19782783e+09 2.62e+01 8.6e-02 4.6e-03 0.794 0.724 0.00
  92 -1.092414820e+09 +1.19782775e+09 2.47e+01 8.1e-02 4.4e-03 0.794 0.724 0.00
  93 -1.092414784e+09 +1.19782768e+09 2.34e+01 7.7e-02 4.1e-03 0.794 0.724 0.00
  94 -1.092414753e+09 +1.19782761e+09 2.21e+01 7.2e-02 3.9e-03 0.794 0.724 0.00
  95 -1.092414724e+09 +1.19782756e+09 2.08e+01 6.8e-02 3.7e-03 0.794 0.724 0.00
  96 -1.092414699e+09 +1.19782751e+09 1.96e+01 6.4e-02 3.5e-03 0.794 0.724 0.00
  97 -1.092414677e+09 +1.19782746e+09 1.85e+01 6.1e-02 3.3e-03 0.794 0.724 0.00
  98 -1.092414657e+09 +1.19782742e+09 1.75e+01 5.7e-02 3.1e-03 0.794 0.724 0.00
  99 -1.092414639e+09 +1.19782739e+09 1.65e+01 5.4e-02 2.9e-03 0.794 0.724 0.00
 100 -1.092414623e+09 +1.19782735e+09 1.55e+01 5.1e-02 2.7e-03 0.794 0.724 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
96421.187  9021.367 48611.254 
