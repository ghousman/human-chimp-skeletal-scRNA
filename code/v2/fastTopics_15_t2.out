
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 15"
> print(paste0("data source: ",data.source))
[1] "data source: t2"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-15 Poisson NMF to 27151 x 17304 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -2.399787625e+08 +2.71763347e+08 1.14e+04 3.4e+02 3.3e+00 0.536 0.426 0.00
   2 -2.317254945e+08 +2.55256811e+08 1.21e+04 2.5e+02 5.3e+00 0.564 0.565 0.00
   3 -2.291746005e+08 +2.50155023e+08 1.02e+04 1.2e+02 3.6e+00 0.586 0.574 0.00
   4 -2.282769739e+08 +2.48359770e+08 8.63e+03 9.3e+01 2.3e+00 0.595 0.593 0.00
   5 -2.277821282e+08 +2.47370078e+08 5.81e+03 6.2e+01 8.0e-01 0.602 0.598 0.00
   6 -2.274700733e+08 +2.46745968e+08 4.55e+03 3.9e+01 6.0e-01 0.607 0.599 0.00
   7 -2.272585416e+08 +2.46322905e+08 4.11e+03 2.3e+01 5.7e-01 0.611 0.600 0.00
   8 -2.271033910e+08 +2.46012604e+08 3.20e+03 2.2e+01 5.1e-01 0.615 0.601 0.00
   9 -2.269829135e+08 +2.45771649e+08 2.24e+03 2.5e+01 4.4e-01 0.618 0.603 0.00
  10 -2.268835233e+08 +2.45572868e+08 1.79e+03 3.0e+01 3.7e-01 0.620 0.605 0.00
  11 -2.267904131e+08 +2.45386648e+08 1.65e+03 3.9e+01 3.7e-01 0.622 0.608 0.00
  12 -2.266866138e+08 +2.45179050e+08 1.41e+03 5.1e+01 5.4e-01 0.623 0.610 0.00
  13 -2.265707654e+08 +2.44947353e+08 1.18e+03 5.8e+01 6.6e-01 0.623 0.613 0.00
  14 -2.264811274e+08 +2.44768077e+08 1.03e+03 5.0e+01 5.0e-01 0.623 0.617 0.00
  15 -2.264235280e+08 +2.44652878e+08 9.29e+02 4.1e+01 2.9e-01 0.623 0.620 0.00
  16 -2.263809277e+08 +2.44567677e+08 8.40e+02 3.5e+01 2.4e-01 0.623 0.623 0.00
  17 -2.263476382e+08 +2.44501098e+08 7.52e+02 3.1e+01 2.4e-01 0.623 0.626 0.00
  18 -2.263213003e+08 +2.44448422e+08 5.91e+02 2.7e+01 2.3e-01 0.623 0.628 0.00
  19 -2.263002391e+08 +2.44406300e+08 4.53e+02 2.4e+01 2.1e-01 0.624 0.630 0.00
  20 -2.262834225e+08 +2.44372667e+08 3.46e+02 2.1e+01 1.8e-01 0.624 0.632 0.00
  21 -2.262699988e+08 +2.44345819e+08 2.12e+02 1.9e+01 1.6e-01 0.624 0.634 0.00
  22 -2.262592166e+08 +2.44324255e+08 1.92e+02 1.6e+01 1.4e-01 0.623 0.635 0.00
  23 -2.262505075e+08 +2.44306837e+08 1.74e+02 1.4e+01 1.2e-01 0.623 0.636 0.00
  24 -2.262434296e+08 +2.44292681e+08 1.56e+02 1.1e+01 9.9e-02 0.623 0.637 0.00
  25 -2.262376429e+08 +2.44281108e+08 1.40e+02 9.5e+00 8.3e-02 0.624 0.638 0.00
  26 -2.262328647e+08 +2.44271551e+08 1.25e+02 8.0e+00 6.9e-02 0.624 0.638 0.00
  27 -2.262288789e+08 +2.44263580e+08 1.10e+02 6.7e+00 5.7e-02 0.624 0.639 0.00
  28 -2.262255269e+08 +2.44256876e+08 9.88e+01 5.6e+00 4.8e-02 0.624 0.640 0.00
  29 -2.262226919e+08 +2.44251206e+08 9.19e+01 4.7e+00 4.1e-02 0.624 0.640 0.00
  30 -2.262202821e+08 +2.44246386e+08 1.00e+02 4.0e+00 3.7e-02 0.624 0.640 0.00
  31 -2.262182229e+08 +2.44242268e+08 9.75e+01 3.4e+00 3.4e-02 0.624 0.640 0.00
  32 -2.262164559e+08 +2.44238734e+08 1.19e+02 2.9e+00 3.1e-02 0.624 0.640 0.00
  33 -2.262149351e+08 +2.44235692e+08 1.41e+02 2.5e+00 2.9e-02 0.624 0.641 0.00
  34 -2.262136219e+08 +2.44233066e+08 1.42e+02 2.2e+00 2.6e-02 0.624 0.641 0.00
  35 -2.262124839e+08 +2.44230790e+08 1.39e+02 2.0e+00 2.4e-02 0.624 0.641 0.00
  36 -2.262114936e+08 +2.44228809e+08 1.36e+02 1.7e+00 2.2e-02 0.624 0.641 0.00
  37 -2.262106283e+08 +2.44227078e+08 1.31e+02 1.5e+00 2.0e-02 0.624 0.641 0.00
  38 -2.262098687e+08 +2.44225559e+08 1.26e+02 1.4e+00 1.9e-02 0.625 0.641 0.00
  39 -2.262091992e+08 +2.44224220e+08 1.20e+02 1.2e+00 1.7e-02 0.625 0.641 0.00
  40 -2.262086069e+08 +2.44223036e+08 1.15e+02 1.1e+00 1.6e-02 0.625 0.641 0.00
  41 -2.262080801e+08 +2.44221982e+08 1.10e+02 9.7e-01 1.5e-02 0.625 0.642 0.00
  42 -2.262076111e+08 +2.44221044e+08 1.05e+02 8.6e-01 1.4e-02 0.625 0.642 0.00
  43 -2.262071924e+08 +2.44220207e+08 1.02e+02 7.7e-01 1.4e-02 0.625 0.642 0.00
  44 -2.262068172e+08 +2.44219456e+08 9.78e+01 6.9e-01 1.3e-02 0.625 0.642 0.00
  45 -2.262064805e+08 +2.44218783e+08 9.36e+01 6.2e-01 1.3e-02 0.625 0.642 0.00
  46 -2.262061774e+08 +2.44218177e+08 8.91e+01 5.6e-01 1.2e-02 0.625 0.642 0.00
  47 -2.262059037e+08 +2.44217629e+08 8.48e+01 5.0e-01 1.2e-02 0.625 0.642 0.00
  48 -2.262056555e+08 +2.44217133e+08 8.06e+01 4.5e-01 1.2e-02 0.625 0.642 0.00
  49 -2.262054294e+08 +2.44216681e+08 7.66e+01 4.1e-01 1.1e-02 0.625 0.642 0.00
  50 -2.262052228e+08 +2.44216267e+08 7.31e+01 3.7e-01 1.1e-02 0.625 0.642 0.00
  51 -2.262050334e+08 +2.44215889e+08 6.97e+01 3.4e-01 1.1e-02 0.625 0.642 0.00
  52 -2.262048595e+08 +2.44215541e+08 6.64e+01 3.1e-01 1.1e-02 0.625 0.642 0.00
  53 -2.262046998e+08 +2.44215222e+08 6.32e+01 2.8e-01 1.0e-02 0.625 0.642 0.00
  54 -2.262045529e+08 +2.44214928e+08 6.03e+01 2.5e-01 1.0e-02 0.625 0.642 0.00
  55 -2.262044175e+08 +2.44214657e+08 5.74e+01 2.3e-01 9.9e-03 0.625 0.642 0.00
  56 -2.262042925e+08 +2.44214407e+08 5.47e+01 2.1e-01 9.6e-03 0.625 0.642 0.00
  57 -2.262041771e+08 +2.44214176e+08 5.22e+01 1.9e-01 9.4e-03 0.625 0.642 0.00
  58 -2.262040702e+08 +2.44213962e+08 4.97e+01 1.7e-01 9.1e-03 0.625 0.642 0.00
  59 -2.262039712e+08 +2.44213764e+08 4.74e+01 1.6e-01 8.9e-03 0.625 0.642 0.00
  60 -2.262038794e+08 +2.44213581e+08 4.52e+01 1.4e-01 8.7e-03 0.625 0.642 0.00
  61 -2.262037942e+08 +2.44213410e+08 4.39e+01 1.4e-01 8.4e-03 0.625 0.642 0.00
  62 -2.262037151e+08 +2.44213252e+08 4.28e+01 1.3e-01 8.2e-03 0.625 0.642 0.00
  63 -2.262036415e+08 +2.44213105e+08 4.17e+01 1.3e-01 8.0e-03 0.625 0.642 0.00
  64 -2.262035727e+08 +2.44212967e+08 4.08e+01 1.3e-01 7.8e-03 0.625 0.642 0.00
  65 -2.262035081e+08 +2.44212838e+08 4.02e+01 1.3e-01 7.6e-03 0.625 0.642 0.00
  66 -2.262034473e+08 +2.44212717e+08 3.96e+01 1.2e-01 7.4e-03 0.625 0.642 0.00
  67 -2.262033902e+08 +2.44212602e+08 3.90e+01 1.2e-01 7.3e-03 0.625 0.642 0.00
  68 -2.262033364e+08 +2.44212495e+08 3.82e+01 1.2e-01 7.1e-03 0.625 0.642 0.00
  69 -2.262032856e+08 +2.44212393e+08 3.75e+01 1.2e-01 7.0e-03 0.625 0.642 0.00
  70 -2.262032378e+08 +2.44212298e+08 3.67e+01 1.2e-01 6.8e-03 0.625 0.642 0.00
  71 -2.262031927e+08 +2.44212207e+08 3.59e+01 1.1e-01 6.7e-03 0.625 0.642 0.00
  72 -2.262031502e+08 +2.44212122e+08 3.51e+01 1.1e-01 6.5e-03 0.625 0.642 0.00
  73 -2.262031100e+08 +2.44212042e+08 3.43e+01 1.1e-01 6.4e-03 0.625 0.642 0.00
  74 -2.262030720e+08 +2.44211966e+08 3.34e+01 1.1e-01 6.2e-03 0.625 0.642 0.00
  75 -2.262030361e+08 +2.44211894e+08 3.26e+01 1.0e-01 6.1e-03 0.625 0.642 0.00
  76 -2.262030022e+08 +2.44211826e+08 3.18e+01 1.0e-01 6.0e-03 0.625 0.642 0.00
  77 -2.262029701e+08 +2.44211762e+08 3.09e+01 1.0e-01 5.8e-03 0.625 0.642 0.00
  78 -2.262029398e+08 +2.44211702e+08 3.00e+01 9.8e-02 5.7e-03 0.625 0.642 0.00
  79 -2.262029111e+08 +2.44211644e+08 2.92e+01 9.6e-02 5.6e-03 0.625 0.642 0.00
  80 -2.262028840e+08 +2.44211590e+08 2.84e+01 9.4e-02 5.4e-03 0.625 0.642 0.00
  81 -2.262028584e+08 +2.44211539e+08 2.76e+01 9.2e-02 5.3e-03 0.625 0.642 0.00
  82 -2.262028341e+08 +2.44211490e+08 2.67e+01 9.0e-02 5.2e-03 0.625 0.642 0.00
  83 -2.262028112e+08 +2.44211444e+08 2.60e+01 8.8e-02 5.0e-03 0.625 0.642 0.00
  84 -2.262027895e+08 +2.44211401e+08 2.52e+01 8.5e-02 4.9e-03 0.625 0.642 0.00
  85 -2.262027689e+08 +2.44211360e+08 2.44e+01 8.3e-02 4.8e-03 0.625 0.642 0.00
  86 -2.262027495e+08 +2.44211321e+08 2.37e+01 8.1e-02 4.7e-03 0.625 0.642 0.00
  87 -2.262027311e+08 +2.44211284e+08 2.29e+01 7.9e-02 4.6e-03 0.625 0.642 0.00
  88 -2.262027138e+08 +2.44211249e+08 2.22e+01 7.7e-02 4.5e-03 0.625 0.642 0.00
  89 -2.262026973e+08 +2.44211217e+08 2.14e+01 7.6e-02 4.3e-03 0.625 0.642 0.00
  90 -2.262026818e+08 +2.44211186e+08 2.07e+01 7.4e-02 4.2e-03 0.625 0.642 0.00
  91 -2.262026672e+08 +2.44211156e+08 2.00e+01 7.2e-02 4.1e-03 0.625 0.642 0.00
  92 -2.262026533e+08 +2.44211128e+08 1.93e+01 7.0e-02 4.0e-03 0.625 0.642 0.00
  93 -2.262026402e+08 +2.44211102e+08 1.85e+01 6.8e-02 3.9e-03 0.625 0.642 0.00
  94 -2.262026278e+08 +2.44211078e+08 1.79e+01 6.6e-02 3.8e-03 0.625 0.642 0.00
  95 -2.262026162e+08 +2.44211054e+08 1.72e+01 6.4e-02 3.7e-03 0.625 0.642 0.00
  96 -2.262026051e+08 +2.44211032e+08 1.65e+01 6.3e-02 3.6e-03 0.625 0.642 0.00
  97 -2.262025947e+08 +2.44211011e+08 1.59e+01 6.1e-02 3.5e-03 0.625 0.642 0.00
  98 -2.262025849e+08 +2.44210992e+08 1.53e+01 5.9e-02 3.4e-03 0.625 0.642 0.00
  99 -2.262025756e+08 +2.44210973e+08 1.48e+01 5.7e-02 3.3e-03 0.625 0.642 0.00
 100 -2.262025668e+08 +2.44210956e+08 1.43e+01 5.6e-02 3.2e-03 0.625 0.642 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
    user   system  elapsed 
40134.97  1727.60 16125.36 
