
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 6"
> print(paste0("data source: ",data.source))
[1] "data source: t2"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> rm(data)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(counts, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-6 Poisson NMF to 27151 x 17304 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -2.556064489e+08 +3.03018720e+08 1.40e+04 1.3e+02 1.9e+00 0.720 0.599 0.00
   2 -2.496055781e+08 +2.91016978e+08 3.15e+04 3.2e+01 2.4e+00 0.759 0.746 0.00
   3 -2.469095092e+08 +2.85624840e+08 8.31e+03 4.4e+01 2.2e+00 0.769 0.708 0.00
   4 -2.456740114e+08 +2.83153845e+08 4.08e+03 5.1e+01 8.8e-01 0.776 0.711 0.00
   5 -2.448894042e+08 +2.81584630e+08 1.21e+03 6.4e+01 7.0e-01 0.777 0.720 0.00
   6 -2.442877477e+08 +2.80381317e+08 8.82e+02 6.1e+01 7.5e-01 0.779 0.724 0.00
   7 -2.438542746e+08 +2.79514371e+08 5.85e+02 4.5e+01 8.1e-01 0.780 0.730 0.00
   8 -2.435569863e+08 +2.78919794e+08 5.12e+02 3.4e+01 8.9e-01 0.782 0.735 0.00
   9 -2.433498262e+08 +2.78505474e+08 5.64e+02 2.7e+01 8.9e-01 0.782 0.739 0.00
  10 -2.431998025e+08 +2.78205427e+08 5.93e+02 2.1e+01 8.7e-01 0.781 0.745 0.00
  11 -2.430896291e+08 +2.77985080e+08 7.18e+02 1.7e+01 8.2e-01 0.781 0.750 0.00
  12 -2.430075670e+08 +2.77820956e+08 6.64e+02 1.4e+01 6.4e-01 0.780 0.755 0.00
  13 -2.429461351e+08 +2.77698092e+08 8.28e+02 1.2e+01 4.6e-01 0.779 0.759 0.00
  14 -2.429006162e+08 +2.77607054e+08 1.04e+03 1.0e+01 3.2e-01 0.777 0.762 0.00
  15 -2.428667998e+08 +2.77539422e+08 1.16e+03 8.8e+00 2.2e-01 0.776 0.764 0.00
  16 -2.428412767e+08 +2.77488375e+08 1.15e+03 7.8e+00 1.7e-01 0.776 0.766 0.00
  17 -2.428218341e+08 +2.77449490e+08 9.95e+02 6.9e+00 1.4e-01 0.775 0.767 0.00
  18 -2.428067601e+08 +2.77419342e+08 7.49e+02 6.2e+00 1.2e-01 0.775 0.768 0.00
  19 -2.427951107e+08 +2.77396043e+08 4.87e+02 5.5e+00 9.8e-02 0.774 0.769 0.00
  20 -2.427860856e+08 +2.77377993e+08 2.80e+02 4.9e+00 8.3e-02 0.774 0.770 0.00
  21 -2.427790603e+08 +2.77363943e+08 1.51e+02 4.3e+00 7.1e-02 0.773 0.770 0.00
  22 -2.427735658e+08 +2.77352953e+08 1.05e+02 3.8e+00 6.1e-02 0.773 0.771 0.00
  23 -2.427692409e+08 +2.77344304e+08 9.29e+01 3.3e+00 5.3e-02 0.773 0.772 0.00
  24 -2.427658185e+08 +2.77337459e+08 8.07e+01 2.9e+00 4.6e-02 0.772 0.772 0.00
  25 -2.427631032e+08 +2.77332028e+08 6.95e+01 2.6e+00 4.0e-02 0.772 0.773 0.00
  26 -2.427609441e+08 +2.77327710e+08 6.20e+01 2.3e+00 3.5e-02 0.772 0.773 0.00
  27 -2.427592326e+08 +2.77324287e+08 5.60e+01 2.0e+00 3.1e-02 0.772 0.774 0.00
  28 -2.427578739e+08 +2.77321570e+08 5.06e+01 1.8e+00 2.8e-02 0.771 0.774 0.00
  29 -2.427567910e+08 +2.77319404e+08 4.56e+01 1.6e+00 2.5e-02 0.771 0.774 0.00
  30 -2.427559325e+08 +2.77317687e+08 4.09e+01 1.4e+00 2.2e-02 0.771 0.774 0.00
  31 -2.427552571e+08 +2.77316336e+08 3.65e+01 1.2e+00 2.0e-02 0.771 0.775 0.00
  32 -2.427547267e+08 +2.77315275e+08 3.24e+01 1.1e+00 2.0e-02 0.771 0.775 0.00
  33 -2.427543097e+08 +2.77314441e+08 2.88e+01 9.5e-01 1.8e-02 0.771 0.775 0.00
  34 -2.427539803e+08 +2.77313783e+08 2.55e+01 8.2e-01 1.6e-02 0.771 0.775 0.00
  35 -2.427537193e+08 +2.77313261e+08 2.26e+01 7.1e-01 1.4e-02 0.771 0.775 0.00
  36 -2.427535123e+08 +2.77312846e+08 2.01e+01 6.2e-01 1.3e-02 0.771 0.775 0.00
  37 -2.427533480e+08 +2.77312518e+08 1.79e+01 5.3e-01 1.1e-02 0.771 0.775 0.00
  38 -2.427532177e+08 +2.77312257e+08 1.59e+01 4.6e-01 1.0e-02 0.771 0.775 0.00
  39 -2.427531143e+08 +2.77312051e+08 1.42e+01 4.0e-01 8.9e-03 0.771 0.775 0.00
  40 -2.427530324e+08 +2.77311887e+08 1.26e+01 3.5e-01 7.9e-03 0.771 0.775 0.00
  41 -2.427529674e+08 +2.77311757e+08 1.12e+01 3.0e-01 7.0e-03 0.771 0.775 0.00
  42 -2.427529159e+08 +2.77311654e+08 9.95e+00 2.6e-01 6.2e-03 0.770 0.776 0.00
  43 -2.427528751e+08 +2.77311572e+08 8.85e+00 2.3e-01 5.5e-03 0.770 0.776 0.00
  44 -2.427528427e+08 +2.77311507e+08 7.86e+00 2.0e-01 4.9e-03 0.770 0.776 0.00
  45 -2.427528171e+08 +2.77311456e+08 6.98e+00 1.7e-01 4.3e-03 0.770 0.776 0.00
  46 -2.427527968e+08 +2.77311415e+08 6.19e+00 1.5e-01 3.8e-03 0.770 0.776 0.00
  47 -2.427527807e+08 +2.77311383e+08 5.50e+00 1.4e-01 3.4e-03 0.770 0.776 0.00
  48 -2.427527679e+08 +2.77311358e+08 4.88e+00 1.2e-01 3.0e-03 0.770 0.776 0.00
  49 -2.427527578e+08 +2.77311338e+08 4.33e+00 1.1e-01 2.6e-03 0.770 0.776 0.00
  50 -2.427527498e+08 +2.77311322e+08 3.88e+00 9.5e-02 2.3e-03 0.770 0.776 0.00
  51 -2.427527435e+08 +2.77311309e+08 3.48e+00 8.4e-02 2.1e-03 0.770 0.776 0.00
  52 -2.427527384e+08 +2.77311299e+08 3.12e+00 7.5e-02 1.8e-03 0.770 0.776 0.00
  53 -2.427527344e+08 +2.77311291e+08 2.80e+00 6.6e-02 1.6e-03 0.770 0.776 0.00
  54 -2.427527312e+08 +2.77311284e+08 2.51e+00 5.9e-02 1.4e-03 0.770 0.776 0.00
  55 -2.427527287e+08 +2.77311279e+08 2.25e+00 5.2e-02 1.3e-03 0.770 0.776 0.00
  56 -2.427527266e+08 +2.77311275e+08 2.02e+00 4.6e-02 1.1e-03 0.770 0.776 0.00
  57 -2.427527250e+08 +2.77311272e+08 1.82e+00 4.1e-02 9.8e-04 0.770 0.776 0.00
  58 -2.427527237e+08 +2.77311269e+08 1.63e+00 3.6e-02 8.7e-04 0.770 0.776 0.00
  59 -2.427527227e+08 +2.77311267e+08 1.46e+00 3.2e-02 7.7e-04 0.770 0.776 0.00
  60 -2.427527219e+08 +2.77311266e+08 1.31e+00 2.8e-02 6.8e-04 0.770 0.776 0.00
  61 -2.427527212e+08 +2.77311264e+08 1.18e+00 2.5e-02 6.0e-04 0.770 0.776 0.00
  62 -2.427527207e+08 +2.77311263e+08 1.06e+00 2.2e-02 5.3e-04 0.770 0.776 0.00
  63 -2.427527202e+08 +2.77311262e+08 9.52e-01 2.0e-02 4.7e-04 0.770 0.776 0.00
  64 -2.427527199e+08 +2.77311262e+08 8.56e-01 1.7e-02 4.1e-04 0.770 0.776 0.00
  65 -2.427527196e+08 +2.77311261e+08 7.69e-01 1.5e-02 3.7e-04 0.770 0.776 0.00
  66 -2.427527194e+08 +2.77311261e+08 6.92e-01 1.3e-02 3.2e-04 0.770 0.776 0.00
  67 -2.427527192e+08 +2.77311260e+08 6.22e-01 1.2e-02 2.8e-04 0.770 0.776 0.00
  68 -2.427527191e+08 +2.77311260e+08 5.60e-01 1.0e-02 2.6e-04 0.770 0.776 0.00
  69 -2.427527189e+08 +2.77311260e+08 5.04e-01 9.2e-03 2.4e-04 0.770 0.776 0.00
  70 -2.427527188e+08 +2.77311260e+08 4.54e-01 8.1e-03 2.2e-04 0.770 0.776 0.00
  71 -2.427527188e+08 +2.77311259e+08 4.09e-01 7.2e-03 2.0e-04 0.770 0.776 0.00
  72 -2.427527187e+08 +2.77311259e+08 3.68e-01 6.3e-03 1.8e-04 0.770 0.776 0.00
  73 -2.427527186e+08 +2.77311259e+08 3.36e-01 5.5e-03 1.7e-04 0.770 0.776 0.00
  74 -2.427527186e+08 +2.77311259e+08 3.08e-01 4.9e-03 1.6e-04 0.770 0.776 0.00
  75 -2.427527186e+08 +2.77311259e+08 2.83e-01 4.4e-03 1.4e-04 0.770 0.776 0.00
  76 -2.427527185e+08 +2.77311259e+08 2.60e-01 4.0e-03 1.3e-04 0.770 0.776 0.00
  77 -2.427527185e+08 +2.77311259e+08 2.39e-01 3.7e-03 1.2e-04 0.770 0.776 0.00
  78 -2.427527185e+08 +2.77311259e+08 2.20e-01 3.4e-03 1.1e-04 0.770 0.776 0.00
  79 -2.427527185e+08 +2.77311259e+08 2.02e-01 3.2e-03 1.0e-04 0.770 0.776 0.00
  80 -2.427527185e+08 +2.77311259e+08 1.86e-01 2.9e-03 9.5e-05 0.770 0.776 0.00
  81 -2.427527184e+08 +2.77311259e+08 1.72e-01 2.7e-03 8.8e-05 0.770 0.776 0.00
  82 -2.427527184e+08 +2.77311259e+08 1.58e-01 2.5e-03 8.1e-05 0.770 0.776 0.00
  83 -2.427527184e+08 +2.77311259e+08 1.46e-01 2.3e-03 7.5e-05 0.770 0.776 0.00
  84 -2.427527184e+08 +2.77311259e+08 1.35e-01 2.1e-03 6.9e-05 0.770 0.776 0.00
  85 -2.427527184e+08 +2.77311259e+08 1.24e-01 2.0e-03 6.4e-05 0.770 0.776 0.00
  86 -2.427527184e+08 +2.77311259e+08 1.15e-01 1.8e-03 5.9e-05 0.770 0.776 0.00
  87 -2.427527184e+08 +2.77311259e+08 1.06e-01 1.7e-03 5.5e-05 0.770 0.776 0.00
  88 -2.427527184e+08 +2.77311259e+08 9.81e-02 1.6e-03 5.0e-05 0.770 0.776 0.00
  89 -2.427527184e+08 +2.77311259e+08 9.08e-02 1.5e-03 4.7e-05 0.770 0.776 0.00
  90 -2.427527184e+08 +2.77311259e+08 8.40e-02 1.3e-03 4.3e-05 0.770 0.776 0.00
  91 -2.427527184e+08 +2.77311259e+08 7.78e-02 1.2e-03 4.0e-05 0.770 0.776 0.00
  92 -2.427527184e+08 +2.77311259e+08 7.20e-02 1.2e-03 3.7e-05 0.770 0.776 0.00
  93 -2.427527184e+08 +2.77311259e+08 6.67e-02 1.1e-03 3.4e-05 0.770 0.776 0.00
  94 -2.427527184e+08 +2.77311259e+08 6.18e-02 1.0e-03 3.2e-05 0.770 0.776 0.00
  95 -2.427527184e+08 +2.77311259e+08 5.73e-02 9.3e-04 3.0e-05 0.770 0.776 0.00
  96 -2.427527184e+08 +2.77311259e+08 5.32e-02 8.6e-04 2.7e-05 0.770 0.776 0.00
  97 -2.427527184e+08 +2.77311259e+08 4.93e-02 8.0e-04 2.5e-05 0.770 0.776 0.00
  98 -2.427527184e+08 +2.77311259e+08 4.58e-02 7.4e-04 2.4e-05 0.770 0.776 0.00
  99 -2.427527184e+08 +2.77311259e+08 4.25e-02 6.9e-04 2.2e-05 0.770 0.776 0.00
 100 -2.427527184e+08 +2.77311259e+08 3.95e-02 6.4e-04 2.0e-05 0.770 0.776 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".log.indv-cell.int19k.reg-",data.source,".rds"))
> 
> proc.time()
     user    system   elapsed 
18261.136  1613.808 11143.078 
