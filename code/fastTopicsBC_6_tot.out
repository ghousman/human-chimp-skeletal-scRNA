
R version 3.6.1 (2019-07-05) -- "Action of the Toes"
Copyright (C) 2019 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Read in command line arguments as list of character vectors
> args=(commandArgs(TRUE))
> 
> #Check if arguments are passed and cycle through to evaluate each element
> if(length(args)==0){
+   print("No arguments supplied.")
+   #supply default values
+   clustnum=3
+   data.source="tot"
+ }else{
+   for(i in 1:length(args)){
+     eval(parse(text=args[[i]]))
+   }
+ }
> print(paste0("k: ",clustnum))
[1] "k: 6"
> print(paste0("data source: ",data.source))
[1] "data source: tot"
> 
> #Load libraries
> library(Seurat)
> library(CountClust)
Loading required package: ggplot2
> library(classtpx)
Loading required package: slam
> library(fastTopics)
> 
> #Load data
> scrna <- paste0("../data/cellranger-data-full/data.filterC.log.indv-cell.intNo0.reg-",data.source,".rds")
> data <- readRDS(scrna)
> 
> #Prepare data (unintegrated count data)
> counts <- as.matrix(data@assays$RNA@counts) #do not use integrated data
> counts <- counts[rowSums(counts>0)>0,]      #remove genes with 0 counts across cells
> counts <- t(as.matrix(counts))              #fix matrix orientation (barcodes x features)
> 
> #Batch correct counts - don't correct for species
> labelBatch1 <- as.factor(paste0(data@meta.data$Pair,data@meta.data$Replicate)[which(rownames(data@meta.data) %in% rownames(counts))])
> countsBC1 <- BatchCorrectedCounts(counts, labelBatch1, use_parallel=FALSE)
> rm(data,counts)
> 
> #Fit fastTopics model and save data
> fit <- fit_poisson_nmf(countsBC1, k=clustnum, numiter=100)
Using 4 RcppParallel threads.
Initializing factors using Topic SCORE algorithm.
Initializing loadings by running 10 SCD updates.
Using 4 RcppParallel threads.
Fitting rank-6 Poisson NMF to 101000 x 18482 dense matrix.
Running 100 SCD updates, without extrapolation (fastTopics 0.3-185).
iter   log-likelihood        deviance res(KKT)  |F-F'|  |L-L'| nz(F) nz(L) beta
   1 -1.149761050e+09 +1.27536184e+09 3.62e+04 1.1e+02 1.2e+00 0.768 0.730 0.00
   2 -1.135266285e+09 +1.24637231e+09 5.68e+04 4.6e+01 2.3e+00 0.777 0.833 0.00
   3 -1.129481948e+09 +1.23480364e+09 5.91e+04 3.3e+01 1.7e+00 0.783 0.794 0.00
   4 -1.126711372e+09 +1.22926248e+09 9.32e+03 2.3e+01 1.3e+00 0.789 0.785 0.00
   5 -1.125242626e+09 +1.22632499e+09 6.22e+03 1.5e+01 5.4e-01 0.793 0.780 0.00
   6 -1.124372227e+09 +1.22458420e+09 3.95e+03 1.1e+01 4.0e-01 0.795 0.773 0.00
   7 -1.123804357e+09 +1.22344846e+09 4.66e+03 1.0e+01 3.3e-01 0.796 0.770 0.00
   8 -1.123405519e+09 +1.22265078e+09 3.42e+03 8.5e+00 3.1e-01 0.795 0.768 0.00
   9 -1.123107549e+09 +1.22205484e+09 2.48e+03 7.2e+00 2.8e-01 0.794 0.766 0.00
  10 -1.122872899e+09 +1.22158554e+09 1.76e+03 6.5e+00 2.4e-01 0.793 0.766 0.00
  11 -1.122683076e+09 +1.22120589e+09 1.73e+03 6.0e+00 1.9e-01 0.791 0.766 0.00
  12 -1.122528351e+09 +1.22089644e+09 1.88e+03 5.7e+00 1.7e-01 0.788 0.766 0.00
  13 -1.122400956e+09 +1.22064165e+09 1.85e+03 5.3e+00 1.6e-01 0.786 0.767 0.00
  14 -1.122293937e+09 +1.22042761e+09 1.76e+03 5.1e+00 1.4e-01 0.784 0.768 0.00
  15 -1.122202376e+09 +1.22024449e+09 1.77e+03 4.8e+00 1.3e-01 0.783 0.769 0.00
  16 -1.122122939e+09 +1.22008562e+09 1.73e+03 4.5e+00 1.3e-01 0.781 0.769 0.00
  17 -1.122054020e+09 +1.21994778e+09 3.01e+03 4.5e+00 1.2e-01 0.780 0.771 0.00
  18 -1.121994547e+09 +1.21982884e+09 4.75e+03 4.4e+00 1.1e-01 0.778 0.771 0.00
  19 -1.121942544e+09 +1.21972483e+09 4.83e+03 4.2e+00 1.0e-01 0.777 0.772 0.00
  20 -1.121896686e+09 +1.21963311e+09 4.70e+03 4.0e+00 9.7e-02 0.777 0.773 0.00
  21 -1.121855918e+09 +1.21955158e+09 4.50e+03 3.8e+00 9.2e-02 0.777 0.774 0.00
  22 -1.121819519e+09 +1.21947878e+09 4.26e+03 3.6e+00 8.7e-02 0.776 0.774 0.00
  23 -1.121786938e+09 +1.21941362e+09 4.02e+03 3.4e+00 8.1e-02 0.776 0.775 0.00
  24 -1.121757696e+09 +1.21935513e+09 3.76e+03 3.2e+00 7.5e-02 0.776 0.776 0.00
  25 -1.121731292e+09 +1.21930233e+09 3.48e+03 3.0e+00 7.0e-02 0.775 0.776 0.00
  26 -1.121707324e+09 +1.21925439e+09 3.21e+03 2.8e+00 6.5e-02 0.775 0.777 0.00
  27 -1.121685429e+09 +1.21921060e+09 2.94e+03 2.6e+00 6.1e-02 0.775 0.777 0.00
  28 -1.121665236e+09 +1.21917021e+09 2.80e+03 2.5e+00 5.9e-02 0.774 0.778 0.00
  29 -1.121646510e+09 +1.21913276e+09 2.64e+03 2.2e+00 5.8e-02 0.774 0.778 0.00
  30 -1.121629223e+09 +1.21909819e+09 2.49e+03 2.2e+00 5.6e-02 0.774 0.779 0.00
  31 -1.121613253e+09 +1.21906625e+09 2.38e+03 2.1e+00 5.5e-02 0.774 0.779 0.00
  32 -1.121598468e+09 +1.21903668e+09 2.24e+03 2.0e+00 5.4e-02 0.774 0.779 0.00
  33 -1.121584730e+09 +1.21900920e+09 2.09e+03 1.9e+00 5.2e-02 0.773 0.780 0.00
  34 -1.121571903e+09 +1.21898355e+09 1.95e+03 1.8e+00 5.1e-02 0.774 0.780 0.00
  35 -1.121559886e+09 +1.21895951e+09 1.80e+03 1.7e+00 4.9e-02 0.773 0.780 0.00
  36 -1.121548600e+09 +1.21893694e+09 1.67e+03 1.6e+00 4.8e-02 0.773 0.780 0.00
  37 -1.121537975e+09 +1.21891569e+09 1.56e+03 1.5e+00 4.6e-02 0.773 0.781 0.00
  38 -1.121527954e+09 +1.21889565e+09 1.48e+03 1.5e+00 4.4e-02 0.773 0.781 0.00
  39 -1.121518504e+09 +1.21887675e+09 1.41e+03 1.4e+00 4.2e-02 0.773 0.781 0.00
  40 -1.121509576e+09 +1.21885889e+09 1.34e+03 1.3e+00 4.1e-02 0.772 0.781 0.00
  41 -1.121501132e+09 +1.21884200e+09 1.28e+03 1.3e+00 3.9e-02 0.772 0.781 0.00
  42 -1.121493146e+09 +1.21882603e+09 1.23e+03 1.2e+00 3.7e-02 0.772 0.781 0.00
  43 -1.121485584e+09 +1.21881091e+09 1.17e+03 1.2e+00 3.5e-02 0.772 0.782 0.00
  44 -1.121478410e+09 +1.21879656e+09 1.12e+03 1.1e+00 3.5e-02 0.772 0.782 0.00
  45 -1.121471603e+09 +1.21878295e+09 1.08e+03 1.1e+00 3.4e-02 0.772 0.782 0.00
  46 -1.121465171e+09 +1.21877008e+09 1.03e+03 1.0e+00 3.3e-02 0.772 0.782 0.00
  47 -1.121459103e+09 +1.21875795e+09 9.88e+02 9.6e-01 3.2e-02 0.772 0.782 0.00
  48 -1.121453372e+09 +1.21874649e+09 9.46e+02 9.2e-01 3.1e-02 0.772 0.783 0.00
  49 -1.121447944e+09 +1.21873563e+09 9.08e+02 8.8e-01 3.0e-02 0.772 0.783 0.00
  50 -1.121442790e+09 +1.21872532e+09 8.75e+02 8.5e-01 2.9e-02 0.772 0.783 0.00
  51 -1.121437879e+09 +1.21871550e+09 8.45e+02 8.2e-01 2.8e-02 0.771 0.783 0.00
  52 -1.121433190e+09 +1.21870612e+09 8.22e+02 7.9e-01 2.7e-02 0.771 0.783 0.00
  53 -1.121428707e+09 +1.21869716e+09 8.17e+02 7.7e-01 2.7e-02 0.771 0.783 0.00
  54 -1.121424416e+09 +1.21868857e+09 8.13e+02 7.4e-01 2.6e-02 0.771 0.783 0.00
  55 -1.121420301e+09 +1.21868034e+09 8.09e+02 7.2e-01 2.5e-02 0.771 0.784 0.00
  56 -1.121416355e+09 +1.21867245e+09 8.04e+02 7.0e-01 2.5e-02 0.771 0.784 0.00
  57 -1.121412573e+09 +1.21866489e+09 7.98e+02 6.8e-01 2.4e-02 0.771 0.784 0.00
  58 -1.121408947e+09 +1.21865764e+09 7.91e+02 6.6e-01 2.3e-02 0.770 0.784 0.00
  59 -1.121405471e+09 +1.21865068e+09 7.83e+02 6.5e-01 2.3e-02 0.770 0.784 0.00
  60 -1.121402148e+09 +1.21864404e+09 7.72e+02 6.3e-01 2.2e-02 0.770 0.784 0.00
  61 -1.121398983e+09 +1.21863771e+09 7.57e+02 6.1e-01 2.1e-02 0.770 0.784 0.00
  62 -1.121395972e+09 +1.21863169e+09 7.43e+02 6.0e-01 2.1e-02 0.770 0.784 0.00
  63 -1.121393119e+09 +1.21862598e+09 7.26e+02 5.8e-01 2.0e-02 0.770 0.784 0.00
  64 -1.121390405e+09 +1.21862055e+09 7.10e+02 5.7e-01 2.0e-02 0.770 0.785 0.00
  65 -1.121387819e+09 +1.21861538e+09 6.97e+02 5.5e-01 2.0e-02 0.770 0.785 0.00
  66 -1.121385350e+09 +1.21861044e+09 6.86e+02 5.3e-01 1.9e-02 0.770 0.785 0.00
  67 -1.121382987e+09 +1.21860572e+09 6.76e+02 5.2e-01 1.9e-02 0.770 0.785 0.00
  68 -1.121380724e+09 +1.21860119e+09 6.66e+02 5.1e-01 1.9e-02 0.770 0.785 0.00
  69 -1.121378552e+09 +1.21859684e+09 6.56e+02 4.9e-01 1.9e-02 0.770 0.785 0.00
  70 -1.121376463e+09 +1.21859267e+09 6.46e+02 4.8e-01 1.8e-02 0.770 0.785 0.00
  71 -1.121374452e+09 +1.21858864e+09 6.36e+02 4.7e-01 1.8e-02 0.769 0.785 0.00
  72 -1.121372508e+09 +1.21858476e+09 6.27e+02 4.6e-01 1.8e-02 0.769 0.785 0.00
  73 -1.121370627e+09 +1.21858099e+09 6.19e+02 4.5e-01 1.8e-02 0.769 0.785 0.00
  74 -1.121368803e+09 +1.21857735e+09 6.12e+02 4.5e-01 1.7e-02 0.769 0.785 0.00
  75 -1.121367030e+09 +1.21857380e+09 6.05e+02 4.4e-01 1.7e-02 0.769 0.785 0.00
  76 -1.121365299e+09 +1.21857034e+09 5.99e+02 4.3e-01 1.7e-02 0.769 0.785 0.00
  77 -1.121363601e+09 +1.21856694e+09 5.94e+02 4.3e-01 1.7e-02 0.769 0.785 0.00
  78 -1.121361923e+09 +1.21856359e+09 5.91e+02 4.3e-01 1.7e-02 0.769 0.786 0.00
  79 -1.121360252e+09 +1.21856025e+09 5.88e+02 4.2e-01 1.6e-02 0.769 0.786 0.00
  80 -1.121358566e+09 +1.21855687e+09 5.88e+02 4.2e-01 1.6e-02 0.769 0.786 0.00
  81 -1.121356785e+09 +1.21855331e+09 5.92e+02 4.3e-01 1.6e-02 0.769 0.786 0.00
  82 -1.121354490e+09 +1.21854872e+09 1.73e+03 4.4e-01 1.8e-02 0.769 0.786 0.00
  83 -1.121349352e+09 +1.21853844e+09 3.17e+03 8.8e-01 3.7e-02 0.769 0.786 0.00
  84 -1.121331662e+09 +1.21850307e+09 8.12e+02 1.9e+00 9.4e-02 0.769 0.786 0.00
  85 -1.121310551e+09 +1.21846084e+09 1.06e+03 1.2e+00 1.7e-01 0.769 0.786 0.00
  86 -1.121300646e+09 +1.21844103e+09 1.13e+03 1.1e+00 8.9e-02 0.769 0.787 0.00
  87 -1.121294426e+09 +1.21842859e+09 1.13e+03 9.0e-01 5.7e-02 0.769 0.787 0.00
  88 -1.121289587e+09 +1.21841892e+09 1.07e+03 7.9e-01 3.7e-02 0.769 0.786 0.00
  89 -1.121285442e+09 +1.21841062e+09 1.00e+03 7.1e-01 2.8e-02 0.769 0.786 0.00
  90 -1.121281725e+09 +1.21840319e+09 9.36e+02 6.5e-01 2.7e-02 0.768 0.786 0.00
  91 -1.121278304e+09 +1.21839635e+09 8.73e+02 6.0e-01 2.7e-02 0.768 0.786 0.00
  92 -1.121275110e+09 +1.21838996e+09 8.15e+02 5.6e-01 2.7e-02 0.768 0.786 0.00
  93 -1.121272106e+09 +1.21838395e+09 7.66e+02 5.3e-01 2.7e-02 0.769 0.786 0.00
  94 -1.121269261e+09 +1.21837826e+09 7.25e+02 5.1e-01 2.7e-02 0.768 0.786 0.00
  95 -1.121266559e+09 +1.21837286e+09 6.93e+02 4.9e-01 2.7e-02 0.768 0.786 0.00
  96 -1.121264007e+09 +1.21836776e+09 6.68e+02 4.7e-01 2.6e-02 0.768 0.786 0.00
  97 -1.121261594e+09 +1.21836293e+09 6.46e+02 4.5e-01 2.6e-02 0.768 0.786 0.00
  98 -1.121259309e+09 +1.21835836e+09 6.29e+02 4.4e-01 2.6e-02 0.768 0.786 0.00
  99 -1.121257137e+09 +1.21835402e+09 6.14e+02 4.2e-01 2.6e-02 0.768 0.786 0.00
 100 -1.121255070e+09 +1.21834988e+09 6.01e+02 4.1e-01 2.6e-02 0.768 0.786 0.00
> saveRDS(fit, file=paste0("../data/gom-data/topics",clustnum,".data.filterC.log.indv-cell.intNo0.reg-",data.source,".bc1.rds"))
> 
> proc.time()
     user    system   elapsed 
95615.833  8490.601 49949.263 
