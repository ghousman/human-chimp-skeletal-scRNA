---
title: "10x-test-view-data-metrics"
author: "Genevieve Housman"
date: "1/27/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Viewing of 10X Data Cellranger Metrics

Data being examined comes from 6 humans and 6 chimpanzees.
- GHO-1:  H1-I + C1-I (iPSCs from H23555 and C8861)
- GHO-2:  H1-M + C1-M (iPSC-derived MSCs from H23555 and C8861)
- GHO-4:  H1-O + C1-O (iPSC-MSC-derived osteoblasts from H23555 and C8861)
- HOU-10: H1-I-r2 + C1-I-r2 (iPSCs from H23555 and C8861)
- HOU-12: H1-M-r2 + C1-M-r2 (iPSC-derived MSCs from H23555 and C8861)
- HOU-16: H1-O-r2 + C1-O-r2 (iPSC-MSC-derived osteoblasts from H23555 and C8861)
- HOU-1:  H2-I + C2-I (iPSCs from H20157 and C3647)
- HOU-2:  H2-M + C2-M (iPSC-derived MSCs from H20157 and C3647)
- HOU-4:  H2-O + C2-O (iPSC-MSC-derived osteoblasts from H20157 and C3647)
- HOU-9:  H3-I + C3-I (iPSCs from H28126 and C3649)
- HOU-11: H3-M + C3-M (iPSC-derived MSCs from H28126 and C3649)
- HOU-15: H3-O + C3-O (iPSC-MSC-derived osteoblasts from H28126 and C3649)
- HOU-5:  H4-I + C4-I (iPSCs from H28834 and C40210)
- HOU-6:  H4-M + C4-M (iPSC-derived MSCs from H28834 and C40210)
- HOU-8:  H4-O + C4-O (iPSC-MSC-derived osteoblasts from H28834 and C40210)
- HOU-17:	H5-I + C5-I (iPSCs from H21792 and C40280)
- HOU-19:	H5-M + C5-M (iPSC-derived MSCs from H21792 and C40280)
- HOU-21:	H5-O + C5-O (iPSC-MSC-derived osteoblasts from H21792 and C40280)
- HOU-18:	H6-I + C6-I (iPSCs from H20961 and C3624)
- HOU-20:	H6-M + C6-M (iPSC-derived MSCs from H20961 and C3624)
- HOU-22:	H6-O + C6-O (iPSC-MSC-derived osteoblasts from H20961 and C3624)

```{r load libraries}

library(Seurat)
library(dplyr)
library(stringi)
library(stringr)
library(ggplot2)
library(colorspace)
library(RColorBrewer)

```

```{r compile summary metrics}

#Define main directory
dir <- '/project2/gilad/ghousman/skeletal-human-chimp/'

#Load batch info
batch <- read.csv(file=paste0(dir,'human-chimp-skeletal-scRNA/data/scrna-batch.csv'), header=TRUE, sep=",")

#Define methods of alignment
align <- c("ortho-hg38","ortho-panTro6")
align <- c("hg38","panTro6","GRCh38.93","Pan_tro_3.0.93","ortho-hg38","ortho-panTro6","ortho-GRCh38.93","ortho-Pan_tro_3.0.93")

#Create empty dataframe for metrics data
metrics <- data.frame()

#Load metrics data from subset data
dir_scrna <- paste0(dir,'scRNA/cellranger-data-subset') #data from prelim seq
for (j in align) {
  i <- 1
  while (i <= length(batch$Sample_Name_at_Core)) {
    print(i)
    #Define directory containing data from one collection
    dir_data <- paste0(dir_scrna,'/cellranger-',j,'/',batch$Sample_Name_at_Core[i],'/outs')
    #Load summary metrics
    temp <- read.csv(file=paste0(dir_data,'/metrics_summary.csv'))
    #Process metrics
    temp[,c(1:4,19:20)] <- lapply(temp[,c(1:4,19:20)], function(x) as.numeric(gsub(",","",as.character(x))))
    temp[,c(5:18)] <- lapply(temp[,c(5:18)], function(x) as.numeric(gsub("%","",as.character(x)))/100)
    temp$Collection.Name <- batch$Sample_Name_at_Core[i]
    temp$Alignment.Type <- j
    #Add data to dataframe
    metrics <- rbind(metrics,temp)
    i <- i+1
  }
}

#Load metrics data from full data
dir_scrna <- paste0(dir,'scRNA/cellranger-data-full')  #data from total seq
for (j in align) {
  i <- 1
  while (i <= length(batch$Sample_Name_at_Core)) {
    print(i)
    #Define directory containing data from one collection
    dir_data <- paste0(dir_scrna,'/cellranger-',j,'/',batch$Sample_Name_at_Core[i],'/outs')
    #Load summary metrics
    temp <- read.csv(file=paste0(dir_data,'/metrics_summary.csv'))
    #Process metrics
    temp[,c(1:4,19:20)] <- lapply(temp[,c(1:4,19:20)], function(x) as.numeric(gsub(",","",as.character(x))))
    temp[,c(5:18)] <- lapply(temp[,c(5:18)], function(x) as.numeric(gsub("%","",as.character(x)))/100)
    temp$Collection.Name <- paste0(batch$Sample_Name_at_Core[i],"-full")
    temp$Alignment.Type <- j
    #Add data to dataframe
    metrics <- rbind(metrics,temp)
    i <- i+1
  }
}

#Fix metrics details so that plotting is easier later on
#eventually add: HOU-17-full/HOU-19-full/HOU-21-full/HOU-18-full/HOU-20-full/HOU-22-full
metrics$Collection.Name <- factor(metrics$Collection.Name,
                                  levels=c("GHO-1","GHO-2","GHO-4","GHO-1-full","GHO-2-full","GHO-4-full",
                                           "HOU-10","HOU-12","HOU-16","HOU-10-full","HOU-12-full","HOU-16-full",
                                           "HOU-1","HOU-2","HOU-4","HOU-1-full","HOU-2-full","HOU-4-full",
                                           "HOU-9","HOU-11","HOU-15","HOU-9-full","HOU-11-full","HOU-15-full",
                                           "HOU-5","HOU-6","HOU-8","HOU-5-full","HOU-6-full","HOU-8-full",
                                           "HOU-17","HOU-19","HOU-21","HOU-17-full","HOU-19-full","HOU-21-full",
                                           "HOU-18","HOU-20","HOU-22","HOU-18-full","HOU-20-full","HOU-22-full"))
metrics$color <- c(rep("subset",168),rep("full",120))

#Define directory for saving plots
dir_out <- paste0(dir,'human-chimp-skeletal-scRNA/output')

#Summarize metrics
#total number of reads
p <- ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Number.of.Reads, fill=color)) +
      geom_col(position="dodge") +
      theme(axis.text.x=element_text(size=6)) +
      labs(title="Number of Reads Sequenced",y="Number of Reads",x="Collection") +
      ylim(0,300000000)
ggsave("readcount.png", plot=p, path=dir_out, width=20, heigh=5)
#percent sequence saturation
p <- ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Sequencing.Saturation, fill=color)) +
      geom_col(position="dodge") +
      theme(axis.text.x=element_text(size=6)) +
      labs(title="Sequencing Saturation",y="Sequencing Saturation",x="Collection") +
      ylim(0,1)
ggsave("saturation.png", plot=p, path=dir_out, width=20, heigh=5)
#mean reads per cell
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (hg38 v98)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (panTro6)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (hg38 v93)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (panTro5)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon hg38 v98)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon panTro6)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon hg38 v93)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Mean.Reads.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon panTro5)",y="Mean Reads per Cell",x="Collection") +
                               ylim(0,145000))), ncol=1)
ggsave("readspercell.png", plot=p, path=dir_out, width=20, heigh=40)
#median genes per cell
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Genes per Cell (hg38 v98)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Genes per Cell (panTro6)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Genes per Cell (hg38 v93)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Genes per Cell (panTro5)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon hg38 v98)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon panTro6)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Genes per Cell (ortho-exon hg38 v93)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Median.Genes.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Genes per Cell (ortho-exon panTro5)",y="Median Genes per Cell",x="Collection") +
                               ylim(0,6000))), ncol=1)
ggsave("genespercell.png", plot=p, path=dir_out, width=20, heigh=40)
#median UMI per cell
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="UMI per Cell (hg38 v98)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="UMI per Cell (panTro6)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="UMI per Cell (hg38 v93)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="UMI per Cell (panTro5)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon hg38 v98)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Reads per Cell (ortho-exon panTro6)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="UMI per Cell (ortho-exon hg38 v93)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Median.UMI.Counts.per.Cell, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="UMI per Cell (ortho-exon panTro5)",y="Median UMI Counts per Cell",x="Collection") +
                               ylim(0,29000))), ncol=1)
ggsave("umipercell.png", plot=p, path=dir_out, width=20, heigh=30)
#proportion of Q30 bases in barcode, rna read, and umi
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (hg38 v98)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (hg38 v98)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (hg38 v98)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (panTro6)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (panTro6)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (panTro6)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (hg38 v93)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (hg38 v93)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (hg38 v93)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                            (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (panTro5)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (panTro5)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (panTro5)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                            (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (ortho-exon hg38 v98)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (ortho-exon hg38 v98)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (ortho-exon hg38 v98)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (ortho-exon panTro6)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (ortho-exon panTro6)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (ortho-exon panTro6)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (ortho-exon hg38 v93)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (ortho-exon hg38 v93)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (ortho-exon hg38 v93)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Q30.Bases.in.Barcode, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: Barcode (ortho-exon panTro5)",y="Q30 Bases in Barcode",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Q30.Bases.in.UMI, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: UMI (ortho-exon panTro5)",y="Q30 Bases in UMI",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Q30.Bases.in.RNA.Read, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion Q30: RNA (ortho-exon panTro5)",y="Q30 Bases in RNA Read",x="Collection") +
                                ylim(0,1))), ncol=3)
ggsave("q30bases.png", plot=p, path=dir_out, width=60, heigh=40, limitsize=FALSE)
#reads mapped to genome, confidently mapped to genome, confidently mapped to exons, and confidently mapped to transcriptome
metrics$reads_mapped_to_genome <- metrics$Number.of.Reads * metrics$Reads.Mapped.to.Genome
metrics$reads_mapped_confidently_to_genome <- metrics$Number.of.Reads * metrics$Reads.Mapped.Confidently.to.Genome
metrics$reads_mapped_confidently_to_exonic_regions <- metrics$Number.of.Reads * metrics$Reads.Mapped.Confidently.to.Exonic.Regions
metrics$reads_mapped_confidently_to_transcriptome <- metrics$Number.of.Reads * metrics$Reads.Mapped.Confidently.to.Transcriptome
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (hg38 v98)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (panTro6)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (hg38 v93)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (panTro5)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (ortho-exon hg38 v98)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (ortho-exon panTro6)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (ortho-exon hg38 v93)",y="Mapped Reads",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93')) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.to.Genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Exonic.Regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Proportion of Mapped Reads (ortho-panTro5)",y="Mapped Reads",x="Collection") +
                                ylim(0,1))),
                             ncol=1)
ggsave("mapping-proportion.png", plot=p, path=dir_out, width=20, heigh=40)
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (hg38 v98)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (panTro6)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (ortho-exon hg38 v93)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (panTro5)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (ortho-exon hg38 v98)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (ortho-exon panTro6)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (ortho-exon hg38 v93)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93')) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome, fill=color), position="dodge", alpha=0.2) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome, fill=color), position="dodge", alpha=0.4) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions, fill=color), position="dodge", alpha=0.6) +
                                geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome, fill=color), position="dodge", alpha=1) +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Numbers of Mapped Reads (ortho-panTro5)",y="Mapped Reads",x="Collection") +
                                ylim(0,300000000))),
                             ncol=1)
ggsave("mapping-number.png", plot=p, path=dir_out, width=20, heigh=30)
#reads mapped to intergenic regions, intronic regions, and antisense to gene
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (hg38 v98)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='hg38'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (hg38 v98)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='hg38'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (hg38 v98)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (panTro6)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (panTro6)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (panTro6)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (hg38 v93)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (hg38 v93)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (hg38 v93)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (panTro5)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (panTro5)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.933'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (panTro5)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon hg38 v98)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (ortho-exon hg38 v98)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon hg38 v98)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon panTro6)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (ortho-exon panTro6)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon panTro6)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon hg38 v93)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (ortho-exon hg38 v93)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon hg38 v93)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intergenic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon panTro5)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Confidently.to.Intronic.Regions, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intronic Regions (ortho-exon panTro5)",y="Reads Mapped to Intronic Regions",x="Collection") +
                                ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'),
                                     aes(x=Collection.Name, y=Reads.Mapped.Antisense.to.Gene, fill=color)) +
                                geom_col(position="dodge") +
                                theme(axis.text.x=element_text(size=6)) +
                                labs(title="Reads Mapped to Intergenic Regions (ortho-exon panTro5)",y="Reads Mapped to Intergenic Regions",x="Collection") +
                                ylim(0,1))),
                  ncol=3)
ggsave("mapping-extra.png", plot=p, path=dir_out, width=60, heigh=40, limitsize=FALSE)
#fraction of reads in cells
p <- CombinePlots(plots=list((ggplot(subset(metrics,Alignment.Type=='hg38'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (hg38 v98)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='panTro6'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (panTro6)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='GRCh38.93'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (hg38 v93)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='Pan_tro_3.0.93'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (panTro5)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-hg38'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (ortho-exon hg38 v98)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-panTro6'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (ortho-exon panTro6)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-GRCh38.93'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (ortho-exon hg38 v93)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1)),
                             (ggplot(subset(metrics,Alignment.Type=='ortho-Pan_tro_3.0.93'), aes(x=Collection.Name, y=Fraction.Reads.in.Cells, fill=color)) +
                               geom_col(position="dodge") +
                               theme(axis.text.x=element_text(size=6)) +
                               labs(title="Fraction of Reads in Cells (ortho-exon panTro5)",y="Fraction of Reads in Cells",x="Collection") +
                               ylim(0,1))), ncol=1)
ggsave("readsincells.png", plot=p, path=dir_out, width=20, heigh=40)

#Compare alignment proportions
smpls <- c(16:21,37:42,58:63,79:84,100:105,121:126,142:147,163:288)
mean(subset(metrics[smpls,],Alignment.Type=='hg38')$Reads.Mapped.Confidently.to.Transcriptome)                 #66.13%
mean(subset(metrics[smpls,],Alignment.Type=='panTro6')$Reads.Mapped.Confidently.to.Transcriptome)              #13.50%
mean(subset(metrics[smpls,],Alignment.Type=='GRCh38.93')$Reads.Mapped.Confidently.to.Transcriptome)            #68.16%
mean(subset(metrics[smpls,],Alignment.Type=='Pan_tro_3.0.93')$Reads.Mapped.Confidently.to.Transcriptome)       #55.68%
mean(subset(metrics[smpls,],Alignment.Type=='ortho-hg38')$Reads.Mapped.Confidently.to.Transcriptome)           #61.03%
mean(subset(metrics[smpls,],Alignment.Type=='ortho-panTro6')$Reads.Mapped.Confidently.to.Transcriptome)        #58.51%
mean(subset(metrics[smpls,],Alignment.Type=='ortho-GRCh38.93')$Reads.Mapped.Confidently.to.Transcriptome)      #31.97%
mean(subset(metrics[smpls,],Alignment.Type=='ortho-Pan_tro_3.0.93')$Reads.Mapped.Confidently.to.Transcriptome) #31.59%

#Summarize metrics in plots for figures
#only consider full data
#eventually add: HOU-17-full/HOU-19-full/HOU-21-full/HOU-18-full/HOU-20-full/HOU-22-full
metrics.o.hg38 <- subset(metrics,Alignment.Type=='ortho-hg38')
metrics.o.hg38$Collection <- c("H1-I/C1-I","H1-M/C1-M","H1-O/C1-O","H1-r2-I/C1-r2-I","H1-r2-M/C1-r2-M","H1-r2-O/C1-r2-O",
                               "H2-I/C2-I","H2-M/C2-M","H2-O/C2-O","H3-I/C3-I","H3-M/C3-M","H3-O/C3-O","H4-I/C4-I","H4-M/C4-M","H4-O/C4-O",
                               "H5-I/C5-I","H5-M/C5-M","H5-O/C5-O","H6-I/C6-I","H6-M/C6-M","H6-O/C6-O")
metrics.o.hg38$Collection <- factor(metrics.o.hg38$Collection,
                                    levels=c("H1-I/C1-I","H1-M/C1-M","H1-O/C1-O","H1-r2-I/C1-r2-I","H1-r2-M/C1-r2-M","H1-r2-O/C1-r2-O",
                                             "H2-I/C2-I","H2-M/C2-M","H2-O/C2-O","H3-I/C3-I","H3-M/C3-M","H3-O/C3-O","H4-I/C4-I","H4-M/C4-M","H4-O/C4-O",
                                             "H5-I/C5-I","H5-M/C5-M","H5-O/C5-O","H6-I/C6-I","H6-M/C6-M","H6-O/C6-O"))
metrics.o.pTr6 <- subset(metrics,Alignment.Type=='ortho-panTro6')
metrics.o.pTr6$Collection <- c("H1-I/C1-I","H1-M/C1-M","H1-O/C1-O","H1-r2-I/C1-r2-I","H1-r2-M/C1-r2-M","H1-r2-O/C1-r2-O",
                               "H2-I/C2-I","H2-M/C2-M","H2-O/C2-O","H3-I/C3-I","H3-M/C3-M","H3-O/C3-O","H4-I/C4-I","H4-M/C4-M","H4-O/C4-O",
                               "H5-I/C5-I","H5-M/C5-M","H5-O/C5-O","H6-I/C6-I","H6-M/C6-M","H6-O/C6-O")
metrics.o.pTr6$Collection <- factor(metrics.o.pTr6$Collection,
                                    levels=c("H1-I/C1-I","H1-M/C1-M","H1-O/C1-O","H1-r2-I/C1-r2-I","H1-r2-M/C1-r2-M","H1-r2-O/C1-r2-O",
                                             "H2-I/C2-I","H2-M/C2-M","H2-O/C2-O","H3-I/C3-I","H3-M/C3-M","H3-O/C3-O","H4-I/C4-I","H4-M/C4-M","H4-O/C4-O",
                                             "H5-I/C5-I","H5-M/C5-M","H5-O/C5-O","H6-I/C6-I","H6-M/C6-M","H6-O/C6-O"))
#make plots
p <- ggplot(metrics.o.hg38) +
      geom_col(aes(x=Collection.Name, y=reads_mapped_to_genome), position="dodge", alpha=0.2) +
      geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_genome), position="dodge", alpha=0.4) +
      geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_exonic_regions), position="dodge", alpha=0.6) +
      geom_col(aes(x=Collection.Name, y=reads_mapped_confidently_to_transcriptome), position="dodge", alpha=1) +
      theme_classic() +
      theme(axis.text.x=element_text(size=12), axis.text.y=element_text(size=12)) +
      labs(title="Numbers of Mapped Reads (Genome: hg38, Annotation: ortho-exon)",y="Mapped Reads",x="Collection") +
      ylim(0,270000000) +
      scale_x_discrete(labels=c("GHO-1-full"="H1+C1\niPSCs", "GHO-2-full"="H1+C1\nMSCs", "GHO-4-full"="H1+C1\nOsteoblasts",
                                "HOU-10-full"="H1r2+C1r2\niPSCs", "HOU-12-full"="H1r2+C1r2\nMSCs", "HOU-16-full"="H1r2+C1r2\nOsteoblasts",
                                "HOU-1-full"="H2+C2\niPSCs", "HOU-2-full"="H2+C2\nMSCs", "HOU-4-full"="H2+C2\nOsteoblasts",
                                "HOU-9-full"="H3+C3\niPSCs", "HOU-11-full"="H3+C3\nMSCs", "HOU-15-full"="H3+C3\nOsteoblasts",
                                "HOU-5-full"="H4+C4\niPSCs", "HOU-6-full"="H4+C4\nMSCs", "HOU-8-full"="H4+C4\nOsteoblasts",
                                "HOU-17-full"="H5+C5\niPSCs", "HOU-19-full"="H5+C5\nMSCs", "HOU-21-full"="H5+C5\nOsteoblasts",
                                "HOU-18-full"="H6+C6\niPSCs", "HOU-20-full"="H6+C6\nMSCs", "HOU-22-full"="H6+C6\nOsteoblasts"))
ggsave("mapping-number-ortho-hg38.png", plot=p, path=dir_out, width=20, height=5)
p <- ggplot(metrics.o.pTr6) +
      geom_col(aes(x=Collection, y=reads_mapped_to_genome), position="dodge", alpha=0.2) +
      geom_col(aes(x=Collection, y=reads_mapped_confidently_to_genome), position="dodge", alpha=0.4) +
      geom_col(aes(x=Collection, y=reads_mapped_confidently_to_exonic_regions), position="dodge", alpha=0.6) +
      geom_col(aes(x=Collection, y=reads_mapped_confidently_to_transcriptome), position="dodge", alpha=1) +
      theme_classic() +
      theme(axis.text.x=element_text(size=12), axis.text.y=element_text(size=12)) +
      labs(title="Numbers of Mapped Reads (Genome: panTro6, Annotation: ortho-exon)",y="Mapped Reads",x="Collection") +
      ylim(0,270000000) +
      scale_x_discrete(labels=c("GHO-1-full"="H1+C1\niPSCs", "GHO-2-full"="H1+C1\nMSCs", "GHO-4-full"="H1+C1\nOsteoblasts",
                                "HOU-10-full"="H1r2+C1r2\niPSCs", "HOU-12-full"="H1r2+C1r2\nMSCs", "HOU-16-full"="H1r2+C1r2\nOsteoblasts",
                                "HOU-1-full"="H2+C2\niPSCs", "HOU-2-full"="H2+C2\nMSCs", "HOU-4-full"="H2+C2\nOsteoblasts",
                                "HOU-9-full"="H3+C3\niPSCs", "HOU-11-full"="H3+C3\nMSCs", "HOU-15-full"="H3+C3\nOsteoblasts",
                                "HOU-5-full"="H4+C4\niPSCs", "HOU-6-full"="H4+C4\nMSCs", "HOU-8-full"="H4+C4\nOsteoblasts",
                                "HOU-17-full"="H5+C5\niPSCs", "HOU-19-full"="H5+C5\nMSCs", "HOU-21-full"="H5+C5\nOsteoblasts",
                                "HOU-18-full"="H6+C6\niPSCs", "HOU-20-full"="H6+C6\nMSCs", "HOU-22-full"="H6+C6\nOsteoblasts"))
ggsave("mapping-number-ortho-pTr6.png", plot=p, path=dir_out, width=20, height=5)
p <- ggplot(metrics.o.hg38) +
      geom_col(aes(x=Collection, y=Reads.Mapped.to.Genome), position="dodge", alpha=0.2) +
      geom_col(aes(x=Collection, y=Reads.Mapped.Confidently.to.Genome), position="dodge", alpha=0.4) +
      geom_col(aes(x=Collection, y=Reads.Mapped.Confidently.to.Exonic.Regions), position="dodge", alpha=0.6) +
      geom_col(aes(x=Collection, y=Reads.Mapped.Confidently.to.Transcriptome), position="dodge", alpha=1) +
      theme(axis.text.x=element_text(size=6)) +
      labs(title="Proportion of Mapped Reads (Genome: hg38, Annotation: ortho-exon)",y="Mapped Reads",x="Collection") +
      ylim(0,1)
ggsave("mapping-proportion-ortho-hg38.png", plot=p, path=dir_out, width=20, height=5)
p <- ggplot(metrics.o.pTr6) +
      geom_col(aes(x=Collection, y=Reads.Mapped.to.Genome), position="dodge", alpha=0.2) +
      geom_col(aes(x=Collection, y=Reads.Mapped.Confidently.to.Genome), position="dodge", alpha=0.4) +
      geom_col(aes(x=Collection, y=Reads.Mapped.Confidently.to.Exonic.Regions), position="dodge", alpha=0.6) +
      geom_col(aes(x=Collection, y=Reads.Mapped.Confidently.to.Transcriptome), position="dodge", alpha=1) +
      theme(axis.text.x=element_text(size=6)) +
      labs(title="Proportion of Mapped Reads (Genome: panTro6, Annotation: ortho-exon)",y="Mapped Reads",x="Collection") +
      ylim(0,1)
ggsave("mapping-proportion-ortho-pTr6.png", plot=p, path=dir_out, width=20, height=5)

```

