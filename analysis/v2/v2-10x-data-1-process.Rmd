---
title: "10x-data-process"
author: "Genevieve Housman"
date: "August 2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 10X Data Cellranger Analysis - Data Processing

Data being examined comes from 6 humans and 6 chimpanzees.

* GHO-1:  H1-I + C1-I (iPSCs from H23555 and C8861)
* GHO-2:  H1-M + C1-M (iPSC-derived MSCs from H23555 and C8861)
* GHO-4:  H1-O + C1-O (iPSC-MSC-derived osteoblasts from H23555 and C8861)
* HOU-10: H1-I-r2 + C1-I-r2 (iPSCs from H23555 and C8861)
* HOU-12: H1-M-r2 + C1-M-r2 (iPSC-derived MSCs from H23555 and C8861)
* HOU-16: H1-O-r2 + C1-O-r2 (iPSC-MSC-derived osteoblasts from H23555 and C8861)
* HOU-1:  H2-I + C2-I (iPSCs from H20157 and C3647)
* HOU-2:  H2-M + C2-M (iPSC-derived MSCs from H20157 and C3647)
* HOU-4:  H2-O + C2-O (iPSC-MSC-derived osteoblasts from H20157 and C3647)
* HOU-9:  H3-I + C3-I (iPSCs from H28126 and C3649)
* HOU-11: H3-M + C3-M (iPSC-derived MSCs from H28126 and C3649)
* HOU-15: H3-O + C3-O (iPSC-MSC-derived osteoblasts from H28126 and C3649)
* HOU-5:  H4-I + C4-I (iPSCs from H28834 and C40210)
* HOU-6:  H4-M + C4-M (iPSC-derived MSCs from H28834 and C40210)
* HOU-8:  H4-O + C4-O (iPSC-MSC-derived osteoblasts from H28834 and C40210)
* HOU-17:	H5-I + C5-I (iPSCs from H21792 and C40280)
* HOU-19:	H5-M + C5-M (iPSC-derived MSCs from H21792 and C40280)
* HOU-21:	H5-O + C5-O (iPSC-MSC-derived osteoblasts from H21792 and C40280)
* HOU-18:	H6-I + C6-I (iPSCs from H20961 and C3624)
* HOU-20:	H6-M + C6-M (iPSC-derived MSCs from H20961 and C3624)
* HOU-22:	H6-O + C6-O (iPSC-MSC-derived osteoblasts from H20961 and C3624)

For downstream analysis of 10X data, we need to:

* process fastq files into count matrices
* process count matrices for use in R

### Process fastq files

Fastq files were processed into count matrices (genes x cells) using cellranger 3.1.0.

Three different cellranger references were made using the hg38 and panTro6 genomes and ortho-exon v2 annotation (completed by KB):

1. human_genome_index: /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2
2. chimp_genome_index: /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2
3. combined_genome_index: /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2

Count matrices were made using each of the three different cellranger references (compeleted by GH):

1. Reads were processed using human_genome_index.
2. Reads were processed using chimp_genome_index.
3. Reads were processed using combined_genome_index.

Notes on what cellranger does to compute count matrices:

* genome alignment
	 + aligner (STAR) peforms splicing-aware alignment of reads to genome
	 + transcript annotation (GTF) buckets reads into exonic/intronic/intergenic and whether reads align (confidently) to genome
	 + [read = exonic if >=50% of it intersects an exon]
	 + [read = intronic if it is non-exonic and intersects an intron]
	 + [read = intergenic in all other cases]
* MAPQ adjustment (MAPQ 255)
   + for reads that align to a single exonic locus and to 1+ non-exonic loci, the exonic locus is prioritized and read is considered to be confidently mapped to exonic locus
* transcriptome alignment
	 + aligns exonic reads to annotated transcripts and looks for compatibility
	 + read is mapped to transcriptome if: read that is compatible with exons of annotated transcript and aligned to same strand
	 + read is uniquely (confidently) mapped to transcriptome if: read is compatible with a single gene annotation
	 + [uniquely (confidently) mapped reads are only ones considered for UMI counting]
* UMI counting
	 + before counting UMIs, corrections for sequencing errors in UMI sequences are attempted
	 + reads confidently mapped to transcriptome are grouped according to shared barcodes, UMIs, and gene annotations
	 + filter 1: if two groups of reads have same barcode and gene, but UMIs differ by a single base (Hamming distance 1 apart), then one UMI was likely introduced by substitution error in sequencing, and UMI of less-supported read group is corrected to UMI with higher support
	 + reads confidently mapped to transcriptome are grouped according to shared barcodes, UMIs (possibly corrected), and gene annotations
	 + filter 2: if two or more groups of reads have same barcode and UMI, but different gene annotations, gene annotation with most supporting reads is kept for UMI counting and other read groups are discarded (ties for maximal read support: all read groups are discarded as gene cannot be confidently assigned)
	 + each observed barcode-UMI-gene combination is recorded as UMI count in unfiltered feature-barcode matrix (number of reads supporting each counted UMI also recorded in molecule info file)
* calling cell barcodes
	 + [improved cell-calling algorithm that better identifies populations of low RNA content cells, especially when low RNA content cells are mixed into population of high RNA content cells, based on EmptyDrops method by Lun et al. 2018]
	 + step 1:
		  - uses cutoff based on total UMI counts of each barcode to identify cells - identifies primary mode of high RNA content cells
		  - (takes as input expected number of recovered cells, N)
		  - (let m be 99th percentile of top N barcodes by total UMI counts)
		  - (all barcodes whose total UMI counts exceed m/10 are called as cells)
	 + step 2:
		  - uses RNA profile of each remaining barcode to determine if it is "empty" or cell containing partition - captures low RNA content cells whose total UMI counts may be similar to empty GEMs
		  - (creates background model of RNA profiles from selected barcodes - multinomial distribution over genes - using Simple Good-Turing smoothing to provide a non-zero model estimate for genes not observed in representative empty GEM set)
		  - (RNA profile of each barcode not called as cell in step 1 is compared to background model)
		  - (barcodes whose RNA profile strongly disagrees with background model are added to set of positive cell calls)
		  - (to remedy cases in which set of barcodes called as cells does not match desired set of barcodes based on visual inspection: re-run count/reanalyze with --force-cells option, select desired barcodes from raw feature-barcode matrix in downstream analysis, or select custom barcodes in reanalyze using --barcodes)
* estimating multiplet rates
	 + cell-associated barcodes are classified as species1 or species2 based on which genome has more total UMI counts for that barcode
	 + cell-associated barcodes with total UMI counts that exceed the 10th percentile of the distributions for both species1 and species2 are classified as multiplets
	 + computes inferred multiplet rate by estimating the total number of multiplets (including (species1, species1) and (species2, species2))
		  - estimates via ML the total number of multiplet GEMs from the observed multiplets and the inferred ratio of species1 to species2 cells
		  - if ratio is 1:1, the inferred multiplet rate is approximately twice the observed (species1, species2) multiplets

```{bash, eval=FALSE, echo=TRUE}
#process reads using human_genome_index
cd /project2/gilad/ghousman/skeletal-human-chimp/scRNA/cellranger-data-full/cellranger-data-HumanOrthoV2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-1 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-2 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-3 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-4 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-1 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-2 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-4 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-5 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-6 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-8 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-9 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-10 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-11 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-12 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-15 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-16 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-17 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-18 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-19 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-20 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-21 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-22 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7

#process reads using chimp_genome_index
cd /project2/gilad/ghousman/skeletal-human-chimp/scRNA/cellranger-data-full/cellranger-data-ChimpOrthoV2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-1 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-2 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-3 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh GHO-4 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-1 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-2 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-4 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-5 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-6 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-8 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-9 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-10 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-11 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-12 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-15 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-16 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-17 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-18 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-19 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-20 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-21 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count.sh HOU-22 /project2/gilad/kenneth/References/HumanChimpCellranger/ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7

#process reads using combined_genome_index
cd /project2/gilad/ghousman/skeletal-human-chimp/scRNA/cellranger-data-full/cellranger-data-HumanOrthoV2_and_ChimpOrthoV2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh GHO-1 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh GHO-2 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh GHO-3 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh GHO-4 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/190621_K00242_0576_AH7G3JBBXY_YG-GH-10X-4S-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190626_K00242_0578_AH77TNBBXY_YG-GH-10X-4S-ln2,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190726_K00242_0593_BH77N2BBXY_YG-GH-10X-4S-xtra-ln1,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/190730_K00242_0594_BH7N3HBBXY_YG-GH-10X-4S-xtra-ln2
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-1 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-2 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-4 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-5 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-6 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-8 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-9 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-10 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-11 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-12 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-15 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-16 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191112_K00242_0637_AHCLNGBBXY-YG-GH-10X-12S-HOU-lns1-2/HCLNGBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191217_K00242_0648_BHFHY7BBXY-YG-GH-10X-12S-HOU-lns345/FastQ/HFHY7BBXY_123,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/191220_K00242_0650_BHFTJ2BBXY-YG-GH-10X-12S-HOU-lns6789/FastQ/HFTJ2BBXY_1234
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-17 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-18 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-19 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-20 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-21 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
sbatch ./../../../human-chimp-skeletal-scRNA/code/submit-cellranger-count-multispp.sh HOU-22 /project2/gilad/kenneth/References/HumanChimpCellranger/HumanOrthoV2_and_ChimpOrthoV2 /project2/gilad/ghousman/skeletal-human-chimp/scRNA/191227_K00242_0655_BHG3MCBBXY-YG-GH-10X-HOU2-6s-lns12/Unaligned_YG-GH-10X-HOU2-6S/HG3MCBBXY_78,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200103_K00242_0656_BHFYVWBBXY_YG-GH-10X-HOU2-6S-ln3/Unaligned_YG-GH-10X-HOU2-6S-ln3/HFYVWBBXY_7,/project2/gilad/ghousman/skeletal-human-chimp/scRNA/200124_K00242_0661_BHGGF3BBXY-YG-GH-HOU2-10X-6S-ln4/Unaligned_YG-GH-10X-HOU2-6S-ln4/HGGF3BBXY_7
```

### Processing count matrices

Compile 10X data using seurat.

Each dataset being evaluated comprises gene count data that were seperately calculated using both the hg38 human genome and the panTro6 chimpanzee genome, as well as the corresponding ortho-exon annotation in cellranger. Species-specific assignments were determined using human-chimpanzee genome combination with ortho-exon annotation.

```{bash, eval=FALSE, echo=TRUE}
#easties to run these scripts on the cluster
sinteractive --mem=24g --time=12:00:00 --partition=broadwl
module load R/3.6.1
R
```

```{r load libraries, eval=FALSE, echo=TRUE}

library(Seurat)
library(dplyr)
library(stringi)
library(stringr)
library(ggplot2)
library(colorspace)
library(RColorBrewer)

```

```{r load batch information, eval=FALSE, echo=TRUE}

#Load batch info
batch <- read.csv(file='./data/scrna-batch.csv', header=TRUE, sep=",")

#batch <- as.data.frame(t(c("1-C","1","Chondrocyte","GHO-3","H1-C","H23555","M",22,"C1-C","C8861","M",16)))
#colnames(batch) <- c("Pooled_Sample_Name","Batch","Cell_Type","Sample_Name_at_Core",
#                     "Human_Sample_in_Pool","Human_Individual_in_Pool","Human_Sex_in_Pool","Human_Age_in_Pool",
#                     "Chimp_Sample_in_Pool","Chimp_Individual_in_Pool","Chimp_Sex_in_Pool","Chimp_Age_in_Pool")

```

```{r assess species assignments, eval=FALSE, echo=TRUE}

#Load species assignments
spp <- data.frame()
i <- 1
while (i <= length(batch$Sample_Name_at_Core)) {
  print(i)
  #Define directory containing data from one collection
  dir_data <- paste0('./../scRNA/cellranger-data-full/cellranger-data-HumanOrthoV2_and_ChimpOrthoV2/',batch$Sample_Name_at_Core[i],'/outs/analysis/')
  #Load summary metrics from one collection
  temp <- read.csv(file=paste0(dir_data,'gem_classification.csv'))
  #Process metrics
  temp$barcode <- sapply(temp$barcode, gsub, pattern="-1", replacement="")
  temp$call <- sapply(temp$call, gsub, pattern="HumanOrthoV2", replacement="Human")
  temp$call <- sapply(temp$call, gsub, pattern="ChimpOrthoV2", replacement="Chimp")
  temp$Collection.Name <- batch$Sample_Name_at_Core[i]
  #Add data to dataframe
  spp <- rbind(spp,temp)
  i <- i+1
}
rm(dir_data,temp)

```

```{r process scRNA data - isolate human and chimp cells, eval=FALSE, echo=TRUE}

#Isolate human and chimp cells for each collection
i <- 1
while (i <= length(batch$Sample_Name_at_Core)) {

  print(paste0("Processing ",batch$Sample_Name_at_Core[i]))
  
  #(0)define directory
    dir_h.data <- paste0('./../scRNA/cellranger-data-full/cellranger-data-HumanOrthoV2/',batch$Sample_Name_at_Core[i],'/outs')
    dir_c.data <- paste0('./../scRNA/cellranger-data-full/cellranger-data-ChimpOrthoV2/',batch$Sample_Name_at_Core[i],'/outs')
    
  #(1)load data
    h.data <- Read10X(data=paste0(dir_h.data,"/raw_feature_bc_matrix"))
    c.data <- Read10X(data=paste0(dir_c.data,"/raw_feature_bc_matrix"))
    
  #(2)create seurat objects
    h.dat <- CreateSeuratObject(counts=h.data)
    c.dat <- CreateSeuratObject(counts=c.data)
    
  #(3)view details of seurat objects
    h.dat #19399 features, 6794880 samples
    c.dat #19399 features, 6794880 samples
    
  #(4)clear raw data from workspace
    rm(h.data,c.data)
  
  #(5)add species assignments to data
    dir_data <- paste0('./../scRNA/cellranger-data-full/cellranger-data-HumanOrthoV2_and_ChimpOrthoV2/',batch$Sample_Name_at_Core[i],'/outs/analysis/')
    #Load summary metrics
    temp <- read.csv(file=paste0(dir_data,'gem_classification.csv'))
    #Process metrics
    temp$barcode <- sapply(temp$barcode, gsub, pattern="-1", replacement="")
    temp$call <- sapply(temp$call, gsub, pattern="HumanOrthoV2", replacement="Human")
    temp$call <- sapply(temp$call, gsub, pattern="ChimpOrthoV2", replacement="Chimp")
    temp$Collection.Name <- batch$Sample_Name_at_Core[i]

    m <- match(rownames(h.dat@meta.data),temp$barcode)
    if(any(is.na(m))) cat("Not all barcodes are in data.\n")
    h.dat <- AddMetaData(h.dat, temp[m,]$call, col.name="Species")
  
    m <- match(rownames(c.dat@meta.data),temp$barcode)
    if(any(is.na(m))) cat("Not all barcodes are in data.\n")
    c.dat <- AddMetaData(c.dat, temp[m,]$call, col.name="Species")

  #(6)view details of species assignments
    table(h.dat@meta.data$Species, useNA="always")
    table(c.dat@meta.data$Species, useNA="always")
  
  #(7)subset data to only include human and chimp cells/genes
    h.dat.spp <- subset(h.dat, subset=Species=="Human")
    c.dat.spp <- subset(c.dat, subset=Species=="Chimp")
 
  #(8)create merged object
    h.c.dat.spp <- merge(h.dat.spp,c.dat.spp)
    saveRDS(h.c.dat.spp, file=paste0('./data/cellranger-data-full/h.c.dat.spp.',batch$Sample_Name_at_Core[i],'.rds'))

  #(9)remove unnecessary variables
    rm(h.dat,c.dat,h.dat.spp,c.dat.spp)
    rm(dir_h.data,dir_c.data)

  i <- i+1
  
}

```

```{r process scRNA data - add mitochondrial metadata, eval=FALSE, echo=TRUE}

#Read in files
data <- list()
for (i in 1:length(batch$Sample_Name_at_Core)) {
  print(i)
  data[[i]] <- readRDS(paste0("./data/cellranger-data-full/h.c.dat.spp.",batch$Sample_Name_at_Core[i],".rds"))
}

#Identify mitochondrial genes (should be 12 genes total) and add percent of mitochondrial reads vs. total reads
#which(sapply(data[[i]]@assays$RNA@counts@Dimnames[[1]], stri_count_regex, pattern="MT-")==1)
#MT-CO2   16608
#MT-CYB   16616
#MT-ND2   16635
#MT-ND5   16643
#MT-CO1   16654
#MT-ND3   16676
#MT-ND4   16701
#MT-ND1   16703
#MT-ATP6  16709
#MT-CO3   16732
#MT-ND4L  17250
#MT-ATP8  17689
#INMT-MINDY4  18276 - not actually a mitochondrial gene
mito <- c("MT-ATP6","MT-ATP8","MT-CO1","MT-CO2","MT-CO3","MT-CYB","MT-ND1","MT-ND2","MT-ND3","MT-ND4","MT-ND4L","MT-ND5")
for (i in 1:length(data)) { data[[i]]$percent.mt <- PercentageFeatureSet(data[[i]], features=mito) }

```

```{r load files with other relevant metadata, eval=FALSE, echo=TRUE}

#Load batch data
batch <- read.csv(file='./data/scrna-batch-reformat.csv', header=TRUE, sep=",")
batch[,c(1:7,9:10,21,24:25)] <- lapply(batch[,c(1:7,9:10,21,24:25)], function(x) as.character(x)) #names, sex, dates
batch[,c(8,11:20,22:23,25:26)] <- lapply(batch[,c(8,11:20,22:23,25:26)], function(x) as.numeric(as.character(x))) #numeric values only

#Load FACS validation data
fcs <- read.csv(file='./data/facs-MSC-collection-summary-total.csv', header=TRUE, sep=",")
fcs <- fcs[,c(2,6,29,31,33,35)]
fcs$Sample_Details <- factor(fcs$Sample_Details,
                             levels=c("iPSC - control","iPSC - cocktail","MSC - cocktail"),
                             labels=c("iPSCcontrol","iPSCcocktail","MSCcocktail"))
fcs <- split(fcs, fcs$Sample_Details)
fcs$iPSCcontrol$Abbr_Details <- factor(fcs$iPSCcontrol$Abbr_Details,
                                       levels=c("C1 iPSC - control",
                                                "C1-r2 iPSC - control",
                                                "C2 iPSC - control",
                                                "C3 iPSC - control",
                                                "C4 iPSC - control",
                                                "C5 iPSC - control",
                                                "C6 iPSC - control",
                                                "H1 iPSC - control",
                                                "H1-r2 iPSC - control",
                                                "H2 iPSC - control",
                                                "H3 iPSC - control",
                                                "H4 iPSC - control",
                                                "H5 iPSC - control",
                                                "H6 iPSC - control"),
                                       labels=c("C1-I","C1-I-r2","C2-I","C3-I","C4-I","C5-I","C6-I",
                                                "H1-I","H1-I-r2","H2-I","H3-I","H4-I","H5-I","H6-I"))
fcs$iPSCcocktail$Abbr_Details <- factor(fcs$iPSCcocktail$Abbr_Details,
                                        levels=c("C1 iPSC - cocktail",
                                                 "C1-r2 iPSC - cocktail",
                                                 "C2 iPSC - cocktail",
                                                 "C3 iPSC - cocktail",
                                                 "C4 iPSC - cocktail",
                                                 "C5 iPSC - cocktail",
                                                 "C6 iPSC - cocktail",
                                                 "H1 iPSC - cocktail",
                                                 "H1-r2 iPSC - cocktail",
                                                 "H2 iPSC - cocktail",
                                                 "H3 iPSC - cocktail",
                                                 "H4 iPSC - cocktail",
                                                 "H5 iPSC - cocktail",
                                                 "H6 iPSC - cocktail"),
                                       labels=c("C1-I","C1-I-r2","C2-I","C3-I","C4-I","C5-I","C6-I",
                                                "H1-I","H1-I-r2","H2-I","H3-I","H4-I","H5-I","H6-I"))
fcs$MSCcocktail$Abbr_Details <- factor(fcs$MSCcocktail$Abbr_Details,
                                       levels=c("C1 MSC - cocktail",
                                                "C1-r2 MSC - cocktail",
                                                "C2 MSC - cocktail",
                                                "C3 MSC - cocktail",
                                                "C4 MSC - cocktail",
                                                "C5 MSC - cocktail",
                                                "C6 MSC - cocktail",
                                                "H1 MSC - cocktail",
                                                "H1-r2 MSC - cocktail",
                                                "H2 MSC - cocktail",
                                                "H3 MSC - cocktail",
                                                "H4 MSC - cocktail",
                                                "H5 MSC - cocktail",
                                                "H6 MSC - cocktail"),
                                       labels=c("C1-M","C1-M-r2","C2-M","C3-M","C4-M","C5-M","C6-M",
                                                "H1-M","H1-M-r2","H2-M","H3-M","H4-M","H5-M","H6-M"))
fcs.ctrl <- aggregate(. ~ Abbr_Details, fcs$iPSCcontrol, mean) #calculate averages
fcs.ipsc <- aggregate(. ~ Abbr_Details, fcs$iPSCcocktail, mean) #calculate averages
fcs.msc  <- aggregate(. ~ Abbr_Details, fcs$MSCcocktail, mean) #calculate averages
fcs.ctrl$Abbr_Details <- as.character(fcs.ctrl$Abbr_Details)
fcs.ipsc$Abbr_Details <- as.character(fcs.ipsc$Abbr_Details)
fcs.msc$Abbr_Details <- as.character(fcs.msc$Abbr_Details)
rm(fcs)

#Load Alizarin Red data
alz <- read.csv(file='./data/alizarin-red-quant-total.csv', header=TRUE, sep=",")
alz <- alz[c(1:8,13:20,25:60,65:72,77:140),] #remove C1-6W, H1-6W, H3-1A
alz <- alz[c(1:8,10:11,14:18,20:124),] #remove outliers
alz$Sample <- factor(alz$Sample, 
                     levels = c("C1-M","C1-O 12w",
                                "CR-M","CR-O",
                                "C2-M","C2-O",
                                "C3-M","C3-O",
                                "C4-M","C4-O",
                                "C5-M","C5-O",
                                "C6-M","C6-O",
                                "H1-M","H1-O 12w",
                                "HR-M","HR-O",
                                "H2-M","H2-O",
                                "H3-M(1)","H3-O(1)",
                                "H4-M","H4-O",
                                "H5-M","H5-O",
                                "H6-M","H6-O"),
                     labels = c("C1-M","C1-O",
                                "C1-M-r2","C1-O-r2",
                                "C2-M","C2-O",
                                "C3-M","C3-O",
                                "C4-M","C4-O",
                                "C5-M","C5-O",
                                "C6-M","C6-O",
                                "H1-M","H1-O",
                                "H1-M-r2","H1-O-r2",
                                "H2-M","H2-O","
                                H3-M","H3-O",
                                "H4-M","H4-O",
                                "H5-M","H5-O",
                                "H6-M","H6-O")) 
alz <- aggregate(Absorbance_Value ~ Sample, alz, mean) #calculate averages
alz$Sample <- as.character(alz$Sample)

#Load Oil Red data
oil <- read.csv(file='./data/oil-red-quant-total.csv', header=TRUE, sep=",")
oil <- oil[c(1:63,65:91,93:112),] #remove outliers
oil$Sample <- factor(oil$Sample, 
                     levels = c("C1-M","C1-A",
                                "CR-M","CR-A",
                                "C2-M","C2-A",
                                "C3-M","C3-A",
                                "C4-M","C4-A",
                                "C5-M","C5-A",
                                "C6-M","C6-A",
                                "H1-M","H1-A",
                                "HR-M","HR-A",
                                "H2-M","H2-A",
                                "H3-M","H3-A",
                                "H4-M","H4-A",
                                "H5-M","H5-A",
                                "H6-M","H6-A"),
                     labels = c("C1-M","C1-O",
                                "C1-M-r2","C1-O-r2",
                                "C2-M","C2-O",
                                "C3-M","C3-O",
                                "C4-M","C4-O",
                                "C5-M","C5-O",
                                "C6-M","C6-O",
                                "H1-M","H1-O",
                                "H1-M-r2","H1-O-r2",
                                "H2-M","H2-O",
                                "H3-M","H3-O",
                                "H4-M","H4-O",
                                "H5-M","H5-O",
                                "H6-M","H6-O")) 
oil <- aggregate(Absorbance_Value ~ Sample, oil, mean) #calculate averages
oil$Sample <- as.character(oil$Sample)

```

```{r process scRNA data - add other relevant metadata, eval=FALSE, echo=TRUE}

#Add additional details to list

#collection
for (i in 1:length(data)) { data[[i]]$Collection <- i }

#cell type anticipated based on stage of differentiation at collection
for (i in c(1,4,7,10,13,16,19)) { data[[i]]$Cell.Type <- "iPSC" }
for (i in c(2,5,8,11,14,17,20)) { data[[i]]$Cell.Type <- "MSC" }
for (i in c(3,6,9,12,15,18,21)) { data[[i]]$Cell.Type <- "Osteoblast" }

#individuals pooled together in collection
for (i in 1:6) { data[[i]]$Pair <- "H1+C1" }
for (i in 7:9) { data[[i]]$Pair <- "H2+C2" }
for (i in 10:12) { data[[i]]$Pair <- "H3+C3" }
for (i in 13:15) { data[[i]]$Pair <- "H4+C4" }
for (i in 16:18) { data[[i]]$Pair <- "H5+C5" }
for (i in 19:21) { data[[i]]$Pair <- "H6+C6" }

#individual cell line used in collection
for (i in 1:length(data)) { data[[i]]$Individual <- NA }
for (i in 1:6) { data[[i]]$Individual[which(data[[i]]$Species=="Human")] <- "H1" }
for (i in 1:6) { data[[i]]$Individual[which(data[[i]]$Species=="Chimp")] <- "C1" }
for (i in 7:9) { data[[i]]$Individual[which(data[[i]]$Species=="Human")] <- "H2" }
for (i in 7:9) { data[[i]]$Individual[which(data[[i]]$Species=="Chimp")] <- "C2" }
for (i in 10:12) { data[[i]]$Individual[which(data[[i]]$Species=="Human")] <- "H3" }
for (i in 10:12) { data[[i]]$Individual[which(data[[i]]$Species=="Chimp")] <- "C3" }
for (i in 13:15) { data[[i]]$Individual[which(data[[i]]$Species=="Human")] <- "H4" }
for (i in 13:15) { data[[i]]$Individual[which(data[[i]]$Species=="Chimp")] <- "C4" }
for (i in 16:18) { data[[i]]$Individual[which(data[[i]]$Species=="Human")] <- "H5" }
for (i in 16:18) { data[[i]]$Individual[which(data[[i]]$Species=="Chimp")] <- "C5" }
for (i in 19:21) { data[[i]]$Individual[which(data[[i]]$Species=="Human")] <- "H6" }
for (i in 19:21) { data[[i]]$Individual[which(data[[i]]$Species=="Chimp")] <- "C6" }

#replicate in overall study design
for (i in c(1:3,7:21)) { data[[i]]$Replicate <- "1" }
for (i in 4:6) { data[[i]]$Replicate <- "2" }
for (i in c(1:3,7:12)) { data[[i]]$MSCmedia <- "3B" }
for (i in c(4:6,13:21)) { data[[i]]$MSCmedia <- "2B" }

#abbreviation of sample name in collection
for (i in 1:length(data)) { data[[i]]$Sample <- NA }
for (i in 1:length(data)) { 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H1" & data[[i]]$Replicate=="1")] <- "H1-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H1" & data[[i]]$Replicate=="2")] <- "H1-I-r2" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H2" & data[[i]]$Replicate=="1")] <- "H2-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H3" & data[[i]]$Replicate=="1")] <- "H3-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H4" & data[[i]]$Replicate=="1")] <- "H4-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H5" & data[[i]]$Replicate=="1")] <- "H5-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="H6" & data[[i]]$Replicate=="1")] <- "H6-I"
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C1" & data[[i]]$Replicate=="1")] <- "C1-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C1" & data[[i]]$Replicate=="2")] <- "C1-I-r2" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C2" & data[[i]]$Replicate=="1")] <- "C2-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C3" & data[[i]]$Replicate=="1")] <- "C3-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C4" & data[[i]]$Replicate=="1")] <- "C4-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C5" & data[[i]]$Replicate=="1")] <- "C5-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="iPSC" & data[[i]]$Individual=="C6" & data[[i]]$Replicate=="1")] <- "C6-I" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H1" & data[[i]]$Replicate=="1")] <- "H1-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H1" & data[[i]]$Replicate=="2")] <- "H1-M-r2" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H2" & data[[i]]$Replicate=="1")] <- "H2-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H3" & data[[i]]$Replicate=="1")] <- "H3-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H4" & data[[i]]$Replicate=="1")] <- "H4-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H5" & data[[i]]$Replicate=="1")] <- "H5-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="H6" & data[[i]]$Replicate=="1")] <- "H6-M"
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C1" & data[[i]]$Replicate=="1")] <- "C1-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C1" & data[[i]]$Replicate=="2")] <- "C1-M-r2" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C2" & data[[i]]$Replicate=="1")] <- "C2-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C3" & data[[i]]$Replicate=="1")] <- "C3-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C4" & data[[i]]$Replicate=="1")] <- "C4-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C5" & data[[i]]$Replicate=="1")] <- "C5-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="MSC" & data[[i]]$Individual=="C6" & data[[i]]$Replicate=="1")] <- "C6-M" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H1" & data[[i]]$Replicate=="1")] <- "H1-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H1" & data[[i]]$Replicate=="2")] <- "H1-O-r2" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H2" & data[[i]]$Replicate=="1")] <- "H2-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H3" & data[[i]]$Replicate=="1")] <- "H3-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H4" & data[[i]]$Replicate=="1")] <- "H4-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H5" & data[[i]]$Replicate=="1")] <- "H5-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="H6" & data[[i]]$Replicate=="1")] <- "H6-O"
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C1" & data[[i]]$Replicate=="1")] <- "C1-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C1" & data[[i]]$Replicate=="2")] <- "C1-O-r2" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C2" & data[[i]]$Replicate=="1")] <- "C2-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C3" & data[[i]]$Replicate=="1")] <- "C3-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C4" & data[[i]]$Replicate=="1")] <- "C4-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C5" & data[[i]]$Replicate=="1")] <- "C5-O" 
  data[[i]]$Sample[which(data[[i]]$Cell.Type=="Osteoblast" & data[[i]]$Individual=="C6" & data[[i]]$Replicate=="1")] <- "C6-O" 
}

samples <- c("C1-I","C1-I-r2","C2-I","C3-I","C4-I","C5-I","C6-I",
             "H1-I","H1-I-r2","H2-I","H3-I","H4-I","H5-I","H6-I",
             "C1-M","C1-M-r2","C2-M","C3-M","C4-M","C5-M","C6-M",
             "H1-M","H1-M-r2","H2-M","H3-M","H4-M","H5-M","H6-M",
             "C1-O","C1-O-r2","C2-O","C3-O","C4-O","C5-O","C6-O",
             "H1-O","H1-O-r2","H2-O","H3-O","H4-O","H5-O","H6-O")

#several details on cell line and collection
for (i in 1:length(data)) { data[[i]]$Sex <- NA }
for (i in 1:length(data)) { data[[i]]$Age <- NA }
for (i in 1:length(data)) { data[[i]]$DateCollection <- NA }
for (i in 1:length(data)) { data[[i]]$Number6W <- NA }
for (i in 1:length(data)) { data[[i]]$PrewashCount <- NA }
for (i in 1:length(data)) { data[[i]]$PrewashViability <- NA }
for (i in 1:length(data)) { data[[i]]$PostwashCount <- NA }
for (i in 1:length(data)) { data[[i]]$PostwashViability <- NA }
for (i in 1:length(data)) { data[[i]]$PostmixCount <- NA }
for (i in 1:length(data)) { data[[i]]$PostmixViability <- NA }
for (i in 1:length(data)) { data[[i]]$DatecDNA <- NA }
for (i in 1:length(data)) { data[[i]]$DateLibrary <- NA }
for (i in 1:length(data)) { data[[i]]$SequencingBatch <- NA }
for (i in 1:length(data)) { 
  for(j in samples) {
    if(j %in% batch$Sample_in_Pool) {
      data[[i]]$Sex[which(data[[i]]$Sample==j)] <- batch$Sex_in_Pool[which(batch$Sample_in_Pool==j)]
      data[[i]]$Age[which(data[[i]]$Sample==j)] <- batch$Age_in_Pool[which(batch$Sample_in_Pool==j)]
      data[[i]]$DateCollection[which(data[[i]]$Sample==j)] <- batch$Date_of_10X_Collection[which(batch$Sample_in_Pool==j)]
      data[[i]]$Number6W[which(data[[i]]$Sample==j)] <- batch$Number_of_6wells_Used[which(batch$Sample_in_Pool==j)]
      data[[i]]$PrewashCount[which(data[[i]]$Sample==j)] <- batch$X10X_Cell_Count_Prewash[which(batch$Sample_in_Pool==j)]
      data[[i]]$PrewashViability[which(data[[i]]$Sample==j)] <- batch$X10X_Cell_Viability_Prewash[which(batch$Sample_in_Pool==j)]
      data[[i]]$PostwashCount[which(data[[i]]$Sample==j)] <- batch$X10X_Cell_Count_Postwash[which(batch$Sample_in_Pool==j)]
      data[[i]]$PostwashViability[which(data[[i]]$Sample==j)] <- batch$X10X_Cell_Viability_Postwash[which(batch$Sample_in_Pool==j)]
      data[[i]]$PostmixCount[which(data[[i]]$Sample==j)] <- batch$X10X_Cell_Count_Postwash_Postmix[which(batch$Sample_in_Pool==j)]
      data[[i]]$PostmixViability[which(data[[i]]$Sample==j)] <- batch$X10X_Cell_Viability_Postwash_Postmix[which(batch$Sample_in_Pool==j)]
      data[[i]]$DatecDNA[which(data[[i]]$Sample==j)] <- batch$Date_of_10X_cDNA_Synthesis[which(batch$Sample_in_Pool==j)]
      data[[i]]$DateLibrary[which(data[[i]]$Sample==j)] <- batch$Date_of_10X_Library_Prep[which(batch$Sample_in_Pool==j)]
      data[[i]]$SequencingBatch[which(data[[i]]$Sample==j)] <- batch$X10X_Sequencing_Pool[which(batch$Sample_in_Pool==j)]
    }
  }
}

#facs information (control)
for (i in 1:length(data)) { data[[i]]$CD90_Control <- NA }
for (i in 1:length(data)) { data[[i]]$CD73_Control <- NA }
for (i in 1:length(data)) { data[[i]]$CD105_Control <- NA }
for (i in 1:length(data)) { data[[i]]$CD45.CD34.CD11b.CD19.HLA.DR_Control <- NA }
for (i in 1:length(data)) { 
  for(j in samples) {
    if(j %in% fcs.ctrl$Abbr_Details) {
      data[[i]]$CD90_Control[which(data[[i]]$Sample==j)] <- fcs.ctrl$CD90_Percentage[which(fcs.ctrl$Abbr_Details==j)] 
      data[[i]]$CD73_Control[which(data[[i]]$Sample==j)] <- fcs.ctrl$CD73_Percentage[which(fcs.ctrl$Abbr_Details==j)] 
      data[[i]]$CD105_Control[which(data[[i]]$Sample==j)] <- fcs.ctrl$CD105_Percentage[which(fcs.ctrl$Abbr_Details==j)] 
      data[[i]]$CD45.CD34.CD11b.CD19.HLA.DR_Control[which(data[[i]]$Sample==j)] <-
        fcs.ctrl$CD45.CD34.CD11b.CD19.HLA.DR_Percentage[which(fcs.ctrl$Abbr_Details==j)]
    }
  }
}

#facs information (cocktail) 
for (i in 1:length(data)) { data[[i]]$CD90 <- NA }
for (i in 1:length(data)) { data[[i]]$CD73 <- NA }
for (i in 1:length(data)) { data[[i]]$CD105 <- NA }
for (i in 1:length(data)) { data[[i]]$CD45.CD34.CD11b.CD19.HLA.DR <- NA }
for (i in 1:length(data)) { 
  for(j in samples) {
    if(j %in% fcs.ipsc$Abbr_Details) {
      data[[i]]$CD90[which(data[[i]]$Sample==j)] <- fcs.ipsc$CD90_Percentage[which(fcs.ipsc$Abbr_Details==j)] 
      data[[i]]$CD73[which(data[[i]]$Sample==j)] <- fcs.ipsc$CD73_Percentage[which(fcs.ipsc$Abbr_Details==j)] 
      data[[i]]$CD105[which(data[[i]]$Sample==j)] <- fcs.ipsc$CD105_Percentage[which(fcs.ipsc$Abbr_Details==j)] 
      data[[i]]$CD45.CD34.CD11b.CD19.HLA.DR[which(data[[i]]$Sample==j)] <- fcs.ipsc$CD45.CD34.CD11b.CD19.HLA.DR_Percentage[which(fcs.ipsc$Abbr_Details==j)]
    }
  }
}
for (i in 1:length(data)) { 
  for(j in samples) {
    if(j %in% fcs.msc$Abbr_Details) {
      data[[i]]$CD90[which(data[[i]]$Sample==j)] <- fcs.msc$CD90_Percentage[which(fcs.msc$Abbr_Details==j)] 
      data[[i]]$CD73[which(data[[i]]$Sample==j)] <- fcs.msc$CD73_Percentage[which(fcs.msc$Abbr_Details==j)] 
      data[[i]]$CD105[which(data[[i]]$Sample==j)] <- fcs.msc$CD105_Percentage[which(fcs.msc$Abbr_Details==j)] 
      data[[i]]$CD45.CD34.CD11b.CD19.HLA.DR[which(data[[i]]$Sample==j)] <- fcs.msc$CD45.CD34.CD11b.CD19.HLA.DR_Percentage[which(fcs.msc$Abbr_Details==j)]
    }
  }
}

#alizarin red data
for (i in 1:length(data)) { data[[i]]$Alizarin <- NA }
for (i in 1:length(data)) { 
  for(j in samples) {
    if(j %in% alz$Sample) {
      data[[i]]$Alizarin[which(data[[i]]$Sample==j)] <- alz$Absorbance_Value[which(alz$Sample==j)]
    }
  }
}

#oil red data (for now put with MSCs and osteoblasts)
for (i in 1:length(data)) { data[[i]]$OilRed <- NA }
for (i in 1:length(data)) { 
  for(j in samples) {
    if(j %in% oil$Sample) {
      data[[i]]$OilRed[which(data[[i]]$Sample==j)] <- oil$Absorbance_Value[which(oil$Sample==j)]
    }
  }
}
  
#cell classification information - stage of differentiation at collection
for (i in c(1,4,7,10,13,16,19)) { data[[i]]$Stage <- "Time 0" }
for (i in c(2,5,8,11,14,17,20)) { data[[i]]$Stage <- "Time 1" }
for (i in c(3,6,9,12,15,18,21)) { data[[i]]$Stage <- "Time 2" }

```

```{r, eval=FALSE, echo=TRUE}

#Save data
saveRDS(data, file="./data/cellranger-data-full/data.rds")

```

NEED TO UPDATE THIS!

Export processed count matrices for GEO

```{r, eval=FALSE, echo=TRUE}

##Export count matrices for each 10x collection with species assignment appended to cell barcode
#sample <- c(unique(batch$Sample_Name_at_Core),"GHO-3")
#for (i in 1:length(sample)) {
#  print(i)
#  data <- readRDS(paste0("./data/cellranger-data-full/h.c.dat.spp.",sample[i],".rds"))
#  data <- RenameCells(data, add.cell.id=data@meta.data$Species)
#  write.table(as.matrix(GetAssayData(object=data, slot="counts")), 
#            paste0("./data/cellranger-data-full/h.c.dat.spp.",sample[i],".csv"), 
#            sep=',',
#            row.names=T,
#            col.names=T,
#            quote=F)
#}

#####

#Add metadata to GHO-3 - INCOMPLETE
tmp.data <- readRDS(paste0("./data/cellranger-data-full/h.c.dat.spp.GHO-3.rds"))
#percent mitochondria
mito <- c("MT-ATP6","MT-ATP8","MT-CO1","MT-CO2","MT-CO3","MT-CYB","MT-ND1","MT-ND2","MT-ND3","MT-ND4","MT-ND4L","MT-ND5")
tmp.data$percent.mt <- PercentageFeatureSet(tmp.data, features=mito)

#CHECK
#collection
tmp.data$Collection <- 0

#cell type anticipated based on stage of differentiation at collection
tmp.data$Cell.Type <- "Chondrogenic"
#individuals pooled together in collection
tmp.data$Pair <- "H1+C1"
#individual cell line used in collection
tmp.data$Individual <- NA
tmp.data$Individual[which(tmp.data$Species=="Human")] <- "H1"
tmp.data$Individual[which(tmp.data$Species=="Chimp")] <- "C1"
#replicate in overall study design
tmp.data$Replicate <- "1"
#MSC media
tmp.data$MSCmedia <- "3B"
#abbreviation of sample name in collection
tmp.data$Sample <- NA
tmp.data$Sample[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- "H1-C" 
tmp.data$Sample[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- "C1-C" 

#CHECK
#several details on cell line and collection
tmp.data$Sex[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$Age[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$DateCollection[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$Number6W[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PrewashCount[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PrewashViability[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostwashCount[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostwashViability[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostmixCount[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostmixViability[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$DatecDNA[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$DateLibrary[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA
tmp.data$SequencingBatch[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="H1" & tmp.data$Replicate=="1")] <- NA

tmp.data$Age[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$DateCollection[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$Number6W[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PrewashCount[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PrewashViability[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostwashCount[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostwashViability[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostmixCount[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$PostmixViability[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$DatecDNA[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$DateLibrary[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA
tmp.data$SequencingBatch[which(tmp.data$Cell.Type=="Chondrogenic" & tmp.data$Individual=="C1" & tmp.data$Replicate=="1")] <- NA

#facs information (control)
tmp.data$CD90_Control <- NA
tmp.data$CD73_Control <- NA
tmp.data$CD105_Control <- NA
tmp.data$CD45.CD34.CD11b.CD19.HLA.DR_Control <- NA
#facs information (cocktail) 
tmp.data$CD90 <- NA
tmp.data$CD73 <- NA
tmp.data$CD105 <- NA
tmp.data$CD45.CD34.CD11b.CD19.HLA.DR <- NA
#alizarin red data
tmp.data$Alizarin <- NA
#oil red data (for now put with MSCs and osteoblasts)
tmp.data$OilRed <- NA
#cell classification information - stage of differentiation at collection
tmp.data$Stage <- "Time 3"

#####

#Export count matrix and metadata for GHO-1, GHO-2, GHO-3, and GHO-4 [processed data for pilot eQTL paper]
sample <- c("GHO-1","GHO-2","GHO-3","GHO-4")
tbl.cnt <- data.frame()
tbl.met <- data.frame()
for (i in 1:length(sample)) {
  print(i)
  data <- readRDS(paste0("./data/cellranger-data-full/h.c.dat.spp.",sample[i],".rds"))
  tbl.cnt <- cbind(tbl.cnt,as.data.frame(GetAssayData(object=data, slot="counts")))
  tbl.met <- rbind(tbl.met,as.data.frame(data@meta.data)[,-c(1:3)])
}

#Export count matrix and metadata for remaining samples
data <- readRDS("./data/cellranger-data-full/data.rds")
tbl.cnt <- data.frame()
tbl.met <- data.frame()
i=1
while (i <= length(data)) {
  print(i)
  tbl.cnt <- cbind(tbl.cnt,as.data.frame(GetAssayData(object=data[i], slot="counts")))
  tbl.met <- rbind(tbl.met,as.data.frame(data[[i]]@meta.data)[,-c(1:3)])
  i=i+1
}

```

