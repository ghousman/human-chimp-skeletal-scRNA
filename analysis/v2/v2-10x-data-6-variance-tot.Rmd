---
title: "10x-data-variance-tot"
author: "Genevieve Housman"
date: "September 2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 10X Data Cellranger Analysis - Variance in Gene Expression

Examine whether variance in gene expression differs across time points in humans and chimpanzees.

```{r, message=FALSE}

#Load libraries
library(Seurat)
library(dplyr)
library(stringi)
library(stringr)
library(ggplot2)
library(grid)
library(gbm)
library(colorspace)
library(RColorBrewer)
library(edgeR)
library(scran)
library(SingleCellExperiment)
library(reshape2)

```

```{r}

#Load data
scrna <- "./data/cellranger-data-full/data.filter.log.indv-cell.int19k.reg-tot.assign.rds" #integrate across individuals - total (19k genes + regress out UMI/mito)
#scrna <- "./data/cellranger-data-full/data.filter.log.indv-cell.int19k-tot.assign.rds" #integrate across individuals - total (19k genes)
data <- readRDS(scrna)
data

#Define individual-replicate sets
data@meta.data$Individual.Replicate <- paste0(data@meta.data$Individual,".",data@meta.data$Replicate)

```

Define genes of interest: all except mitochondrial genes and ribosomal genes.

```{r}

genes <- rownames(data@assays$RNA@counts)
genes.mito <- c("MT-ATP6","MT-ATP8","MT-CO1","MT-CO2","MT-CO3","MT-CYB","MT-ND1","MT-ND2","MT-ND3","MT-ND4","MT-ND4L","MT-ND5")
genes.ribo <- grep('^RP',genes,value=T)
genes.no.mito.ribo <- genes[which(!(genes %in% c(genes.mito,genes.ribo)))]
rm(genes,genes.mito,genes.ribo)

```

### Examine variance in log2cpm (single-cell resolution)

```{r}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object
counts <- as.matrix(GetAssayData(data, assay="RNA", slot="counts"))
metadata <- data@meta.data[,c("Species","Individual","Individual.Replicate","Stage",
                              "Cluster","Cluster0.5","Cluster.t2",
                              "AdHoc.Assign.median","AdHoc.Assign.thresh0",
                              "OstAdHoc.Assign.5gene.median","OstAdHoc.Assign.5gene.thresh0","OstAdHoc.Assign.5gene.thresh0.t2")]
metadata <- metadata[colnames(counts),]
#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes (filter genes across full dataset, pch=0.2)
dge$counts <- dge$counts[rowSums(dge$counts!=0)>=(0.2*dim(dge$counts)[2]),]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

```

### SC: Stages vs. Species

```{r}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,sapply(dge$samples$Stage,function(x)sub(" ","",x)),sep = "_"),
                      levels=c("Human_Time0","Human_Time1","Human_Time2","Chimp_Time0","Chimp_Time1","Chimp_Time2"))

# Calculate log2cpm means within species - mean increases in time 1 and decreases in time 2
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Time0")],1, mean))
HC.mean["Human_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Time1")],1, mean))
HC.mean["Human_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Time2")],1, mean))
HC.mean["Chimp_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Time0")],1, mean))
HC.mean["Chimp_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Time1")],1, mean))
HC.mean["Chimp_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Time2")],1, mean))
HC.mean.melt <- melt(HC.mean,id.vars="gene",measure.vars=c("Human_Time0","Human_Time1","Human_Time2","Chimp_Time0","Chimp_Time1","Chimp_Time2"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$stage <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_Time0,HC.mean$Human_Time1) #p=1.9e-14
t.test(HC.mean$Human_Time1,HC.mean$Human_Time2) #p<2.2e-16
t.test(HC.mean$Chimp_Time0,HC.mean$Chimp_Time1) #p=8.4e-09
t.test(HC.mean$Chimp_Time1,HC.mean$Chimp_Time2) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in time 1 and time 2
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Time0")],1, var))
HC.var["Human_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Time1")],1, var))
HC.var["Human_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Time2")],1, var))
HC.var["Chimp_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Time0")],1, var))
HC.var["Chimp_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Time1")],1, var))
HC.var["Chimp_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Time2")],1, var))
HC.var.melt <- melt(HC.var,id.vars="gene",measure.vars=c("Human_Time0","Human_Time1","Human_Time2","Chimp_Time0","Chimp_Time1","Chimp_Time2"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$stage <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_Time0,HC.var$Human_Time1) #p=8.9e-10
t.test(HC.var$Human_Time1,HC.var$Human_Time2) #p<2.2e-16
t.test(HC.var$Chimp_Time0,HC.var$Chimp_Time1) #p<2.2e-16
t.test(HC.var$Chimp_Time1,HC.var$Chimp_Time2) #p<2.2e-16

```

### SC: Stages vs. Individuals

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,sapply(dge$samples$Stage,function(x)sub(" ","",x)),sep = "_"),
                      levels=c("H1_Time0","H1_Time1","H1_Time2",
                               "H2_Time0","H2_Time1","H2_Time2",
                               "H3_Time0","H3_Time1","H3_Time2",
                               "H4_Time0","H4_Time1","H4_Time2",
                               "H5_Time0","H5_Time1","H5_Time2",
                               "H6_Time0","H6_Time1","H6_Time2",
                               "C1_Time0","C1_Time1","C1_Time2",
                               "C2_Time0","C2_Time1","C2_Time2",
                               "C3_Time0","C3_Time1","C3_Time2",
                               "C4_Time0","C4_Time1","C4_Time2",
                               "C5_Time0","C5_Time1","C5_Time2",
                               "C6_Time0","C6_Time1","C6_Time2"))

# Calculate log2cpm means within individuals - generally mean increases in time 1 (except C4, C5, H5) and decreases in time 2
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Time0")],1, mean))
HC.mean["H1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Time1")],1, mean))
HC.mean["H1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Time2")],1, mean))
HC.mean["H2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Time0")],1, mean))
HC.mean["H2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Time1")],1, mean))
HC.mean["H2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Time2")],1, mean))
HC.mean["H3_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Time0")],1, mean))
HC.mean["H3_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Time1")],1, mean))
HC.mean["H3_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Time2")],1, mean))
HC.mean["H4_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Time0")],1, mean))
HC.mean["H4_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Time1")],1, mean))
HC.mean["H4_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Time2")],1, mean))
HC.mean["H5_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Time0")],1, mean))
HC.mean["H5_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Time1")],1, mean))
HC.mean["H5_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Time2")],1, mean))
HC.mean["H6_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Time0")],1, mean))
HC.mean["H6_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Time1")],1, mean))
HC.mean["H6_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Time2")],1, mean))
HC.mean["C1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Time0")],1, mean))
HC.mean["C1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Time1")],1, mean))
HC.mean["C1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Time2")],1, mean))
HC.mean["C2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Time0")],1, mean))
HC.mean["C2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Time1")],1, mean))
HC.mean["C2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Time2")],1, mean))
HC.mean["C3_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Time0")],1, mean))
HC.mean["C3_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Time1")],1, mean))
HC.mean["C3_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Time2")],1, mean))
HC.mean["C4_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Time0")],1, mean))
HC.mean["C4_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Time1")],1, mean))
HC.mean["C4_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Time2")],1, mean))
HC.mean["C5_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Time0")],1, mean))
HC.mean["C5_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Time1")],1, mean))
HC.mean["C5_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Time2")],1, mean))
HC.mean["C6_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Time0")],1, mean))
HC.mean["C6_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Time1")],1, mean))
HC.mean["C6_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Time2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_Time0","H1_Time1","H1_Time2",
                                    "H2_Time0","H2_Time1","H2_Time2",
                                    "H3_Time0","H3_Time1","H3_Time2",
                                    "H4_Time0","H4_Time1","H4_Time2",
                                    "H5_Time0","H5_Time1","H5_Time2",
                                    "H6_Time0","H6_Time1","H6_Time2",
                                    "C1_Time0","C1_Time1","C1_Time2",
                                    "C2_Time0","C2_Time1","C2_Time2",
                                    "C3_Time0","C3_Time1","C3_Time2",
                                    "C4_Time0","C4_Time1","C4_Time2",
                                    "C5_Time0","C5_Time1","C5_Time2",
                                    "C6_Time0","C6_Time1","C6_Time2"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$stage <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_Time0,HC.mean$H1_Time1) #p<2.2e-16
t.test(HC.mean$H1_Time1,HC.mean$H1_Time2) #p<2.2e-16
t.test(HC.mean$H2_Time0,HC.mean$H2_Time1) #p<2.2e-16
t.test(HC.mean$H2_Time1,HC.mean$H2_Time2) #p<2.2e-16
t.test(HC.mean$H3_Time0,HC.mean$H3_Time1) #p=5.0e-05
t.test(HC.mean$H3_Time1,HC.mean$H3_Time2) #p<2.2e-16
t.test(HC.mean$H4_Time0,HC.mean$H4_Time1) #p<2.2e-16
t.test(HC.mean$H4_Time1,HC.mean$H4_Time2) #p<2.2e-16
t.test(HC.mean$H5_Time0,HC.mean$H5_Time1) #p=4.0e-09
t.test(HC.mean$H5_Time1,HC.mean$H5_Time2) #p<2.2e-16
t.test(HC.mean$H6_Time0,HC.mean$H6_Time1) #p=1.0e-09
t.test(HC.mean$H6_Time1,HC.mean$H6_Time2) #p<2.2e-16
t.test(HC.mean$C1_Time0,HC.mean$C1_Time1) #p=2.2e-11
t.test(HC.mean$C1_Time1,HC.mean$C1_Time2) #p<2.2e-16
t.test(HC.mean$C2_Time0,HC.mean$C2_Time1) #p<2.2e-16
t.test(HC.mean$C2_Time1,HC.mean$C2_Time2) #p<2.2e-16
t.test(HC.mean$C3_Time0,HC.mean$C3_Time1) #p<2.2e-16
t.test(HC.mean$C3_Time1,HC.mean$C3_Time2) #p<2.2e-16
t.test(HC.mean$C4_Time0,HC.mean$C4_Time1) #p=0.01698
t.test(HC.mean$C4_Time1,HC.mean$C4_Time2) #p<2.2e-16
t.test(HC.mean$C5_Time0,HC.mean$C5_Time1) #p=0.02207
t.test(HC.mean$C5_Time1,HC.mean$C5_Time2) #p<2.2e-16
t.test(HC.mean$C6_Time0,HC.mean$C6_Time1) #p<2.2e-16
t.test(HC.mean$C6_Time1,HC.mean$C6_Time2) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in time 1 (except C2, C3, H1, H2, H4) and time 2
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Time0")],1, var))
HC.var["H1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Time1")],1, var))
HC.var["H1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Time2")],1, var))
HC.var["H2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Time0")],1, var))
HC.var["H2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Time1")],1, var))
HC.var["H2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Time2")],1, var))
HC.var["H3_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Time0")],1, var))
HC.var["H3_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Time1")],1, var))
HC.var["H3_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Time2")],1, var))
HC.var["H4_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Time0")],1, var))
HC.var["H4_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Time1")],1, var))
HC.var["H4_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Time2")],1, var))
HC.var["H5_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Time0")],1, var))
HC.var["H5_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Time1")],1, var))
HC.var["H5_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Time2")],1, var))
HC.var["H6_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Time0")],1, var))
HC.var["H6_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Time1")],1, var))
HC.var["H6_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Time2")],1, var))
HC.var["C1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Time0")],1, var))
HC.var["C1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Time1")],1, var))
HC.var["C1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Time2")],1, var))
HC.var["C2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Time0")],1, var))
HC.var["C2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Time1")],1, var))
HC.var["C2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Time2")],1, var))
HC.var["C3_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Time0")],1, var))
HC.var["C3_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Time1")],1, var))
HC.var["C3_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Time2")],1, var))
HC.var["C4_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Time0")],1, var))
HC.var["C4_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Time1")],1, var))
HC.var["C4_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Time2")],1, var))
HC.var["C5_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Time0")],1, var))
HC.var["C5_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Time1")],1, var))
HC.var["C5_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Time2")],1, var))
HC.var["C6_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Time0")],1, var))
HC.var["C6_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Time1")],1, var))
HC.var["C6_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Time2")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_Time0","H1_Time1","H1_Time2",
                                    "H2_Time0","H2_Time1","H2_Time2",
                                    "H3_Time0","H3_Time1","H3_Time2",
                                    "H4_Time0","H4_Time1","H4_Time2",
                                    "H5_Time0","H5_Time1","H5_Time2",
                                    "H6_Time0","H6_Time1","H6_Time2",
                                    "C1_Time0","C1_Time1","C1_Time2",
                                    "C2_Time0","C2_Time1","C2_Time2",
                                    "C3_Time0","C3_Time1","C3_Time2",
                                    "C4_Time0","C4_Time1","C4_Time2",
                                    "C5_Time0","C5_Time1","C5_Time2",
                                    "C6_Time0","C6_Time1","C6_Time2"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$stage <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_Time0,HC.var$H1_Time1) #p=0.00024
t.test(HC.var$H1_Time1,HC.var$H1_Time2) #p<2.2e-16
t.test(HC.var$H2_Time0,HC.var$H2_Time1) #p=0.00028
t.test(HC.var$H2_Time1,HC.var$H2_Time2) #p<2.2e-16
t.test(HC.var$H3_Time0,HC.var$H3_Time1) #p=2.8e-07
t.test(HC.var$H3_Time1,HC.var$H3_Time2) #p=2.4e-10
t.test(HC.var$H4_Time0,HC.var$H4_Time1) #p=0.87340
t.test(HC.var$H4_Time1,HC.var$H4_Time2) #p=7.0e-12
t.test(HC.var$H5_Time0,HC.var$H5_Time1) #p<2.2e-16
t.test(HC.var$H5_Time1,HC.var$H5_Time2) #p<2.2e-16
t.test(HC.var$H6_Time0,HC.var$H6_Time1) #p<2.2e-16
t.test(HC.var$H6_Time1,HC.var$H6_Time2) #p<2.2e-16
t.test(HC.var$C1_Time0,HC.var$C1_Time1) #p<2.2e-16
t.test(HC.var$C1_Time1,HC.var$C1_Time2) #p<2.2e-16
t.test(HC.var$C2_Time0,HC.var$C2_Time1) #p=1.5e-11
t.test(HC.var$C2_Time1,HC.var$C2_Time2) #p<2.2e-16
t.test(HC.var$C3_Time0,HC.var$C3_Time1) #p=0.18280
t.test(HC.var$C3_Time1,HC.var$C3_Time2) #p<2.2e-16
t.test(HC.var$C4_Time0,HC.var$C4_Time1) #p<2.2e-16
t.test(HC.var$C4_Time1,HC.var$C4_Time2) #p<2.2e-16
t.test(HC.var$C5_Time0,HC.var$C5_Time1) #p<2.2e-16
t.test(HC.var$C5_Time1,HC.var$C5_Time2) #p=3.1e-11
t.test(HC.var$C6_Time0,HC.var$C6_Time1) #p<2.2e-16
t.test(HC.var$C6_Time1,HC.var$C6_Time2) #p<2.2e-16

```

### SC: Stages vs. Individual.Replicates

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,sapply(dge$samples$Stage,function(x)sub(" ","",x)),sep = "_"),
                      levels=c("H1.1_Time0","H1.1_Time1","H1.1_Time2",
                               "H1.2_Time0","H1.2_Time1","H1.2_Time2",
                               "H2.1_Time0","H2.1_Time1","H2.1_Time2",
                               "H3.1_Time0","H3.1_Time1","H3.1_Time2",
                               "H4.1_Time0","H4.1_Time1","H4.1_Time2",
                               "H5.1_Time0","H5.1_Time1","H5.1_Time2",
                               "H6.1_Time0","H6.1_Time1","H6.1_Time2",
                               "C1.1_Time0","C1.1_Time1","C1.1_Time2",
                               "C1.2_Time0","C1.2_Time1","C1.2_Time2",
                               "C2.1_Time0","C2.1_Time1","C2.1_Time2",
                               "C3.1_Time0","C3.1_Time1","C3.1_Time2",
                               "C4.1_Time0","C4.1_Time1","C4.1_Time2",
                               "C5.1_Time0","C5.1_Time1","C5.1_Time2",
                               "C6.1_Time0","C6.1_Time1","C6.1_Time2"))

# Calculate log2cpm means within individuals - generally mean increases in time 1 (except C4.1, C5.1, H5.1) and decreases in time 2
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Time0")],1, mean))
HC.mean["H1.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Time1")],1, mean))
HC.mean["H1.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Time2")],1, mean))
HC.mean["H1.2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Time0")],1, mean))
HC.mean["H1.2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Time1")],1, mean))
HC.mean["H1.2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Time2")],1, mean))
HC.mean["H2.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Time0")],1, mean))
HC.mean["H2.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Time1")],1, mean))
HC.mean["H2.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Time2")],1, mean))
HC.mean["H3.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Time0")],1, mean))
HC.mean["H3.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Time1")],1, mean))
HC.mean["H3.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Time2")],1, mean))
HC.mean["H4.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Time0")],1, mean))
HC.mean["H4.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Time1")],1, mean))
HC.mean["H4.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Time2")],1, mean))
HC.mean["H5.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Time0")],1, mean))
HC.mean["H5.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Time1")],1, mean))
HC.mean["H5.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Time2")],1, mean))
HC.mean["H6.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Time0")],1, mean))
HC.mean["H6.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Time1")],1, mean))
HC.mean["H6.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Time2")],1, mean))
HC.mean["C1.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Time0")],1, mean))
HC.mean["C1.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Time1")],1, mean))
HC.mean["C1.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Time2")],1, mean))
HC.mean["C1.2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Time0")],1, mean))
HC.mean["C1.2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Time1")],1, mean))
HC.mean["C1.2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Time2")],1, mean))
HC.mean["C2.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Time0")],1, mean))
HC.mean["C2.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Time1")],1, mean))
HC.mean["C2.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Time2")],1, mean))
HC.mean["C3.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Time0")],1, mean))
HC.mean["C3.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Time1")],1, mean))
HC.mean["C3.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Time2")],1, mean))
HC.mean["C4.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Time0")],1, mean))
HC.mean["C4.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Time1")],1, mean))
HC.mean["C4.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Time2")],1, mean))
HC.mean["C5.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Time0")],1, mean))
HC.mean["C5.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Time1")],1, mean))
HC.mean["C5.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Time2")],1, mean))
HC.mean["C6.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Time0")],1, mean))
HC.mean["C6.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Time1")],1, mean))
HC.mean["C6.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Time2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_Time0","H1.1_Time1","H1.1_Time2",
                                    "H1.2_Time0","H1.2_Time1","H1.2_Time2",
                                    "H2.1_Time0","H2.1_Time1","H2.1_Time2",
                                    "H3.1_Time0","H3.1_Time1","H3.1_Time2",
                                    "H4.1_Time0","H4.1_Time1","H4.1_Time2",
                                    "H5.1_Time0","H5.1_Time1","H5.1_Time2",
                                    "H6.1_Time0","H6.1_Time1","H6.1_Time2",
                                    "C1.1_Time0","C1.1_Time1","C1.1_Time2",
                                    "C1.2_Time0","C1.2_Time1","C1.2_Time2",
                                    "C2.1_Time0","C2.1_Time1","C2.1_Time2",
                                    "C3.1_Time0","C3.1_Time1","C3.1_Time2",
                                    "C4.1_Time0","C4.1_Time1","C4.1_Time2",
                                    "C5.1_Time0","C5.1_Time1","C5.1_Time2",
                                    "C6.1_Time0","C6.1_Time1","C6.1_Time2"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$stage <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_Time0,HC.mean$H1.1_Time1) #p<2.2e-16
t.test(HC.mean$H1.1_Time1,HC.mean$H1.1_Time2) #p<2.2e-16
t.test(HC.mean$H1.2_Time0,HC.mean$H1.2_Time1) #p<2.2e-16
t.test(HC.mean$H1.2_Time1,HC.mean$H1.2_Time2) #p<2.2e-16
t.test(HC.mean$H2.1_Time0,HC.mean$H2.1_Time1) #p<2.2e-16
t.test(HC.mean$H2.1_Time1,HC.mean$H2.1_Time2) #p<2.2e-16
t.test(HC.mean$H3.1_Time0,HC.mean$H3.1_Time1) #p=5.0e-05
t.test(HC.mean$H3.1_Time1,HC.mean$H3.1_Time2) #p<2.2e-16
t.test(HC.mean$H4.1_Time0,HC.mean$H4.1_Time1) #p<2.2e-16
t.test(HC.mean$H4.1_Time1,HC.mean$H4.1_Time2) #p<2.2e-16
t.test(HC.mean$H5.1_Time0,HC.mean$H5.1_Time1) #p=4.0e-09
t.test(HC.mean$H5.1_Time1,HC.mean$H5.1_Time2) #p<2.2e-16
t.test(HC.mean$H6.1_Time0,HC.mean$H6.1_Time1) #p=1.0e-09
t.test(HC.mean$H6.1_Time1,HC.mean$H6.1_Time2) #p<2.2e-16
t.test(HC.mean$C1.1_Time0,HC.mean$C1.1_Time1) #p=1.0e-09
t.test(HC.mean$C1.1_Time1,HC.mean$C1.1_Time2) #p<2.2e-16
t.test(HC.mean$C1.2_Time0,HC.mean$C1.2_Time1) #p=2.9e-11
t.test(HC.mean$C1.2_Time1,HC.mean$C1.2_Time2) #p<2.2e-16
t.test(HC.mean$C2.1_Time0,HC.mean$C2.1_Time1) #p<2.2e-16
t.test(HC.mean$C2.1_Time1,HC.mean$C2.1_Time2) #p<2.2e-16
t.test(HC.mean$C3.1_Time0,HC.mean$C3.1_Time1) #p<2.2e-16
t.test(HC.mean$C3.1_Time1,HC.mean$C3.1_Time2) #p<2.2e-16
t.test(HC.mean$C4.1_Time0,HC.mean$C4.1_Time1) #p=0.01698
t.test(HC.mean$C4.1_Time1,HC.mean$C4.1_Time2) #p<2.2e-16
t.test(HC.mean$C5.1_Time0,HC.mean$C5.1_Time1) #p=0.02207
t.test(HC.mean$C5.1_Time1,HC.mean$C5.1_Time2) #p<2.2e-16
t.test(HC.mean$C6.1_Time0,HC.mean$C6.1_Time1) #p<2.2e-16
t.test(HC.mean$C6.1_Time1,HC.mean$C6.1_Time2) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in time 1 (except C2.1, C3.1, H1.1, H1.2, H2.1, H4.1) and time 2
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Time0")],1, var))
HC.var["H1.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Time1")],1, var))
HC.var["H1.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Time2")],1, var))
HC.var["H1.2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Time0")],1, var))
HC.var["H1.2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Time1")],1, var))
HC.var["H1.2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Time2")],1, var))
HC.var["H2.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Time0")],1, var))
HC.var["H2.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Time1")],1, var))
HC.var["H2.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Time2")],1, var))
HC.var["H3.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Time0")],1, var))
HC.var["H3.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Time1")],1, var))
HC.var["H3.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Time2")],1, var))
HC.var["H4.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Time0")],1, var))
HC.var["H4.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Time1")],1, var))
HC.var["H4.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Time2")],1, var))
HC.var["H5.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Time0")],1, var))
HC.var["H5.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Time1")],1, var))
HC.var["H5.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Time2")],1, var))
HC.var["H6.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Time0")],1, var))
HC.var["H6.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Time1")],1, var))
HC.var["H6.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Time2")],1, var))
HC.var["C1.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Time0")],1, var))
HC.var["C1.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Time1")],1, var))
HC.var["C1.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Time2")],1, var))
HC.var["C1.2_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Time0")],1, var))
HC.var["C1.2_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Time1")],1, var))
HC.var["C1.2_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Time2")],1, var))
HC.var["C2.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Time0")],1, var))
HC.var["C2.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Time1")],1, var))
HC.var["C2.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Time2")],1, var))
HC.var["C3.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Time0")],1, var))
HC.var["C3.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Time1")],1, var))
HC.var["C3.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Time2")],1, var))
HC.var["C4.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Time0")],1, var))
HC.var["C4.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Time1")],1, var))
HC.var["C4.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Time2")],1, var))
HC.var["C5.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Time0")],1, var))
HC.var["C5.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Time1")],1, var))
HC.var["C5.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Time2")],1, var))
HC.var["C6.1_Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Time0")],1, var))
HC.var["C6.1_Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Time1")],1, var))
HC.var["C6.1_Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Time2")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_Time0","H1.1_Time1","H1.1_Time2",
                                    "H1.2_Time0","H1.2_Time1","H1.2_Time2",
                                    "H2.1_Time0","H2.1_Time1","H2.1_Time2",
                                    "H3.1_Time0","H3.1_Time1","H3.1_Time2",
                                    "H4.1_Time0","H4.1_Time1","H4.1_Time2",
                                    "H5.1_Time0","H5.1_Time1","H5.1_Time2",
                                    "H6.1_Time0","H6.1_Time1","H6.1_Time2",
                                    "C1.1_Time0","C1.1_Time1","C1.1_Time2",
                                    "C1.2_Time0","C1.2_Time1","C1.2_Time2",
                                    "C2.1_Time0","C2.1_Time1","C2.1_Time2",
                                    "C3.1_Time0","C3.1_Time1","C3.1_Time2",
                                    "C4.1_Time0","C4.1_Time1","C4.1_Time2",
                                    "C5.1_Time0","C5.1_Time1","C5.1_Time2",
                                    "C6.1_Time0","C6.1_Time1","C6.1_Time2"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$stage <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_Time0,HC.var$H1.1_Time1) #p=5.0e-06
t.test(HC.var$H1.1_Time1,HC.var$H1.1_Time2) #p<2.2e-16
t.test(HC.var$H1.2_Time0,HC.var$H1.2_Time1) #p=0.00505
t.test(HC.var$H1.2_Time1,HC.var$H1.2_Time2) #p<2.2e-16
t.test(HC.var$H2.1_Time0,HC.var$H2.1_Time1) #p=0.00028
t.test(HC.var$H2.1_Time1,HC.var$H2.1_Time2) #p<2.2e-16
t.test(HC.var$H3.1_Time0,HC.var$H3.1_Time1) #p=2.8e-07
t.test(HC.var$H3.1_Time1,HC.var$H3.1_Time2) #p=2.4e-10
t.test(HC.var$H4.1_Time0,HC.var$H4.1_Time1) #p=0.87340
t.test(HC.var$H4.1_Time1,HC.var$H4.1_Time2) #p=7.0e-12
t.test(HC.var$H5.1_Time0,HC.var$H5.1_Time1) #p<2.2e-16
t.test(HC.var$H5.1_Time1,HC.var$H5.1_Time2) #p<2.2e-16
t.test(HC.var$H6.1_Time0,HC.var$H6.1_Time1) #p<2.2e-16
t.test(HC.var$H6.1_Time1,HC.var$H6.1_Time2) #p<2.2e-16
t.test(HC.var$C1.1_Time0,HC.var$C1.1_Time1) #p<2.2e-16
t.test(HC.var$C1.1_Time1,HC.var$C1.1_Time2) #p<2.2e-16
t.test(HC.var$C1.2_Time0,HC.var$C1.2_Time1) #p<2.2e-16
t.test(HC.var$C1.2_Time1,HC.var$C1.2_Time2) #p<2.2e-16
t.test(HC.var$C2.1_Time0,HC.var$C2.1_Time1) #p=1.5e-11
t.test(HC.var$C2.1_Time1,HC.var$C2.1_Time2) #p<2.2e-16
t.test(HC.var$C3.1_Time0,HC.var$C3.1_Time1) #p=0.18280
t.test(HC.var$C3.1_Time1,HC.var$C3.1_Time2) #p<2.2e-16
t.test(HC.var$C4.1_Time0,HC.var$C4.1_Time1) #p<2.2e-16
t.test(HC.var$C4.1_Time1,HC.var$C4.1_Time2) #p<2.2e-16
t.test(HC.var$C5.1_Time0,HC.var$C5.1_Time1) #p<2.2e-16
t.test(HC.var$C5.1_Time1,HC.var$C5.1_Time2) #p=3.1e-11
t.test(HC.var$C6.1_Time0,HC.var$C6.1_Time1) #p<2.2e-16
t.test(HC.var$C6.1_Time1,HC.var$C6.1_Time2) #p<2.2e-16

```

### SC: General Clusters vs. Species (res=0.05)

```{r}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$Cluster,sep="_"),
                      levels=c("Human_iPSC.c1","Human_iPSC.c2","Human_iPSC.c3","Human_MSC.c1","Human_Osteogenic.c1","Human_Osteogenic.c2",
                               "Chimp_iPSC.c1","Chimp_iPSC.c2","Chimp_iPSC.c3","Chimp_MSC.c1","Chimp_Osteogenic.c1","Chimp_Osteogenic.c2"))

# Calculate log2cpm means within species - mean increases in MSC.c1 (except Chimp) and decreases in Osteogenic.c1
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c1")],1, mean))
HC.mean["Human_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c2")],1, mean))
HC.mean["Human_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c3")],1, mean))
HC.mean["Human_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC.c1")],1, mean))
HC.mean["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, mean))
HC.mean["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, mean))
HC.mean["Chimp_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c1")],1, mean))
HC.mean["Chimp_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c2")],1, mean))
HC.mean["Chimp_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c3")],1, mean))
HC.mean["Chimp_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_iPSC.c1","Human_iPSC.c2","Human_iPSC.c3","Human_MSC.c1","Human_Osteogenic.c1","Human_Osteogenic.c2",
                                    "Chimp_iPSC.c1","Chimp_iPSC.c2","Chimp_iPSC.c3","Chimp_MSC.c1","Chimp_Osteogenic.c1","Chimp_Osteogenic.c2"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_iPSC.c1,HC.mean$Human_MSC.c1)       #p=0.00107
t.test(HC.mean$Human_MSC.c1,HC.mean$Human_Osteogenic.c1) #p=6.8e-09
t.test(HC.mean$Chimp_iPSC.c1,HC.mean$Chimp_MSC.c1)       #p=0.90990
t.test(HC.mean$Chimp_MSC.c1,HC.mean$Chimp_Osteogenic.c1) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSC.c1 and Osteogenic.c1
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c1")],1, var))
HC.var["Human_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c2")],1, var))
HC.var["Human_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c3")],1, var))
HC.var["Human_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC.c1")],1, var))
HC.var["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, var))
HC.var["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, var))
HC.var["Chimp_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c1")],1, var))
HC.var["Chimp_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c2")],1, var))
HC.var["Chimp_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c3")],1, var))
HC.var["Chimp_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC.c1")],1, var))
HC.var["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, var))
HC.var["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_iPSC.c1","Human_iPSC.c2","Human_iPSC.c3","Human_MSC.c1","Human_Osteogenic.c1","Human_Osteogenic.c2",
                                   "Chimp_iPSC.c1","Chimp_iPSC.c2","Chimp_iPSC.c3","Chimp_MSC.c1","Chimp_Osteogenic.c1","Chimp_Osteogenic.c2"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_iPSC.c1,HC.var$Human_MSC.c1)       #p<2.2e-16
t.test(HC.var$Human_MSC.c1,HC.var$Human_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$Chimp_iPSC.c1,HC.var$Chimp_MSC.c1)       #p<2.2e-16
t.test(HC.var$Chimp_MSC.c1,HC.var$Chimp_Osteogenic.c1) #p<2.2e-16

```

### SC: General Clusters vs. Individuals (res=0.05)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,dge$samples$Cluster,sep="_"),
                      levels=c("H1_iPSC.c1","H1_iPSC.c2","H1_iPSC.c3","H1_MSC.c1","H1_Osteogenic.c1","H1_Osteogenic.c2",
                               "H2_iPSC.c1","H2_iPSC.c2","H2_iPSC.c3","H2_MSC.c1","H2_Osteogenic.c1","H2_Osteogenic.c2",
                               "H3_iPSC.c1","H3_iPSC.c2","H3_iPSC.c3","H3_MSC.c1","H3_Osteogenic.c1","H3_Osteogenic.c2",
                               "H4_iPSC.c1","H4_iPSC.c2","H4_iPSC.c3","H4_MSC.c1","H4_Osteogenic.c1","H4_Osteogenic.c2",
                               "H5_iPSC.c1","H5_iPSC.c2","H5_iPSC.c3","H5_MSC.c1","H5_Osteogenic.c1","H5_Osteogenic.c2",
                               "H6_iPSC.c1","H6_iPSC.c2","H6_iPSC.c3","H6_MSC.c1","H6_Osteogenic.c1","H6_Osteogenic.c2",
                               "C1_iPSC.c1","C1_iPSC.c2","C1_iPSC.c3","C1_MSC.c1","C1_Osteogenic.c1","C1_Osteogenic.c2",
                               "C2_iPSC.c1","C2_iPSC.c2","C2_iPSC.c3","C2_MSC.c1","C2_Osteogenic.c1","C2_Osteogenic.c2",
                               "C3_iPSC.c1","C3_iPSC.c2","C3_iPSC.c3","C3_MSC.c1","C3_Osteogenic.c1","C3_Osteogenic.c2",
                               "C4_iPSC.c1","C4_iPSC.c2","C4_iPSC.c3","C4_MSC.c1","C4_Osteogenic.c1","C4_Osteogenic.c2",
                               "C5_iPSC.c1","C5_iPSC.c2","C5_iPSC.c3","C5_MSC.c1","C5_Osteogenic.c1","C5_Osteogenic.c2",
                               "C6_iPSC.c1","C6_iPSC.c2","C6_iPSC.c3","C6_MSC.c1","C6_Osteogenic.c1","C6_Osteogenic.c2"))

# Calculate log2cpm means within individuals - generally mean decreases in MSC.c1 (except C1, C3, C6, H1, H3, H4, H6) and decreases in Osteogenic.c1 (except H1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c1")],1, mean))
HC.mean["H1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c2")],1, mean))
HC.mean["H1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c3")],1, mean))
HC.mean["H1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC.c1")],1, mean))
HC.mean["H1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c1")],1, mean))
HC.mean["H1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c2")],1, mean))
HC.mean["H2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c1")],1, mean))
HC.mean["H2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c2")],1, mean))
HC.mean["H2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c3")],1, mean))
HC.mean["H2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC.c1")],1, mean))
HC.mean["H2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c1")],1, mean))
HC.mean["H2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c2")],1, mean))
HC.mean["H3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c1")],1, mean))
HC.mean["H3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c2")],1, mean))
HC.mean["H3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c3")],1, mean))
HC.mean["H3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC.c1")],1, mean))
HC.mean["H3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c1")],1, mean))
HC.mean["H3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c2")],1, mean))
HC.mean["H4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c1")],1, mean))
HC.mean["H4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c2")],1, mean))
HC.mean["H4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c3")],1, mean))
HC.mean["H4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC.c1")],1, mean))
HC.mean["H4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c1")],1, mean))
HC.mean["H4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c2")],1, mean))
HC.mean["H5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c1")],1, mean))
HC.mean["H5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c2")],1, mean))
HC.mean["H5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c3")],1, mean))
HC.mean["H5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC.c1")],1, mean))
HC.mean["H5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c1")],1, mean))
HC.mean["H5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c2")],1, mean))
HC.mean["H6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c1")],1, mean))
HC.mean["H6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c2")],1, mean))
HC.mean["H6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c3")],1, mean))
HC.mean["H6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC.c1")],1, mean))
HC.mean["H6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c1")],1, mean))
HC.mean["H6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c2")],1, mean))
HC.mean["C1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c1")],1, mean))
HC.mean["C1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c2")],1, mean))
HC.mean["C1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c3")],1, mean))
HC.mean["C1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC.c1")],1, mean))
HC.mean["C1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c1")],1, mean))
HC.mean["C1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c2")],1, mean))
HC.mean["C2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c1")],1, mean))
HC.mean["C2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c2")],1, mean))
HC.mean["C2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c3")],1, mean))
HC.mean["C2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC.c1")],1, mean))
HC.mean["C2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c1")],1, mean))
HC.mean["C2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c2")],1, mean))
HC.mean["C3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c1")],1, mean))
HC.mean["C3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c2")],1, mean))
HC.mean["C3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c3")],1, mean))
HC.mean["C3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC.c1")],1, mean))
HC.mean["C3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c1")],1, mean))
HC.mean["C3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c2")],1, mean))
HC.mean["C4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c1")],1, mean))
HC.mean["C4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c2")],1, mean))
HC.mean["C4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c3")],1, mean))
HC.mean["C4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC.c1")],1, mean))
HC.mean["C4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c1")],1, mean))
HC.mean["C4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c2")],1, mean))
HC.mean["C5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c1")],1, mean))
HC.mean["C5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c2")],1, mean))
HC.mean["C5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c3")],1, mean))
HC.mean["C5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC.c1")],1, mean))
HC.mean["C5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c1")],1, mean))
HC.mean["C5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c2")],1, mean))
HC.mean["C6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c1")],1, mean))
HC.mean["C6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c2")],1, mean))
HC.mean["C6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c3")],1, mean))
HC.mean["C6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC.c1")],1, mean))
HC.mean["C6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c1")],1, mean))
HC.mean["C6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC.c1","H1_iPSC.c2","H1_iPSC.c3","H1_MSC.c1","H1_Osteogenic.c1","H1_Osteogenic.c2",
                                    "H2_iPSC.c1","H2_iPSC.c2","H2_iPSC.c3","H2_MSC.c1","H2_Osteogenic.c1","H2_Osteogenic.c2",
                                    "H3_iPSC.c1","H3_iPSC.c2","H3_iPSC.c3","H3_MSC.c1","H3_Osteogenic.c1","H3_Osteogenic.c2",
                                    "H4_iPSC.c1","H4_iPSC.c2","H4_iPSC.c3","H4_MSC.c1","H4_Osteogenic.c1","H4_Osteogenic.c2",
                                    "H5_iPSC.c1","H5_iPSC.c2","H5_iPSC.c3","H5_MSC.c1","H5_Osteogenic.c1","H5_Osteogenic.c2",
                                    "H6_iPSC.c1","H6_iPSC.c2","H6_iPSC.c3","H6_MSC.c1","H6_Osteogenic.c1","H6_Osteogenic.c2",
                                    "C1_iPSC.c1","C1_iPSC.c2","C1_iPSC.c3","C1_MSC.c1","C1_Osteogenic.c1","C1_Osteogenic.c2",
                                    "C2_iPSC.c1","C2_iPSC.c2","C2_iPSC.c3","C2_MSC.c1","C2_Osteogenic.c1","C2_Osteogenic.c2",
                                    "C3_iPSC.c1","C3_iPSC.c2","C3_iPSC.c3","C3_MSC.c1","C3_Osteogenic.c1","C3_Osteogenic.c2",
                                    "C4_iPSC.c1","C4_iPSC.c2","C4_iPSC.c3","C4_MSC.c1","C4_Osteogenic.c1","C4_Osteogenic.c2",
                                    "C5_iPSC.c1","C5_iPSC.c2","C5_iPSC.c3","C5_MSC.c1","C5_Osteogenic.c1","C5_Osteogenic.c2",
                                    "C6_iPSC.c1","C6_iPSC.c2","C6_iPSC.c3","C6_MSC.c1","C6_Osteogenic.c1","C6_Osteogenic.c2"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_iPSC.c1,HC.mean$H1_MSC.c1)       #p=1.1e-08
t.test(HC.mean$H1_MSC.c1,HC.mean$H1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H2_iPSC.c1,HC.mean$H2_MSC.c1)       #p=0.79570
t.test(HC.mean$H2_MSC.c1,HC.mean$H2_Osteogenic.c1) #p=1.0e-11
t.test(HC.mean$H3_iPSC.c1,HC.mean$H3_MSC.c1)       #p=0.45760
t.test(HC.mean$H3_MSC.c1,HC.mean$H3_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H4_iPSC.c1,HC.mean$H4_MSC.c1)       #p<2.2e-16
t.test(HC.mean$H4_MSC.c1,HC.mean$H4_Osteogenic.c1) #p=2.4e=13
t.test(HC.mean$H5_iPSC.c1,HC.mean$H5_MSC.c1)       #p=2.3e-13
t.test(HC.mean$H5_MSC.c1,HC.mean$H5_Osteogenic.c1) #p=5.2e-10
t.test(HC.mean$H6_iPSC.c1,HC.mean$H6_MSC.c1)       #p=3.1e-08
t.test(HC.mean$H6_MSC.c1,HC.mean$H6_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C1_iPSC.c1,HC.mean$C1_MSC.c1)       #p=0.27660
t.test(HC.mean$C1_MSC.c1,HC.mean$C1_Osteogenic.c1) #p=1.4e-08
t.test(HC.mean$C2_iPSC.c1,HC.mean$C2_MSC.c1)       #p=3.0e-06
t.test(HC.mean$C2_MSC.c1,HC.mean$C2_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C3_iPSC.c1,HC.mean$C3_MSC.c1)       #p=0.2378
t.test(HC.mean$C3_MSC.c1,HC.mean$C3_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C4_iPSC.c1,HC.mean$C4_MSC.c1)       #p=5.2e-05
t.test(HC.mean$C4_MSC.c1,HC.mean$C4_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C5_iPSC.c1,HC.mean$C5_MSC.c1)       #p=2.8e-08
t.test(HC.mean$C5_MSC.c1,HC.mean$C5_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C6_iPSC.c1,HC.mean$C6_MSC.c1)       #p=6.1e-11
t.test(HC.mean$C6_MSC.c1,HC.mean$C6_Osteogenic.c1) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSC.c1 (except H4) and Osteogenic.c1 (except H1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c1")],1, var))
HC.var["H1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c2")],1, var))
HC.var["H1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c3")],1, var))
HC.var["H1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC.c1")],1, var))
HC.var["H1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c1")],1, var))
HC.var["H1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c2")],1, var))
HC.var["H2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c1")],1, var))
HC.var["H2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c2")],1, var))
HC.var["H2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c3")],1, var))
HC.var["H2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC.c1")],1, var))
HC.var["H2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c1")],1, var))
HC.var["H2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c2")],1, var))
HC.var["H3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c1")],1, var))
HC.var["H3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c2")],1, var))
HC.var["H3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c3")],1, var))
HC.var["H3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC.c1")],1, var))
HC.var["H3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c1")],1, var))
HC.var["H3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c2")],1, var))
HC.var["H4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c1")],1, var))
HC.var["H4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c2")],1, var))
HC.var["H4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c3")],1, var))
HC.var["H4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC.c1")],1, var))
HC.var["H4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c1")],1, var))
HC.var["H4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c2")],1, var))
HC.var["H5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c1")],1, var))
HC.var["H5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c2")],1, var))
HC.var["H5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c3")],1, var))
HC.var["H5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC.c1")],1, var))
HC.var["H5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c1")],1, var))
HC.var["H5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c2")],1, var))
HC.var["H6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c1")],1, var))
HC.var["H6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c2")],1, var))
HC.var["H6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c3")],1, var))
HC.var["H6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC.c1")],1, var))
HC.var["H6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c1")],1, var))
HC.var["H6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c2")],1, var))
HC.var["C1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c1")],1, var))
HC.var["C1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c2")],1, var))
HC.var["C1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c3")],1, var))
HC.var["C1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC.c1")],1, var))
HC.var["C1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c1")],1, var))
HC.var["C1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c2")],1, var))
HC.var["C2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c1")],1, var))
HC.var["C2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c2")],1, var))
HC.var["C2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c3")],1, var))
HC.var["C2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC.c1")],1, var))
HC.var["C2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c1")],1, var))
HC.var["C2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c2")],1, var))
HC.var["C3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c1")],1, var))
HC.var["C3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c2")],1, var))
HC.var["C3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c3")],1, var))
HC.var["C3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC.c1")],1, var))
HC.var["C3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c1")],1, var))
HC.var["C3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c2")],1, var))
HC.var["C4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c1")],1, var))
HC.var["C4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c2")],1, var))
HC.var["C4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c3")],1, var))
HC.var["C4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC.c1")],1, var))
HC.var["C4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c1")],1, var))
HC.var["C4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c2")],1, var))
HC.var["C5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c1")],1, var))
HC.var["C5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c2")],1, var))
HC.var["C5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c3")],1, var))
HC.var["C5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC.c1")],1, var))
HC.var["C5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c1")],1, var))
HC.var["C5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c2")],1, var))
HC.var["C6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c1")],1, var))
HC.var["C6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c2")],1, var))
HC.var["C6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c3")],1, var))
HC.var["C6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC.c1")],1, var))
HC.var["C6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c1")],1, var))
HC.var["C6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c2")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC.c1","H1_iPSC.c2","H1_iPSC.c3","H1_MSC.c1","H1_Osteogenic.c1","H1_Osteogenic.c2",
                                    "H2_iPSC.c1","H2_iPSC.c2","H2_iPSC.c3","H2_MSC.c1","H2_Osteogenic.c1","H2_Osteogenic.c2",
                                    "H3_iPSC.c1","H3_iPSC.c2","H3_iPSC.c3","H3_MSC.c1","H3_Osteogenic.c1","H3_Osteogenic.c2",
                                    "H4_iPSC.c1","H4_iPSC.c2","H4_iPSC.c3","H4_MSC.c1","H4_Osteogenic.c1","H4_Osteogenic.c2",
                                    "H5_iPSC.c1","H5_iPSC.c2","H5_iPSC.c3","H5_MSC.c1","H5_Osteogenic.c1","H5_Osteogenic.c2",
                                    "H6_iPSC.c1","H6_iPSC.c2","H6_iPSC.c3","H6_MSC.c1","H6_Osteogenic.c1","H6_Osteogenic.c2",
                                    "C1_iPSC.c1","C1_iPSC.c2","C1_iPSC.c3","C1_MSC.c1","C1_Osteogenic.c1","C1_Osteogenic.c2",
                                    "C2_iPSC.c1","C2_iPSC.c2","C2_iPSC.c3","C2_MSC.c1","C2_Osteogenic.c1","C2_Osteogenic.c2",
                                    "C3_iPSC.c1","C3_iPSC.c2","C3_iPSC.c3","C3_MSC.c1","C3_Osteogenic.c1","C3_Osteogenic.c2",
                                    "C4_iPSC.c1","C4_iPSC.c2","C4_iPSC.c3","C4_MSC.c1","C4_Osteogenic.c1","C4_Osteogenic.c2",
                                    "C5_iPSC.c1","C5_iPSC.c2","C5_iPSC.c3","C5_MSC.c1","C5_Osteogenic.c1","C5_Osteogenic.c2",
                                    "C6_iPSC.c1","C6_iPSC.c2","C6_iPSC.c3","C6_MSC.c1","C6_Osteogenic.c1","C6_Osteogenic.c2"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_iPSC.c1,HC.var$H1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H1_MSC.c1,HC.var$H1_Osteogenic.c1) #p=0.96980
t.test(HC.var$H2_iPSC.c1,HC.var$H2_MSC.c1)       #p<2.2e-16
t.test(HC.var$H2_MSC.c1,HC.var$H2_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H3_iPSC.c1,HC.var$H3_MSC.c1)       #p<2.2e-16
t.test(HC.var$H3_MSC.c1,HC.var$H3_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H4_iPSC.c1,HC.var$H4_MSC.c1)       #p<2.2e-16
t.test(HC.var$H4_MSC.c1,HC.var$H4_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H5_iPSC.c1,HC.var$H5_MSC.c1)       #p<2.2e-16
t.test(HC.var$H5_MSC.c1,HC.var$H5_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H6_iPSC.c1,HC.var$H6_MSC.c1)       #p<2.2e-16
t.test(HC.var$H6_MSC.c1,HC.var$H6_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C1_iPSC.c1,HC.var$C1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C1_MSC.c1,HC.var$C1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C2_iPSC.c1,HC.var$C2_MSC.c1)       #p<2.2e-16
t.test(HC.var$C2_MSC.c1,HC.var$C2_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C3_iPSC.c1,HC.var$C3_MSC.c1)       #p<2.2e-16
t.test(HC.var$C3_MSC.c1,HC.var$C3_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C4_iPSC.c1,HC.var$C4_MSC.c1)       #p<2.2e-16
t.test(HC.var$C4_MSC.c1,HC.var$C4_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C5_iPSC.c1,HC.var$C5_MSC.c1)       #p<2.2e-16
t.test(HC.var$C5_MSC.c1,HC.var$C5_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C6_iPSC.c1,HC.var$C6_MSC.c1)       #p<2.2e-16
t.test(HC.var$C6_MSC.c1,HC.var$C6_Osteogenic.c1) #p<2.2e-16

```

### SC: General Clusters vs. Individual.Replicates (res=0.05)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,dge$samples$Cluster,sep="_"),
                      levels=c("H1.1_iPSC.c1","H1.1_iPSC.c2","H1.1_iPSC.c3","H1.1_MSC.c1","H1.1_Osteogenic.c1","H1.1_Osteogenic.c2",
                               "H1.2_iPSC.c1","H1.2_iPSC.c2","H1.2_iPSC.c3","H1.2_MSC.c1","H1.2_Osteogenic.c1","H1.2_Osteogenic.c2",
                               "H2.1_iPSC.c1","H2.1_iPSC.c2","H2.1_iPSC.c3","H2.1_MSC.c1","H2.1_Osteogenic.c1","H2.1_Osteogenic.c2",
                               "H3.1_iPSC.c1","H3.1_iPSC.c2","H3.1_iPSC.c3","H3.1_MSC.c1","H3.1_Osteogenic.c1","H3.1_Osteogenic.c2",
                               "H4.1_iPSC.c1","H4.1_iPSC.c2","H4.1_iPSC.c3","H4.1_MSC.c1","H4.1_Osteogenic.c1","H4.1_Osteogenic.c2",
                               "H5.1_iPSC.c1","H5.1_iPSC.c2","H5.1_iPSC.c3","H5.1_MSC.c1","H5.1_Osteogenic.c1","H5.1_Osteogenic.c2",
                               "H6.1_iPSC.c1","H6.1_iPSC.c2","H6.1_iPSC.c3","H6.1_MSC.c1","H6.1_Osteogenic.c1","H6.1_Osteogenic.c2",
                               "C1.1_iPSC.c1","C1.1_iPSC.c2","C1.1_iPSC.c3","C1.1_MSC.c1","C1.1_Osteogenic.c1","C1.1_Osteogenic.c2",
                               "C1.2_iPSC.c1","C1.2_iPSC.c2","C1.2_iPSC.c3","C1.2_MSC.c1","C1.2_Osteogenic.c1","C1.2_Osteogenic.c2",
                               "C2.1_iPSC.c1","C2.1_iPSC.c2","C2.1_iPSC.c3","C2.1_MSC.c1","C2.1_Osteogenic.c1","C2.1_Osteogenic.c2",
                               "C3.1_iPSC.c1","C3.1_iPSC.c2","C3.1_iPSC.c3","C3.1_MSC.c1","C3.1_Osteogenic.c1","C3.1_Osteogenic.c2",
                               "C4.1_iPSC.c1","C4.1_iPSC.c2","C4.1_iPSC.c3","C4.1_MSC.c1","C4.1_Osteogenic.c1","C4.1_Osteogenic.c2",
                               "C5.1_iPSC.c1","C5.1_iPSC.c2","C5.1_iPSC.c3","C5.1_MSC.c1","C5.1_Osteogenic.c1","C5.1_Osteogenic.c2",
                               "C6.1_iPSC.c1","C6.1_iPSC.c2","C6.1_iPSC.c3","C6.1_MSC.c1","C6.1_Osteogenic.c1","C6.1_Osteogenic.c2"))

# Calculate log2cpm means within individuals - generally mean decreases in MSC.c1 (except C1.1, C3.1, C6.1, H1.1, H1.2, H3.1, H4.1, H6.1) and decreases in Osteogenic.c1 (except C1.1, H1.1, H1.2)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c1")],1, mean))
HC.mean["H1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c2")],1, mean))
HC.mean["H1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c3")],1, mean))
HC.mean["H1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC.c1")],1, mean))
HC.mean["H1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c1")],1, mean))
HC.mean["H1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c2")],1, mean))
HC.mean["H1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c1")],1, mean))
HC.mean["H1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c2")],1, mean))
HC.mean["H1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c3")],1, mean))
HC.mean["H1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC.c1")],1, mean))
HC.mean["H1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c1")],1, mean))
HC.mean["H1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c2")],1, mean))
HC.mean["H2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c1")],1, mean))
HC.mean["H2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c2")],1, mean))
HC.mean["H2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c3")],1, mean))
HC.mean["H2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC.c1")],1, mean))
HC.mean["H2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c1")],1, mean))
HC.mean["H2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c2")],1, mean))
HC.mean["H3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c1")],1, mean))
HC.mean["H3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c2")],1, mean))
HC.mean["H3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c3")],1, mean))
HC.mean["H3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC.c1")],1, mean))
HC.mean["H3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c1")],1, mean))
HC.mean["H3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c2")],1, mean))
HC.mean["H4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c1")],1, mean))
HC.mean["H4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c2")],1, mean))
HC.mean["H4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c3")],1, mean))
HC.mean["H4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC.c1")],1, mean))
HC.mean["H4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c1")],1, mean))
HC.mean["H4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c2")],1, mean))
HC.mean["H5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c1")],1, mean))
HC.mean["H5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c2")],1, mean))
HC.mean["H5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c3")],1, mean))
HC.mean["H5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC.c1")],1, mean))
HC.mean["H5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c1")],1, mean))
HC.mean["H5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c2")],1, mean))
HC.mean["H6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c1")],1, mean))
HC.mean["H6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c2")],1, mean))
HC.mean["H6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c3")],1, mean))
HC.mean["H6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC.c1")],1, mean))
HC.mean["H6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c1")],1, mean))
HC.mean["H6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c2")],1, mean))
HC.mean["C1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c1")],1, mean))
HC.mean["C1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c2")],1, mean))
HC.mean["C1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c3")],1, mean))
HC.mean["C1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC.c1")],1, mean))
HC.mean["C1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c1")],1, mean))
HC.mean["C1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c2")],1, mean))
HC.mean["C1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c1")],1, mean))
HC.mean["C1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c2")],1, mean))
HC.mean["C1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c3")],1, mean))
HC.mean["C1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC.c1")],1, mean))
HC.mean["C1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c1")],1, mean))
HC.mean["C1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c2")],1, mean))
HC.mean["C2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c1")],1, mean))
HC.mean["C2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c2")],1, mean))
HC.mean["C2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c3")],1, mean))
HC.mean["C2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC.c1")],1, mean))
HC.mean["C2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c1")],1, mean))
HC.mean["C2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c2")],1, mean))
HC.mean["C3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c1")],1, mean))
HC.mean["C3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c2")],1, mean))
HC.mean["C3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c3")],1, mean))
HC.mean["C3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC.c1")],1, mean))
HC.mean["C3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c1")],1, mean))
HC.mean["C3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c2")],1, mean))
HC.mean["C4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c1")],1, mean))
HC.mean["C4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c2")],1, mean))
HC.mean["C4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c3")],1, mean))
HC.mean["C4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC.c1")],1, mean))
HC.mean["C4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c1")],1, mean))
HC.mean["C4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c2")],1, mean))
HC.mean["C5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c1")],1, mean))
HC.mean["C5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c2")],1, mean))
HC.mean["C5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c3")],1, mean))
HC.mean["C5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC.c1")],1, mean))
HC.mean["C5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c1")],1, mean))
HC.mean["C5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c2")],1, mean))
HC.mean["C6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c1")],1, mean))
HC.mean["C6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c2")],1, mean))
HC.mean["C6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c3")],1, mean))
HC.mean["C6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC.c1")],1, mean))
HC.mean["C6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c1")],1, mean))
HC.mean["C6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC.c1","H1.1_iPSC.c2","H1.1_iPSC.c3","H1.1_MSC.c1","H1.1_Osteogenic.c1","H1.1_Osteogenic.c2",
                                    "H1.2_iPSC.c1","H1.2_iPSC.c2","H1.2_iPSC.c3","H1.2_MSC.c1","H1.2_Osteogenic.c1","H1.2_Osteogenic.c2",
                                    "H2.1_iPSC.c1","H2.1_iPSC.c2","H2.1_iPSC.c3","H2.1_MSC.c1","H2.1_Osteogenic.c1","H2.1_Osteogenic.c2",
                                    "H3.1_iPSC.c1","H3.1_iPSC.c2","H3.1_iPSC.c3","H3.1_MSC.c1","H3.1_Osteogenic.c1","H3.1_Osteogenic.c2",
                                    "H4.1_iPSC.c1","H4.1_iPSC.c2","H4.1_iPSC.c3","H4.1_MSC.c1","H4.1_Osteogenic.c1","H4.1_Osteogenic.c2",
                                    "H5.1_iPSC.c1","H5.1_iPSC.c2","H5.1_iPSC.c3","H5.1_MSC.c1","H5.1_Osteogenic.c1","H5.1_Osteogenic.c2",
                                    "H6.1_iPSC.c1","H6.1_iPSC.c2","H6.1_iPSC.c3","H6.1_MSC.c1","H6.1_Osteogenic.c1","H6.1_Osteogenic.c2",
                                    "C1.1_iPSC.c1","C1.1_iPSC.c2","C1.1_iPSC.c3","C1.1_MSC.c1","C1.1_Osteogenic.c1","C1.1_Osteogenic.c2",
                                    "C1.2_iPSC.c1","C1.2_iPSC.c2","C1.2_iPSC.c3","C1.2_MSC.c1","C1.2_Osteogenic.c1","C1.2_Osteogenic.c2",
                                    "C2.1_iPSC.c1","C2.1_iPSC.c2","C2.1_iPSC.c3","C2.1_MSC.c1","C2.1_Osteogenic.c1","C2.1_Osteogenic.c2",
                                    "C3.1_iPSC.c1","C3.1_iPSC.c2","C3.1_iPSC.c3","C3.1_MSC.c1","C3.1_Osteogenic.c1","C3.1_Osteogenic.c2",
                                    "C4.1_iPSC.c1","C4.1_iPSC.c2","C4.1_iPSC.c3","C4.1_MSC.c1","C4.1_Osteogenic.c1","C4.1_Osteogenic.c2",
                                    "C5.1_iPSC.c1","C5.1_iPSC.c2","C5.1_iPSC.c3","C5.1_MSC.c1","C5.1_Osteogenic.c1","C5.1_Osteogenic.c2",
                                    "C6.1_iPSC.c1","C6.1_iPSC.c2","C6.1_iPSC.c3","C6.1_MSC.c1","C6.1_Osteogenic.c1","C6.1_Osteogenic.c2"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_iPSC.c1,HC.mean$H1.1_MSC.c1)       #p=0.89510
t.test(HC.mean$H1.1_MSC.c1,HC.mean$H1.1_Osteogenic.c1) #p=1.2e-11
t.test(HC.mean$H1.2_iPSC.c1,HC.mean$H1.2_MSC.c1)       #p<2.2e-16
t.test(HC.mean$H1.2_MSC.c1,HC.mean$H1.2_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H2.1_iPSC.c1,HC.mean$H2.1_MSC.c1)       #p=0.79570
t.test(HC.mean$H2.1_MSC.c1,HC.mean$H2.1_Osteogenic.c1) #p=1.0e-11
t.test(HC.mean$H3.1_iPSC.c1,HC.mean$H3.1_MSC.c1)       #p=0.45760
t.test(HC.mean$H3.1_MSC.c1,HC.mean$H3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H4.1_iPSC.c1,HC.mean$H4.1_MSC.c1)       #p<2.2e-16
t.test(HC.mean$H4.1_MSC.c1,HC.mean$H4.1_Osteogenic.c1) #p=2.4e-13
t.test(HC.mean$H5.1_iPSC.c1,HC.mean$H5.1_MSC.c1)       #p=2.3e-13
t.test(HC.mean$H5.1_MSC.c1,HC.mean$H5.1_Osteogenic.c1) #p=5.2e-10
t.test(HC.mean$H6.1_iPSC.c1,HC.mean$H6.1_MSC.c1)       #p=3.1e-08
t.test(HC.mean$H6.1_MSC.c1,HC.mean$H6.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C1.1_iPSC.c1,HC.mean$C1.1_MSC.c1)       #p=0.01723
t.test(HC.mean$C1.1_MSC.c1,HC.mean$C1.1_Osteogenic.c1) #p=0.63770
t.test(HC.mean$C1.2_iPSC.c1,HC.mean$C1.2_MSC.c1)       #p=0.38600
t.test(HC.mean$C1.2_MSC.c1,HC.mean$C1.2_Osteogenic.c1) #p=3.3e-11
t.test(HC.mean$C2.1_iPSC.c1,HC.mean$C2.1_MSC.c1)       #p=3.0e-06
t.test(HC.mean$C2.1_MSC.c1,HC.mean$C2.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C3.1_iPSC.c1,HC.mean$C3.1_MSC.c1)       #p=0.23780
t.test(HC.mean$C3.1_MSC.c1,HC.mean$C3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C4.1_iPSC.c1,HC.mean$C4.1_MSC.c1)       #p=5.2e-05
t.test(HC.mean$C4.1_MSC.c1,HC.mean$C4.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C5.1_iPSC.c1,HC.mean$C5.1_MSC.c1)       #p=2.8e-08
t.test(HC.mean$C5.1_MSC.c1,HC.mean$C5.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C6.1_iPSC.c1,HC.mean$C6.1_MSC.c1)       #p=6.1e-11
t.test(HC.mean$C6.1_MSC.c1,HC.mean$C6.1_Osteogenic.c1) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSC.c1 (except H4.1) and Osteogenic.c1 (except H1.2)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c1")],1, var))
HC.var["H1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c2")],1, var))
HC.var["H1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c3")],1, var))
HC.var["H1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC.c1")],1, var))
HC.var["H1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c1")],1, var))
HC.var["H1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c2")],1, var))
HC.var["H1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c1")],1, var))
HC.var["H1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c2")],1, var))
HC.var["H1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c3")],1, var))
HC.var["H1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC.c1")],1, var))
HC.var["H1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c1")],1, var))
HC.var["H1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c2")],1, var))
HC.var["H2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c1")],1, var))
HC.var["H2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c2")],1, var))
HC.var["H2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c3")],1, var))
HC.var["H2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC.c1")],1, var))
HC.var["H2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c1")],1, var))
HC.var["H2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c2")],1, var))
HC.var["H3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c1")],1, var))
HC.var["H3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c2")],1, var))
HC.var["H3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c3")],1, var))
HC.var["H3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC.c1")],1, var))
HC.var["H3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c1")],1, var))
HC.var["H3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c2")],1, var))
HC.var["H4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c1")],1, var))
HC.var["H4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c2")],1, var))
HC.var["H4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c3")],1, var))
HC.var["H4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC.c1")],1, var))
HC.var["H4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c1")],1, var))
HC.var["H4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c2")],1, var))
HC.var["H5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c1")],1, var))
HC.var["H5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c2")],1, var))
HC.var["H5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c3")],1, var))
HC.var["H5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC.c1")],1, var))
HC.var["H5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c1")],1, var))
HC.var["H5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c2")],1, var))
HC.var["H6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c1")],1, var))
HC.var["H6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c2")],1, var))
HC.var["H6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c3")],1, var))
HC.var["H6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC.c1")],1, var))
HC.var["H6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c1")],1, var))
HC.var["H6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c2")],1, var))
HC.var["C1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c1")],1, var))
HC.var["C1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c2")],1, var))
HC.var["C1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c3")],1, var))
HC.var["C1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC.c1")],1, var))
HC.var["C1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c1")],1, var))
HC.var["C1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c2")],1, var))
HC.var["C1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c1")],1, var))
HC.var["C1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c2")],1, var))
HC.var["C1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c3")],1, var))
HC.var["C1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC.c1")],1, var))
HC.var["C1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c1")],1, var))
HC.var["C1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c2")],1, var))
HC.var["C2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c1")],1, var))
HC.var["C2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c2")],1, var))
HC.var["C2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c3")],1, var))
HC.var["C2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC.c1")],1, var))
HC.var["C2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c1")],1, var))
HC.var["C2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c2")],1, var))
HC.var["C3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c1")],1, var))
HC.var["C3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c2")],1, var))
HC.var["C3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c3")],1, var))
HC.var["C3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC.c1")],1, var))
HC.var["C3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c1")],1, var))
HC.var["C3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c2")],1, var))
HC.var["C4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c1")],1, var))
HC.var["C4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c2")],1, var))
HC.var["C4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c3")],1, var))
HC.var["C4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC.c1")],1, var))
HC.var["C4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c1")],1, var))
HC.var["C4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c2")],1, var))
HC.var["C5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c1")],1, var))
HC.var["C5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c2")],1, var))
HC.var["C5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c3")],1, var))
HC.var["C5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC.c1")],1, var))
HC.var["C5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c1")],1, var))
HC.var["C5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c2")],1, var))
HC.var["C6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c1")],1, var))
HC.var["C6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c2")],1, var))
HC.var["C6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c3")],1, var))
HC.var["C6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC.c1")],1, var))
HC.var["C6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c1")],1, var))
HC.var["C6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c2")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC.c1","H1.1_iPSC.c2","H1.1_iPSC.c3","H1.1_MSC.c1","H1.1_Osteogenic.c1","H1.1_Osteogenic.c2",
                                    "H1.2_iPSC.c1","H1.2_iPSC.c2","H1.2_iPSC.c3","H1.2_MSC.c1","H1.2_Osteogenic.c1","H1.2_Osteogenic.c2",
                                    "H2.1_iPSC.c1","H2.1_iPSC.c2","H2.1_iPSC.c3","H2.1_MSC.c1","H2.1_Osteogenic.c1","H2.1_Osteogenic.c2",
                                    "H3.1_iPSC.c1","H3.1_iPSC.c2","H3.1_iPSC.c3","H3.1_MSC.c1","H3.1_Osteogenic.c1","H3.1_Osteogenic.c2",
                                    "H4.1_iPSC.c1","H4.1_iPSC.c2","H4.1_iPSC.c3","H4.1_MSC.c1","H4.1_Osteogenic.c1","H4.1_Osteogenic.c2",
                                    "H5.1_iPSC.c1","H5.1_iPSC.c2","H5.1_iPSC.c3","H5.1_MSC.c1","H5.1_Osteogenic.c1","H5.1_Osteogenic.c2",
                                    "H6.1_iPSC.c1","H6.1_iPSC.c2","H6.1_iPSC.c3","H6.1_MSC.c1","H6.1_Osteogenic.c1","H6.1_Osteogenic.c2",
                                    "C1.1_iPSC.c1","C1.1_iPSC.c2","C1.1_iPSC.c3","C1.1_MSC.c1","C1.1_Osteogenic.c1","C1.1_Osteogenic.c2",
                                    "C1.2_iPSC.c1","C1.2_iPSC.c2","C1.2_iPSC.c3","C1.2_MSC.c1","C1.2_Osteogenic.c1","C1.2_Osteogenic.c2",
                                    "C2.1_iPSC.c1","C2.1_iPSC.c2","C2.1_iPSC.c3","C2.1_MSC.c1","C2.1_Osteogenic.c1","C2.1_Osteogenic.c2",
                                    "C3.1_iPSC.c1","C3.1_iPSC.c2","C3.1_iPSC.c3","C3.1_MSC.c1","C3.1_Osteogenic.c1","C3.1_Osteogenic.c2",
                                    "C4.1_iPSC.c1","C4.1_iPSC.c2","C4.1_iPSC.c3","C4.1_MSC.c1","C4.1_Osteogenic.c1","C4.1_Osteogenic.c2",
                                    "C5.1_iPSC.c1","C5.1_iPSC.c2","C5.1_iPSC.c3","C5.1_MSC.c1","C5.1_Osteogenic.c1","C5.1_Osteogenic.c2",
                                    "C6.1_iPSC.c1","C6.1_iPSC.c2","C6.1_iPSC.c3","C6.1_MSC.c1","C6.1_Osteogenic.c1","C6.1_Osteogenic.c2"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_iPSC.c1,HC.var$H1.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H1.1_MSC.c1,HC.var$H1.1_Osteogenic.c1) #p=6.2e-15
t.test(HC.var$H1.2_iPSC.c1,HC.var$H1.2_MSC.c1)       #p=7.5e-08
t.test(HC.var$H1.2_MSC.c1,HC.var$H1.2_Osteogenic.c1) #p=6.9e-09
t.test(HC.var$H2.1_iPSC.c1,HC.var$H2.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H2.1_MSC.c1,HC.var$H2.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H3.1_iPSC.c1,HC.var$H3.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H3.1_MSC.c1,HC.var$H3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H4.1_iPSC.c1,HC.var$H4.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H4.1_MSC.c1,HC.var$H4.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H5.1_iPSC.c1,HC.var$H5.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H5.1_MSC.c1,HC.var$H5.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H6.1_iPSC.c1,HC.var$H6.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H6.1_MSC.c1,HC.var$H6.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C1.1_iPSC.c1,HC.var$C1.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C1.1_MSC.c1,HC.var$C1.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C1.2_iPSC.c1,HC.var$C1.2_MSC.c1)       #p<2.2e-16
t.test(HC.var$C1.2_MSC.c1,HC.var$C1.2_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C2.1_iPSC.c1,HC.var$C2.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C2.1_MSC.c1,HC.var$C2.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C3.1_iPSC.c1,HC.var$C3.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C3.1_MSC.c1,HC.var$C3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C4.1_iPSC.c1,HC.var$C4.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C4.1_MSC.c1,HC.var$C4.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C5.1_iPSC.c1,HC.var$C5.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C5.1_MSC.c1,HC.var$C5.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C6.1_iPSC.c1,HC.var$C6.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C6.1_MSC.c1,HC.var$C6.1_Osteogenic.c1) #p<2.2e-16

```

### SC: General Ad Hoc Classifications vs. Species (thresh0)

```{r}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc.Assign.thresh0,sep = "_"),
                      levels=c("Human_iPSC","Human_MSC","Human_Osteogenic","Human_other","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic","Chimp_other"))

# Calculate log2cpm means within species - mean increases in MSCs and decreases in Osteogenic cells
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, mean))
HC.mean["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, mean))
HC.mean["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, mean))
HC.mean["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, mean))
HC.mean["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, mean))
HC.mean["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_iPSC,HC.mean$Human_MSC)       #p=8.9e-05
t.test(HC.mean$Human_MSC,HC.mean$Human_Osteogenic) #p=7.7e-08
t.test(HC.mean$Chimp_iPSC,HC.mean$Chimp_MSC)       #p=9.2e-05
t.test(HC.mean$Chimp_MSC,HC.mean$Chimp_Osteogenic) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSCs and Osteogenic cells
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, var))
HC.var["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, var))
HC.var["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, var))
HC.var["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, var))
HC.var["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, var))
HC.var["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_iPSC,HC.var$Human_MSC)       #p<2.2e-16
t.test(HC.var$Human_MSC,HC.var$Human_Osteogenic) #p<2.2e-16
t.test(HC.var$Chimp_iPSC,HC.var$Chimp_MSC)       #p<2.2e-16
t.test(HC.var$Chimp_MSC,HC.var$Chimp_Osteogenic) #p=5.0e-15

```

### SC: General Ad Hoc Classifications vs. Individuals (thresh0)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,dge$samples$AdHoc.Assign.thresh0,sep = "_"),
                      levels=c("H1_iPSC","H1_MSC","H1_Osteogenic",
                               "H2_iPSC","H2_MSC","H2_Osteogenic",
                               "H3_iPSC","H3_MSC","H3_Osteogenic",
                               "H4_iPSC","H4_MSC","H4_Osteogenic",
                               "H5_iPSC","H5_MSC","H5_Osteogenic",
                               "H6_iPSC","H6_MSC","H6_Osteogenic",
                               "C1_iPSC","C1_MSC","C1_Osteogenic",
                               "C2_iPSC","C2_MSC","C2_Osteogenic",
                               "C3_iPSC","C3_MSC","C3_Osteogenic",
                               "C4_iPSC","C4_MSC","C4_Osteogenic",
                               "C5_iPSC","C5_MSC","C5_Osteogenic",
                               "C6_iPSC","C6_MSC","C6_Osteogenic"))

# Calculate log2cpm means within individuals - generally mean increases in MSCs (except C4, C5, H5, H6) and decreases in Osteogenic cells (except H1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC")],1, mean))
HC.mean["H1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC")],1, mean))
HC.mean["H1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic")],1, mean))
HC.mean["H2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC")],1, mean))
HC.mean["H2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC")],1, mean))
HC.mean["H2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic")],1, mean))
HC.mean["H3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC")],1, mean))
HC.mean["H3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC")],1, mean))
HC.mean["H3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic")],1, mean))
HC.mean["H4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC")],1, mean))
HC.mean["H4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC")],1, mean))
HC.mean["H4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic")],1, mean))
HC.mean["H5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC")],1, mean))
HC.mean["H5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC")],1, mean))
HC.mean["H5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic")],1, mean))
HC.mean["H6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC")],1, mean))
HC.mean["H6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC")],1, mean))
HC.mean["H6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic")],1, mean))
HC.mean["C1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC")],1, mean))
HC.mean["C1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC")],1, mean))
HC.mean["C1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic")],1, mean))
HC.mean["C2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC")],1, mean))
HC.mean["C2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC")],1, mean))
HC.mean["C2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic")],1, mean))
HC.mean["C3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC")],1, mean))
HC.mean["C3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC")],1, mean))
HC.mean["C3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic")],1, mean))
HC.mean["C4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC")],1, mean))
HC.mean["C4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC")],1, mean))
HC.mean["C4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic")],1, mean))
HC.mean["C5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC")],1, mean))
HC.mean["C5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC")],1, mean))
HC.mean["C5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic")],1, mean))
HC.mean["C6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC")],1, mean))
HC.mean["C6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC")],1, mean))
HC.mean["C6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC","H1_MSC","H1_Osteogenic",
                                    "H2_iPSC","H2_MSC","H2_Osteogenic",
                                    "H3_iPSC","H3_MSC","H3_Osteogenic",
                                    "H4_iPSC","H4_MSC","H4_Osteogenic",
                                    "H5_iPSC","H5_MSC","H5_Osteogenic",
                                    "H6_iPSC","H6_MSC","H6_Osteogenic",
                                    "C1_iPSC","C1_MSC","C1_Osteogenic",
                                    "C2_iPSC","C2_MSC","C2_Osteogenic",
                                    "C3_iPSC","C3_MSC","C3_Osteogenic",
                                    "C4_iPSC","C4_MSC","C4_Osteogenic",
                                    "C5_iPSC","C5_MSC","C5_Osteogenic",
                                    "C6_iPSC","C6_MSC","C6_Osteogenic"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_iPSC,HC.mean$H1_MSC)       #p<2.2e-16
t.test(HC.mean$H1_MSC,HC.mean$H1_Osteogenic) #p=2.1e-06
t.test(HC.mean$H2_iPSC,HC.mean$H2_MSC)       #p=3.6e-07
t.test(HC.mean$H2_MSC,HC.mean$H2_Osteogenic) #p=0.00059
t.test(HC.mean$H3_iPSC,HC.mean$H3_MSC)       #p=9.1e=06
t.test(HC.mean$H3_MSC,HC.mean$H3_Osteogenic) #p<2.2e-16
t.test(HC.mean$H4_iPSC,HC.mean$H4_MSC)       #p=3.8e-05
t.test(HC.mean$H4_MSC,HC.mean$H4_Osteogenic) #p<2.2e-16
t.test(HC.mean$H5_iPSC,HC.mean$H5_MSC)       #p<2.2e-16
t.test(HC.mean$H5_MSC,HC.mean$H5_Osteogenic) #p=0.00163
t.test(HC.mean$H6_iPSC,HC.mean$H6_MSC)       #p=5.5e-12
t.test(HC.mean$H6_MSC,HC.mean$H6_Osteogenic) #p=4.4e-11
t.test(HC.mean$C1_iPSC,HC.mean$C1_MSC)       #p=1.9e-06
t.test(HC.mean$C1_MSC,HC.mean$C1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C2_iPSC,HC.mean$C2_MSC)       #p<2.2e-16
t.test(HC.mean$C2_MSC,HC.mean$C2_Osteogenic) #p<2.2e-16
t.test(HC.mean$C3_iPSC,HC.mean$C3_MSC)       #p<2.2e-16
t.test(HC.mean$C3_MSC,HC.mean$C3_Osteogenic) #p<2.2e-16
t.test(HC.mean$C4_iPSC,HC.mean$C4_MSC)       #p=2.0e-06
t.test(HC.mean$C4_MSC,HC.mean$C4_Osteogenic) #p<2.2e-16
t.test(HC.mean$C5_iPSC,HC.mean$C5_MSC)       #p=0.00221
t.test(HC.mean$C5_MSC,HC.mean$C5_Osteogenic) #p<2.2e-16
t.test(HC.mean$C6_iPSC,HC.mean$C6_MSC)       #p=0.05711
t.test(HC.mean$C6_MSC,HC.mean$C6_Osteogenic) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSCs (expt C2, C3) and increases in Osteogenic cells (expt H6, C2, C6)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC")],1, var))
HC.var["H1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC")],1, var))
HC.var["H1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic")],1, var))
HC.var["H2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC")],1, var))
HC.var["H2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC")],1, var))
HC.var["H2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic")],1, var))
HC.var["H3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC")],1, var))
HC.var["H3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC")],1, var))
HC.var["H3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic")],1, var))
HC.var["H4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC")],1, var))
HC.var["H4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC")],1, var))
HC.var["H4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic")],1, var))
HC.var["H5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC")],1, var))
HC.var["H5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC")],1, var))
HC.var["H5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic")],1, var))
HC.var["H6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC")],1, var))
HC.var["H6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC")],1, var))
HC.var["H6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic")],1, var))
HC.var["C1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC")],1, var))
HC.var["C1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC")],1, var))
HC.var["C1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic")],1, var))
HC.var["C2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC")],1, var))
HC.var["C2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC")],1, var))
HC.var["C2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic")],1, var))
HC.var["C3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC")],1, var))
HC.var["C3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC")],1, var))
HC.var["C3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic")],1, var))
HC.var["C4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC")],1, var))
HC.var["C4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC")],1, var))
HC.var["C4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic")],1, var))
HC.var["C5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC")],1, var))
HC.var["C5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC")],1, var))
HC.var["C5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic")],1, var))
HC.var["C6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC")],1, var))
HC.var["C6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC")],1, var))
HC.var["C6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC","H1_MSC","H1_Osteogenic",
                                    "H2_iPSC","H2_MSC","H2_Osteogenic",
                                    "H3_iPSC","H3_MSC","H3_Osteogenic",
                                    "H4_iPSC","H4_MSC","H4_Osteogenic",
                                    "H5_iPSC","H5_MSC","H5_Osteogenic",
                                    "H6_iPSC","H6_MSC","H6_Osteogenic",
                                    "C1_iPSC","C1_MSC","C1_Osteogenic",
                                    "C2_iPSC","C2_MSC","C2_Osteogenic",
                                    "C3_iPSC","C3_MSC","C3_Osteogenic",
                                    "C4_iPSC","C4_MSC","C4_Osteogenic",
                                    "C5_iPSC","C5_MSC","C5_Osteogenic",
                                    "C6_iPSC","C6_MSC","C6_Osteogenic"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_iPSC,HC.var$H1_MSC)       #p=1.2e-05
t.test(HC.var$H1_MSC,HC.var$H1_Osteogenic) #p<2.2e-16
t.test(HC.var$H2_iPSC,HC.var$H2_MSC)       #p<2.2e-16
t.test(HC.var$H2_MSC,HC.var$H2_Osteogenic) #p<2.2e-16
t.test(HC.var$H3_iPSC,HC.var$H3_MSC)       #p=8.1e-05
t.test(HC.var$H3_MSC,HC.var$H3_Osteogenic) #p<2.2e-16
t.test(HC.var$H4_iPSC,HC.var$H4_MSC)       #p<2.2e-16
t.test(HC.var$H4_MSC,HC.var$H4_Osteogenic) #p=1.3e-09
t.test(HC.var$H5_iPSC,HC.var$H5_MSC)       #p<2.2e-16
t.test(HC.var$H5_MSC,HC.var$H5_Osteogenic) #p<2.2e-16
t.test(HC.var$H6_iPSC,HC.var$H6_MSC)       #p<2.2e-16
t.test(HC.var$H6_MSC,HC.var$H6_Osteogenic) #p=0.53020
t.test(HC.var$C1_iPSC,HC.var$C1_MSC)       #p<2.2e-16
t.test(HC.var$C1_MSC,HC.var$C1_Osteogenic) #p=3.8e-14
t.test(HC.var$C2_iPSC,HC.var$C2_MSC)       #p=0.13040
t.test(HC.var$C2_MSC,HC.var$C2_Osteogenic) #p=0.15120
t.test(HC.var$C3_iPSC,HC.var$C3_MSC)       #p=0.77120
t.test(HC.var$C3_MSC,HC.var$C3_Osteogenic) #p<2.2e-16
t.test(HC.var$C4_iPSC,HC.var$C4_MSC)       #p<2.2e-16
t.test(HC.var$C4_MSC,HC.var$C4_Osteogenic) #p<2.2e-16
t.test(HC.var$C5_iPSC,HC.var$C5_MSC)       #p<2.2e-16
t.test(HC.var$C5_MSC,HC.var$C5_Osteogenic) #p=2.1e-05
t.test(HC.var$C6_iPSC,HC.var$C6_MSC)       #p<2.2e-16
t.test(HC.var$C6_MSC,HC.var$C6_Osteogenic) #p=0.43000

```

### SC: General Ad Hoc Classifications vs. Individual.Replicates (thresh0)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,dge$samples$AdHoc.Assign.thresh0,sep = "_"),
                      levels=c("H1.1_iPSC","H1.1_MSC","H1.1_Osteogenic",
                               "H1.2_iPSC","H1.2_MSC","H1.2_Osteogenic",
                               "H2.1_iPSC","H2.1_MSC","H2.1_Osteogenic",
                               "H3.1_iPSC","H3.1_MSC","H3.1_Osteogenic",
                               "H4.1_iPSC","H4.1_MSC","H4.1_Osteogenic",
                               "H5.1_iPSC","H5.1_MSC","H5.1_Osteogenic",
                               "H6.1_iPSC","H6.1_MSC","H6.1_Osteogenic",
                               "C1.1_iPSC","C1.1_MSC","C1.1_Osteogenic",
                               "C1.2_iPSC","C1.2_MSC","C1.2_Osteogenic",
                               "C2.1_iPSC","C2.1_MSC","C2.1_Osteogenic",
                               "C3.1_iPSC","C3.1_MSC","C3.1_Osteogenic",
                               "C4.1_iPSC","C4.1_MSC","C4.1_Osteogenic",
                               "C5.1_iPSC","C5.1_MSC","C5.1_Osteogenic",
                               "C6.1_iPSC","C6.1_MSC","C6.1_Osteogenic"))

# Calculate log2cpm means within individuals - generally mean increases in MSCs (except C4.1, C5.1, H5.1, H6.1) and decreases in Osteogenic cells (except H1.2)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC")],1, mean))
HC.mean["H1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC")],1, mean))
HC.mean["H1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic")],1, mean))
HC.mean["H1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC")],1, mean))
HC.mean["H1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC")],1, mean))
HC.mean["H1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic")],1, mean))
HC.mean["H2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC")],1, mean))
HC.mean["H2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC")],1, mean))
HC.mean["H2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic")],1, mean))
HC.mean["H3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC")],1, mean))
HC.mean["H3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC")],1, mean))
HC.mean["H3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic")],1, mean))
HC.mean["H4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC")],1, mean))
HC.mean["H4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC")],1, mean))
HC.mean["H4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic")],1, mean))
HC.mean["H5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC")],1, mean))
HC.mean["H5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC")],1, mean))
HC.mean["H5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic")],1, mean))
HC.mean["H6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC")],1, mean))
HC.mean["H6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC")],1, mean))
HC.mean["H6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic")],1, mean))
HC.mean["C1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC")],1, mean))
HC.mean["C1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC")],1, mean))
HC.mean["C1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic")],1, mean))
HC.mean["C1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC")],1, mean))
HC.mean["C1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC")],1, mean))
HC.mean["C1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic")],1, mean))
HC.mean["C2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC")],1, mean))
HC.mean["C2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC")],1, mean))
HC.mean["C2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic")],1, mean))
HC.mean["C3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC")],1, mean))
HC.mean["C3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC")],1, mean))
HC.mean["C3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic")],1, mean))
HC.mean["C4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC")],1, mean))
HC.mean["C4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC")],1, mean))
HC.mean["C4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic")],1, mean))
HC.mean["C5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC")],1, mean))
HC.mean["C5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC")],1, mean))
HC.mean["C5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic")],1, mean))
HC.mean["C6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC")],1, mean))
HC.mean["C6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC")],1, mean))
HC.mean["C6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC","H1.1_MSC","H1.1_Osteogenic",
                                    "H1.2_iPSC","H1.2_MSC","H1.2_Osteogenic",
                                    "H2.1_iPSC","H2.1_MSC","H2.1_Osteogenic",
                                    "H3.1_iPSC","H3.1_MSC","H3.1_Osteogenic",
                                    "H4.1_iPSC","H4.1_MSC","H4.1_Osteogenic",
                                    "H5.1_iPSC","H5.1_MSC","H5.1_Osteogenic",
                                    "H6.1_iPSC","H6.1_MSC","H6.1_Osteogenic",
                                    "C1.1_iPSC","C1.1_MSC","C1.1_Osteogenic",
                                    "C1.2_iPSC","C1.2_MSC","C1.2_Osteogenic",
                                    "C2.1_iPSC","C2.1_MSC","C2.1_Osteogenic",
                                    "C3.1_iPSC","C3.1_MSC","C3.1_Osteogenic",
                                    "C4.1_iPSC","C4.1_MSC","C4.1_Osteogenic",
                                    "C5.1_iPSC","C5.1_MSC","C5.1_Osteogenic",
                                    "C6.1_iPSC","C6.1_MSC","C6.1_Osteogenic"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_iPSC,HC.mean$H1.1_MSC)       #p=2.2e-12
t.test(HC.mean$H1.1_MSC,HC.mean$H1.1_Osteogenic) #p=0.00229
t.test(HC.mean$H1.2_iPSC,HC.mean$H1.2_MSC)       #p<2.2e-16
t.test(HC.mean$H1.2_MSC,HC.mean$H1.2_Osteogenic) #p<2.2e-16
t.test(HC.mean$H2.1_iPSC,HC.mean$H2.1_MSC)       #p=3.6e-07
t.test(HC.mean$H2.1_MSC,HC.mean$H2.1_Osteogenic) #p=0.00059
t.test(HC.mean$H3.1_iPSC,HC.mean$H3.1_MSC)       #p=9.1e-06
t.test(HC.mean$H3.1_MSC,HC.mean$H3.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$H4.1_iPSC,HC.mean$H4.1_MSC)       #p=3.8e-05
t.test(HC.mean$H4.1_MSC,HC.mean$H4.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$H5.1_iPSC,HC.mean$H5.1_MSC)       #p<2.2e-16
t.test(HC.mean$H5.1_MSC,HC.mean$H5.1_Osteogenic) #p=0.00163
t.test(HC.mean$H6.1_iPSC,HC.mean$H6.1_MSC)       #p=5.5e-12
t.test(HC.mean$H6.1_MSC,HC.mean$H6.1_Osteogenic) #p=4.4e-11
t.test(HC.mean$C1.1_iPSC,HC.mean$C1.1_MSC)       #p=3.0e-06
t.test(HC.mean$C1.1_MSC,HC.mean$C1.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C1.2_iPSC,HC.mean$C1.2_MSC)       #p=0.00025
t.test(HC.mean$C1.2_MSC,HC.mean$C1.2_Osteogenic) #p=3.8e-10
t.test(HC.mean$C2.1_iPSC,HC.mean$C2.1_MSC)       #p<2.2e-16
t.test(HC.mean$C2.1_MSC,HC.mean$C2.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C3.1_iPSC,HC.mean$C3.1_MSC)       #p<2.2e-16
t.test(HC.mean$C3.1_MSC,HC.mean$C3.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C4.1_iPSC,HC.mean$C4.1_MSC)       #p=2.0e-06
t.test(HC.mean$C4.1_MSC,HC.mean$C4.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C5.1_iPSC,HC.mean$C5.1_MSC)       #p=0.00221
t.test(HC.mean$C5.1_MSC,HC.mean$C5.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C6.1_iPSC,HC.mean$C6.1_MSC)       #p=0.05711
t.test(HC.mean$C6.1_MSC,HC.mean$C6.1_Osteogenic) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSCs (expt C2.1, C3.1) and increases in Osteogenic cells (expt H1.2, H6.1, C2.1, C6.1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC")],1, var))
HC.var["H1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC")],1, var))
HC.var["H1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic")],1, var))
HC.var["H1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC")],1, var))
HC.var["H1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC")],1, var))
HC.var["H1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic")],1, var))
HC.var["H2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC")],1, var))
HC.var["H2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC")],1, var))
HC.var["H2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic")],1, var))
HC.var["H3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC")],1, var))
HC.var["H3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC")],1, var))
HC.var["H3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic")],1, var))
HC.var["H4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC")],1, var))
HC.var["H4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC")],1, var))
HC.var["H4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic")],1, var))
HC.var["H5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC")],1, var))
HC.var["H5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC")],1, var))
HC.var["H5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic")],1, var))
HC.var["H6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC")],1, var))
HC.var["H6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC")],1, var))
HC.var["H6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic")],1, var))
HC.var["C1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC")],1, var))
HC.var["C1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC")],1, var))
HC.var["C1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic")],1, var))
HC.var["C1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC")],1, var))
HC.var["C1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC")],1, var))
HC.var["C1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic")],1, var))
HC.var["C2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC")],1, var))
HC.var["C2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC")],1, var))
HC.var["C2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic")],1, var))
HC.var["C3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC")],1, var))
HC.var["C3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC")],1, var))
HC.var["C3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic")],1, var))
HC.var["C4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC")],1, var))
HC.var["C4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC")],1, var))
HC.var["C4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic")],1, var))
HC.var["C5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC")],1, var))
HC.var["C5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC")],1, var))
HC.var["C5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic")],1, var))
HC.var["C6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC")],1, var))
HC.var["C6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC")],1, var))
HC.var["C6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC","H1.1_MSC","H1.1_Osteogenic",
                                    "H1.2_iPSC","H1.2_MSC","H1.2_Osteogenic",
                                    "H2.1_iPSC","H2.1_MSC","H2.1_Osteogenic",
                                    "H3.1_iPSC","H3.1_MSC","H3.1_Osteogenic",
                                    "H4.1_iPSC","H4.1_MSC","H4.1_Osteogenic",
                                    "H5.1_iPSC","H5.1_MSC","H5.1_Osteogenic",
                                    "H6.1_iPSC","H6.1_MSC","H6.1_Osteogenic",
                                    "C1.1_iPSC","C1.1_MSC","C1.1_Osteogenic",
                                    "C1.2_iPSC","C1.2_MSC","C1.2_Osteogenic",
                                    "C2.1_iPSC","C2.1_MSC","C2.1_Osteogenic",
                                    "C3.1_iPSC","C3.1_MSC","C3.1_Osteogenic",
                                    "C4.1_iPSC","C4.1_MSC","C4.1_Osteogenic",
                                    "C5.1_iPSC","C5.1_MSC","C5.1_Osteogenic",
                                    "C6.1_iPSC","C6.1_MSC","C6.1_Osteogenic"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_iPSC,HC.var$H1.1_MSC)       #p<2.2e-16
t.test(HC.var$H1.1_MSC,HC.var$H1.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H1.2_iPSC,HC.var$H1.2_MSC)       #p=9.0e-05
t.test(HC.var$H1.2_MSC,HC.var$H1.2_Osteogenic) #p<2.2e-16
t.test(HC.var$H2.1_iPSC,HC.var$H2.1_MSC)       #p<2.2e-16
t.test(HC.var$H2.1_MSC,HC.var$H2.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H3.1_iPSC,HC.var$H3.1_MSC)       #p=8.1e-05
t.test(HC.var$H3.1_MSC,HC.var$H3.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H4.1_iPSC,HC.var$H4.1_MSC)       #p<2.2e-16
t.test(HC.var$H4.1_MSC,HC.var$H4.1_Osteogenic) #p=1.3e-09
t.test(HC.var$H5.1_iPSC,HC.var$H5.1_MSC)       #p<2.2e-16
t.test(HC.var$H5.1_MSC,HC.var$H5.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H6.1_iPSC,HC.var$H6.1_MSC)       #p<2.2e-16
t.test(HC.var$H6.1_MSC,HC.var$H6.1_Osteogenic) #p=0.53020
t.test(HC.var$C1.1_iPSC,HC.var$C1.1_MSC)       #p<2.2e-16
t.test(HC.var$C1.1_MSC,HC.var$C1.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C1.2_iPSC,HC.var$C1.2_MSC)       #p<2.2e-16
t.test(HC.var$C1.2_MSC,HC.var$C1.2_Osteogenic) #p=3.1e-06
t.test(HC.var$C2.1_iPSC,HC.var$C2.1_MSC)       #p=0.13040
t.test(HC.var$C2.1_MSC,HC.var$C2.1_Osteogenic) #p=0.15120
t.test(HC.var$C3.1_iPSC,HC.var$C3.1_MSC)       #p=0.77120
t.test(HC.var$C3.1_MSC,HC.var$C3.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C4.1_iPSC,HC.var$C4.1_MSC)       #p<2.2e-16
t.test(HC.var$C4.1_MSC,HC.var$C4.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C5.1_iPSC,HC.var$C5.1_MSC)       #p<2.2e-16
t.test(HC.var$C5.1_MSC,HC.var$C5.1_Osteogenic) #p=2.1e-05
t.test(HC.var$C6.1_iPSC,HC.var$C6.1_MSC)       #p<2.2e-16
t.test(HC.var$C6.1_MSC,HC.var$C6.1_Osteogenic) #p=0.43000

```

### SC: General Ad Hoc Classifications vs. Species (median)

```{r, eval=FALSE}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc.Assign.median,sep = "_"),
                      levels=c("Human_iPSC","Human_MSC","Human_Osteogenic","Human_other","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic","Chimp_other"))

# Calculate log2cpm means within species - mean increases in MSCs and stays constant in Osteogenic cells
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, mean))
HC.mean["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, mean))
HC.mean["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, mean))
HC.mean["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, mean))
HC.mean["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, mean))
HC.mean["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_iPSC,HC.mean$Human_MSC)       #p<2.2e-16
t.test(HC.mean$Human_MSC,HC.mean$Human_Osteogenic) #p=0.71970
t.test(HC.mean$Chimp_iPSC,HC.mean$Chimp_MSC)       #p<2.2e-16
t.test(HC.mean$Chimp_MSC,HC.mean$Chimp_Osteogenic) #p=0.10470

# Calculate log2cpm variances within species - variance increases in MSCs and Osteogenic cells
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, var))
HC.var["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, var))
HC.var["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, var))
HC.var["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, var))
HC.var["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, var))
HC.var["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_iPSC,HC.var$Human_MSC)       #p=3.5e-10
t.test(HC.var$Human_MSC,HC.var$Human_Osteogenic) #p=4.0e-15
t.test(HC.var$Chimp_iPSC,HC.var$Chimp_MSC)       #p<2.2e-16
t.test(HC.var$Chimp_MSC,HC.var$Chimp_Osteogenic) #p<2.2e-16

```

### SC: General Ad Hoc Classifications vs. Individuals (median)

```{r, eval=FALSE}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,dge$samples$AdHoc.Assign.median,sep = "_"),
                      levels=c("H1_iPSC","H1_MSC","H1_Osteogenic",
                               "H2_iPSC","H2_MSC","H2_Osteogenic",
                               "H3_iPSC","H3_MSC","H3_Osteogenic",
                               "H4_iPSC","H4_MSC","H4_Osteogenic",
                               "H5_iPSC","H5_MSC","H5_Osteogenic",
                               "H6_iPSC","H6_MSC","H6_Osteogenic",
                               "C1_iPSC","C1_MSC","C1_Osteogenic",
                               "C2_iPSC","C2_MSC","C2_Osteogenic",
                               "C3_iPSC","C3_MSC","C3_Osteogenic",
                               "C4_iPSC","C4_MSC","C4_Osteogenic",
                               "C5_iPSC","C5_MSC","C5_Osteogenic",
                               "C6_iPSC","C6_MSC","C6_Osteogenic"))

# Calculate log2cpm means within individuals - generally mean increases in MSCs (except C4, H3, H5) and stays constant in Osteogenic cells (except C2, C4, C5, C6, H1, H4)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC")],1, mean))
HC.mean["H1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC")],1, mean))
HC.mean["H1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic")],1, mean))
HC.mean["H2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC")],1, mean))
HC.mean["H2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC")],1, mean))
HC.mean["H2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic")],1, mean))
HC.mean["H3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC")],1, mean))
HC.mean["H3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC")],1, mean))
HC.mean["H3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic")],1, mean))
HC.mean["H4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC")],1, mean))
HC.mean["H4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC")],1, mean))
HC.mean["H4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic")],1, mean))
HC.mean["H5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC")],1, mean))
HC.mean["H5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC")],1, mean))
HC.mean["H5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic")],1, mean))
HC.mean["H6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC")],1, mean))
HC.mean["H6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC")],1, mean))
HC.mean["H6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic")],1, mean))
HC.mean["C1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC")],1, mean))
HC.mean["C1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC")],1, mean))
HC.mean["C1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic")],1, mean))
HC.mean["C2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC")],1, mean))
HC.mean["C2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC")],1, mean))
HC.mean["C2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic")],1, mean))
HC.mean["C3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC")],1, mean))
HC.mean["C3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC")],1, mean))
HC.mean["C3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic")],1, mean))
HC.mean["C4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC")],1, mean))
HC.mean["C4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC")],1, mean))
HC.mean["C4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic")],1, mean))
HC.mean["C5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC")],1, mean))
HC.mean["C5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC")],1, mean))
HC.mean["C5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic")],1, mean))
HC.mean["C6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC")],1, mean))
HC.mean["C6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC")],1, mean))
HC.mean["C6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC","H1_MSC","H1_Osteogenic",
                                    "H2_iPSC","H2_MSC","H2_Osteogenic",
                                    "H3_iPSC","H3_MSC","H3_Osteogenic",
                                    "H4_iPSC","H4_MSC","H4_Osteogenic",
                                    "H5_iPSC","H5_MSC","H5_Osteogenic",
                                    "H6_iPSC","H6_MSC","H6_Osteogenic",
                                    "C1_iPSC","C1_MSC","C1_Osteogenic",
                                    "C2_iPSC","C2_MSC","C2_Osteogenic",
                                    "C3_iPSC","C3_MSC","C3_Osteogenic",
                                    "C4_iPSC","C4_MSC","C4_Osteogenic",
                                    "C5_iPSC","C5_MSC","C5_Osteogenic",
                                    "C6_iPSC","C6_MSC","C6_Osteogenic"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_iPSC,HC.mean$H1_MSC)       #p<2.2e-16
t.test(HC.mean$H1_MSC,HC.mean$H1_Osteogenic) #p=0.00637
t.test(HC.mean$H2_iPSC,HC.mean$H2_MSC)       #p=3.3e-15
t.test(HC.mean$H2_MSC,HC.mean$H2_Osteogenic) #p=0.79480
t.test(HC.mean$H3_iPSC,HC.mean$H3_MSC)       #p=0.15970
t.test(HC.mean$H3_MSC,HC.mean$H3_Osteogenic) #p=0.65990
t.test(HC.mean$H4_iPSC,HC.mean$H4_MSC)       #p<2.2e-16
t.test(HC.mean$H4_MSC,HC.mean$H4_Osteogenic) #p<2.2e-16
t.test(HC.mean$H5_iPSC,HC.mean$H5_MSC)       #p=0.00476
t.test(HC.mean$H5_MSC,HC.mean$H5_Osteogenic) #p=0.21640
t.test(HC.mean$H6_iPSC,HC.mean$H6_MSC)       #p=9.9e-13
t.test(HC.mean$H6_MSC,HC.mean$H6_Osteogenic) #p=0.17890
t.test(HC.mean$C1_iPSC,HC.mean$C1_MSC)       #p<2.2e-16
t.test(HC.mean$C1_MSC,HC.mean$C1_Osteogenic) #p=0.87690
t.test(HC.mean$C2_iPSC,HC.mean$C2_MSC)       #p<2.2e-16
t.test(HC.mean$C2_MSC,HC.mean$C2_Osteogenic) #p<2.2e-16
t.test(HC.mean$C3_iPSC,HC.mean$C3_MSC)       #p<2.2e-16
t.test(HC.mean$C3_MSC,HC.mean$C3_Osteogenic) #p=0.03999
t.test(HC.mean$C4_iPSC,HC.mean$C4_MSC)       #p=0.12530
t.test(HC.mean$C4_MSC,HC.mean$C4_Osteogenic) #p=0.00012
t.test(HC.mean$C5_iPSC,HC.mean$C5_MSC)       #p<2.2e-16
t.test(HC.mean$C5_MSC,HC.mean$C5_Osteogenic) #p=0.01165
t.test(HC.mean$C6_iPSC,HC.mean$C6_MSC)       #p<2.2e-16
t.test(HC.mean$C6_MSC,HC.mean$C6_Osteogenic) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSCs (except C2, C3, H1, H2) and Osteogenic cells (except H3, H4)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC")],1, var))
HC.var["H1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC")],1, var))
HC.var["H1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic")],1, var))
HC.var["H2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC")],1, var))
HC.var["H2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC")],1, var))
HC.var["H2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic")],1, var))
HC.var["H3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC")],1, var))
HC.var["H3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC")],1, var))
HC.var["H3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic")],1, var))
HC.var["H4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC")],1, var))
HC.var["H4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC")],1, var))
HC.var["H4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic")],1, var))
HC.var["H5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC")],1, var))
HC.var["H5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC")],1, var))
HC.var["H5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic")],1, var))
HC.var["H6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC")],1, var))
HC.var["H6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC")],1, var))
HC.var["H6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic")],1, var))
HC.var["C1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC")],1, var))
HC.var["C1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC")],1, var))
HC.var["C1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic")],1, var))
HC.var["C2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC")],1, var))
HC.var["C2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC")],1, var))
HC.var["C2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic")],1, var))
HC.var["C3_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC")],1, var))
HC.var["C3_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC")],1, var))
HC.var["C3_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic")],1, var))
HC.var["C4_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC")],1, var))
HC.var["C4_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC")],1, var))
HC.var["C4_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic")],1, var))
HC.var["C5_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC")],1, var))
HC.var["C5_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC")],1, var))
HC.var["C5_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic")],1, var))
HC.var["C6_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC")],1, var))
HC.var["C6_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC")],1, var))
HC.var["C6_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC","H1_MSC","H1_Osteogenic",
                                    "H2_iPSC","H2_MSC","H2_Osteogenic",
                                    "H3_iPSC","H3_MSC","H3_Osteogenic",
                                    "H4_iPSC","H4_MSC","H4_Osteogenic",
                                    "H5_iPSC","H5_MSC","H5_Osteogenic",
                                    "H6_iPSC","H6_MSC","H6_Osteogenic",
                                    "C1_iPSC","C1_MSC","C1_Osteogenic",
                                    "C2_iPSC","C2_MSC","C2_Osteogenic",
                                    "C3_iPSC","C3_MSC","C3_Osteogenic",
                                    "C4_iPSC","C4_MSC","C4_Osteogenic",
                                    "C5_iPSC","C5_MSC","C5_Osteogenic",
                                    "C6_iPSC","C6_MSC","C6_Osteogenic"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_iPSC,HC.var$H1_MSC)       #p<2.2e-16
t.test(HC.var$H1_MSC,HC.var$H1_Osteogenic) #p<2.2e-16
t.test(HC.var$H2_iPSC,HC.var$H2_MSC)       #p=0.14120
t.test(HC.var$H2_MSC,HC.var$H2_Osteogenic) #p<2.2e-16
t.test(HC.var$H3_iPSC,HC.var$H3_MSC)       #p=2.2e-16
t.test(HC.var$H3_MSC,HC.var$H3_Osteogenic) #p=0.05900
t.test(HC.var$H4_iPSC,HC.var$H4_MSC)       #p<2.2e-16
t.test(HC.var$H4_MSC,HC.var$H4_Osteogenic) #p=0.00167
t.test(HC.var$H5_iPSC,HC.var$H5_MSC)       #p<2.2e-16
t.test(HC.var$H5_MSC,HC.var$H5_Osteogenic) #p<2.2e-16
t.test(HC.var$H6_iPSC,HC.var$H6_MSC)       #p<2.2e-16
t.test(HC.var$H6_MSC,HC.var$H6_Osteogenic) #p<2.2e-16
t.test(HC.var$C1_iPSC,HC.var$C1_MSC)       #p<2.2e-16
t.test(HC.var$C1_MSC,HC.var$C1_Osteogenic) #p<2.2e-16
t.test(HC.var$C2_iPSC,HC.var$C2_MSC)       #p=0.00059
t.test(HC.var$C2_MSC,HC.var$C2_Osteogenic) #p<2.2e-16
t.test(HC.var$C3_iPSC,HC.var$C3_MSC)       #p=1.2e-14
t.test(HC.var$C3_MSC,HC.var$C3_Osteogenic) #p<2.2e-16
t.test(HC.var$C4_iPSC,HC.var$C4_MSC)       #p<2.2e-16
t.test(HC.var$C4_MSC,HC.var$C4_Osteogenic) #p<2.2e-16
t.test(HC.var$C5_iPSC,HC.var$C5_MSC)       #p=0.03652
t.test(HC.var$C5_MSC,HC.var$C5_Osteogenic) #p<2.2e-16
t.test(HC.var$C6_iPSC,HC.var$C6_MSC)       #p<2.2e-16
t.test(HC.var$C6_MSC,HC.var$C6_Osteogenic) #p<2.2e-16

```

### SC: General Ad Hoc Classifications vs. Individual.Replicates (median)

```{r, eval=FALSE}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,dge$samples$AdHoc.Assign.median,sep = "_"),
                      levels=c("H1.1_iPSC","H1.1_MSC","H1.1_Osteogenic",
                               "H1.2_iPSC","H1.2_MSC","H1.2_Osteogenic",
                               "H2.1_iPSC","H2.1_MSC","H2.1_Osteogenic",
                               "H3.1_iPSC","H3.1_MSC","H3.1_Osteogenic",
                               "H4.1_iPSC","H4.1_MSC","H4.1_Osteogenic",
                               "H5.1_iPSC","H5.1_MSC","H5.1_Osteogenic",
                               "H6.1_iPSC","H6.1_MSC","H6.1_Osteogenic",
                               "C1.1_iPSC","C1.1_MSC","C1.1_Osteogenic",
                               "C1.2_iPSC","C1.2_MSC","C1.2_Osteogenic",
                               "C2.1_iPSC","C2.1_MSC","C2.1_Osteogenic",
                               "C3.1_iPSC","C3.1_MSC","C3.1_Osteogenic",
                               "C4.1_iPSC","C4.1_MSC","C4.1_Osteogenic",
                               "C5.1_iPSC","C5.1_MSC","C5.1_Osteogenic",
                               "C6.1_iPSC","C6.1_MSC","C6.1_Osteogenic"))

# Calculate log2cpm means within individuals - generally mean increases in MSCs (except C4.1, H3.1, H5.1) and stays constant in Osteogenic cells (except C2.1, C4.1, C5.1, C6.1, H1.1, H4.1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC")],1, mean))
HC.mean["H1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC")],1, mean))
HC.mean["H1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic")],1, mean))
HC.mean["H1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC")],1, mean))
HC.mean["H1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC")],1, mean))
HC.mean["H1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic")],1, mean))
HC.mean["H2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC")],1, mean))
HC.mean["H2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC")],1, mean))
HC.mean["H2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic")],1, mean))
HC.mean["H3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC")],1, mean))
HC.mean["H3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC")],1, mean))
HC.mean["H3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic")],1, mean))
HC.mean["H4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC")],1, mean))
HC.mean["H4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC")],1, mean))
HC.mean["H4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic")],1, mean))
HC.mean["H5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC")],1, mean))
HC.mean["H5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC")],1, mean))
HC.mean["H5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic")],1, mean))
HC.mean["H6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC")],1, mean))
HC.mean["H6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC")],1, mean))
HC.mean["H6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic")],1, mean))
HC.mean["C1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC")],1, mean))
HC.mean["C1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC")],1, mean))
HC.mean["C1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic")],1, mean))
HC.mean["C1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC")],1, mean))
HC.mean["C1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC")],1, mean))
HC.mean["C1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic")],1, mean))
HC.mean["C2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC")],1, mean))
HC.mean["C2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC")],1, mean))
HC.mean["C2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic")],1, mean))
HC.mean["C3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC")],1, mean))
HC.mean["C3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC")],1, mean))
HC.mean["C3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic")],1, mean))
HC.mean["C4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC")],1, mean))
HC.mean["C4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC")],1, mean))
HC.mean["C4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic")],1, mean))
HC.mean["C5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC")],1, mean))
HC.mean["C5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC")],1, mean))
HC.mean["C5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic")],1, mean))
HC.mean["C6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC")],1, mean))
HC.mean["C6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC")],1, mean))
HC.mean["C6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC","H1.1_MSC","H1.1_Osteogenic",
                                    "H1.2_iPSC","H1.2_MSC","H1.2_Osteogenic",
                                    "H2.1_iPSC","H2.1_MSC","H2.1_Osteogenic",
                                    "H3.1_iPSC","H3.1_MSC","H3.1_Osteogenic",
                                    "H4.1_iPSC","H4.1_MSC","H4.1_Osteogenic",
                                    "H5.1_iPSC","H5.1_MSC","H5.1_Osteogenic",
                                    "H6.1_iPSC","H6.1_MSC","H6.1_Osteogenic",
                                    "C1.1_iPSC","C1.1_MSC","C1.1_Osteogenic",
                                    "C1.2_iPSC","C1.2_MSC","C1.2_Osteogenic",
                                    "C2.1_iPSC","C2.1_MSC","C2.1_Osteogenic",
                                    "C3.1_iPSC","C3.1_MSC","C3.1_Osteogenic",
                                    "C4.1_iPSC","C4.1_MSC","C4.1_Osteogenic",
                                    "C5.1_iPSC","C5.1_MSC","C5.1_Osteogenic",
                                    "C6.1_iPSC","C6.1_MSC","C6.1_Osteogenic"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_iPSC,HC.mean$H1.1_MSC)       #p<2.2e-16
t.test(HC.mean$H1.1_MSC,HC.mean$H1.1_Osteogenic) #p=1.2e-05
t.test(HC.mean$H1.2_iPSC,HC.mean$H1.2_MSC)       #p<2.2e-16
t.test(HC.mean$H1.2_MSC,HC.mean$H1.2_Osteogenic) #p=0.35090
t.test(HC.mean$H2.1_iPSC,HC.mean$H2.1_MSC)       #p=3.3e-15
t.test(HC.mean$H2.1_MSC,HC.mean$H2.1_Osteogenic) #p=0.79480
t.test(HC.mean$H3.1_iPSC,HC.mean$H3.1_MSC)       #p=0.15970
t.test(HC.mean$H3.1_MSC,HC.mean$H3.1_Osteogenic) #p=0.65990
t.test(HC.mean$H4.1_iPSC,HC.mean$H4.1_MSC)       #p<2.2e-16
t.test(HC.mean$H4.1_MSC,HC.mean$H4.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$H5.1_iPSC,HC.mean$H5.1_MSC)       #p=0.00476
t.test(HC.mean$H5.1_MSC,HC.mean$H5.1_Osteogenic) #p=0.21640
t.test(HC.mean$H6.1_iPSC,HC.mean$H6.1_MSC)       #p=9.9e-13
t.test(HC.mean$H6.1_MSC,HC.mean$H6.1_Osteogenic) #p=0.17890
t.test(HC.mean$C1.1_iPSC,HC.mean$C1.1_MSC)       #p<2.2e-16
t.test(HC.mean$C1.1_MSC,HC.mean$C1.1_Osteogenic) #p=0.14760
t.test(HC.mean$C1.2_iPSC,HC.mean$C1.2_MSC)       #p<2.2e-16
t.test(HC.mean$C1.2_MSC,HC.mean$C1.2_Osteogenic) #p=0.43280
t.test(HC.mean$C2.1_iPSC,HC.mean$C2.1_MSC)       #p<2.2e-16
t.test(HC.mean$C2.1_MSC,HC.mean$C2.1_Osteogenic) #p<2.2e-16
t.test(HC.mean$C3.1_iPSC,HC.mean$C3.1_MSC)       #p<2.2e-16
t.test(HC.mean$C3.1_MSC,HC.mean$C3.1_Osteogenic) #p=0.03999
t.test(HC.mean$C4.1_iPSC,HC.mean$C4.1_MSC)       #p=0.12530
t.test(HC.mean$C4.1_MSC,HC.mean$C4.1_Osteogenic) #p=0.00012
t.test(HC.mean$C5.1_iPSC,HC.mean$C5.1_MSC)       #p<2.2e-16
t.test(HC.mean$C5.1_MSC,HC.mean$C5.1_Osteogenic) #p=0.01165
t.test(HC.mean$C6.1_iPSC,HC.mean$C6.1_MSC)       #p<2.2e-16
t.test(HC.mean$C6.1_MSC,HC.mean$C6.1_Osteogenic) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSCs (except C1.1, C2.1, C3.1, H1.1, H1.2, H2.1) and Osteogenic cells (except H3.1, H4.1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC")],1, var))
HC.var["H1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC")],1, var))
HC.var["H1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic")],1, var))
HC.var["H1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC")],1, var))
HC.var["H1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC")],1, var))
HC.var["H1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic")],1, var))
HC.var["H2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC")],1, var))
HC.var["H2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC")],1, var))
HC.var["H2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic")],1, var))
HC.var["H3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC")],1, var))
HC.var["H3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC")],1, var))
HC.var["H3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic")],1, var))
HC.var["H4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC")],1, var))
HC.var["H4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC")],1, var))
HC.var["H4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic")],1, var))
HC.var["H5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC")],1, var))
HC.var["H5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC")],1, var))
HC.var["H5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic")],1, var))
HC.var["H6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC")],1, var))
HC.var["H6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC")],1, var))
HC.var["H6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic")],1, var))
HC.var["C1.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC")],1, var))
HC.var["C1.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC")],1, var))
HC.var["C1.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic")],1, var))
HC.var["C1.2_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC")],1, var))
HC.var["C1.2_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC")],1, var))
HC.var["C1.2_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic")],1, var))
HC.var["C2.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC")],1, var))
HC.var["C2.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC")],1, var))
HC.var["C2.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic")],1, var))
HC.var["C3.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC")],1, var))
HC.var["C3.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC")],1, var))
HC.var["C3.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic")],1, var))
HC.var["C4.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC")],1, var))
HC.var["C4.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC")],1, var))
HC.var["C4.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic")],1, var))
HC.var["C5.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC")],1, var))
HC.var["C5.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC")],1, var))
HC.var["C5.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic")],1, var))
HC.var["C6.1_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC")],1, var))
HC.var["C6.1_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC")],1, var))
HC.var["C6.1_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC","H1.1_MSC","H1.1_Osteogenic",
                                    "H1.2_iPSC","H1.2_MSC","H1.2_Osteogenic",
                                    "H2.1_iPSC","H2.1_MSC","H2.1_Osteogenic",
                                    "H3.1_iPSC","H3.1_MSC","H3.1_Osteogenic",
                                    "H4.1_iPSC","H4.1_MSC","H4.1_Osteogenic",
                                    "H5.1_iPSC","H5.1_MSC","H5.1_Osteogenic",
                                    "H6.1_iPSC","H6.1_MSC","H6.1_Osteogenic",
                                    "C1.1_iPSC","C1.1_MSC","C1.1_Osteogenic",
                                    "C1.2_iPSC","C1.2_MSC","C1.2_Osteogenic",
                                    "C2.1_iPSC","C2.1_MSC","C2.1_Osteogenic",
                                    "C3.1_iPSC","C3.1_MSC","C3.1_Osteogenic",
                                    "C4.1_iPSC","C4.1_MSC","C4.1_Osteogenic",
                                    "C5.1_iPSC","C5.1_MSC","C5.1_Osteogenic",
                                    "C6.1_iPSC","C6.1_MSC","C6.1_Osteogenic"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_iPSC,HC.var$H1.1_MSC)       #p<2.2e-16
t.test(HC.var$H1.1_MSC,HC.var$H1.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H1.2_iPSC,HC.var$H1.2_MSC)       #p=3.0e-11
t.test(HC.var$H1.2_MSC,HC.var$H1.2_Osteogenic) #p<2.2e-16
t.test(HC.var$H2.1_iPSC,HC.var$H2.1_MSC)       #p=0.14120
t.test(HC.var$H2.1_MSC,HC.var$H2.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H3.1_iPSC,HC.var$H3.1_MSC)       #p=2.2e-16
t.test(HC.var$H3.1_MSC,HC.var$H3.1_Osteogenic) #p=0.05900
t.test(HC.var$H4.1_iPSC,HC.var$H4.1_MSC)       #p<2.2e-16
t.test(HC.var$H4.1_MSC,HC.var$H4.1_Osteogenic) #p=0.00167
t.test(HC.var$H5.1_iPSC,HC.var$H5.1_MSC)       #p<2.2e-16
t.test(HC.var$H5.1_MSC,HC.var$H5.1_Osteogenic) #p<2.2e-16
t.test(HC.var$H6.1_iPSC,HC.var$H6.1_MSC)       #p<2.2e-16
t.test(HC.var$H6.1_MSC,HC.var$H6.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C1.1_iPSC,HC.var$C1.1_MSC)       #p=0.46550
t.test(HC.var$C1.1_MSC,HC.var$C1.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C1.2_iPSC,HC.var$C1.2_MSC)       #p<2.2e-16
t.test(HC.var$C1.2_MSC,HC.var$C1.2_Osteogenic) #p<2.2e-16

t.test(HC.var$C2.1_iPSC,HC.var$C2.1_MSC)       #p=0.00059
t.test(HC.var$C2.1_MSC,HC.var$C2.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C3.1_iPSC,HC.var$C3.1_MSC)       #p=1.2e-14
t.test(HC.var$C3.1_MSC,HC.var$C3.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C4.1_iPSC,HC.var$C4.1_MSC)       #p<2.2e-16
t.test(HC.var$C4.1_MSC,HC.var$C4.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C5.1_iPSC,HC.var$C5.1_MSC)       #p=0.03652
t.test(HC.var$C5.1_MSC,HC.var$C5.1_Osteogenic) #p<2.2e-16
t.test(HC.var$C6.1_iPSC,HC.var$C6.1_MSC)       #p<2.2e-16
t.test(HC.var$C6.1_MSC,HC.var$C6.1_Osteogenic) #p<2.2e-16

```

### SC: Osteogenic Clusters vs. Species (res=0.5)

```{r}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$Cluster0.5,sep="_"),
                      levels=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                               "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))

# Calculate log2cpm means within species - mean increases in Osteogenic.c2, decreases in Osteogenic.c3, and decreases in Osteogenic.c5 (expt C)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, mean))
HC.mean["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, mean))
HC.mean["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, mean))
HC.mean["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, mean))
HC.mean["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, mean))
HC.mean["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, mean))
HC.mean["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, mean))
HC.mean["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, mean))
HC.mean["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_Osteogenic.c1,HC.mean$Human_Osteogenic.c2) #p<2.2e-16
t.test(HC.mean$Human_Osteogenic.c2,HC.mean$Human_Osteogenic.c3) #p<2.2e-16
t.test(HC.mean$Human_Osteogenic.c3,HC.mean$Human_Osteogenic.c5) #p=2.4e-14
t.test(HC.mean$Chimp_Osteogenic.c1,HC.mean$Chimp_Osteogenic.c2) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c2,HC.mean$Chimp_Osteogenic.c3) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c3,HC.mean$Chimp_Osteogenic.c5) #p=0.53100

# Calculate log2cpm variances within species - variance decreases in Osteogenic.c2, decreases in Osteogenic.c3, and decreases in Osteogenic.c5
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, var))
HC.var["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, var))
HC.var["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, var))
HC.var["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, var))
HC.var["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, var))
HC.var["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, var))
HC.var["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, var))
HC.var["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, var))
HC.var["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, var))
HC.var["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_Osteogenic.c1,HC.var$Human_Osteogenic.c2) #p<2.2e-16
t.test(HC.var$Human_Osteogenic.c2,HC.var$Human_Osteogenic.c3) #p<2.2e-16
t.test(HC.var$Human_Osteogenic.c3,HC.var$Human_Osteogenic.c5) #p=3.8e-09
t.test(HC.var$Chimp_Osteogenic.c1,HC.var$Chimp_Osteogenic.c2) #p=1.6e-10
t.test(HC.var$Chimp_Osteogenic.c2,HC.var$Chimp_Osteogenic.c3) #p<2.2e-16
t.test(HC.var$Chimp_Osteogenic.c3,HC.var$Chimp_Osteogenic.c5) #p=0.00950

```

### TO EDIT
### SC: Osteogenic Clusters vs. Individuals (res=0.5)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,dge$samples$Cluster,sep="_"),
                      levels=c("H1_iPSC.c1","H1_iPSC.c2","H1_iPSC.c3","H1_MSC.c1","H1_Osteogenic.c1","H1_Osteogenic.c2",
                               "H2_iPSC.c1","H2_iPSC.c2","H2_iPSC.c3","H2_MSC.c1","H2_Osteogenic.c1","H2_Osteogenic.c2",
                               "H3_iPSC.c1","H3_iPSC.c2","H3_iPSC.c3","H3_MSC.c1","H3_Osteogenic.c1","H3_Osteogenic.c2",
                               "H4_iPSC.c1","H4_iPSC.c2","H4_iPSC.c3","H4_MSC.c1","H4_Osteogenic.c1","H4_Osteogenic.c2",
                               "H5_iPSC.c1","H5_iPSC.c2","H5_iPSC.c3","H5_MSC.c1","H5_Osteogenic.c1","H5_Osteogenic.c2",
                               "H6_iPSC.c1","H6_iPSC.c2","H6_iPSC.c3","H6_MSC.c1","H6_Osteogenic.c1","H6_Osteogenic.c2",
                               "C1_iPSC.c1","C1_iPSC.c2","C1_iPSC.c3","C1_MSC.c1","C1_Osteogenic.c1","C1_Osteogenic.c2",
                               "C2_iPSC.c1","C2_iPSC.c2","C2_iPSC.c3","C2_MSC.c1","C2_Osteogenic.c1","C2_Osteogenic.c2",
                               "C3_iPSC.c1","C3_iPSC.c2","C3_iPSC.c3","C3_MSC.c1","C3_Osteogenic.c1","C3_Osteogenic.c2",
                               "C4_iPSC.c1","C4_iPSC.c2","C4_iPSC.c3","C4_MSC.c1","C4_Osteogenic.c1","C4_Osteogenic.c2",
                               "C5_iPSC.c1","C5_iPSC.c2","C5_iPSC.c3","C5_MSC.c1","C5_Osteogenic.c1","C5_Osteogenic.c2",
                               "C6_iPSC.c1","C6_iPSC.c2","C6_iPSC.c3","C6_MSC.c1","C6_Osteogenic.c1","C6_Osteogenic.c2"))

# Calculate log2cpm means within individuals - generally mean decreases in MSC.c1 (except C1, C3, C6, H1, H3, H4, H6) and decreases in Osteogenic.c1 (except H1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c1")],1, mean))
HC.mean["H1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c2")],1, mean))
HC.mean["H1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c3")],1, mean))
HC.mean["H1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC.c1")],1, mean))
HC.mean["H1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c1")],1, mean))
HC.mean["H1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c2")],1, mean))
HC.mean["H2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c1")],1, mean))
HC.mean["H2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c2")],1, mean))
HC.mean["H2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c3")],1, mean))
HC.mean["H2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC.c1")],1, mean))
HC.mean["H2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c1")],1, mean))
HC.mean["H2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c2")],1, mean))
HC.mean["H3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c1")],1, mean))
HC.mean["H3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c2")],1, mean))
HC.mean["H3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c3")],1, mean))
HC.mean["H3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC.c1")],1, mean))
HC.mean["H3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c1")],1, mean))
HC.mean["H3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c2")],1, mean))
HC.mean["H4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c1")],1, mean))
HC.mean["H4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c2")],1, mean))
HC.mean["H4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c3")],1, mean))
HC.mean["H4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC.c1")],1, mean))
HC.mean["H4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c1")],1, mean))
HC.mean["H4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c2")],1, mean))
HC.mean["H5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c1")],1, mean))
HC.mean["H5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c2")],1, mean))
HC.mean["H5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c3")],1, mean))
HC.mean["H5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC.c1")],1, mean))
HC.mean["H5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c1")],1, mean))
HC.mean["H5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c2")],1, mean))
HC.mean["H6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c1")],1, mean))
HC.mean["H6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c2")],1, mean))
HC.mean["H6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c3")],1, mean))
HC.mean["H6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC.c1")],1, mean))
HC.mean["H6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c1")],1, mean))
HC.mean["H6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c2")],1, mean))
HC.mean["C1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c1")],1, mean))
HC.mean["C1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c2")],1, mean))
HC.mean["C1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c3")],1, mean))
HC.mean["C1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC.c1")],1, mean))
HC.mean["C1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c1")],1, mean))
HC.mean["C1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c2")],1, mean))
HC.mean["C2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c1")],1, mean))
HC.mean["C2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c2")],1, mean))
HC.mean["C2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c3")],1, mean))
HC.mean["C2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC.c1")],1, mean))
HC.mean["C2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c1")],1, mean))
HC.mean["C2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c2")],1, mean))
HC.mean["C3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c1")],1, mean))
HC.mean["C3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c2")],1, mean))
HC.mean["C3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c3")],1, mean))
HC.mean["C3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC.c1")],1, mean))
HC.mean["C3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c1")],1, mean))
HC.mean["C3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c2")],1, mean))
HC.mean["C4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c1")],1, mean))
HC.mean["C4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c2")],1, mean))
HC.mean["C4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c3")],1, mean))
HC.mean["C4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC.c1")],1, mean))
HC.mean["C4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c1")],1, mean))
HC.mean["C4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c2")],1, mean))
HC.mean["C5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c1")],1, mean))
HC.mean["C5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c2")],1, mean))
HC.mean["C5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c3")],1, mean))
HC.mean["C5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC.c1")],1, mean))
HC.mean["C5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c1")],1, mean))
HC.mean["C5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c2")],1, mean))
HC.mean["C6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c1")],1, mean))
HC.mean["C6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c2")],1, mean))
HC.mean["C6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c3")],1, mean))
HC.mean["C6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC.c1")],1, mean))
HC.mean["C6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c1")],1, mean))
HC.mean["C6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC.c1","H1_iPSC.c2","H1_iPSC.c3","H1_MSC.c1","H1_Osteogenic.c1","H1_Osteogenic.c2",
                                    "H2_iPSC.c1","H2_iPSC.c2","H2_iPSC.c3","H2_MSC.c1","H2_Osteogenic.c1","H2_Osteogenic.c2",
                                    "H3_iPSC.c1","H3_iPSC.c2","H3_iPSC.c3","H3_MSC.c1","H3_Osteogenic.c1","H3_Osteogenic.c2",
                                    "H4_iPSC.c1","H4_iPSC.c2","H4_iPSC.c3","H4_MSC.c1","H4_Osteogenic.c1","H4_Osteogenic.c2",
                                    "H5_iPSC.c1","H5_iPSC.c2","H5_iPSC.c3","H5_MSC.c1","H5_Osteogenic.c1","H5_Osteogenic.c2",
                                    "H6_iPSC.c1","H6_iPSC.c2","H6_iPSC.c3","H6_MSC.c1","H6_Osteogenic.c1","H6_Osteogenic.c2",
                                    "C1_iPSC.c1","C1_iPSC.c2","C1_iPSC.c3","C1_MSC.c1","C1_Osteogenic.c1","C1_Osteogenic.c2",
                                    "C2_iPSC.c1","C2_iPSC.c2","C2_iPSC.c3","C2_MSC.c1","C2_Osteogenic.c1","C2_Osteogenic.c2",
                                    "C3_iPSC.c1","C3_iPSC.c2","C3_iPSC.c3","C3_MSC.c1","C3_Osteogenic.c1","C3_Osteogenic.c2",
                                    "C4_iPSC.c1","C4_iPSC.c2","C4_iPSC.c3","C4_MSC.c1","C4_Osteogenic.c1","C4_Osteogenic.c2",
                                    "C5_iPSC.c1","C5_iPSC.c2","C5_iPSC.c3","C5_MSC.c1","C5_Osteogenic.c1","C5_Osteogenic.c2",
                                    "C6_iPSC.c1","C6_iPSC.c2","C6_iPSC.c3","C6_MSC.c1","C6_Osteogenic.c1","C6_Osteogenic.c2"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_iPSC.c1,HC.mean$H1_MSC.c1)       #p=1.1e-08
t.test(HC.mean$H1_MSC.c1,HC.mean$H1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H2_iPSC.c1,HC.mean$H2_MSC.c1)       #p=0.79570
t.test(HC.mean$H2_MSC.c1,HC.mean$H2_Osteogenic.c1) #p=1.0e-11
t.test(HC.mean$H3_iPSC.c1,HC.mean$H3_MSC.c1)       #p=0.45760
t.test(HC.mean$H3_MSC.c1,HC.mean$H3_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H4_iPSC.c1,HC.mean$H4_MSC.c1)       #p<2.2e-16
t.test(HC.mean$H4_MSC.c1,HC.mean$H4_Osteogenic.c1) #p=2.4e=13
t.test(HC.mean$H5_iPSC.c1,HC.mean$H5_MSC.c1)       #p=2.3e-13
t.test(HC.mean$H5_MSC.c1,HC.mean$H5_Osteogenic.c1) #p=5.2e-10
t.test(HC.mean$H6_iPSC.c1,HC.mean$H6_MSC.c1)       #p=3.1e-08
t.test(HC.mean$H6_MSC.c1,HC.mean$H6_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C1_iPSC.c1,HC.mean$C1_MSC.c1)       #p=0.27660
t.test(HC.mean$C1_MSC.c1,HC.mean$C1_Osteogenic.c1) #p=1.4e-08
t.test(HC.mean$C2_iPSC.c1,HC.mean$C2_MSC.c1)       #p=3.0e-06
t.test(HC.mean$C2_MSC.c1,HC.mean$C2_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C3_iPSC.c1,HC.mean$C3_MSC.c1)       #p=0.2378
t.test(HC.mean$C3_MSC.c1,HC.mean$C3_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C4_iPSC.c1,HC.mean$C4_MSC.c1)       #p=5.2e-05
t.test(HC.mean$C4_MSC.c1,HC.mean$C4_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C5_iPSC.c1,HC.mean$C5_MSC.c1)       #p=2.8e-08
t.test(HC.mean$C5_MSC.c1,HC.mean$C5_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C6_iPSC.c1,HC.mean$C6_MSC.c1)       #p=6.1e-11
t.test(HC.mean$C6_MSC.c1,HC.mean$C6_Osteogenic.c1) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSC.c1 (except H4) and Osteogenic.c1 (except H1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c1")],1, var))
HC.var["H1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c2")],1, var))
HC.var["H1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_iPSC.c3")],1, var))
HC.var["H1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_MSC.c1")],1, var))
HC.var["H1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c1")],1, var))
HC.var["H1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_Osteogenic.c2")],1, var))
HC.var["H2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c1")],1, var))
HC.var["H2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c2")],1, var))
HC.var["H2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_iPSC.c3")],1, var))
HC.var["H2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_MSC.c1")],1, var))
HC.var["H2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c1")],1, var))
HC.var["H2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_Osteogenic.c2")],1, var))
HC.var["H3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c1")],1, var))
HC.var["H3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c2")],1, var))
HC.var["H3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_iPSC.c3")],1, var))
HC.var["H3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_MSC.c1")],1, var))
HC.var["H3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c1")],1, var))
HC.var["H3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_Osteogenic.c2")],1, var))
HC.var["H4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c1")],1, var))
HC.var["H4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c2")],1, var))
HC.var["H4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_iPSC.c3")],1, var))
HC.var["H4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_MSC.c1")],1, var))
HC.var["H4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c1")],1, var))
HC.var["H4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_Osteogenic.c2")],1, var))
HC.var["H5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c1")],1, var))
HC.var["H5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c2")],1, var))
HC.var["H5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_iPSC.c3")],1, var))
HC.var["H5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_MSC.c1")],1, var))
HC.var["H5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c1")],1, var))
HC.var["H5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_Osteogenic.c2")],1, var))
HC.var["H6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c1")],1, var))
HC.var["H6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c2")],1, var))
HC.var["H6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_iPSC.c3")],1, var))
HC.var["H6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_MSC.c1")],1, var))
HC.var["H6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c1")],1, var))
HC.var["H6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_Osteogenic.c2")],1, var))
HC.var["C1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c1")],1, var))
HC.var["C1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c2")],1, var))
HC.var["C1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_iPSC.c3")],1, var))
HC.var["C1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_MSC.c1")],1, var))
HC.var["C1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c1")],1, var))
HC.var["C1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_Osteogenic.c2")],1, var))
HC.var["C2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c1")],1, var))
HC.var["C2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c2")],1, var))
HC.var["C2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_iPSC.c3")],1, var))
HC.var["C2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_MSC.c1")],1, var))
HC.var["C2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c1")],1, var))
HC.var["C2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_Osteogenic.c2")],1, var))
HC.var["C3_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c1")],1, var))
HC.var["C3_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c2")],1, var))
HC.var["C3_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_iPSC.c3")],1, var))
HC.var["C3_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_MSC.c1")],1, var))
HC.var["C3_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c1")],1, var))
HC.var["C3_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_Osteogenic.c2")],1, var))
HC.var["C4_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c1")],1, var))
HC.var["C4_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c2")],1, var))
HC.var["C4_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_iPSC.c3")],1, var))
HC.var["C4_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_MSC.c1")],1, var))
HC.var["C4_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c1")],1, var))
HC.var["C4_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_Osteogenic.c2")],1, var))
HC.var["C5_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c1")],1, var))
HC.var["C5_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c2")],1, var))
HC.var["C5_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_iPSC.c3")],1, var))
HC.var["C5_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_MSC.c1")],1, var))
HC.var["C5_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c1")],1, var))
HC.var["C5_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_Osteogenic.c2")],1, var))
HC.var["C6_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c1")],1, var))
HC.var["C6_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c2")],1, var))
HC.var["C6_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_iPSC.c3")],1, var))
HC.var["C6_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_MSC.c1")],1, var))
HC.var["C6_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c1")],1, var))
HC.var["C6_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_Osteogenic.c2")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_iPSC.c1","H1_iPSC.c2","H1_iPSC.c3","H1_MSC.c1","H1_Osteogenic.c1","H1_Osteogenic.c2",
                                    "H2_iPSC.c1","H2_iPSC.c2","H2_iPSC.c3","H2_MSC.c1","H2_Osteogenic.c1","H2_Osteogenic.c2",
                                    "H3_iPSC.c1","H3_iPSC.c2","H3_iPSC.c3","H3_MSC.c1","H3_Osteogenic.c1","H3_Osteogenic.c2",
                                    "H4_iPSC.c1","H4_iPSC.c2","H4_iPSC.c3","H4_MSC.c1","H4_Osteogenic.c1","H4_Osteogenic.c2",
                                    "H5_iPSC.c1","H5_iPSC.c2","H5_iPSC.c3","H5_MSC.c1","H5_Osteogenic.c1","H5_Osteogenic.c2",
                                    "H6_iPSC.c1","H6_iPSC.c2","H6_iPSC.c3","H6_MSC.c1","H6_Osteogenic.c1","H6_Osteogenic.c2",
                                    "C1_iPSC.c1","C1_iPSC.c2","C1_iPSC.c3","C1_MSC.c1","C1_Osteogenic.c1","C1_Osteogenic.c2",
                                    "C2_iPSC.c1","C2_iPSC.c2","C2_iPSC.c3","C2_MSC.c1","C2_Osteogenic.c1","C2_Osteogenic.c2",
                                    "C3_iPSC.c1","C3_iPSC.c2","C3_iPSC.c3","C3_MSC.c1","C3_Osteogenic.c1","C3_Osteogenic.c2",
                                    "C4_iPSC.c1","C4_iPSC.c2","C4_iPSC.c3","C4_MSC.c1","C4_Osteogenic.c1","C4_Osteogenic.c2",
                                    "C5_iPSC.c1","C5_iPSC.c2","C5_iPSC.c3","C5_MSC.c1","C5_Osteogenic.c1","C5_Osteogenic.c2",
                                    "C6_iPSC.c1","C6_iPSC.c2","C6_iPSC.c3","C6_MSC.c1","C6_Osteogenic.c1","C6_Osteogenic.c2"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_iPSC.c1,HC.var$H1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H1_MSC.c1,HC.var$H1_Osteogenic.c1) #p=0.96980
t.test(HC.var$H2_iPSC.c1,HC.var$H2_MSC.c1)       #p<2.2e-16
t.test(HC.var$H2_MSC.c1,HC.var$H2_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H3_iPSC.c1,HC.var$H3_MSC.c1)       #p<2.2e-16
t.test(HC.var$H3_MSC.c1,HC.var$H3_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H4_iPSC.c1,HC.var$H4_MSC.c1)       #p<2.2e-16
t.test(HC.var$H4_MSC.c1,HC.var$H4_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H5_iPSC.c1,HC.var$H5_MSC.c1)       #p<2.2e-16
t.test(HC.var$H5_MSC.c1,HC.var$H5_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H6_iPSC.c1,HC.var$H6_MSC.c1)       #p<2.2e-16
t.test(HC.var$H6_MSC.c1,HC.var$H6_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C1_iPSC.c1,HC.var$C1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C1_MSC.c1,HC.var$C1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C2_iPSC.c1,HC.var$C2_MSC.c1)       #p<2.2e-16
t.test(HC.var$C2_MSC.c1,HC.var$C2_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C3_iPSC.c1,HC.var$C3_MSC.c1)       #p<2.2e-16
t.test(HC.var$C3_MSC.c1,HC.var$C3_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C4_iPSC.c1,HC.var$C4_MSC.c1)       #p<2.2e-16
t.test(HC.var$C4_MSC.c1,HC.var$C4_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C5_iPSC.c1,HC.var$C5_MSC.c1)       #p<2.2e-16
t.test(HC.var$C5_MSC.c1,HC.var$C5_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C6_iPSC.c1,HC.var$C6_MSC.c1)       #p<2.2e-16
t.test(HC.var$C6_MSC.c1,HC.var$C6_Osteogenic.c1) #p<2.2e-16

```

### TO EDIT
### SC: Osteogenic Clusters vs. Individual.Replicates (res=0.5)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,dge$samples$Cluster,sep="_"),
                      levels=c("H1.1_iPSC.c1","H1.1_iPSC.c2","H1.1_iPSC.c3","H1.1_MSC.c1","H1.1_Osteogenic.c1","H1.1_Osteogenic.c2",
                               "H1.2_iPSC.c1","H1.2_iPSC.c2","H1.2_iPSC.c3","H1.2_MSC.c1","H1.2_Osteogenic.c1","H1.2_Osteogenic.c2",
                               "H2.1_iPSC.c1","H2.1_iPSC.c2","H2.1_iPSC.c3","H2.1_MSC.c1","H2.1_Osteogenic.c1","H2.1_Osteogenic.c2",
                               "H3.1_iPSC.c1","H3.1_iPSC.c2","H3.1_iPSC.c3","H3.1_MSC.c1","H3.1_Osteogenic.c1","H3.1_Osteogenic.c2",
                               "H4.1_iPSC.c1","H4.1_iPSC.c2","H4.1_iPSC.c3","H4.1_MSC.c1","H4.1_Osteogenic.c1","H4.1_Osteogenic.c2",
                               "H5.1_iPSC.c1","H5.1_iPSC.c2","H5.1_iPSC.c3","H5.1_MSC.c1","H5.1_Osteogenic.c1","H5.1_Osteogenic.c2",
                               "H6.1_iPSC.c1","H6.1_iPSC.c2","H6.1_iPSC.c3","H6.1_MSC.c1","H6.1_Osteogenic.c1","H6.1_Osteogenic.c2",
                               "C1.1_iPSC.c1","C1.1_iPSC.c2","C1.1_iPSC.c3","C1.1_MSC.c1","C1.1_Osteogenic.c1","C1.1_Osteogenic.c2",
                               "C1.2_iPSC.c1","C1.2_iPSC.c2","C1.2_iPSC.c3","C1.2_MSC.c1","C1.2_Osteogenic.c1","C1.2_Osteogenic.c2",
                               "C2.1_iPSC.c1","C2.1_iPSC.c2","C2.1_iPSC.c3","C2.1_MSC.c1","C2.1_Osteogenic.c1","C2.1_Osteogenic.c2",
                               "C3.1_iPSC.c1","C3.1_iPSC.c2","C3.1_iPSC.c3","C3.1_MSC.c1","C3.1_Osteogenic.c1","C3.1_Osteogenic.c2",
                               "C4.1_iPSC.c1","C4.1_iPSC.c2","C4.1_iPSC.c3","C4.1_MSC.c1","C4.1_Osteogenic.c1","C4.1_Osteogenic.c2",
                               "C5.1_iPSC.c1","C5.1_iPSC.c2","C5.1_iPSC.c3","C5.1_MSC.c1","C5.1_Osteogenic.c1","C5.1_Osteogenic.c2",
                               "C6.1_iPSC.c1","C6.1_iPSC.c2","C6.1_iPSC.c3","C6.1_MSC.c1","C6.1_Osteogenic.c1","C6.1_Osteogenic.c2"))

# Calculate log2cpm means within individuals - generally mean decreases in MSC.c1 (except C1.1, C3.1, C6.1, H1.1, H1.2, H3.1, H4.1, H6.1) and decreases in Osteogenic.c1 (except C1.1, H1.1, H1.2)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c1")],1, mean))
HC.mean["H1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c2")],1, mean))
HC.mean["H1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c3")],1, mean))
HC.mean["H1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC.c1")],1, mean))
HC.mean["H1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c1")],1, mean))
HC.mean["H1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c2")],1, mean))
HC.mean["H1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c1")],1, mean))
HC.mean["H1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c2")],1, mean))
HC.mean["H1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c3")],1, mean))
HC.mean["H1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC.c1")],1, mean))
HC.mean["H1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c1")],1, mean))
HC.mean["H1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c2")],1, mean))
HC.mean["H2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c1")],1, mean))
HC.mean["H2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c2")],1, mean))
HC.mean["H2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c3")],1, mean))
HC.mean["H2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC.c1")],1, mean))
HC.mean["H2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c1")],1, mean))
HC.mean["H2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c2")],1, mean))
HC.mean["H3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c1")],1, mean))
HC.mean["H3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c2")],1, mean))
HC.mean["H3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c3")],1, mean))
HC.mean["H3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC.c1")],1, mean))
HC.mean["H3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c1")],1, mean))
HC.mean["H3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c2")],1, mean))
HC.mean["H4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c1")],1, mean))
HC.mean["H4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c2")],1, mean))
HC.mean["H4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c3")],1, mean))
HC.mean["H4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC.c1")],1, mean))
HC.mean["H4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c1")],1, mean))
HC.mean["H4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c2")],1, mean))
HC.mean["H5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c1")],1, mean))
HC.mean["H5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c2")],1, mean))
HC.mean["H5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c3")],1, mean))
HC.mean["H5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC.c1")],1, mean))
HC.mean["H5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c1")],1, mean))
HC.mean["H5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c2")],1, mean))
HC.mean["H6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c1")],1, mean))
HC.mean["H6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c2")],1, mean))
HC.mean["H6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c3")],1, mean))
HC.mean["H6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC.c1")],1, mean))
HC.mean["H6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c1")],1, mean))
HC.mean["H6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c2")],1, mean))
HC.mean["C1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c1")],1, mean))
HC.mean["C1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c2")],1, mean))
HC.mean["C1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c3")],1, mean))
HC.mean["C1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC.c1")],1, mean))
HC.mean["C1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c1")],1, mean))
HC.mean["C1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c2")],1, mean))
HC.mean["C1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c1")],1, mean))
HC.mean["C1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c2")],1, mean))
HC.mean["C1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c3")],1, mean))
HC.mean["C1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC.c1")],1, mean))
HC.mean["C1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c1")],1, mean))
HC.mean["C1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c2")],1, mean))
HC.mean["C2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c1")],1, mean))
HC.mean["C2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c2")],1, mean))
HC.mean["C2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c3")],1, mean))
HC.mean["C2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC.c1")],1, mean))
HC.mean["C2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c1")],1, mean))
HC.mean["C2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c2")],1, mean))
HC.mean["C3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c1")],1, mean))
HC.mean["C3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c2")],1, mean))
HC.mean["C3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c3")],1, mean))
HC.mean["C3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC.c1")],1, mean))
HC.mean["C3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c1")],1, mean))
HC.mean["C3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c2")],1, mean))
HC.mean["C4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c1")],1, mean))
HC.mean["C4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c2")],1, mean))
HC.mean["C4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c3")],1, mean))
HC.mean["C4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC.c1")],1, mean))
HC.mean["C4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c1")],1, mean))
HC.mean["C4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c2")],1, mean))
HC.mean["C5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c1")],1, mean))
HC.mean["C5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c2")],1, mean))
HC.mean["C5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c3")],1, mean))
HC.mean["C5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC.c1")],1, mean))
HC.mean["C5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c1")],1, mean))
HC.mean["C5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c2")],1, mean))
HC.mean["C6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c1")],1, mean))
HC.mean["C6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c2")],1, mean))
HC.mean["C6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c3")],1, mean))
HC.mean["C6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC.c1")],1, mean))
HC.mean["C6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c1")],1, mean))
HC.mean["C6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC.c1","H1.1_iPSC.c2","H1.1_iPSC.c3","H1.1_MSC.c1","H1.1_Osteogenic.c1","H1.1_Osteogenic.c2",
                                    "H1.2_iPSC.c1","H1.2_iPSC.c2","H1.2_iPSC.c3","H1.2_MSC.c1","H1.2_Osteogenic.c1","H1.2_Osteogenic.c2",
                                    "H2.1_iPSC.c1","H2.1_iPSC.c2","H2.1_iPSC.c3","H2.1_MSC.c1","H2.1_Osteogenic.c1","H2.1_Osteogenic.c2",
                                    "H3.1_iPSC.c1","H3.1_iPSC.c2","H3.1_iPSC.c3","H3.1_MSC.c1","H3.1_Osteogenic.c1","H3.1_Osteogenic.c2",
                                    "H4.1_iPSC.c1","H4.1_iPSC.c2","H4.1_iPSC.c3","H4.1_MSC.c1","H4.1_Osteogenic.c1","H4.1_Osteogenic.c2",
                                    "H5.1_iPSC.c1","H5.1_iPSC.c2","H5.1_iPSC.c3","H5.1_MSC.c1","H5.1_Osteogenic.c1","H5.1_Osteogenic.c2",
                                    "H6.1_iPSC.c1","H6.1_iPSC.c2","H6.1_iPSC.c3","H6.1_MSC.c1","H6.1_Osteogenic.c1","H6.1_Osteogenic.c2",
                                    "C1.1_iPSC.c1","C1.1_iPSC.c2","C1.1_iPSC.c3","C1.1_MSC.c1","C1.1_Osteogenic.c1","C1.1_Osteogenic.c2",
                                    "C1.2_iPSC.c1","C1.2_iPSC.c2","C1.2_iPSC.c3","C1.2_MSC.c1","C1.2_Osteogenic.c1","C1.2_Osteogenic.c2",
                                    "C2.1_iPSC.c1","C2.1_iPSC.c2","C2.1_iPSC.c3","C2.1_MSC.c1","C2.1_Osteogenic.c1","C2.1_Osteogenic.c2",
                                    "C3.1_iPSC.c1","C3.1_iPSC.c2","C3.1_iPSC.c3","C3.1_MSC.c1","C3.1_Osteogenic.c1","C3.1_Osteogenic.c2",
                                    "C4.1_iPSC.c1","C4.1_iPSC.c2","C4.1_iPSC.c3","C4.1_MSC.c1","C4.1_Osteogenic.c1","C4.1_Osteogenic.c2",
                                    "C5.1_iPSC.c1","C5.1_iPSC.c2","C5.1_iPSC.c3","C5.1_MSC.c1","C5.1_Osteogenic.c1","C5.1_Osteogenic.c2",
                                    "C6.1_iPSC.c1","C6.1_iPSC.c2","C6.1_iPSC.c3","C6.1_MSC.c1","C6.1_Osteogenic.c1","C6.1_Osteogenic.c2"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_iPSC.c1,HC.mean$H1.1_MSC.c1)       #p=0.89510
t.test(HC.mean$H1.1_MSC.c1,HC.mean$H1.1_Osteogenic.c1) #p=1.2e-11
t.test(HC.mean$H1.2_iPSC.c1,HC.mean$H1.2_MSC.c1)       #p<2.2e-16
t.test(HC.mean$H1.2_MSC.c1,HC.mean$H1.2_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H2.1_iPSC.c1,HC.mean$H2.1_MSC.c1)       #p=0.79570
t.test(HC.mean$H2.1_MSC.c1,HC.mean$H2.1_Osteogenic.c1) #p=1.0e-11
t.test(HC.mean$H3.1_iPSC.c1,HC.mean$H3.1_MSC.c1)       #p=0.45760
t.test(HC.mean$H3.1_MSC.c1,HC.mean$H3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$H4.1_iPSC.c1,HC.mean$H4.1_MSC.c1)       #p<2.2e-16
t.test(HC.mean$H4.1_MSC.c1,HC.mean$H4.1_Osteogenic.c1) #p=2.4e-13
t.test(HC.mean$H5.1_iPSC.c1,HC.mean$H5.1_MSC.c1)       #p=2.3e-13
t.test(HC.mean$H5.1_MSC.c1,HC.mean$H5.1_Osteogenic.c1) #p=5.2e-10
t.test(HC.mean$H6.1_iPSC.c1,HC.mean$H6.1_MSC.c1)       #p=3.1e-08
t.test(HC.mean$H6.1_MSC.c1,HC.mean$H6.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C1.1_iPSC.c1,HC.mean$C1.1_MSC.c1)       #p=0.01723
t.test(HC.mean$C1.1_MSC.c1,HC.mean$C1.1_Osteogenic.c1) #p=0.63770
t.test(HC.mean$C1.2_iPSC.c1,HC.mean$C1.2_MSC.c1)       #p=0.38600
t.test(HC.mean$C1.2_MSC.c1,HC.mean$C1.2_Osteogenic.c1) #p=3.3e-11
t.test(HC.mean$C2.1_iPSC.c1,HC.mean$C2.1_MSC.c1)       #p=3.0e-06
t.test(HC.mean$C2.1_MSC.c1,HC.mean$C2.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C3.1_iPSC.c1,HC.mean$C3.1_MSC.c1)       #p=0.23780
t.test(HC.mean$C3.1_MSC.c1,HC.mean$C3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C4.1_iPSC.c1,HC.mean$C4.1_MSC.c1)       #p=5.2e-05
t.test(HC.mean$C4.1_MSC.c1,HC.mean$C4.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C5.1_iPSC.c1,HC.mean$C5.1_MSC.c1)       #p=2.8e-08
t.test(HC.mean$C5.1_MSC.c1,HC.mean$C5.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.mean$C6.1_iPSC.c1,HC.mean$C6.1_MSC.c1)       #p=6.1e-11
t.test(HC.mean$C6.1_MSC.c1,HC.mean$C6.1_Osteogenic.c1) #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in MSC.c1 (except H4.1) and Osteogenic.c1 (except H1.2)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c1")],1, var))
HC.var["H1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c2")],1, var))
HC.var["H1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_iPSC.c3")],1, var))
HC.var["H1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_MSC.c1")],1, var))
HC.var["H1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c1")],1, var))
HC.var["H1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_Osteogenic.c2")],1, var))
HC.var["H1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c1")],1, var))
HC.var["H1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c2")],1, var))
HC.var["H1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_iPSC.c3")],1, var))
HC.var["H1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_MSC.c1")],1, var))
HC.var["H1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c1")],1, var))
HC.var["H1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_Osteogenic.c2")],1, var))
HC.var["H2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c1")],1, var))
HC.var["H2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c2")],1, var))
HC.var["H2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_iPSC.c3")],1, var))
HC.var["H2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_MSC.c1")],1, var))
HC.var["H2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c1")],1, var))
HC.var["H2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_Osteogenic.c2")],1, var))
HC.var["H3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c1")],1, var))
HC.var["H3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c2")],1, var))
HC.var["H3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_iPSC.c3")],1, var))
HC.var["H3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_MSC.c1")],1, var))
HC.var["H3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c1")],1, var))
HC.var["H3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_Osteogenic.c2")],1, var))
HC.var["H4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c1")],1, var))
HC.var["H4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c2")],1, var))
HC.var["H4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_iPSC.c3")],1, var))
HC.var["H4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_MSC.c1")],1, var))
HC.var["H4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c1")],1, var))
HC.var["H4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_Osteogenic.c2")],1, var))
HC.var["H5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c1")],1, var))
HC.var["H5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c2")],1, var))
HC.var["H5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_iPSC.c3")],1, var))
HC.var["H5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_MSC.c1")],1, var))
HC.var["H5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c1")],1, var))
HC.var["H5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_Osteogenic.c2")],1, var))
HC.var["H6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c1")],1, var))
HC.var["H6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c2")],1, var))
HC.var["H6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_iPSC.c3")],1, var))
HC.var["H6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_MSC.c1")],1, var))
HC.var["H6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c1")],1, var))
HC.var["H6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_Osteogenic.c2")],1, var))
HC.var["C1.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c1")],1, var))
HC.var["C1.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c2")],1, var))
HC.var["C1.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_iPSC.c3")],1, var))
HC.var["C1.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_MSC.c1")],1, var))
HC.var["C1.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c1")],1, var))
HC.var["C1.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_Osteogenic.c2")],1, var))
HC.var["C1.2_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c1")],1, var))
HC.var["C1.2_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c2")],1, var))
HC.var["C1.2_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_iPSC.c3")],1, var))
HC.var["C1.2_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_MSC.c1")],1, var))
HC.var["C1.2_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c1")],1, var))
HC.var["C1.2_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_Osteogenic.c2")],1, var))
HC.var["C2.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c1")],1, var))
HC.var["C2.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c2")],1, var))
HC.var["C2.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_iPSC.c3")],1, var))
HC.var["C2.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_MSC.c1")],1, var))
HC.var["C2.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c1")],1, var))
HC.var["C2.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_Osteogenic.c2")],1, var))
HC.var["C3.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c1")],1, var))
HC.var["C3.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c2")],1, var))
HC.var["C3.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_iPSC.c3")],1, var))
HC.var["C3.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_MSC.c1")],1, var))
HC.var["C3.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c1")],1, var))
HC.var["C3.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_Osteogenic.c2")],1, var))
HC.var["C4.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c1")],1, var))
HC.var["C4.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c2")],1, var))
HC.var["C4.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_iPSC.c3")],1, var))
HC.var["C4.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_MSC.c1")],1, var))
HC.var["C4.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c1")],1, var))
HC.var["C4.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_Osteogenic.c2")],1, var))
HC.var["C5.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c1")],1, var))
HC.var["C5.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c2")],1, var))
HC.var["C5.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_iPSC.c3")],1, var))
HC.var["C5.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_MSC.c1")],1, var))
HC.var["C5.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c1")],1, var))
HC.var["C5.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_Osteogenic.c2")],1, var))
HC.var["C6.1_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c1")],1, var))
HC.var["C6.1_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c2")],1, var))
HC.var["C6.1_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_iPSC.c3")],1, var))
HC.var["C6.1_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_MSC.c1")],1, var))
HC.var["C6.1_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c1")],1, var))
HC.var["C6.1_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_Osteogenic.c2")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_iPSC.c1","H1.1_iPSC.c2","H1.1_iPSC.c3","H1.1_MSC.c1","H1.1_Osteogenic.c1","H1.1_Osteogenic.c2",
                                    "H1.2_iPSC.c1","H1.2_iPSC.c2","H1.2_iPSC.c3","H1.2_MSC.c1","H1.2_Osteogenic.c1","H1.2_Osteogenic.c2",
                                    "H2.1_iPSC.c1","H2.1_iPSC.c2","H2.1_iPSC.c3","H2.1_MSC.c1","H2.1_Osteogenic.c1","H2.1_Osteogenic.c2",
                                    "H3.1_iPSC.c1","H3.1_iPSC.c2","H3.1_iPSC.c3","H3.1_MSC.c1","H3.1_Osteogenic.c1","H3.1_Osteogenic.c2",
                                    "H4.1_iPSC.c1","H4.1_iPSC.c2","H4.1_iPSC.c3","H4.1_MSC.c1","H4.1_Osteogenic.c1","H4.1_Osteogenic.c2",
                                    "H5.1_iPSC.c1","H5.1_iPSC.c2","H5.1_iPSC.c3","H5.1_MSC.c1","H5.1_Osteogenic.c1","H5.1_Osteogenic.c2",
                                    "H6.1_iPSC.c1","H6.1_iPSC.c2","H6.1_iPSC.c3","H6.1_MSC.c1","H6.1_Osteogenic.c1","H6.1_Osteogenic.c2",
                                    "C1.1_iPSC.c1","C1.1_iPSC.c2","C1.1_iPSC.c3","C1.1_MSC.c1","C1.1_Osteogenic.c1","C1.1_Osteogenic.c2",
                                    "C1.2_iPSC.c1","C1.2_iPSC.c2","C1.2_iPSC.c3","C1.2_MSC.c1","C1.2_Osteogenic.c1","C1.2_Osteogenic.c2",
                                    "C2.1_iPSC.c1","C2.1_iPSC.c2","C2.1_iPSC.c3","C2.1_MSC.c1","C2.1_Osteogenic.c1","C2.1_Osteogenic.c2",
                                    "C3.1_iPSC.c1","C3.1_iPSC.c2","C3.1_iPSC.c3","C3.1_MSC.c1","C3.1_Osteogenic.c1","C3.1_Osteogenic.c2",
                                    "C4.1_iPSC.c1","C4.1_iPSC.c2","C4.1_iPSC.c3","C4.1_MSC.c1","C4.1_Osteogenic.c1","C4.1_Osteogenic.c2",
                                    "C5.1_iPSC.c1","C5.1_iPSC.c2","C5.1_iPSC.c3","C5.1_MSC.c1","C5.1_Osteogenic.c1","C5.1_Osteogenic.c2",
                                    "C6.1_iPSC.c1","C6.1_iPSC.c2","C6.1_iPSC.c3","C6.1_MSC.c1","C6.1_Osteogenic.c1","C6.1_Osteogenic.c2"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=individual, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_iPSC.c1,HC.var$H1.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H1.1_MSC.c1,HC.var$H1.1_Osteogenic.c1) #p=6.2e-15
t.test(HC.var$H1.2_iPSC.c1,HC.var$H1.2_MSC.c1)       #p=7.5e-08
t.test(HC.var$H1.2_MSC.c1,HC.var$H1.2_Osteogenic.c1) #p=6.9e-09
t.test(HC.var$H2.1_iPSC.c1,HC.var$H2.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H2.1_MSC.c1,HC.var$H2.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H3.1_iPSC.c1,HC.var$H3.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H3.1_MSC.c1,HC.var$H3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H4.1_iPSC.c1,HC.var$H4.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H4.1_MSC.c1,HC.var$H4.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H5.1_iPSC.c1,HC.var$H5.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H5.1_MSC.c1,HC.var$H5.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$H6.1_iPSC.c1,HC.var$H6.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$H6.1_MSC.c1,HC.var$H6.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C1.1_iPSC.c1,HC.var$C1.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C1.1_MSC.c1,HC.var$C1.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C1.2_iPSC.c1,HC.var$C1.2_MSC.c1)       #p<2.2e-16
t.test(HC.var$C1.2_MSC.c1,HC.var$C1.2_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C2.1_iPSC.c1,HC.var$C2.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C2.1_MSC.c1,HC.var$C2.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C3.1_iPSC.c1,HC.var$C3.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C3.1_MSC.c1,HC.var$C3.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C4.1_iPSC.c1,HC.var$C4.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C4.1_MSC.c1,HC.var$C4.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C5.1_iPSC.c1,HC.var$C5.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C5.1_MSC.c1,HC.var$C5.1_Osteogenic.c1) #p<2.2e-16
t.test(HC.var$C6.1_iPSC.c1,HC.var$C6.1_MSC.c1)       #p<2.2e-16
t.test(HC.var$C6.1_MSC.c1,HC.var$C6.1_Osteogenic.c1) #p<2.2e-16

```

### TO EDIT
### SC: Osteogenic Clusters vs. Species (t2 with res=0.1)

```{r, eval=FALSE}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$Cluster.t2,sep="_"),
                      levels=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                               "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))

# Calculate log2cpm means within species - mean increases in Osteogenic.c2, stays constant in Osteogenic.c3 (expt C), and decreases in Osteogenic.c5 (expt C)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, mean))
HC.mean["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, mean))
HC.mean["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, mean))
HC.mean["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, mean))
HC.mean["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, mean))
HC.mean["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, mean))
HC.mean["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, mean))
#HC.mean["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, mean))
HC.mean["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c5"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_Osteogenic.c1,HC.mean$Human_Osteogenic.c2) #p<2.2e-16
t.test(HC.mean$Human_Osteogenic.c2,HC.mean$Human_Osteogenic.c3) #p=0.51510
t.test(HC.mean$Human_Osteogenic.c3,HC.mean$Human_Osteogenic.c5) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c1,HC.mean$Chimp_Osteogenic.c2) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c2,HC.mean$Chimp_Osteogenic.c3) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c3,HC.mean$Chimp_Osteogenic.c5) #p<2.2e-16

# Calculate log2cpm variances within species - variance decreases in Osteogenic.c2, stays constant in Osteogenic.c3 (expt C), and decreases in Osteogenic.c5
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, var))
HC.var["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, var))
HC.var["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, var))
HC.var["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, var))
HC.var["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, var))
HC.var["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, var))
HC.var["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, var))
HC.var["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, var))
HC.var["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, var))
HC.var["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_Osteogenic.c1,HC.var$Human_Osteogenic.c2) #p<2.2e-16
t.test(HC.var$Human_Osteogenic.c2,HC.var$Human_Osteogenic.c3) #p=0.28780
t.test(HC.var$Human_Osteogenic.c3,HC.var$Human_Osteogenic.c5) #p<2.2e-16
t.test(HC.var$Chimp_Osteogenic.c1,HC.var$Chimp_Osteogenic.c2) #p=1.3e-09
t.test(HC.var$Chimp_Osteogenic.c2,HC.var$Chimp_Osteogenic.c3) #p=1.7e-09
t.test(HC.var$Chimp_Osteogenic.c3,HC.var$Chimp_Osteogenic.c5) #p<2.2e-16

```

### TO EDIT
### SC: Osteogenic Clusters vs. Individuals (t2 with res=0.1)
### TO EDIT
### SC: Osteogenic Clusters vs. Individual.Replicates (t2 with res=0.1)

### SC: Osteogenic Ad Hoc Classifications vs. Species (thresh0)

```{r}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,sapply(dge$samples$OstAdHoc.Assign.5gene.thresh0,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean stays constant in osteoblasts (expt C), stays constant in emb.osteoblasts(expt C), stays constant in min.osteoblasts, and decreases in mat.osteocytes
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p=0.05370
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p=0.06232
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=0.10090
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p=1.6e-11
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p=0.63110
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in osteoblasts (expt C), stays constant in emb.osteoblasts, increases in min.osteoblasts, and increases in mat.osteocytes (expt C)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p=6.4e-06
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p=0.56040
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p=0.00278
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p=5.9e-14
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p=1.1e-10
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p=0.71220
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=4.6e-07
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p<2.2e-16

```

### TO EDIT
### SC: Osteogenic Ad Hoc Classifications vs. Individuals (thresh0)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,sapply(dge$samples$OstAdHoc.Assign.5gene.thresh0,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                               "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                               "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                               "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                               "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                               "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                               "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                               "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                               "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                               "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                               "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                               "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))

# Calculate log2cpm means within individuals
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_preosteoblast")],1, mean))
HC.mean["H1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_osteoblast")],1, mean))
HC.mean["H1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_embedding.osteoblast")],1, mean))
HC.mean["H1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_mineralizing.osteoblast")],1, mean))
HC.mean["H1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_maturing.osteocyte")],1, mean))
HC.mean["H2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_preosteoblast")],1, mean))
HC.mean["H2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_osteoblast")],1, mean))
HC.mean["H2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_embedding.osteoblast")],1, mean))
HC.mean["H2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_mineralizing.osteoblast")],1, mean))
HC.mean["H2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_maturing.osteocyte")],1, mean))
#HC.mean["H3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_preosteoblast")],1, mean))
#HC.mean["H3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_osteoblast")],1, mean))
HC.mean["H3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_embedding.osteoblast")],1, mean))
HC.mean["H3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_mineralizing.osteoblast")],1, mean))
HC.mean["H3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_maturing.osteocyte")],1, mean))
HC.mean["H4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_preosteoblast")],1, mean))
HC.mean["H4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_osteoblast")],1, mean))
HC.mean["H4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_embedding.osteoblast")],1, mean))
HC.mean["H4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_mineralizing.osteoblast")],1, mean))
HC.mean["H4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_maturing.osteocyte")],1, mean))
HC.mean["H5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_preosteoblast")],1, mean))
HC.mean["H5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_osteoblast")],1, mean))
HC.mean["H5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_embedding.osteoblast")],1, mean))
HC.mean["H5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_mineralizing.osteoblast")],1, mean))
HC.mean["H5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_maturing.osteocyte")],1, mean))
HC.mean["H6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_preosteoblast")],1, mean))
HC.mean["H6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_osteoblast")],1, mean))
HC.mean["H6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_embedding.osteoblast")],1, mean))
HC.mean["H6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_mineralizing.osteoblast")],1, mean))
HC.mean["H6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_maturing.osteocyte")],1, mean))
HC.mean["C1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_preosteoblast")],1, mean))
HC.mean["C1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_osteoblast")],1, mean))
HC.mean["C1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_embedding.osteoblast")],1, mean))
HC.mean["C1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_mineralizing.osteoblast")],1, mean))
HC.mean["C1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_maturing.osteocyte")],1, mean))
HC.mean["C2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_preosteoblast")],1, mean))
HC.mean["C2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_osteoblast")],1, mean))
HC.mean["C2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_embedding.osteoblast")],1, mean))
HC.mean["C2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_mineralizing.osteoblast")],1, mean))
HC.mean["C2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_maturing.osteocyte")],1, mean))
HC.mean["C3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_preosteoblast")],1, mean))
HC.mean["C3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_osteoblast")],1, mean))
HC.mean["C3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_embedding.osteoblast")],1, mean))
HC.mean["C3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_mineralizing.osteoblast")],1, mean))
HC.mean["C3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_maturing.osteocyte")],1, mean))
HC.mean["C4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_preosteoblast")],1, mean))
HC.mean["C4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_osteoblast")],1, mean))
HC.mean["C4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_embedding.osteoblast")],1, mean))
HC.mean["C4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_mineralizing.osteoblast")],1, mean))
HC.mean["C4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_maturing.osteocyte")],1, mean))
HC.mean["C5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_preosteoblast")],1, mean))
HC.mean["C5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_osteoblast")],1, mean))
HC.mean["C5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_embedding.osteoblast")],1, mean))
HC.mean["C5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_mineralizing.osteoblast")],1, mean))
HC.mean["C5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_maturing.osteocyte")],1, mean))
HC.mean["C6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_preosteoblast")],1, mean))
HC.mean["C6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_osteoblast")],1, mean))
HC.mean["C6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_embedding.osteoblast")],1, mean))
HC.mean["C6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_mineralizing.osteoblast")],1, mean))
HC.mean["C6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                                    "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                                    "H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                                    "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                                    "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                                    "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                                    "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                                    "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                                    "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                                    "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                                    "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                                    "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_preosteoblast,HC.mean$H1_osteoblast)                     #p
t.test(HC.mean$H1_osteoblast,HC.mean$H1_embedding.osteoblast)              #p
t.test(HC.mean$H1_embedding.osteoblast,HC.mean$H1_mineralizing.osteoblast) #p
t.test(HC.mean$H1_mineralizing.osteoblast,HC.mean$H1_maturing.osteocyte)   #p
t.test(HC.mean$H2_preosteoblast,HC.mean$H2_osteoblast)                     #p
t.test(HC.mean$H2_osteoblast,HC.mean$H2_embedding.osteoblast)              #p
t.test(HC.mean$H2_embedding.osteoblast,HC.mean$H2_mineralizing.osteoblast) #p
t.test(HC.mean$H2_mineralizing.osteoblast,HC.mean$H2_maturing.osteocyte)   #p
t.test(HC.mean$H3_preosteoblast,HC.mean$H3_osteoblast)                     #p
t.test(HC.mean$H3_osteoblast,HC.mean$H3_embedding.osteoblast)              #p
t.test(HC.mean$H3_embedding.osteoblast,HC.mean$H3_mineralizing.osteoblast) #p
t.test(HC.mean$H3_mineralizing.osteoblast,HC.mean$H3_maturing.osteocyte)   #p
t.test(HC.mean$H4_preosteoblast,HC.mean$H4_osteoblast)                     #p
t.test(HC.mean$H4_osteoblast,HC.mean$H4_embedding.osteoblast)              #p
t.test(HC.mean$H4_embedding.osteoblast,HC.mean$H4_mineralizing.osteoblast) #p
t.test(HC.mean$H4_mineralizing.osteoblast,HC.mean$H4_maturing.osteocyte)   #p
t.test(HC.mean$H5_preosteoblast,HC.mean$H5_osteoblast)                     #p
t.test(HC.mean$H5_osteoblast,HC.mean$H5_embedding.osteoblast)              #p
t.test(HC.mean$H5_embedding.osteoblast,HC.mean$H5_mineralizing.osteoblast) #p
t.test(HC.mean$H5_mineralizing.osteoblast,HC.mean$H5_maturing.osteocyte)   #p
t.test(HC.mean$H6_preosteoblast,HC.mean$H6_osteoblast)                     #p
t.test(HC.mean$H6_osteoblast,HC.mean$H6_embedding.osteoblast)              #p
t.test(HC.mean$H6_embedding.osteoblast,HC.mean$H6_mineralizing.osteoblast) #p
t.test(HC.mean$H6_mineralizing.osteoblast,HC.mean$H6_maturing.osteocyte)   #p
t.test(HC.mean$C1_preosteoblast,HC.mean$C1_osteoblast)                     #p
t.test(HC.mean$C1_osteoblast,HC.mean$C1_embedding.osteoblast)              #p
t.test(HC.mean$C1_embedding.osteoblast,HC.mean$C1_mineralizing.osteoblast) #p
t.test(HC.mean$C1_mineralizing.osteoblast,HC.mean$C1_maturing.osteocyte)   #p
t.test(HC.mean$C2_preosteoblast,HC.mean$C2_osteoblast)                     #p
t.test(HC.mean$C2_osteoblast,HC.mean$C2_embedding.osteoblast)              #p
t.test(HC.mean$C2_embedding.osteoblast,HC.mean$C2_mineralizing.osteoblast) #p
t.test(HC.mean$C2_mineralizing.osteoblast,HC.mean$C2_maturing.osteocyte)   #p
t.test(HC.mean$C3_preosteoblast,HC.mean$C3_osteoblast)                     #p
t.test(HC.mean$C3_osteoblast,HC.mean$C3_embedding.osteoblast)              #p
t.test(HC.mean$C3_embedding.osteoblast,HC.mean$C3_mineralizing.osteoblast) #p
t.test(HC.mean$C3_mineralizing.osteoblast,HC.mean$C3_maturing.osteocyte)   #p
t.test(HC.mean$C4_preosteoblast,HC.mean$C4_osteoblast)                     #p
t.test(HC.mean$C4_osteoblast,HC.mean$C4_embedding.osteoblast)              #p
t.test(HC.mean$C4_embedding.osteoblast,HC.mean$C4_mineralizing.osteoblast) #p
t.test(HC.mean$C4_mineralizing.osteoblast,HC.mean$C4_maturing.osteocyte)   #p
t.test(HC.mean$C5_preosteoblast,HC.mean$C5_osteoblast)                     #p
t.test(HC.mean$C5_osteoblast,HC.mean$C5_embedding.osteoblast)              #p
t.test(HC.mean$C5_embedding.osteoblast,HC.mean$C5_mineralizing.osteoblast) #p
t.test(HC.mean$C5_mineralizing.osteoblast,HC.mean$C5_maturing.osteocyte)   #p
t.test(HC.mean$C6_preosteoblast,HC.mean$C6_osteoblast)                     #p
t.test(HC.mean$C6_osteoblast,HC.mean$C6_embedding.osteoblast)              #p
t.test(HC.mean$C6_embedding.osteoblast,HC.mean$C6_mineralizing.osteoblast) #p
t.test(HC.mean$C6_mineralizing.osteoblast,HC.mean$C6_maturing.osteocyte)   #p

# Calculate log2cpm variances within species - variance increases in ost (expt H1), decreases in emb.ost (expt H2), decreases in min.ost (expt), and increases in mat.ost (expt)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_preosteoblast")],1, var))
HC.var["H1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_osteoblast")],1, var))
HC.var["H1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_embedding.osteoblast")],1, var))
HC.var["H1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_mineralizing.osteoblast")],1, var))
HC.var["H1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_maturing.osteocyte")],1, var))
HC.var["H2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_preosteoblast")],1, var))
HC.var["H2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_osteoblast")],1, var))
HC.var["H2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_embedding.osteoblast")],1, var))
HC.var["H2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_mineralizing.osteoblast")],1, var))
HC.var["H2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_maturing.osteocyte")],1, var))
#HC.var["H3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_preosteoblast")],1, var))
#HC.var["H3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_osteoblast")],1, var))
HC.var["H3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_embedding.osteoblast")],1, var))
HC.var["H3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_mineralizing.osteoblast")],1, var))
HC.var["H3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_maturing.osteocyte")],1, var))
HC.var["H4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_preosteoblast")],1, var))
HC.var["H4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_osteoblast")],1, var))
HC.var["H4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_embedding.osteoblast")],1, var))
HC.var["H4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_mineralizing.osteoblast")],1, var))
HC.var["H4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_maturing.osteocyte")],1, var))
HC.var["H5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_preosteoblast")],1, var))
HC.var["H5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_osteoblast")],1, var))
HC.var["H5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_embedding.osteoblast")],1, var))
HC.var["H5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_mineralizing.osteoblast")],1, var))
HC.var["H5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_maturing.osteocyte")],1, var))
HC.var["H6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_preosteoblast")],1, var))
HC.var["H6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_osteoblast")],1, var))
HC.var["H6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_embedding.osteoblast")],1, var))
HC.var["H6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_mineralizing.osteoblast")],1, var))
HC.var["H6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_maturing.osteocyte")],1, var))
HC.var["C1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_preosteoblast")],1, var))
HC.var["C1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_osteoblast")],1, var))
HC.var["C1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_embedding.osteoblast")],1, var))
HC.var["C1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_mineralizing.osteoblast")],1, var))
HC.var["C1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_maturing.osteocyte")],1, var))
HC.var["C2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_preosteoblast")],1, var))
HC.var["C2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_osteoblast")],1, var))
HC.var["C2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_embedding.osteoblast")],1, var))
HC.var["C2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_mineralizing.osteoblast")],1, var))
HC.var["C2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_maturing.osteocyte")],1, var))
HC.var["C3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_preosteoblast")],1, var))
HC.var["C3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_osteoblast")],1, var))
HC.var["C3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_embedding.osteoblast")],1, var))
HC.var["C3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_mineralizing.osteoblast")],1, var))
HC.var["C3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_maturing.osteocyte")],1, var))
HC.var["C4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_preosteoblast")],1, var))
HC.var["C4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_osteoblast")],1, var))
HC.var["C4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_embedding.osteoblast")],1, var))
HC.var["C4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_mineralizing.osteoblast")],1, var))
HC.var["C4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_maturing.osteocyte")],1, var))
HC.var["C5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_preosteoblast")],1, var))
HC.var["C5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_osteoblast")],1, var))
HC.var["C5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_embedding.osteoblast")],1, var))
HC.var["C5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_mineralizing.osteoblast")],1, var))
HC.var["C5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_maturing.osteocyte")],1, var))
HC.var["C6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_preosteoblast")],1, var))
HC.var["C6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_osteoblast")],1, var))
HC.var["C6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_embedding.osteoblast")],1, var))
HC.var["C6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_mineralizing.osteoblast")],1, var))
HC.var["C6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                                    "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                                    "H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                                    "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                                    "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                                    "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                                    "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                                    "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                                    "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                                    "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                                    "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                                    "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_preosteoblast,HC.var$H1_osteoblast)                     #p=0.10040
t.test(HC.var$H1_osteoblast,HC.var$H1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1_embedding.osteoblast,HC.var$H1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H1_mineralizing.osteoblast,HC.var$H1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H2_preosteoblast,HC.var$H2_osteoblast)                     #p=0.00037
t.test(HC.var$H2_osteoblast,HC.var$H2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H2_embedding.osteoblast,HC.var$H2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H2_mineralizing.osteoblast,HC.var$H2_maturing.osteocyte)   #p<2.2e-16
#t.test(HC.var$H3_preosteoblast,HC.var$H3_osteoblast)                     #p
#t.test(HC.var$H3_osteoblast,HC.var$H3_embedding.osteoblast)              #p
t.test(HC.var$H3_embedding.osteoblast,HC.var$H3_mineralizing.osteoblast) #p=0.20040
t.test(HC.var$H3_mineralizing.osteoblast,HC.var$H3_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H4_preosteoblast,HC.var$H4_osteoblast)                     #p<2.2e-16
t.test(HC.var$H4_osteoblast,HC.var$H4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H4_embedding.osteoblast,HC.var$H4_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H4_mineralizing.osteoblast,HC.var$H4_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H5_preosteoblast,HC.var$H5_osteoblast)                     #p<2.2e-16
t.test(HC.var$H5_osteoblast,HC.var$H5_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H5_embedding.osteoblast,HC.var$H5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H5_mineralizing.osteoblast,HC.var$H5_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H6_preosteoblast,HC.var$H6_osteoblast)                     #p=3.0e-10
t.test(HC.var$H6_osteoblast,HC.var$H6_embedding.osteoblast)              #p=6.9e-05
t.test(HC.var$H6_embedding.osteoblast,HC.var$H6_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H6_mineralizing.osteoblast,HC.var$H6_maturing.osteocyte)   #p=0.32550
t.test(HC.var$C1_preosteoblast,HC.var$C1_osteoblast)                     #p=2.0e-07
t.test(HC.var$C1_osteoblast,HC.var$C1_embedding.osteoblast)              #p=2.0e-05
t.test(HC.var$C1_embedding.osteoblast,HC.var$C1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C1_mineralizing.osteoblast,HC.var$C1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C2_preosteoblast,HC.var$C2_osteoblast)                     #p=2.0e-09
t.test(HC.var$C2_osteoblast,HC.var$C2_embedding.osteoblast)              #p=0.10730
t.test(HC.var$C2_embedding.osteoblast,HC.var$C2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C2_mineralizing.osteoblast,HC.var$C2_maturing.osteocyte)   #p=0.74010
t.test(HC.var$C3_preosteoblast,HC.var$C3_osteoblast)                     #p<2.2e-16
t.test(HC.var$C3_osteoblast,HC.var$C3_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C3_embedding.osteoblast,HC.var$C3_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C3_mineralizing.osteoblast,HC.var$C3_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C4_preosteoblast,HC.var$C4_osteoblast)                     #p=0.00017
t.test(HC.var$C4_osteoblast,HC.var$C4_embedding.osteoblast)              #p=0.10910
t.test(HC.var$C4_embedding.osteoblast,HC.var$C4_mineralizing.osteoblast) #p=2.2e-11
t.test(HC.var$C4_mineralizing.osteoblast,HC.var$C4_maturing.osteocyte)   #p=0.02783
t.test(HC.var$C5_preosteoblast,HC.var$C5_osteoblast)                     #p=0.92800
t.test(HC.var$C5_osteoblast,HC.var$C5_embedding.osteoblast)              #p=0.43890
t.test(HC.var$C5_embedding.osteoblast,HC.var$C5_mineralizing.osteoblast) #p=1.6e-08
t.test(HC.var$C5_mineralizing.osteoblast,HC.var$C5_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C6_preosteoblast,HC.var$C6_osteoblast)                     #p=2.6e-07
t.test(HC.var$C6_osteoblast,HC.var$C6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C6_embedding.osteoblast,HC.var$C6_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C6_mineralizing.osteoblast,HC.var$C6_maturing.osteocyte)   #p<2.2e-16

```

### TO EDIT
### SC: Osteogenic Ad Hoc Classifications vs. Individual.Replicates (thresh0)

```{r}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,sapply(dge$samples$OstAdHoc.Assign.5gene.median,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                               "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                               "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                               "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                               "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                               "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                               "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                               "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                               "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                               "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                               "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                               "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                               "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                               "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))

# Calculate log2cpm means within individuals - decreases in ost (expt H5.1,C1.2,C2.1,C3.1,C4.1), decreases in emb.ost (expt H1.1,H3.1,C6.1), decreases in min.ost (expt H6.1,C1.1,C1.2,C3.1,C4.1,C5.1), and increases in mat.ost (expt H1.1,H3.1,H4.1,H5.1,C1.1,C3.1,C4.1,C5.1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_preosteoblast")],1, mean))
HC.mean["H1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_osteoblast")],1, mean))
HC.mean["H1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_embedding.osteoblast")],1, mean))
HC.mean["H1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_mineralizing.osteoblast")],1, mean))
HC.mean["H1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_maturing.osteocyte")],1, mean))
HC.mean["H1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_preosteoblast")],1, mean))
HC.mean["H1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_osteoblast")],1, mean))
HC.mean["H1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_embedding.osteoblast")],1, mean))
HC.mean["H1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_mineralizing.osteoblast")],1, mean))
HC.mean["H1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_maturing.osteocyte")],1, mean))
HC.mean["H2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_preosteoblast")],1, mean))
HC.mean["H2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_osteoblast")],1, mean))
HC.mean["H2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_embedding.osteoblast")],1, mean))
HC.mean["H2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_mineralizing.osteoblast")],1, mean))
HC.mean["H2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_maturing.osteocyte")],1, mean))
HC.mean["H3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_preosteoblast")],1, mean))
HC.mean["H3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_osteoblast")],1, mean))
HC.mean["H3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_embedding.osteoblast")],1, mean))
HC.mean["H3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_mineralizing.osteoblast")],1, mean))
HC.mean["H3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_maturing.osteocyte")],1, mean))
HC.mean["H4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_preosteoblast")],1, mean))
HC.mean["H4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_osteoblast")],1, mean))
HC.mean["H4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_embedding.osteoblast")],1, mean))
HC.mean["H4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_mineralizing.osteoblast")],1, mean))
HC.mean["H4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_maturing.osteocyte")],1, mean))
HC.mean["H5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_preosteoblast")],1, mean))
HC.mean["H5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_osteoblast")],1, mean))
HC.mean["H5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_embedding.osteoblast")],1, mean))
HC.mean["H5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_mineralizing.osteoblast")],1, mean))
HC.mean["H5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_maturing.osteocyte")],1, mean))
HC.mean["H6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_preosteoblast")],1, mean))
HC.mean["H6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_osteoblast")],1, mean))
HC.mean["H6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_embedding.osteoblast")],1, mean))
HC.mean["H6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_mineralizing.osteoblast")],1, mean))
HC.mean["H6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_maturing.osteocyte")],1, mean))
HC.mean["C1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_preosteoblast")],1, mean))
HC.mean["C1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_osteoblast")],1, mean))
HC.mean["C1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_embedding.osteoblast")],1, mean))
HC.mean["C1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_mineralizing.osteoblast")],1, mean))
HC.mean["C1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_maturing.osteocyte")],1, mean))
HC.mean["C1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_preosteoblast")],1, mean))
HC.mean["C1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_osteoblast")],1, mean))
HC.mean["C1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_embedding.osteoblast")],1, mean))
HC.mean["C1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_mineralizing.osteoblast")],1, mean))
HC.mean["C1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_maturing.osteocyte")],1, mean))
HC.mean["C2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_preosteoblast")],1, mean))
HC.mean["C2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_osteoblast")],1, mean))
HC.mean["C2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_embedding.osteoblast")],1, mean))
HC.mean["C2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_mineralizing.osteoblast")],1, mean))
HC.mean["C2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_maturing.osteocyte")],1, mean))
HC.mean["C3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_preosteoblast")],1, mean))
HC.mean["C3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_osteoblast")],1, mean))
HC.mean["C3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_embedding.osteoblast")],1, mean))
HC.mean["C3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_mineralizing.osteoblast")],1, mean))
HC.mean["C3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_maturing.osteocyte")],1, mean))
HC.mean["C4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_preosteoblast")],1, mean))
HC.mean["C4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_osteoblast")],1, mean))
HC.mean["C4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_embedding.osteoblast")],1, mean))
HC.mean["C4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_mineralizing.osteoblast")],1, mean))
HC.mean["C4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_maturing.osteocyte")],1, mean))
HC.mean["C5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_preosteoblast")],1, mean))
HC.mean["C5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_osteoblast")],1, mean))
HC.mean["C5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_embedding.osteoblast")],1, mean))
HC.mean["C5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_mineralizing.osteoblast")],1, mean))
HC.mean["C5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_maturing.osteocyte")],1, mean))
HC.mean["C6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_preosteoblast")],1, mean))
HC.mean["C6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_osteoblast")],1, mean))
HC.mean["C6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_embedding.osteoblast")],1, mean))
HC.mean["C6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_mineralizing.osteoblast")],1, mean))
HC.mean["C6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                                    "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                                    "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                                    "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                                    "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                                    "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                                    "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                                    "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                                    "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                                    "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                                    "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                                    "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                                    "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                                    "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_preosteoblast,HC.mean$H1.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H1.1_osteoblast,HC.mean$H1.1_embedding.osteoblast)              #p=3.9e-11
t.test(HC.mean$H1.1_embedding.osteoblast,HC.mean$H1.1_mineralizing.osteoblast) #p=2.6e-10
t.test(HC.mean$H1.1_mineralizing.osteoblast,HC.mean$H1.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H1.2_preosteoblast,HC.mean$H1.2_osteoblast)                     #p=1.5e-13
t.test(HC.mean$H1.2_osteoblast,HC.mean$H1.2_embedding.osteoblast)              #p=8.2e-12
t.test(HC.mean$H1.2_embedding.osteoblast,HC.mean$H1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$H1.2_mineralizing.osteoblast,HC.mean$H1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H2.1_preosteoblast,HC.mean$H2.1_osteoblast)                     #p=6.9e-11
t.test(HC.mean$H2.1_osteoblast,HC.mean$H2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H2.1_embedding.osteoblast,HC.mean$H2.1_mineralizing.osteoblast) #p=0.03296
t.test(HC.mean$H2.1_mineralizing.osteoblast,HC.mean$H2.1_maturing.osteocyte)   #p=0.71240
t.test(HC.mean$H3.1_preosteoblast,HC.mean$H3.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H3.1_osteoblast,HC.mean$H3.1_embedding.osteoblast)              #p=1.5e-07
t.test(HC.mean$H3.1_embedding.osteoblast,HC.mean$H3.1_mineralizing.osteoblast) #p=2.3e-05
t.test(HC.mean$H3.1_mineralizing.osteoblast,HC.mean$H3.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H4.1_preosteoblast,HC.mean$H4.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H4.1_osteoblast,HC.mean$H4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H4.1_embedding.osteoblast,HC.mean$H4.1_mineralizing.osteoblast) #p=2.2e-13
t.test(HC.mean$H4.1_mineralizing.osteoblast,HC.mean$H4.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H5.1_preosteoblast,HC.mean$H5.1_osteoblast)                     #p=3.3e-07
t.test(HC.mean$H5.1_osteoblast,HC.mean$H5.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H5.1_embedding.osteoblast,HC.mean$H5.1_mineralizing.osteoblast) #p=0.02699
t.test(HC.mean$H5.1_mineralizing.osteoblast,HC.mean$H5.1_maturing.osteocyte)   #p=2.6e-08
t.test(HC.mean$H6.1_preosteoblast,HC.mean$H6.1_osteoblast)                     #p=8.8e-09
t.test(HC.mean$H6.1_osteoblast,HC.mean$H6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H6.1_embedding.osteoblast,HC.mean$H6.1_mineralizing.osteoblast) #p=0.37260
t.test(HC.mean$H6.1_mineralizing.osteoblast,HC.mean$H6.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C1.1_preosteoblast,HC.mean$C1.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C1.1_osteoblast,HC.mean$C1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1.1_embedding.osteoblast,HC.mean$C1.1_mineralizing.osteoblast) #p=0.08749
t.test(HC.mean$C1.1_mineralizing.osteoblast,HC.mean$C1.1_maturing.osteocyte)   #p<2.2e-16
#t.test(HC.mean$C1.2_preosteoblast,HC.mean$C1.2_osteoblast)                     #p=NA
t.test(HC.mean$C1.2_osteoblast,HC.mean$C1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1.2_embedding.osteoblast,HC.mean$C1.2_mineralizing.osteoblast) #p=6.0e-13
t.test(HC.mean$C1.2_mineralizing.osteoblast,HC.mean$C1.2_maturing.osteocyte)   #p=6.4e-05
t.test(HC.mean$C2.1_preosteoblast,HC.mean$C2.1_osteoblast)                     #p=6.9e-08
t.test(HC.mean$C2.1_osteoblast,HC.mean$C2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C2.1_embedding.osteoblast,HC.mean$C2.1_mineralizing.osteoblast) #p=0.00507
t.test(HC.mean$C2.1_mineralizing.osteoblast,HC.mean$C2.1_maturing.osteocyte)   #p=0.00653
t.test(HC.mean$C3.1_preosteoblast,HC.mean$C3.1_osteoblast)                     #p=6.2e-07
t.test(HC.mean$C3.1_osteoblast,HC.mean$C3.1_embedding.osteoblast)              #p=2.7e-11
t.test(HC.mean$C3.1_embedding.osteoblast,HC.mean$C3.1_mineralizing.osteoblast) #p=9.8e-11
t.test(HC.mean$C3.1_mineralizing.osteoblast,HC.mean$C3.1_maturing.osteocyte)   #p=0.24900
t.test(HC.mean$C4.1_preosteoblast,HC.mean$C4.1_osteoblast)                     #p=0.79680
t.test(HC.mean$C4.1_osteoblast,HC.mean$C4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C4.1_embedding.osteoblast,HC.mean$C4.1_mineralizing.osteoblast) #p=3.5e-06
t.test(HC.mean$C4.1_mineralizing.osteoblast,HC.mean$C4.1_maturing.osteocyte)   #p=0.18870
t.test(HC.mean$C5.1_preosteoblast,HC.mean$C5.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C5.1_osteoblast,HC.mean$C5.1_embedding.osteoblast)              #p=4.2e-14
t.test(HC.mean$C5.1_embedding.osteoblast,HC.mean$C5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C5.1_mineralizing.osteoblast,HC.mean$C5.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C6.1_preosteoblast,HC.mean$C6.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C6.1_osteoblast,HC.mean$C6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C6.1_embedding.osteoblast,HC.mean$C6.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C6.1_mineralizing.osteoblast,HC.mean$C6.1_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in ost (expt H5.1,C2.1,C3.1,C4.1), increases in emb.ost (expt H1.1,H3.1), decreases in min.ost (expt H1.1,H1.2,H2.1,C6.1), and decreases in mat.ost (expt H5.1,C4.1,C5.1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_preosteoblast")],1, var))
HC.var["H1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_osteoblast")],1, var))
HC.var["H1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_embedding.osteoblast")],1, var))
HC.var["H1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_mineralizing.osteoblast")],1, var))
HC.var["H1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_maturing.osteocyte")],1, var))
HC.var["H1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_preosteoblast")],1, var))
HC.var["H1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_osteoblast")],1, var))
HC.var["H1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_embedding.osteoblast")],1, var))
HC.var["H1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_mineralizing.osteoblast")],1, var))
HC.var["H1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_maturing.osteocyte")],1, var))
HC.var["H2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_preosteoblast")],1, var))
HC.var["H2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_osteoblast")],1, var))
HC.var["H2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_embedding.osteoblast")],1, var))
HC.var["H2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_mineralizing.osteoblast")],1, var))
HC.var["H2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_maturing.osteocyte")],1, var))
HC.var["H3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_preosteoblast")],1, var))
HC.var["H3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_osteoblast")],1, var))
HC.var["H3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_embedding.osteoblast")],1, var))
HC.var["H3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_mineralizing.osteoblast")],1, var))
HC.var["H3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_maturing.osteocyte")],1, var))
HC.var["H4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_preosteoblast")],1, var))
HC.var["H4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_osteoblast")],1, var))
HC.var["H4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_embedding.osteoblast")],1, var))
HC.var["H4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_mineralizing.osteoblast")],1, var))
HC.var["H4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_maturing.osteocyte")],1, var))
HC.var["H5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_preosteoblast")],1, var))
HC.var["H5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_osteoblast")],1, var))
HC.var["H5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_embedding.osteoblast")],1, var))
HC.var["H5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_mineralizing.osteoblast")],1, var))
HC.var["H5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_maturing.osteocyte")],1, var))
HC.var["H6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_preosteoblast")],1, var))
HC.var["H6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_osteoblast")],1, var))
HC.var["H6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_embedding.osteoblast")],1, var))
HC.var["H6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_mineralizing.osteoblast")],1, var))
HC.var["H6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_maturing.osteocyte")],1, var))
HC.var["C1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_preosteoblast")],1, var))
HC.var["C1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_osteoblast")],1, var))
HC.var["C1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_embedding.osteoblast")],1, var))
HC.var["C1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_mineralizing.osteoblast")],1, var))
HC.var["C1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_maturing.osteocyte")],1, var))
HC.var["C1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_preosteoblast")],1, var))
HC.var["C1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_osteoblast")],1, var))
HC.var["C1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_embedding.osteoblast")],1, var))
HC.var["C1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_mineralizing.osteoblast")],1, var))
HC.var["C1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_maturing.osteocyte")],1, var))
HC.var["C2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_preosteoblast")],1, var))
HC.var["C2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_osteoblast")],1, var))
HC.var["C2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_embedding.osteoblast")],1, var))
HC.var["C2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_mineralizing.osteoblast")],1, var))
HC.var["C2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_maturing.osteocyte")],1, var))
HC.var["C3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_preosteoblast")],1, var))
HC.var["C3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_osteoblast")],1, var))
HC.var["C3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_embedding.osteoblast")],1, var))
HC.var["C3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_mineralizing.osteoblast")],1, var))
HC.var["C3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_maturing.osteocyte")],1, var))
HC.var["C4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_preosteoblast")],1, var))
HC.var["C4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_osteoblast")],1, var))
HC.var["C4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_embedding.osteoblast")],1, var))
HC.var["C4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_mineralizing.osteoblast")],1, var))
HC.var["C4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_maturing.osteocyte")],1, var))
HC.var["C5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_preosteoblast")],1, var))
HC.var["C5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_osteoblast")],1, var))
HC.var["C5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_embedding.osteoblast")],1, var))
HC.var["C5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_mineralizing.osteoblast")],1, var))
HC.var["C5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_maturing.osteocyte")],1, var))
HC.var["C6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_preosteoblast")],1, var))
HC.var["C6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_osteoblast")],1, var))
HC.var["C6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_embedding.osteoblast")],1, var))
HC.var["C6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_mineralizing.osteoblast")],1, var))
HC.var["C6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                                    "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                                    "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                                    "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                                    "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                                    "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                                    "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                                    "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                                    "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                                    "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                                    "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                                    "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                                    "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                                    "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_preosteoblast,HC.var$H1.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1.1_osteoblast,HC.var$H1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1.1_embedding.osteoblast,HC.var$H1.1_mineralizing.osteoblast) #p=0.26460
t.test(HC.var$H1.1_mineralizing.osteoblast,HC.var$H1.1_maturing.osteocyte)   #p=7.7e-06
t.test(HC.var$H1.2_preosteoblast,HC.var$H1.2_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1.2_osteoblast,HC.var$H1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1.2_embedding.osteoblast,HC.var$H1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H1.2_mineralizing.osteoblast,HC.var$H1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H2.1_preosteoblast,HC.var$H2.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H2.1_osteoblast,HC.var$H2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H2.1_embedding.osteoblast,HC.var$H2.1_mineralizing.osteoblast) #p=0.33970
t.test(HC.var$H2.1_mineralizing.osteoblast,HC.var$H2.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H3.1_preosteoblast,HC.var$H3.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H3.1_osteoblast,HC.var$H3.1_embedding.osteoblast)              #p=0.11930
t.test(HC.var$H3.1_embedding.osteoblast,HC.var$H3.1_mineralizing.osteoblast) #p=5.7e-06
t.test(HC.var$H3.1_mineralizing.osteoblast,HC.var$H3.1_maturing.osteocyte)   #p=1.9e-12
t.test(HC.var$H4.1_preosteoblast,HC.var$H4.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H4.1_osteoblast,HC.var$H4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H4.1_embedding.osteoblast,HC.var$H4.1_mineralizing.osteoblast) #p=0.01404
t.test(HC.var$H4.1_mineralizing.osteoblast,HC.var$H4.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H5.1_preosteoblast,HC.var$H5.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H5.1_osteoblast,HC.var$H5.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H5.1_embedding.osteoblast,HC.var$H5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H5.1_mineralizing.osteoblast,HC.var$H5.1_maturing.osteocyte)   #p=0.28510
t.test(HC.var$H6.1_preosteoblast,HC.var$H6.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H6.1_osteoblast,HC.var$H6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H6.1_embedding.osteoblast,HC.var$H6.1_mineralizing.osteoblast) #p=1.6e-10
t.test(HC.var$H6.1_mineralizing.osteoblast,HC.var$H6.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C1.1_preosteoblast,HC.var$C1.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C1.1_osteoblast,HC.var$C1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1.1_embedding.osteoblast,HC.var$C1.1_mineralizing.osteoblast) #p=1.9e-06
t.test(HC.var$C1.1_mineralizing.osteoblast,HC.var$C1.1_maturing.osteocyte)   #p<2.8e-16
#t.test(HC.var$C1.2_preosteoblast,HC.var$C1.2_osteoblast)                     #p=NA
t.test(HC.var$C1.2_osteoblast,HC.var$C1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1.2_embedding.osteoblast,HC.var$C1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C1.2_mineralizing.osteoblast,HC.var$C1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C2.1_preosteoblast,HC.var$C2.1_osteoblast)                     #p=0.70000
t.test(HC.var$C2.1_osteoblast,HC.var$C2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C2.1_embedding.osteoblast,HC.var$C2.1_mineralizing.osteoblast) #p=0.00039
t.test(HC.var$C2.1_mineralizing.osteoblast,HC.var$C2.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C3.1_preosteoblast,HC.var$C3.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C3.1_osteoblast,HC.var$C3.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C3.1_embedding.osteoblast,HC.var$C3.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C3.1_mineralizing.osteoblast,HC.var$C3.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C4.1_preosteoblast,HC.var$C4.1_osteoblast)                     #p=0.25910
t.test(HC.var$C4.1_osteoblast,HC.var$C4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C4.1_embedding.osteoblast,HC.var$C4.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C4.1_mineralizing.osteoblast,HC.var$C4.1_maturing.osteocyte)   #p=0.98870
t.test(HC.var$C5.1_preosteoblast,HC.var$C5.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C5.1_osteoblast,HC.var$C5.1_embedding.osteoblast)              #p=1.2e-10
t.test(HC.var$C5.1_embedding.osteoblast,HC.var$C5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C5.1_mineralizing.osteoblast,HC.var$C5.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C6.1_preosteoblast,HC.var$C6.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C6.1_osteoblast,HC.var$C6.1_embedding.osteoblast)              #p=1.2e-05
t.test(HC.var$C6.1_embedding.osteoblast,HC.var$C6.1_mineralizing.osteoblast) #p=9.6e-05
t.test(HC.var$C6.1_mineralizing.osteoblast,HC.var$C6.1_maturing.osteocyte)   #p<2.2e-16

```

### SC: Osteogenic Ad Hoc Classifications vs. Species (median)

```{r, eval=FALSE}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,sapply(dge$samples$OstAdHoc.Assign.5gene.median,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean decreases in osteoblasts, decreases in emb.osteoblasts (expt C), decreases in min.osteoblasts (expt C), and increases in mat.osteocytes (expt C)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p=2.9e-15
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p=2.7e-11
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=1.3e-07
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p=0.03818
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p=0.08910
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p=0.97890
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p=0.25630

# Calculate log2cpm variances within species - variance increases in osteoblasts, increases in emb.osteoblasts, decreases in min.osteoblasts, and decreases in mat.osteocytes
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p<2.2e-16
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p=0.00027
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p=1.3e-15
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=3.2e-10
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p=1.3e-09

```

### SC: Osteogenic Ad Hoc Classifications vs. Individuals (median)

```{r, eval=FALSE}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,sapply(dge$samples$OstAdHoc.Assign.5gene.median,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                               "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                               "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                               "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                               "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                               "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                               "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                               "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                               "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                               "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                               "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                               "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))

# Calculate log2cpm means within individuals - decreases in ost (expt H5,C2,C3,C4), decreases in emb.ost (expt H1,H3,C6), decreases in min.ost (expt H6,C3,C4,C5), and increases in mat.ost (expt H1,H3,H4,H5,C1,C3,C4,C5)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_preosteoblast")],1, mean))
HC.mean["H1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_osteoblast")],1, mean))
HC.mean["H1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_embedding.osteoblast")],1, mean))
HC.mean["H1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_mineralizing.osteoblast")],1, mean))
HC.mean["H1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_maturing.osteocyte")],1, mean))
HC.mean["H2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_preosteoblast")],1, mean))
HC.mean["H2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_osteoblast")],1, mean))
HC.mean["H2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_embedding.osteoblast")],1, mean))
HC.mean["H2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_mineralizing.osteoblast")],1, mean))
HC.mean["H2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_maturing.osteocyte")],1, mean))
HC.mean["H3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_preosteoblast")],1, mean))
HC.mean["H3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_osteoblast")],1, mean))
HC.mean["H3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_embedding.osteoblast")],1, mean))
HC.mean["H3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_mineralizing.osteoblast")],1, mean))
HC.mean["H3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_maturing.osteocyte")],1, mean))
HC.mean["H4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_preosteoblast")],1, mean))
HC.mean["H4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_osteoblast")],1, mean))
HC.mean["H4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_embedding.osteoblast")],1, mean))
HC.mean["H4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_mineralizing.osteoblast")],1, mean))
HC.mean["H4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_maturing.osteocyte")],1, mean))
HC.mean["H5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_preosteoblast")],1, mean))
HC.mean["H5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_osteoblast")],1, mean))
HC.mean["H5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_embedding.osteoblast")],1, mean))
HC.mean["H5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_mineralizing.osteoblast")],1, mean))
HC.mean["H5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_maturing.osteocyte")],1, mean))
HC.mean["H6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_preosteoblast")],1, mean))
HC.mean["H6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_osteoblast")],1, mean))
HC.mean["H6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_embedding.osteoblast")],1, mean))
HC.mean["H6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_mineralizing.osteoblast")],1, mean))
HC.mean["H6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_maturing.osteocyte")],1, mean))
HC.mean["C1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_preosteoblast")],1, mean))
HC.mean["C1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_osteoblast")],1, mean))
HC.mean["C1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_embedding.osteoblast")],1, mean))
HC.mean["C1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_mineralizing.osteoblast")],1, mean))
HC.mean["C1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_maturing.osteocyte")],1, mean))
HC.mean["C2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_preosteoblast")],1, mean))
HC.mean["C2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_osteoblast")],1, mean))
HC.mean["C2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_embedding.osteoblast")],1, mean))
HC.mean["C2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_mineralizing.osteoblast")],1, mean))
HC.mean["C2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_maturing.osteocyte")],1, mean))
HC.mean["C3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_preosteoblast")],1, mean))
HC.mean["C3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_osteoblast")],1, mean))
HC.mean["C3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_embedding.osteoblast")],1, mean))
HC.mean["C3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_mineralizing.osteoblast")],1, mean))
HC.mean["C3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_maturing.osteocyte")],1, mean))
HC.mean["C4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_preosteoblast")],1, mean))
HC.mean["C4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_osteoblast")],1, mean))
HC.mean["C4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_embedding.osteoblast")],1, mean))
HC.mean["C4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_mineralizing.osteoblast")],1, mean))
HC.mean["C4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_maturing.osteocyte")],1, mean))
HC.mean["C5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_preosteoblast")],1, mean))
HC.mean["C5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_osteoblast")],1, mean))
HC.mean["C5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_embedding.osteoblast")],1, mean))
HC.mean["C5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_mineralizing.osteoblast")],1, mean))
HC.mean["C5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_maturing.osteocyte")],1, mean))
HC.mean["C6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_preosteoblast")],1, mean))
HC.mean["C6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_osteoblast")],1, mean))
HC.mean["C6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_embedding.osteoblast")],1, mean))
HC.mean["C6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_mineralizing.osteoblast")],1, mean))
HC.mean["C6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                                    "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                                    "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                                    "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                                    "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                                    "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                                    "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                                    "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                                    "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                                    "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                                    "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                                    "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_preosteoblast,HC.mean$H1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H1_osteoblast,HC.mean$H1_embedding.osteoblast)              #p=0.01418
t.test(HC.mean$H1_embedding.osteoblast,HC.mean$H1_mineralizing.osteoblast) #p=7.4e-15
t.test(HC.mean$H1_mineralizing.osteoblast,HC.mean$H1_maturing.osteocyte)   #p=0.36460
t.test(HC.mean$H2_preosteoblast,HC.mean$H2_osteoblast)                     #p=6.9e-11
t.test(HC.mean$H2_osteoblast,HC.mean$H2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H2_embedding.osteoblast,HC.mean$H2_mineralizing.osteoblast) #p=0.03296
t.test(HC.mean$H2_mineralizing.osteoblast,HC.mean$H2_maturing.osteocyte)   #p=0.71240
t.test(HC.mean$H3_preosteoblast,HC.mean$H3_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H3_osteoblast,HC.mean$H3_embedding.osteoblast)              #p=1.5e-07
t.test(HC.mean$H3_embedding.osteoblast,HC.mean$H3_mineralizing.osteoblast) #p=2.3e-05
t.test(HC.mean$H3_mineralizing.osteoblast,HC.mean$H3_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H4_preosteoblast,HC.mean$H4_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H4_osteoblast,HC.mean$H4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H4_embedding.osteoblast,HC.mean$H4_mineralizing.osteoblast) #p=2.2e-13
t.test(HC.mean$H4_mineralizing.osteoblast,HC.mean$H4_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H5_preosteoblast,HC.mean$H5_osteoblast)                     #p=3.3e-07
t.test(HC.mean$H5_osteoblast,HC.mean$H5_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H5_embedding.osteoblast,HC.mean$H5_mineralizing.osteoblast) #p=0.02699
t.test(HC.mean$H5_mineralizing.osteoblast,HC.mean$H5_maturing.osteocyte)   #p=2.6e-08
t.test(HC.mean$H6_preosteoblast,HC.mean$H6_osteoblast)                     #p=8.8e-09
t.test(HC.mean$H6_osteoblast,HC.mean$H6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H6_embedding.osteoblast,HC.mean$H6_mineralizing.osteoblast) #p=0.37260
t.test(HC.mean$H6_mineralizing.osteoblast,HC.mean$H6_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C1_preosteoblast,HC.mean$C1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C1_osteoblast,HC.mean$C1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1_embedding.osteoblast,HC.mean$C1_mineralizing.osteoblast) #p=0.02954
t.test(HC.mean$C1_mineralizing.osteoblast,HC.mean$C1_maturing.osteocyte)   #p=6.2e-05
t.test(HC.mean$C2_preosteoblast,HC.mean$C2_osteoblast)                     #p=6.9e-08
t.test(HC.mean$C2_osteoblast,HC.mean$C2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C2_embedding.osteoblast,HC.mean$C2_mineralizing.osteoblast) #p=0.00507
t.test(HC.mean$C2_mineralizing.osteoblast,HC.mean$C2_maturing.osteocyte)   #p=0.00653
t.test(HC.mean$C3_preosteoblast,HC.mean$C3_osteoblast)                     #p=6.2e-07
t.test(HC.mean$C3_osteoblast,HC.mean$C3_embedding.osteoblast)              #p=2.7e-11
t.test(HC.mean$C3_embedding.osteoblast,HC.mean$C3_mineralizing.osteoblast) #p=9.8e-11
t.test(HC.mean$C3_mineralizing.osteoblast,HC.mean$C3_maturing.osteocyte)   #p=0.24900
t.test(HC.mean$C4_preosteoblast,HC.mean$C4_osteoblast)                     #p=0.79680
t.test(HC.mean$C4_osteoblast,HC.mean$C4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C4_embedding.osteoblast,HC.mean$C4_mineralizing.osteoblast) #p=3.5e-06
t.test(HC.mean$C4_mineralizing.osteoblast,HC.mean$C4_maturing.osteocyte)   #p=0.18870
t.test(HC.mean$C5_preosteoblast,HC.mean$C5_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C5_osteoblast,HC.mean$C5_embedding.osteoblast)              #p=4.2e-14
t.test(HC.mean$C5_embedding.osteoblast,HC.mean$C5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C5_mineralizing.osteoblast,HC.mean$C5_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C6_preosteoblast,HC.mean$C6_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C6_osteoblast,HC.mean$C6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C6_embedding.osteoblast,HC.mean$C6_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C6_mineralizing.osteoblast,HC.mean$C6_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in ost (expt H5,C2,C3,C4), increases in emb.ost (expt H1,H3), decreases in min.ost (expt H1,H2,C6), and decreases in mat.ost (expt H5,C4,C5)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_preosteoblast")],1, var))
HC.var["H1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_osteoblast")],1, var))
HC.var["H1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_embedding.osteoblast")],1, var))
HC.var["H1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_mineralizing.osteoblast")],1, var))
HC.var["H1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_maturing.osteocyte")],1, var))
HC.var["H2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_preosteoblast")],1, var))
HC.var["H2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_osteoblast")],1, var))
HC.var["H2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_embedding.osteoblast")],1, var))
HC.var["H2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_mineralizing.osteoblast")],1, var))
HC.var["H2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_maturing.osteocyte")],1, var))
HC.var["H3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_preosteoblast")],1, var))
HC.var["H3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_osteoblast")],1, var))
HC.var["H3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_embedding.osteoblast")],1, var))
HC.var["H3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_mineralizing.osteoblast")],1, var))
HC.var["H3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_maturing.osteocyte")],1, var))
HC.var["H4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_preosteoblast")],1, var))
HC.var["H4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_osteoblast")],1, var))
HC.var["H4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_embedding.osteoblast")],1, var))
HC.var["H4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_mineralizing.osteoblast")],1, var))
HC.var["H4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_maturing.osteocyte")],1, var))
HC.var["H5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_preosteoblast")],1, var))
HC.var["H5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_osteoblast")],1, var))
HC.var["H5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_embedding.osteoblast")],1, var))
HC.var["H5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_mineralizing.osteoblast")],1, var))
HC.var["H5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_maturing.osteocyte")],1, var))
HC.var["H6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_preosteoblast")],1, var))
HC.var["H6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_osteoblast")],1, var))
HC.var["H6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_embedding.osteoblast")],1, var))
HC.var["H6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_mineralizing.osteoblast")],1, var))
HC.var["H6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_maturing.osteocyte")],1, var))
HC.var["C1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_preosteoblast")],1, var))
HC.var["C1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_osteoblast")],1, var))
HC.var["C1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_embedding.osteoblast")],1, var))
HC.var["C1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_mineralizing.osteoblast")],1, var))
HC.var["C1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_maturing.osteocyte")],1, var))
HC.var["C2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_preosteoblast")],1, var))
HC.var["C2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_osteoblast")],1, var))
HC.var["C2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_embedding.osteoblast")],1, var))
HC.var["C2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_mineralizing.osteoblast")],1, var))
HC.var["C2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_maturing.osteocyte")],1, var))
HC.var["C3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_preosteoblast")],1, var))
HC.var["C3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_osteoblast")],1, var))
HC.var["C3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_embedding.osteoblast")],1, var))
HC.var["C3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_mineralizing.osteoblast")],1, var))
HC.var["C3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_maturing.osteocyte")],1, var))
HC.var["C4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_preosteoblast")],1, var))
HC.var["C4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_osteoblast")],1, var))
HC.var["C4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_embedding.osteoblast")],1, var))
HC.var["C4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_mineralizing.osteoblast")],1, var))
HC.var["C4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_maturing.osteocyte")],1, var))
HC.var["C5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_preosteoblast")],1, var))
HC.var["C5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_osteoblast")],1, var))
HC.var["C5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_embedding.osteoblast")],1, var))
HC.var["C5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_mineralizing.osteoblast")],1, var))
HC.var["C5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_maturing.osteocyte")],1, var))
HC.var["C6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_preosteoblast")],1, var))
HC.var["C6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_osteoblast")],1, var))
HC.var["C6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_embedding.osteoblast")],1, var))
HC.var["C6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_mineralizing.osteoblast")],1, var))
HC.var["C6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                                    "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                                    "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                                    "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                                    "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                                    "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                                    "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                                    "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                                    "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                                    "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                                    "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                                    "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_preosteoblast,HC.var$H1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1_osteoblast,HC.var$H1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1_embedding.osteoblast,HC.var$H1_mineralizing.osteoblast) #p=1.2e-07
t.test(HC.var$H1_mineralizing.osteoblast,HC.var$H1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H2_preosteoblast,HC.var$H2_osteoblast)                     #p<2.2e-16
t.test(HC.var$H2_osteoblast,HC.var$H2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H2_embedding.osteoblast,HC.var$H2_mineralizing.osteoblast) #p=0.33970
t.test(HC.var$H2_mineralizing.osteoblast,HC.var$H2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H3_preosteoblast,HC.var$H3_osteoblast)                     #p<2.2e-16
t.test(HC.var$H3_osteoblast,HC.var$H3_embedding.osteoblast)              #p=0.11930
t.test(HC.var$H3_embedding.osteoblast,HC.var$H3_mineralizing.osteoblast) #p=5.7e-06
t.test(HC.var$H3_mineralizing.osteoblast,HC.var$H3_maturing.osteocyte)   #p=1.9e-12
t.test(HC.var$H4_preosteoblast,HC.var$H4_osteoblast)                     #p<2.2e-16
t.test(HC.var$H4_osteoblast,HC.var$H4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H4_embedding.osteoblast,HC.var$H4_mineralizing.osteoblast) #p=0.01404
t.test(HC.var$H4_mineralizing.osteoblast,HC.var$H4_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H5_preosteoblast,HC.var$H5_osteoblast)                     #p<2.2e-16
t.test(HC.var$H5_osteoblast,HC.var$H5_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H5_embedding.osteoblast,HC.var$H5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H5_mineralizing.osteoblast,HC.var$H5_maturing.osteocyte)   #p=0.28510
t.test(HC.var$H6_preosteoblast,HC.var$H6_osteoblast)                     #p<2.2e-16
t.test(HC.var$H6_osteoblast,HC.var$H6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H6_embedding.osteoblast,HC.var$H6_mineralizing.osteoblast) #p=1.6e-10
t.test(HC.var$H6_mineralizing.osteoblast,HC.var$H6_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C1_preosteoblast,HC.var$C1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C1_osteoblast,HC.var$C1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1_embedding.osteoblast,HC.var$C1_mineralizing.osteoblast) #p=8.2e-15
t.test(HC.var$C1_mineralizing.osteoblast,HC.var$C1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C2_preosteoblast,HC.var$C2_osteoblast)                     #p=0.70000
t.test(HC.var$C2_osteoblast,HC.var$C2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C2_embedding.osteoblast,HC.var$C2_mineralizing.osteoblast) #p=0.00039
t.test(HC.var$C2_mineralizing.osteoblast,HC.var$C2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C3_preosteoblast,HC.var$C3_osteoblast)                     #p<2.2e-16
t.test(HC.var$C3_osteoblast,HC.var$C3_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C3_embedding.osteoblast,HC.var$C3_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C3_mineralizing.osteoblast,HC.var$C3_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C4_preosteoblast,HC.var$C4_osteoblast)                     #p=0.25910
t.test(HC.var$C4_osteoblast,HC.var$C4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C4_embedding.osteoblast,HC.var$C4_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C4_mineralizing.osteoblast,HC.var$C4_maturing.osteocyte)   #p=0.98870
t.test(HC.var$C5_preosteoblast,HC.var$C5_osteoblast)                     #p<2.2e-16
t.test(HC.var$C5_osteoblast,HC.var$C5_embedding.osteoblast)              #p=1.2e-10
t.test(HC.var$C5_embedding.osteoblast,HC.var$C5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C5_mineralizing.osteoblast,HC.var$C5_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C6_preosteoblast,HC.var$C6_osteoblast)                     #p<2.2e-16
t.test(HC.var$C6_osteoblast,HC.var$C6_embedding.osteoblast)              #p=1.2e-05
t.test(HC.var$C6_embedding.osteoblast,HC.var$C6_mineralizing.osteoblast) #p=9.6e-05
t.test(HC.var$C6_mineralizing.osteoblast,HC.var$C6_maturing.osteocyte)   #p<2.2e-16

```

### SC: Osteogenic Ad Hoc Classifications vs. Individual.Replicates (median)

```{r, eval=FALSE}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,sapply(dge$samples$OstAdHoc.Assign.5gene.median,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                               "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                               "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                               "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                               "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                               "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                               "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                               "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                               "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                               "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                               "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                               "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                               "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                               "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))

# Calculate log2cpm means within individuals - decreases in ost (expt H5.1,C1.2,C2.1,C3.1,C4.1), decreases in emb.ost (expt H1.1,H3.1,C6.1), decreases in min.ost (expt H6.1,C1.1,C1.2,C3.1,C4.1,C5.1), and increases in mat.ost (expt H1.1,H3.1,H4.1,H5.1,C1.1,C3.1,C4.1,C5.1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_preosteoblast")],1, mean))
HC.mean["H1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_osteoblast")],1, mean))
HC.mean["H1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_embedding.osteoblast")],1, mean))
HC.mean["H1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_mineralizing.osteoblast")],1, mean))
HC.mean["H1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_maturing.osteocyte")],1, mean))
HC.mean["H1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_preosteoblast")],1, mean))
HC.mean["H1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_osteoblast")],1, mean))
HC.mean["H1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_embedding.osteoblast")],1, mean))
HC.mean["H1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_mineralizing.osteoblast")],1, mean))
HC.mean["H1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_maturing.osteocyte")],1, mean))
HC.mean["H2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_preosteoblast")],1, mean))
HC.mean["H2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_osteoblast")],1, mean))
HC.mean["H2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_embedding.osteoblast")],1, mean))
HC.mean["H2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_mineralizing.osteoblast")],1, mean))
HC.mean["H2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_maturing.osteocyte")],1, mean))
HC.mean["H3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_preosteoblast")],1, mean))
HC.mean["H3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_osteoblast")],1, mean))
HC.mean["H3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_embedding.osteoblast")],1, mean))
HC.mean["H3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_mineralizing.osteoblast")],1, mean))
HC.mean["H3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_maturing.osteocyte")],1, mean))
HC.mean["H4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_preosteoblast")],1, mean))
HC.mean["H4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_osteoblast")],1, mean))
HC.mean["H4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_embedding.osteoblast")],1, mean))
HC.mean["H4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_mineralizing.osteoblast")],1, mean))
HC.mean["H4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_maturing.osteocyte")],1, mean))
HC.mean["H5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_preosteoblast")],1, mean))
HC.mean["H5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_osteoblast")],1, mean))
HC.mean["H5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_embedding.osteoblast")],1, mean))
HC.mean["H5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_mineralizing.osteoblast")],1, mean))
HC.mean["H5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_maturing.osteocyte")],1, mean))
HC.mean["H6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_preosteoblast")],1, mean))
HC.mean["H6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_osteoblast")],1, mean))
HC.mean["H6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_embedding.osteoblast")],1, mean))
HC.mean["H6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_mineralizing.osteoblast")],1, mean))
HC.mean["H6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_maturing.osteocyte")],1, mean))
HC.mean["C1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_preosteoblast")],1, mean))
HC.mean["C1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_osteoblast")],1, mean))
HC.mean["C1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_embedding.osteoblast")],1, mean))
HC.mean["C1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_mineralizing.osteoblast")],1, mean))
HC.mean["C1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_maturing.osteocyte")],1, mean))
HC.mean["C1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_preosteoblast")],1, mean))
HC.mean["C1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_osteoblast")],1, mean))
HC.mean["C1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_embedding.osteoblast")],1, mean))
HC.mean["C1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_mineralizing.osteoblast")],1, mean))
HC.mean["C1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_maturing.osteocyte")],1, mean))
HC.mean["C2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_preosteoblast")],1, mean))
HC.mean["C2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_osteoblast")],1, mean))
HC.mean["C2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_embedding.osteoblast")],1, mean))
HC.mean["C2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_mineralizing.osteoblast")],1, mean))
HC.mean["C2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_maturing.osteocyte")],1, mean))
HC.mean["C3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_preosteoblast")],1, mean))
HC.mean["C3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_osteoblast")],1, mean))
HC.mean["C3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_embedding.osteoblast")],1, mean))
HC.mean["C3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_mineralizing.osteoblast")],1, mean))
HC.mean["C3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_maturing.osteocyte")],1, mean))
HC.mean["C4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_preosteoblast")],1, mean))
HC.mean["C4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_osteoblast")],1, mean))
HC.mean["C4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_embedding.osteoblast")],1, mean))
HC.mean["C4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_mineralizing.osteoblast")],1, mean))
HC.mean["C4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_maturing.osteocyte")],1, mean))
HC.mean["C5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_preosteoblast")],1, mean))
HC.mean["C5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_osteoblast")],1, mean))
HC.mean["C5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_embedding.osteoblast")],1, mean))
HC.mean["C5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_mineralizing.osteoblast")],1, mean))
HC.mean["C5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_maturing.osteocyte")],1, mean))
HC.mean["C6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_preosteoblast")],1, mean))
HC.mean["C6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_osteoblast")],1, mean))
HC.mean["C6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_embedding.osteoblast")],1, mean))
HC.mean["C6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_mineralizing.osteoblast")],1, mean))
HC.mean["C6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                                    "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                                    "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                                    "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                                    "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                                    "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                                    "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                                    "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                                    "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                                    "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                                    "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                                    "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                                    "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                                    "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_preosteoblast,HC.mean$H1.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H1.1_osteoblast,HC.mean$H1.1_embedding.osteoblast)              #p=3.9e-11
t.test(HC.mean$H1.1_embedding.osteoblast,HC.mean$H1.1_mineralizing.osteoblast) #p=2.6e-10
t.test(HC.mean$H1.1_mineralizing.osteoblast,HC.mean$H1.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H1.2_preosteoblast,HC.mean$H1.2_osteoblast)                     #p=1.5e-13
t.test(HC.mean$H1.2_osteoblast,HC.mean$H1.2_embedding.osteoblast)              #p=8.2e-12
t.test(HC.mean$H1.2_embedding.osteoblast,HC.mean$H1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$H1.2_mineralizing.osteoblast,HC.mean$H1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H2.1_preosteoblast,HC.mean$H2.1_osteoblast)                     #p=6.9e-11
t.test(HC.mean$H2.1_osteoblast,HC.mean$H2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H2.1_embedding.osteoblast,HC.mean$H2.1_mineralizing.osteoblast) #p=0.03296
t.test(HC.mean$H2.1_mineralizing.osteoblast,HC.mean$H2.1_maturing.osteocyte)   #p=0.71240
t.test(HC.mean$H3.1_preosteoblast,HC.mean$H3.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H3.1_osteoblast,HC.mean$H3.1_embedding.osteoblast)              #p=1.5e-07
t.test(HC.mean$H3.1_embedding.osteoblast,HC.mean$H3.1_mineralizing.osteoblast) #p=2.3e-05
t.test(HC.mean$H3.1_mineralizing.osteoblast,HC.mean$H3.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H4.1_preosteoblast,HC.mean$H4.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H4.1_osteoblast,HC.mean$H4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H4.1_embedding.osteoblast,HC.mean$H4.1_mineralizing.osteoblast) #p=2.2e-13
t.test(HC.mean$H4.1_mineralizing.osteoblast,HC.mean$H4.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H5.1_preosteoblast,HC.mean$H5.1_osteoblast)                     #p=3.3e-07
t.test(HC.mean$H5.1_osteoblast,HC.mean$H5.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H5.1_embedding.osteoblast,HC.mean$H5.1_mineralizing.osteoblast) #p=0.02699
t.test(HC.mean$H5.1_mineralizing.osteoblast,HC.mean$H5.1_maturing.osteocyte)   #p=2.6e-08
t.test(HC.mean$H6.1_preosteoblast,HC.mean$H6.1_osteoblast)                     #p=8.8e-09
t.test(HC.mean$H6.1_osteoblast,HC.mean$H6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H6.1_embedding.osteoblast,HC.mean$H6.1_mineralizing.osteoblast) #p=0.37260
t.test(HC.mean$H6.1_mineralizing.osteoblast,HC.mean$H6.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C1.1_preosteoblast,HC.mean$C1.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C1.1_osteoblast,HC.mean$C1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1.1_embedding.osteoblast,HC.mean$C1.1_mineralizing.osteoblast) #p=0.08749
t.test(HC.mean$C1.1_mineralizing.osteoblast,HC.mean$C1.1_maturing.osteocyte)   #p<2.2e-16
#t.test(HC.mean$C1.2_preosteoblast,HC.mean$C1.2_osteoblast)                     #p=NA
t.test(HC.mean$C1.2_osteoblast,HC.mean$C1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1.2_embedding.osteoblast,HC.mean$C1.2_mineralizing.osteoblast) #p=6.0e-13
t.test(HC.mean$C1.2_mineralizing.osteoblast,HC.mean$C1.2_maturing.osteocyte)   #p=6.4e-05
t.test(HC.mean$C2.1_preosteoblast,HC.mean$C2.1_osteoblast)                     #p=6.9e-08
t.test(HC.mean$C2.1_osteoblast,HC.mean$C2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C2.1_embedding.osteoblast,HC.mean$C2.1_mineralizing.osteoblast) #p=0.00507
t.test(HC.mean$C2.1_mineralizing.osteoblast,HC.mean$C2.1_maturing.osteocyte)   #p=0.00653
t.test(HC.mean$C3.1_preosteoblast,HC.mean$C3.1_osteoblast)                     #p=6.2e-07
t.test(HC.mean$C3.1_osteoblast,HC.mean$C3.1_embedding.osteoblast)              #p=2.7e-11
t.test(HC.mean$C3.1_embedding.osteoblast,HC.mean$C3.1_mineralizing.osteoblast) #p=9.8e-11
t.test(HC.mean$C3.1_mineralizing.osteoblast,HC.mean$C3.1_maturing.osteocyte)   #p=0.24900
t.test(HC.mean$C4.1_preosteoblast,HC.mean$C4.1_osteoblast)                     #p=0.79680
t.test(HC.mean$C4.1_osteoblast,HC.mean$C4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C4.1_embedding.osteoblast,HC.mean$C4.1_mineralizing.osteoblast) #p=3.5e-06
t.test(HC.mean$C4.1_mineralizing.osteoblast,HC.mean$C4.1_maturing.osteocyte)   #p=0.18870
t.test(HC.mean$C5.1_preosteoblast,HC.mean$C5.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C5.1_osteoblast,HC.mean$C5.1_embedding.osteoblast)              #p=4.2e-14
t.test(HC.mean$C5.1_embedding.osteoblast,HC.mean$C5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C5.1_mineralizing.osteoblast,HC.mean$C5.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C6.1_preosteoblast,HC.mean$C6.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C6.1_osteoblast,HC.mean$C6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C6.1_embedding.osteoblast,HC.mean$C6.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C6.1_mineralizing.osteoblast,HC.mean$C6.1_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in ost (expt H5.1,C2.1,C3.1,C4.1), increases in emb.ost (expt H1.1,H3.1), decreases in min.ost (expt H1.1,H1.2,H2.1,C6.1), and decreases in mat.ost (expt H5.1,C4.1,C5.1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_preosteoblast")],1, var))
HC.var["H1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_osteoblast")],1, var))
HC.var["H1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_embedding.osteoblast")],1, var))
HC.var["H1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_mineralizing.osteoblast")],1, var))
HC.var["H1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_maturing.osteocyte")],1, var))
HC.var["H1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_preosteoblast")],1, var))
HC.var["H1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_osteoblast")],1, var))
HC.var["H1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_embedding.osteoblast")],1, var))
HC.var["H1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_mineralizing.osteoblast")],1, var))
HC.var["H1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_maturing.osteocyte")],1, var))
HC.var["H2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_preosteoblast")],1, var))
HC.var["H2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_osteoblast")],1, var))
HC.var["H2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_embedding.osteoblast")],1, var))
HC.var["H2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_mineralizing.osteoblast")],1, var))
HC.var["H2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_maturing.osteocyte")],1, var))
HC.var["H3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_preosteoblast")],1, var))
HC.var["H3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_osteoblast")],1, var))
HC.var["H3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_embedding.osteoblast")],1, var))
HC.var["H3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_mineralizing.osteoblast")],1, var))
HC.var["H3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_maturing.osteocyte")],1, var))
HC.var["H4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_preosteoblast")],1, var))
HC.var["H4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_osteoblast")],1, var))
HC.var["H4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_embedding.osteoblast")],1, var))
HC.var["H4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_mineralizing.osteoblast")],1, var))
HC.var["H4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_maturing.osteocyte")],1, var))
HC.var["H5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_preosteoblast")],1, var))
HC.var["H5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_osteoblast")],1, var))
HC.var["H5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_embedding.osteoblast")],1, var))
HC.var["H5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_mineralizing.osteoblast")],1, var))
HC.var["H5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_maturing.osteocyte")],1, var))
HC.var["H6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_preosteoblast")],1, var))
HC.var["H6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_osteoblast")],1, var))
HC.var["H6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_embedding.osteoblast")],1, var))
HC.var["H6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_mineralizing.osteoblast")],1, var))
HC.var["H6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_maturing.osteocyte")],1, var))
HC.var["C1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_preosteoblast")],1, var))
HC.var["C1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_osteoblast")],1, var))
HC.var["C1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_embedding.osteoblast")],1, var))
HC.var["C1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_mineralizing.osteoblast")],1, var))
HC.var["C1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_maturing.osteocyte")],1, var))
HC.var["C1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_preosteoblast")],1, var))
HC.var["C1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_osteoblast")],1, var))
HC.var["C1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_embedding.osteoblast")],1, var))
HC.var["C1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_mineralizing.osteoblast")],1, var))
HC.var["C1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_maturing.osteocyte")],1, var))
HC.var["C2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_preosteoblast")],1, var))
HC.var["C2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_osteoblast")],1, var))
HC.var["C2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_embedding.osteoblast")],1, var))
HC.var["C2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_mineralizing.osteoblast")],1, var))
HC.var["C2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_maturing.osteocyte")],1, var))
HC.var["C3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_preosteoblast")],1, var))
HC.var["C3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_osteoblast")],1, var))
HC.var["C3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_embedding.osteoblast")],1, var))
HC.var["C3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_mineralizing.osteoblast")],1, var))
HC.var["C3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_maturing.osteocyte")],1, var))
HC.var["C4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_preosteoblast")],1, var))
HC.var["C4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_osteoblast")],1, var))
HC.var["C4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_embedding.osteoblast")],1, var))
HC.var["C4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_mineralizing.osteoblast")],1, var))
HC.var["C4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_maturing.osteocyte")],1, var))
HC.var["C5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_preosteoblast")],1, var))
HC.var["C5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_osteoblast")],1, var))
HC.var["C5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_embedding.osteoblast")],1, var))
HC.var["C5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_mineralizing.osteoblast")],1, var))
HC.var["C5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_maturing.osteocyte")],1, var))
HC.var["C6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_preosteoblast")],1, var))
HC.var["C6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_osteoblast")],1, var))
HC.var["C6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_embedding.osteoblast")],1, var))
HC.var["C6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_mineralizing.osteoblast")],1, var))
HC.var["C6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                                    "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                                    "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                                    "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                                    "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                                    "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                                    "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                                    "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                                    "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                                    "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                                    "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                                    "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                                    "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                                    "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=individual, y=log2(value), fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_preosteoblast,HC.var$H1.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1.1_osteoblast,HC.var$H1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1.1_embedding.osteoblast,HC.var$H1.1_mineralizing.osteoblast) #p=0.26460
t.test(HC.var$H1.1_mineralizing.osteoblast,HC.var$H1.1_maturing.osteocyte)   #p=7.7e-06
t.test(HC.var$H1.2_preosteoblast,HC.var$H1.2_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1.2_osteoblast,HC.var$H1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1.2_embedding.osteoblast,HC.var$H1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H1.2_mineralizing.osteoblast,HC.var$H1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H2.1_preosteoblast,HC.var$H2.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H2.1_osteoblast,HC.var$H2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H2.1_embedding.osteoblast,HC.var$H2.1_mineralizing.osteoblast) #p=0.33970
t.test(HC.var$H2.1_mineralizing.osteoblast,HC.var$H2.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H3.1_preosteoblast,HC.var$H3.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H3.1_osteoblast,HC.var$H3.1_embedding.osteoblast)              #p=0.11930
t.test(HC.var$H3.1_embedding.osteoblast,HC.var$H3.1_mineralizing.osteoblast) #p=5.7e-06
t.test(HC.var$H3.1_mineralizing.osteoblast,HC.var$H3.1_maturing.osteocyte)   #p=1.9e-12
t.test(HC.var$H4.1_preosteoblast,HC.var$H4.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H4.1_osteoblast,HC.var$H4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H4.1_embedding.osteoblast,HC.var$H4.1_mineralizing.osteoblast) #p=0.01404
t.test(HC.var$H4.1_mineralizing.osteoblast,HC.var$H4.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H5.1_preosteoblast,HC.var$H5.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H5.1_osteoblast,HC.var$H5.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H5.1_embedding.osteoblast,HC.var$H5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H5.1_mineralizing.osteoblast,HC.var$H5.1_maturing.osteocyte)   #p=0.28510
t.test(HC.var$H6.1_preosteoblast,HC.var$H6.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H6.1_osteoblast,HC.var$H6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H6.1_embedding.osteoblast,HC.var$H6.1_mineralizing.osteoblast) #p=1.6e-10
t.test(HC.var$H6.1_mineralizing.osteoblast,HC.var$H6.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C1.1_preosteoblast,HC.var$C1.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C1.1_osteoblast,HC.var$C1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1.1_embedding.osteoblast,HC.var$C1.1_mineralizing.osteoblast) #p=1.9e-06
t.test(HC.var$C1.1_mineralizing.osteoblast,HC.var$C1.1_maturing.osteocyte)   #p<2.8e-16
#t.test(HC.var$C1.2_preosteoblast,HC.var$C1.2_osteoblast)                     #p=NA
t.test(HC.var$C1.2_osteoblast,HC.var$C1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1.2_embedding.osteoblast,HC.var$C1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C1.2_mineralizing.osteoblast,HC.var$C1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C2.1_preosteoblast,HC.var$C2.1_osteoblast)                     #p=0.70000
t.test(HC.var$C2.1_osteoblast,HC.var$C2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C2.1_embedding.osteoblast,HC.var$C2.1_mineralizing.osteoblast) #p=0.00039
t.test(HC.var$C2.1_mineralizing.osteoblast,HC.var$C2.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C3.1_preosteoblast,HC.var$C3.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C3.1_osteoblast,HC.var$C3.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C3.1_embedding.osteoblast,HC.var$C3.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C3.1_mineralizing.osteoblast,HC.var$C3.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C4.1_preosteoblast,HC.var$C4.1_osteoblast)                     #p=0.25910
t.test(HC.var$C4.1_osteoblast,HC.var$C4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C4.1_embedding.osteoblast,HC.var$C4.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C4.1_mineralizing.osteoblast,HC.var$C4.1_maturing.osteocyte)   #p=0.98870
t.test(HC.var$C5.1_preosteoblast,HC.var$C5.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C5.1_osteoblast,HC.var$C5.1_embedding.osteoblast)              #p=1.2e-10
t.test(HC.var$C5.1_embedding.osteoblast,HC.var$C5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C5.1_mineralizing.osteoblast,HC.var$C5.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C6.1_preosteoblast,HC.var$C6.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C6.1_osteoblast,HC.var$C6.1_embedding.osteoblast)              #p=1.2e-05
t.test(HC.var$C6.1_embedding.osteoblast,HC.var$C6.1_mineralizing.osteoblast) #p=9.6e-05
t.test(HC.var$C6.1_mineralizing.osteoblast,HC.var$C6.1_maturing.osteocyte)   #p<2.2e-16

```

### SC: Osteogenic Ad Hoc Classifications vs. Species (thresh0 in t2)

```{r, eval=FALSE}

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,sapply(dge$samples$OstAdHoc.Assign.5gene.thresh0.t2,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean decreases in osteoblasts, decreases in emb.osteoblasts (expt C), increases in min.osteoblasts (expt C), and decreases in mat.osteocytes (expt C)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p<2.2e-16
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p=7.7e-06
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=0.00330
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p=9.6e-05
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p=7.7e-09

# Calculate log2cpm variances within species - variance increases in osteoblasts, increases in emb.osteoblasts, increases in min.osteoblasts, and stays constant in mat.osteocytes
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p<2.2e-16
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p=0.00043
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p=0.00011
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p=0.30640
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p=0.21110
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p=0.78010
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=2.8e-06
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p=0.00017

```

### TO EDIT
### SC: Osteogenic Ad Hoc Classifications vs. Individuals (thresh0 in t2)

```{r, eval=FALSE}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual,sapply(dge$samples$OstAdHoc.Assign.5gene.median,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                               "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                               "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                               "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                               "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                               "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                               "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                               "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                               "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                               "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                               "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                               "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))

# Calculate log2cpm means within individuals - decreases in ost (expt H5,C2,C3,C4), decreases in emb.ost (expt H1,H3,C6), decreases in min.ost (expt H6,C3,C4,C5), and increases in mat.ost (expt H1,H3,H4,H5,C1,C3,C4,C5)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_preosteoblast")],1, mean))
HC.mean["H1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_osteoblast")],1, mean))
HC.mean["H1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_embedding.osteoblast")],1, mean))
HC.mean["H1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_mineralizing.osteoblast")],1, mean))
HC.mean["H1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_maturing.osteocyte")],1, mean))
HC.mean["H2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_preosteoblast")],1, mean))
HC.mean["H2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_osteoblast")],1, mean))
HC.mean["H2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_embedding.osteoblast")],1, mean))
HC.mean["H2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_mineralizing.osteoblast")],1, mean))
HC.mean["H2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_maturing.osteocyte")],1, mean))
HC.mean["H3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_preosteoblast")],1, mean))
HC.mean["H3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_osteoblast")],1, mean))
HC.mean["H3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_embedding.osteoblast")],1, mean))
HC.mean["H3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_mineralizing.osteoblast")],1, mean))
HC.mean["H3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_maturing.osteocyte")],1, mean))
HC.mean["H4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_preosteoblast")],1, mean))
HC.mean["H4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_osteoblast")],1, mean))
HC.mean["H4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_embedding.osteoblast")],1, mean))
HC.mean["H4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_mineralizing.osteoblast")],1, mean))
HC.mean["H4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_maturing.osteocyte")],1, mean))
HC.mean["H5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_preosteoblast")],1, mean))
HC.mean["H5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_osteoblast")],1, mean))
HC.mean["H5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_embedding.osteoblast")],1, mean))
HC.mean["H5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_mineralizing.osteoblast")],1, mean))
HC.mean["H5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_maturing.osteocyte")],1, mean))
HC.mean["H6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_preosteoblast")],1, mean))
HC.mean["H6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_osteoblast")],1, mean))
HC.mean["H6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_embedding.osteoblast")],1, mean))
HC.mean["H6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_mineralizing.osteoblast")],1, mean))
HC.mean["H6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_maturing.osteocyte")],1, mean))
HC.mean["C1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_preosteoblast")],1, mean))
HC.mean["C1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_osteoblast")],1, mean))
HC.mean["C1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_embedding.osteoblast")],1, mean))
HC.mean["C1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_mineralizing.osteoblast")],1, mean))
HC.mean["C1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_maturing.osteocyte")],1, mean))
HC.mean["C2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_preosteoblast")],1, mean))
HC.mean["C2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_osteoblast")],1, mean))
HC.mean["C2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_embedding.osteoblast")],1, mean))
HC.mean["C2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_mineralizing.osteoblast")],1, mean))
HC.mean["C2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_maturing.osteocyte")],1, mean))
HC.mean["C3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_preosteoblast")],1, mean))
HC.mean["C3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_osteoblast")],1, mean))
HC.mean["C3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_embedding.osteoblast")],1, mean))
HC.mean["C3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_mineralizing.osteoblast")],1, mean))
HC.mean["C3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_maturing.osteocyte")],1, mean))
HC.mean["C4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_preosteoblast")],1, mean))
HC.mean["C4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_osteoblast")],1, mean))
HC.mean["C4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_embedding.osteoblast")],1, mean))
HC.mean["C4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_mineralizing.osteoblast")],1, mean))
HC.mean["C4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_maturing.osteocyte")],1, mean))
HC.mean["C5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_preosteoblast")],1, mean))
HC.mean["C5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_osteoblast")],1, mean))
HC.mean["C5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_embedding.osteoblast")],1, mean))
HC.mean["C5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_mineralizing.osteoblast")],1, mean))
HC.mean["C5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_maturing.osteocyte")],1, mean))
HC.mean["C6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_preosteoblast")],1, mean))
HC.mean["C6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_osteoblast")],1, mean))
HC.mean["C6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_embedding.osteoblast")],1, mean))
HC.mean["C6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_mineralizing.osteoblast")],1, mean))
HC.mean["C6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                                    "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                                    "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                                    "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                                    "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                                    "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                                    "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                                    "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                                    "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                                    "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                                    "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                                    "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1_preosteoblast,HC.mean$H1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H1_osteoblast,HC.mean$H1_embedding.osteoblast)              #p=0.01418
t.test(HC.mean$H1_embedding.osteoblast,HC.mean$H1_mineralizing.osteoblast) #p=7.4e-15
t.test(HC.mean$H1_mineralizing.osteoblast,HC.mean$H1_maturing.osteocyte)   #p=0.36460
t.test(HC.mean$H2_preosteoblast,HC.mean$H2_osteoblast)                     #p=6.9e-11
t.test(HC.mean$H2_osteoblast,HC.mean$H2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H2_embedding.osteoblast,HC.mean$H2_mineralizing.osteoblast) #p=0.03296
t.test(HC.mean$H2_mineralizing.osteoblast,HC.mean$H2_maturing.osteocyte)   #p=0.71240
t.test(HC.mean$H3_preosteoblast,HC.mean$H3_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H3_osteoblast,HC.mean$H3_embedding.osteoblast)              #p=1.5e-07
t.test(HC.mean$H3_embedding.osteoblast,HC.mean$H3_mineralizing.osteoblast) #p=2.3e-05
t.test(HC.mean$H3_mineralizing.osteoblast,HC.mean$H3_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H4_preosteoblast,HC.mean$H4_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H4_osteoblast,HC.mean$H4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H4_embedding.osteoblast,HC.mean$H4_mineralizing.osteoblast) #p=2.2e-13
t.test(HC.mean$H4_mineralizing.osteoblast,HC.mean$H4_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H5_preosteoblast,HC.mean$H5_osteoblast)                     #p=3.3e-07
t.test(HC.mean$H5_osteoblast,HC.mean$H5_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H5_embedding.osteoblast,HC.mean$H5_mineralizing.osteoblast) #p=0.02699
t.test(HC.mean$H5_mineralizing.osteoblast,HC.mean$H5_maturing.osteocyte)   #p=2.6e-08
t.test(HC.mean$H6_preosteoblast,HC.mean$H6_osteoblast)                     #p=8.8e-09
t.test(HC.mean$H6_osteoblast,HC.mean$H6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H6_embedding.osteoblast,HC.mean$H6_mineralizing.osteoblast) #p=0.37260
t.test(HC.mean$H6_mineralizing.osteoblast,HC.mean$H6_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C1_preosteoblast,HC.mean$C1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C1_osteoblast,HC.mean$C1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1_embedding.osteoblast,HC.mean$C1_mineralizing.osteoblast) #p=0.02954
t.test(HC.mean$C1_mineralizing.osteoblast,HC.mean$C1_maturing.osteocyte)   #p=6.2e-05
t.test(HC.mean$C2_preosteoblast,HC.mean$C2_osteoblast)                     #p=6.9e-08
t.test(HC.mean$C2_osteoblast,HC.mean$C2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C2_embedding.osteoblast,HC.mean$C2_mineralizing.osteoblast) #p=0.00507
t.test(HC.mean$C2_mineralizing.osteoblast,HC.mean$C2_maturing.osteocyte)   #p=0.00653
t.test(HC.mean$C3_preosteoblast,HC.mean$C3_osteoblast)                     #p=6.2e-07
t.test(HC.mean$C3_osteoblast,HC.mean$C3_embedding.osteoblast)              #p=2.7e-11
t.test(HC.mean$C3_embedding.osteoblast,HC.mean$C3_mineralizing.osteoblast) #p=9.8e-11
t.test(HC.mean$C3_mineralizing.osteoblast,HC.mean$C3_maturing.osteocyte)   #p=0.24900
t.test(HC.mean$C4_preosteoblast,HC.mean$C4_osteoblast)                     #p=0.79680
t.test(HC.mean$C4_osteoblast,HC.mean$C4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C4_embedding.osteoblast,HC.mean$C4_mineralizing.osteoblast) #p=3.5e-06
t.test(HC.mean$C4_mineralizing.osteoblast,HC.mean$C4_maturing.osteocyte)   #p=0.18870
t.test(HC.mean$C5_preosteoblast,HC.mean$C5_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C5_osteoblast,HC.mean$C5_embedding.osteoblast)              #p=4.2e-14
t.test(HC.mean$C5_embedding.osteoblast,HC.mean$C5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C5_mineralizing.osteoblast,HC.mean$C5_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C6_preosteoblast,HC.mean$C6_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C6_osteoblast,HC.mean$C6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C6_embedding.osteoblast,HC.mean$C6_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C6_mineralizing.osteoblast,HC.mean$C6_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in ost (expt H5,C2,C3,C4), increases in emb.ost (expt H1,H3), decreases in min.ost (expt H1,H2,C6), and decreases in mat.ost (expt H5,C4,C5)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_preosteoblast")],1, var))
HC.var["H1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_osteoblast")],1, var))
HC.var["H1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_embedding.osteoblast")],1, var))
HC.var["H1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_mineralizing.osteoblast")],1, var))
HC.var["H1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1_maturing.osteocyte")],1, var))
HC.var["H2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_preosteoblast")],1, var))
HC.var["H2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_osteoblast")],1, var))
HC.var["H2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_embedding.osteoblast")],1, var))
HC.var["H2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_mineralizing.osteoblast")],1, var))
HC.var["H2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2_maturing.osteocyte")],1, var))
HC.var["H3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_preosteoblast")],1, var))
HC.var["H3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_osteoblast")],1, var))
HC.var["H3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_embedding.osteoblast")],1, var))
HC.var["H3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_mineralizing.osteoblast")],1, var))
HC.var["H3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3_maturing.osteocyte")],1, var))
HC.var["H4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_preosteoblast")],1, var))
HC.var["H4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_osteoblast")],1, var))
HC.var["H4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_embedding.osteoblast")],1, var))
HC.var["H4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_mineralizing.osteoblast")],1, var))
HC.var["H4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4_maturing.osteocyte")],1, var))
HC.var["H5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_preosteoblast")],1, var))
HC.var["H5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_osteoblast")],1, var))
HC.var["H5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_embedding.osteoblast")],1, var))
HC.var["H5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_mineralizing.osteoblast")],1, var))
HC.var["H5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5_maturing.osteocyte")],1, var))
HC.var["H6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_preosteoblast")],1, var))
HC.var["H6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_osteoblast")],1, var))
HC.var["H6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_embedding.osteoblast")],1, var))
HC.var["H6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_mineralizing.osteoblast")],1, var))
HC.var["H6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6_maturing.osteocyte")],1, var))
HC.var["C1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_preosteoblast")],1, var))
HC.var["C1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_osteoblast")],1, var))
HC.var["C1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_embedding.osteoblast")],1, var))
HC.var["C1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_mineralizing.osteoblast")],1, var))
HC.var["C1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1_maturing.osteocyte")],1, var))
HC.var["C2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_preosteoblast")],1, var))
HC.var["C2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_osteoblast")],1, var))
HC.var["C2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_embedding.osteoblast")],1, var))
HC.var["C2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_mineralizing.osteoblast")],1, var))
HC.var["C2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2_maturing.osteocyte")],1, var))
HC.var["C3_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_preosteoblast")],1, var))
HC.var["C3_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_osteoblast")],1, var))
HC.var["C3_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_embedding.osteoblast")],1, var))
HC.var["C3_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_mineralizing.osteoblast")],1, var))
HC.var["C3_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3_maturing.osteocyte")],1, var))
HC.var["C4_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_preosteoblast")],1, var))
HC.var["C4_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_osteoblast")],1, var))
HC.var["C4_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_embedding.osteoblast")],1, var))
HC.var["C4_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_mineralizing.osteoblast")],1, var))
HC.var["C4_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4_maturing.osteocyte")],1, var))
HC.var["C5_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_preosteoblast")],1, var))
HC.var["C5_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_osteoblast")],1, var))
HC.var["C5_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_embedding.osteoblast")],1, var))
HC.var["C5_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_mineralizing.osteoblast")],1, var))
HC.var["C5_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5_maturing.osteocyte")],1, var))
HC.var["C6_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_preosteoblast")],1, var))
HC.var["C6_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_osteoblast")],1, var))
HC.var["C6_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_embedding.osteoblast")],1, var))
HC.var["C6_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_mineralizing.osteoblast")],1, var))
HC.var["C6_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1_preosteoblast","H1_osteoblast","H1_embedding.osteoblast","H1_mineralizing.osteoblast","H1_maturing.osteocyte",
                                    "H2_preosteoblast","H2_osteoblast","H2_embedding.osteoblast","H2_mineralizing.osteoblast","H2_maturing.osteocyte",
                                    "H3_preosteoblast","H3_osteoblast","H3_embedding.osteoblast","H3_mineralizing.osteoblast","H3_maturing.osteocyte",
                                    "H4_preosteoblast","H4_osteoblast","H4_embedding.osteoblast","H4_mineralizing.osteoblast","H4_maturing.osteocyte",
                                    "H5_preosteoblast","H5_osteoblast","H5_embedding.osteoblast","H5_mineralizing.osteoblast","H5_maturing.osteocyte",
                                    "H6_preosteoblast","H6_osteoblast","H6_embedding.osteoblast","H6_mineralizing.osteoblast","H6_maturing.osteocyte",
                                    "C1_preosteoblast","C1_osteoblast","C1_embedding.osteoblast","C1_mineralizing.osteoblast","C1_maturing.osteocyte",
                                    "C2_preosteoblast","C2_osteoblast","C2_embedding.osteoblast","C2_mineralizing.osteoblast","C2_maturing.osteocyte",
                                    "C3_preosteoblast","C3_osteoblast","C3_embedding.osteoblast","C3_mineralizing.osteoblast","C3_maturing.osteocyte",
                                    "C4_preosteoblast","C4_osteoblast","C4_embedding.osteoblast","C4_mineralizing.osteoblast","C4_maturing.osteocyte",
                                    "C5_preosteoblast","C5_osteoblast","C5_embedding.osteoblast","C5_mineralizing.osteoblast","C5_maturing.osteocyte",
                                    "C6_preosteoblast","C6_osteoblast","C6_embedding.osteoblast","C6_mineralizing.osteoblast","C6_maturing.osteocyte"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1_preosteoblast,HC.var$H1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1_osteoblast,HC.var$H1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1_embedding.osteoblast,HC.var$H1_mineralizing.osteoblast) #p=1.2e-07
t.test(HC.var$H1_mineralizing.osteoblast,HC.var$H1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H2_preosteoblast,HC.var$H2_osteoblast)                     #p<2.2e-16
t.test(HC.var$H2_osteoblast,HC.var$H2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H2_embedding.osteoblast,HC.var$H2_mineralizing.osteoblast) #p=0.33970
t.test(HC.var$H2_mineralizing.osteoblast,HC.var$H2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H3_preosteoblast,HC.var$H3_osteoblast)                     #p<2.2e-16
t.test(HC.var$H3_osteoblast,HC.var$H3_embedding.osteoblast)              #p=0.11930
t.test(HC.var$H3_embedding.osteoblast,HC.var$H3_mineralizing.osteoblast) #p=5.7e-06
t.test(HC.var$H3_mineralizing.osteoblast,HC.var$H3_maturing.osteocyte)   #p=1.9e-12
t.test(HC.var$H4_preosteoblast,HC.var$H4_osteoblast)                     #p<2.2e-16
t.test(HC.var$H4_osteoblast,HC.var$H4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H4_embedding.osteoblast,HC.var$H4_mineralizing.osteoblast) #p=0.01404
t.test(HC.var$H4_mineralizing.osteoblast,HC.var$H4_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H5_preosteoblast,HC.var$H5_osteoblast)                     #p<2.2e-16
t.test(HC.var$H5_osteoblast,HC.var$H5_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H5_embedding.osteoblast,HC.var$H5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H5_mineralizing.osteoblast,HC.var$H5_maturing.osteocyte)   #p=0.28510
t.test(HC.var$H6_preosteoblast,HC.var$H6_osteoblast)                     #p<2.2e-16
t.test(HC.var$H6_osteoblast,HC.var$H6_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H6_embedding.osteoblast,HC.var$H6_mineralizing.osteoblast) #p=1.6e-10
t.test(HC.var$H6_mineralizing.osteoblast,HC.var$H6_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C1_preosteoblast,HC.var$C1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C1_osteoblast,HC.var$C1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1_embedding.osteoblast,HC.var$C1_mineralizing.osteoblast) #p=8.2e-15
t.test(HC.var$C1_mineralizing.osteoblast,HC.var$C1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C2_preosteoblast,HC.var$C2_osteoblast)                     #p=0.70000
t.test(HC.var$C2_osteoblast,HC.var$C2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C2_embedding.osteoblast,HC.var$C2_mineralizing.osteoblast) #p=0.00039
t.test(HC.var$C2_mineralizing.osteoblast,HC.var$C2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C3_preosteoblast,HC.var$C3_osteoblast)                     #p<2.2e-16
t.test(HC.var$C3_osteoblast,HC.var$C3_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C3_embedding.osteoblast,HC.var$C3_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C3_mineralizing.osteoblast,HC.var$C3_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C4_preosteoblast,HC.var$C4_osteoblast)                     #p=0.25910
t.test(HC.var$C4_osteoblast,HC.var$C4_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C4_embedding.osteoblast,HC.var$C4_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C4_mineralizing.osteoblast,HC.var$C4_maturing.osteocyte)   #p=0.98870
t.test(HC.var$C5_preosteoblast,HC.var$C5_osteoblast)                     #p<2.2e-16
t.test(HC.var$C5_osteoblast,HC.var$C5_embedding.osteoblast)              #p=1.2e-10
t.test(HC.var$C5_embedding.osteoblast,HC.var$C5_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C5_mineralizing.osteoblast,HC.var$C5_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C6_preosteoblast,HC.var$C6_osteoblast)                     #p<2.2e-16
t.test(HC.var$C6_osteoblast,HC.var$C6_embedding.osteoblast)              #p=1.2e-05
t.test(HC.var$C6_embedding.osteoblast,HC.var$C6_mineralizing.osteoblast) #p=9.6e-05
t.test(HC.var$C6_mineralizing.osteoblast,HC.var$C6_maturing.osteocyte)   #p<2.2e-16

```

### TO EDIT
### SC: Osteogenic Ad Hoc Classifications vs. Individual.Replicates (thresh0 in t2)

```{r, eval=FALSE}

# Compile group labels of each individual
groupFactor <- factor(paste(dge$samples$Individual.Replicate,sapply(dge$samples$OstAdHoc.Assign.5gene.median,function(x)sub(" ",".",x)),sep="_"),
                      levels=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                               "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                               "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                               "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                               "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                               "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                               "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                               "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                               "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                               "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                               "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                               "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                               "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                               "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))

# Calculate log2cpm means within individuals - decreases in ost (expt H5.1,C1.2,C2.1,C3.1,C4.1), decreases in emb.ost (expt H1.1,H3.1,C6.1), decreases in min.ost (expt H6.1,C1.1,C1.2,C3.1,C4.1,C5.1), and increases in mat.ost (expt H1.1,H3.1,H4.1,H5.1,C1.1,C3.1,C4.1,C5.1)
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["H1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_preosteoblast")],1, mean))
HC.mean["H1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_osteoblast")],1, mean))
HC.mean["H1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_embedding.osteoblast")],1, mean))
HC.mean["H1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_mineralizing.osteoblast")],1, mean))
HC.mean["H1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_maturing.osteocyte")],1, mean))
HC.mean["H1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_preosteoblast")],1, mean))
HC.mean["H1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_osteoblast")],1, mean))
HC.mean["H1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_embedding.osteoblast")],1, mean))
HC.mean["H1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_mineralizing.osteoblast")],1, mean))
HC.mean["H1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_maturing.osteocyte")],1, mean))
HC.mean["H2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_preosteoblast")],1, mean))
HC.mean["H2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_osteoblast")],1, mean))
HC.mean["H2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_embedding.osteoblast")],1, mean))
HC.mean["H2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_mineralizing.osteoblast")],1, mean))
HC.mean["H2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_maturing.osteocyte")],1, mean))
HC.mean["H3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_preosteoblast")],1, mean))
HC.mean["H3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_osteoblast")],1, mean))
HC.mean["H3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_embedding.osteoblast")],1, mean))
HC.mean["H3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_mineralizing.osteoblast")],1, mean))
HC.mean["H3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_maturing.osteocyte")],1, mean))
HC.mean["H4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_preosteoblast")],1, mean))
HC.mean["H4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_osteoblast")],1, mean))
HC.mean["H4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_embedding.osteoblast")],1, mean))
HC.mean["H4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_mineralizing.osteoblast")],1, mean))
HC.mean["H4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_maturing.osteocyte")],1, mean))
HC.mean["H5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_preosteoblast")],1, mean))
HC.mean["H5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_osteoblast")],1, mean))
HC.mean["H5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_embedding.osteoblast")],1, mean))
HC.mean["H5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_mineralizing.osteoblast")],1, mean))
HC.mean["H5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_maturing.osteocyte")],1, mean))
HC.mean["H6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_preosteoblast")],1, mean))
HC.mean["H6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_osteoblast")],1, mean))
HC.mean["H6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_embedding.osteoblast")],1, mean))
HC.mean["H6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_mineralizing.osteoblast")],1, mean))
HC.mean["H6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_maturing.osteocyte")],1, mean))
HC.mean["C1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_preosteoblast")],1, mean))
HC.mean["C1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_osteoblast")],1, mean))
HC.mean["C1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_embedding.osteoblast")],1, mean))
HC.mean["C1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_mineralizing.osteoblast")],1, mean))
HC.mean["C1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_maturing.osteocyte")],1, mean))
HC.mean["C1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_preosteoblast")],1, mean))
HC.mean["C1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_osteoblast")],1, mean))
HC.mean["C1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_embedding.osteoblast")],1, mean))
HC.mean["C1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_mineralizing.osteoblast")],1, mean))
HC.mean["C1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_maturing.osteocyte")],1, mean))
HC.mean["C2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_preosteoblast")],1, mean))
HC.mean["C2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_osteoblast")],1, mean))
HC.mean["C2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_embedding.osteoblast")],1, mean))
HC.mean["C2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_mineralizing.osteoblast")],1, mean))
HC.mean["C2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_maturing.osteocyte")],1, mean))
HC.mean["C3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_preosteoblast")],1, mean))
HC.mean["C3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_osteoblast")],1, mean))
HC.mean["C3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_embedding.osteoblast")],1, mean))
HC.mean["C3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_mineralizing.osteoblast")],1, mean))
HC.mean["C3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_maturing.osteocyte")],1, mean))
HC.mean["C4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_preosteoblast")],1, mean))
HC.mean["C4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_osteoblast")],1, mean))
HC.mean["C4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_embedding.osteoblast")],1, mean))
HC.mean["C4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_mineralizing.osteoblast")],1, mean))
HC.mean["C4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_maturing.osteocyte")],1, mean))
HC.mean["C5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_preosteoblast")],1, mean))
HC.mean["C5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_osteoblast")],1, mean))
HC.mean["C5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_embedding.osteoblast")],1, mean))
HC.mean["C5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_mineralizing.osteoblast")],1, mean))
HC.mean["C5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_maturing.osteocyte")],1, mean))
HC.mean["C6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_preosteoblast")],1, mean))
HC.mean["C6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_osteoblast")],1, mean))
HC.mean["C6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_embedding.osteoblast")],1, mean))
HC.mean["C6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_mineralizing.osteoblast")],1, mean))
HC.mean["C6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                                    "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                                    "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                                    "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                                    "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                                    "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                                    "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                                    "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                                    "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                                    "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                                    "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                                    "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                                    "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                                    "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))
HC.mean.melt$individual <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$H1.1_preosteoblast,HC.mean$H1.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H1.1_osteoblast,HC.mean$H1.1_embedding.osteoblast)              #p=3.9e-11
t.test(HC.mean$H1.1_embedding.osteoblast,HC.mean$H1.1_mineralizing.osteoblast) #p=2.6e-10
t.test(HC.mean$H1.1_mineralizing.osteoblast,HC.mean$H1.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H1.2_preosteoblast,HC.mean$H1.2_osteoblast)                     #p=1.5e-13
t.test(HC.mean$H1.2_osteoblast,HC.mean$H1.2_embedding.osteoblast)              #p=8.2e-12
t.test(HC.mean$H1.2_embedding.osteoblast,HC.mean$H1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$H1.2_mineralizing.osteoblast,HC.mean$H1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H2.1_preosteoblast,HC.mean$H2.1_osteoblast)                     #p=6.9e-11
t.test(HC.mean$H2.1_osteoblast,HC.mean$H2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H2.1_embedding.osteoblast,HC.mean$H2.1_mineralizing.osteoblast) #p=0.03296
t.test(HC.mean$H2.1_mineralizing.osteoblast,HC.mean$H2.1_maturing.osteocyte)   #p=0.71240
t.test(HC.mean$H3.1_preosteoblast,HC.mean$H3.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H3.1_osteoblast,HC.mean$H3.1_embedding.osteoblast)              #p=1.5e-07
t.test(HC.mean$H3.1_embedding.osteoblast,HC.mean$H3.1_mineralizing.osteoblast) #p=2.3e-05
t.test(HC.mean$H3.1_mineralizing.osteoblast,HC.mean$H3.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H4.1_preosteoblast,HC.mean$H4.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$H4.1_osteoblast,HC.mean$H4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H4.1_embedding.osteoblast,HC.mean$H4.1_mineralizing.osteoblast) #p=2.2e-13
t.test(HC.mean$H4.1_mineralizing.osteoblast,HC.mean$H4.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$H5.1_preosteoblast,HC.mean$H5.1_osteoblast)                     #p=3.3e-07
t.test(HC.mean$H5.1_osteoblast,HC.mean$H5.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H5.1_embedding.osteoblast,HC.mean$H5.1_mineralizing.osteoblast) #p=0.02699
t.test(HC.mean$H5.1_mineralizing.osteoblast,HC.mean$H5.1_maturing.osteocyte)   #p=2.6e-08
t.test(HC.mean$H6.1_preosteoblast,HC.mean$H6.1_osteoblast)                     #p=8.8e-09
t.test(HC.mean$H6.1_osteoblast,HC.mean$H6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$H6.1_embedding.osteoblast,HC.mean$H6.1_mineralizing.osteoblast) #p=0.37260
t.test(HC.mean$H6.1_mineralizing.osteoblast,HC.mean$H6.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C1.1_preosteoblast,HC.mean$C1.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C1.1_osteoblast,HC.mean$C1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1.1_embedding.osteoblast,HC.mean$C1.1_mineralizing.osteoblast) #p=0.08749
t.test(HC.mean$C1.1_mineralizing.osteoblast,HC.mean$C1.1_maturing.osteocyte)   #p<2.2e-16
#t.test(HC.mean$C1.2_preosteoblast,HC.mean$C1.2_osteoblast)                     #p=NA
t.test(HC.mean$C1.2_osteoblast,HC.mean$C1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C1.2_embedding.osteoblast,HC.mean$C1.2_mineralizing.osteoblast) #p=6.0e-13
t.test(HC.mean$C1.2_mineralizing.osteoblast,HC.mean$C1.2_maturing.osteocyte)   #p=6.4e-05
t.test(HC.mean$C2.1_preosteoblast,HC.mean$C2.1_osteoblast)                     #p=6.9e-08
t.test(HC.mean$C2.1_osteoblast,HC.mean$C2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C2.1_embedding.osteoblast,HC.mean$C2.1_mineralizing.osteoblast) #p=0.00507
t.test(HC.mean$C2.1_mineralizing.osteoblast,HC.mean$C2.1_maturing.osteocyte)   #p=0.00653
t.test(HC.mean$C3.1_preosteoblast,HC.mean$C3.1_osteoblast)                     #p=6.2e-07
t.test(HC.mean$C3.1_osteoblast,HC.mean$C3.1_embedding.osteoblast)              #p=2.7e-11
t.test(HC.mean$C3.1_embedding.osteoblast,HC.mean$C3.1_mineralizing.osteoblast) #p=9.8e-11
t.test(HC.mean$C3.1_mineralizing.osteoblast,HC.mean$C3.1_maturing.osteocyte)   #p=0.24900
t.test(HC.mean$C4.1_preosteoblast,HC.mean$C4.1_osteoblast)                     #p=0.79680
t.test(HC.mean$C4.1_osteoblast,HC.mean$C4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C4.1_embedding.osteoblast,HC.mean$C4.1_mineralizing.osteoblast) #p=3.5e-06
t.test(HC.mean$C4.1_mineralizing.osteoblast,HC.mean$C4.1_maturing.osteocyte)   #p=0.18870
t.test(HC.mean$C5.1_preosteoblast,HC.mean$C5.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C5.1_osteoblast,HC.mean$C5.1_embedding.osteoblast)              #p=4.2e-14
t.test(HC.mean$C5.1_embedding.osteoblast,HC.mean$C5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C5.1_mineralizing.osteoblast,HC.mean$C5.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$C6.1_preosteoblast,HC.mean$C6.1_osteoblast)                     #p<2.2e-16
t.test(HC.mean$C6.1_osteoblast,HC.mean$C6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$C6.1_embedding.osteoblast,HC.mean$C6.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.mean$C6.1_mineralizing.osteoblast,HC.mean$C6.1_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in ost (expt H5.1,C2.1,C3.1,C4.1), increases in emb.ost (expt H1.1,H3.1), decreases in min.ost (expt H1.1,H1.2,H2.1,C6.1), and decreases in mat.ost (expt H5.1,C4.1,C5.1)
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["H1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_preosteoblast")],1, var))
HC.var["H1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_osteoblast")],1, var))
HC.var["H1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_embedding.osteoblast")],1, var))
HC.var["H1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_mineralizing.osteoblast")],1, var))
HC.var["H1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.1_maturing.osteocyte")],1, var))
HC.var["H1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_preosteoblast")],1, var))
HC.var["H1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_osteoblast")],1, var))
HC.var["H1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_embedding.osteoblast")],1, var))
HC.var["H1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_mineralizing.osteoblast")],1, var))
HC.var["H1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H1.2_maturing.osteocyte")],1, var))
HC.var["H2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_preosteoblast")],1, var))
HC.var["H2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_osteoblast")],1, var))
HC.var["H2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_embedding.osteoblast")],1, var))
HC.var["H2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_mineralizing.osteoblast")],1, var))
HC.var["H2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H2.1_maturing.osteocyte")],1, var))
HC.var["H3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_preosteoblast")],1, var))
HC.var["H3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_osteoblast")],1, var))
HC.var["H3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_embedding.osteoblast")],1, var))
HC.var["H3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_mineralizing.osteoblast")],1, var))
HC.var["H3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H3.1_maturing.osteocyte")],1, var))
HC.var["H4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_preosteoblast")],1, var))
HC.var["H4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_osteoblast")],1, var))
HC.var["H4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_embedding.osteoblast")],1, var))
HC.var["H4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_mineralizing.osteoblast")],1, var))
HC.var["H4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H4.1_maturing.osteocyte")],1, var))
HC.var["H5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_preosteoblast")],1, var))
HC.var["H5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_osteoblast")],1, var))
HC.var["H5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_embedding.osteoblast")],1, var))
HC.var["H5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_mineralizing.osteoblast")],1, var))
HC.var["H5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H5.1_maturing.osteocyte")],1, var))
HC.var["H6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_preosteoblast")],1, var))
HC.var["H6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_osteoblast")],1, var))
HC.var["H6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_embedding.osteoblast")],1, var))
HC.var["H6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_mineralizing.osteoblast")],1, var))
HC.var["H6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="H6.1_maturing.osteocyte")],1, var))
HC.var["C1.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_preosteoblast")],1, var))
HC.var["C1.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_osteoblast")],1, var))
HC.var["C1.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_embedding.osteoblast")],1, var))
HC.var["C1.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_mineralizing.osteoblast")],1, var))
HC.var["C1.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.1_maturing.osteocyte")],1, var))
HC.var["C1.2_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_preosteoblast")],1, var))
HC.var["C1.2_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_osteoblast")],1, var))
HC.var["C1.2_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_embedding.osteoblast")],1, var))
HC.var["C1.2_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_mineralizing.osteoblast")],1, var))
HC.var["C1.2_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C1.2_maturing.osteocyte")],1, var))
HC.var["C2.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_preosteoblast")],1, var))
HC.var["C2.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_osteoblast")],1, var))
HC.var["C2.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_embedding.osteoblast")],1, var))
HC.var["C2.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_mineralizing.osteoblast")],1, var))
HC.var["C2.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C2.1_maturing.osteocyte")],1, var))
HC.var["C3.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_preosteoblast")],1, var))
HC.var["C3.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_osteoblast")],1, var))
HC.var["C3.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_embedding.osteoblast")],1, var))
HC.var["C3.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_mineralizing.osteoblast")],1, var))
HC.var["C3.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C3.1_maturing.osteocyte")],1, var))
HC.var["C4.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_preosteoblast")],1, var))
HC.var["C4.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_osteoblast")],1, var))
HC.var["C4.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_embedding.osteoblast")],1, var))
HC.var["C4.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_mineralizing.osteoblast")],1, var))
HC.var["C4.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C4.1_maturing.osteocyte")],1, var))
HC.var["C5.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_preosteoblast")],1, var))
HC.var["C5.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_osteoblast")],1, var))
HC.var["C5.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_embedding.osteoblast")],1, var))
HC.var["C5.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_mineralizing.osteoblast")],1, var))
HC.var["C5.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C5.1_maturing.osteocyte")],1, var))
HC.var["C6.1_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_preosteoblast")],1, var))
HC.var["C6.1_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_osteoblast")],1, var))
HC.var["C6.1_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_embedding.osteoblast")],1, var))
HC.var["C6.1_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_mineralizing.osteoblast")],1, var))
HC.var["C6.1_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="C6.1_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("H1.1_preosteoblast","H1.1_osteoblast","H1.1_embedding.osteoblast","H1.1_mineralizing.osteoblast","H1.1_maturing.osteocyte",
                                    "H1.2_preosteoblast","H1.2_osteoblast","H1.2_embedding.osteoblast","H1.2_mineralizing.osteoblast","H1.2_maturing.osteocyte",
                                    "H2.1_preosteoblast","H2.1_osteoblast","H2.1_embedding.osteoblast","H2.1_mineralizing.osteoblast","H2.1_maturing.osteocyte",
                                    "H3.1_preosteoblast","H3.1_osteoblast","H3.1_embedding.osteoblast","H3.1_mineralizing.osteoblast","H3.1_maturing.osteocyte",
                                    "H4.1_preosteoblast","H4.1_osteoblast","H4.1_embedding.osteoblast","H4.1_mineralizing.osteoblast","H4.1_maturing.osteocyte",
                                    "H5.1_preosteoblast","H5.1_osteoblast","H5.1_embedding.osteoblast","H5.1_mineralizing.osteoblast","H5.1_maturing.osteocyte",
                                    "H6.1_preosteoblast","H6.1_osteoblast","H6.1_embedding.osteoblast","H6.1_mineralizing.osteoblast","H6.1_maturing.osteocyte",
                                    "C1.1_preosteoblast","C1.1_osteoblast","C1.1_embedding.osteoblast","C1.1_mineralizing.osteoblast","C1.1_maturing.osteocyte",
                                    "C1.2_preosteoblast","C1.2_osteoblast","C1.2_embedding.osteoblast","C1.2_mineralizing.osteoblast","C1.2_maturing.osteocyte",
                                    "C2.1_preosteoblast","C2.1_osteoblast","C2.1_embedding.osteoblast","C2.1_mineralizing.osteoblast","C2.1_maturing.osteocyte",
                                    "C3.1_preosteoblast","C3.1_osteoblast","C3.1_embedding.osteoblast","C3.1_mineralizing.osteoblast","C3.1_maturing.osteocyte",
                                    "C4.1_preosteoblast","C4.1_osteoblast","C4.1_embedding.osteoblast","C4.1_mineralizing.osteoblast","C4.1_maturing.osteocyte",
                                    "C5.1_preosteoblast","C5.1_osteoblast","C5.1_embedding.osteoblast","C5.1_mineralizing.osteoblast","C5.1_maturing.osteocyte",
                                    "C6.1_preosteoblast","C6.1_osteoblast","C6.1_embedding.osteoblast","C6.1_mineralizing.osteoblast","C6.1_maturing.osteocyte"))
HC.var.melt$individual <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=individual, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Individual") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$H1.1_preosteoblast,HC.var$H1.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1.1_osteoblast,HC.var$H1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1.1_embedding.osteoblast,HC.var$H1.1_mineralizing.osteoblast) #p=0.26460
t.test(HC.var$H1.1_mineralizing.osteoblast,HC.var$H1.1_maturing.osteocyte)   #p=7.7e-06
t.test(HC.var$H1.2_preosteoblast,HC.var$H1.2_osteoblast)                     #p<2.2e-16
t.test(HC.var$H1.2_osteoblast,HC.var$H1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H1.2_embedding.osteoblast,HC.var$H1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H1.2_mineralizing.osteoblast,HC.var$H1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H2.1_preosteoblast,HC.var$H2.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H2.1_osteoblast,HC.var$H2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H2.1_embedding.osteoblast,HC.var$H2.1_mineralizing.osteoblast) #p=0.33970
t.test(HC.var$H2.1_mineralizing.osteoblast,HC.var$H2.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H3.1_preosteoblast,HC.var$H3.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H3.1_osteoblast,HC.var$H3.1_embedding.osteoblast)              #p=0.11930
t.test(HC.var$H3.1_embedding.osteoblast,HC.var$H3.1_mineralizing.osteoblast) #p=5.7e-06
t.test(HC.var$H3.1_mineralizing.osteoblast,HC.var$H3.1_maturing.osteocyte)   #p=1.9e-12
t.test(HC.var$H4.1_preosteoblast,HC.var$H4.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H4.1_osteoblast,HC.var$H4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H4.1_embedding.osteoblast,HC.var$H4.1_mineralizing.osteoblast) #p=0.01404
t.test(HC.var$H4.1_mineralizing.osteoblast,HC.var$H4.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$H5.1_preosteoblast,HC.var$H5.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H5.1_osteoblast,HC.var$H5.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H5.1_embedding.osteoblast,HC.var$H5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$H5.1_mineralizing.osteoblast,HC.var$H5.1_maturing.osteocyte)   #p=0.28510
t.test(HC.var$H6.1_preosteoblast,HC.var$H6.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$H6.1_osteoblast,HC.var$H6.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$H6.1_embedding.osteoblast,HC.var$H6.1_mineralizing.osteoblast) #p=1.6e-10
t.test(HC.var$H6.1_mineralizing.osteoblast,HC.var$H6.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C1.1_preosteoblast,HC.var$C1.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C1.1_osteoblast,HC.var$C1.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1.1_embedding.osteoblast,HC.var$C1.1_mineralizing.osteoblast) #p=1.9e-06
t.test(HC.var$C1.1_mineralizing.osteoblast,HC.var$C1.1_maturing.osteocyte)   #p<2.8e-16
#t.test(HC.var$C1.2_preosteoblast,HC.var$C1.2_osteoblast)                     #p=NA
t.test(HC.var$C1.2_osteoblast,HC.var$C1.2_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C1.2_embedding.osteoblast,HC.var$C1.2_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C1.2_mineralizing.osteoblast,HC.var$C1.2_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C2.1_preosteoblast,HC.var$C2.1_osteoblast)                     #p=0.70000
t.test(HC.var$C2.1_osteoblast,HC.var$C2.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C2.1_embedding.osteoblast,HC.var$C2.1_mineralizing.osteoblast) #p=0.00039
t.test(HC.var$C2.1_mineralizing.osteoblast,HC.var$C2.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C3.1_preosteoblast,HC.var$C3.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C3.1_osteoblast,HC.var$C3.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C3.1_embedding.osteoblast,HC.var$C3.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C3.1_mineralizing.osteoblast,HC.var$C3.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C4.1_preosteoblast,HC.var$C4.1_osteoblast)                     #p=0.25910
t.test(HC.var$C4.1_osteoblast,HC.var$C4.1_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$C4.1_embedding.osteoblast,HC.var$C4.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C4.1_mineralizing.osteoblast,HC.var$C4.1_maturing.osteocyte)   #p=0.98870
t.test(HC.var$C5.1_preosteoblast,HC.var$C5.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C5.1_osteoblast,HC.var$C5.1_embedding.osteoblast)              #p=1.2e-10
t.test(HC.var$C5.1_embedding.osteoblast,HC.var$C5.1_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$C5.1_mineralizing.osteoblast,HC.var$C5.1_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$C6.1_preosteoblast,HC.var$C6.1_osteoblast)                     #p<2.2e-16
t.test(HC.var$C6.1_osteoblast,HC.var$C6.1_embedding.osteoblast)              #p=1.2e-05
t.test(HC.var$C6.1_embedding.osteoblast,HC.var$C6.1_mineralizing.osteoblast) #p=9.6e-05
t.test(HC.var$C6.1_mineralizing.osteoblast,HC.var$C6.1_maturing.osteocyte)   #p<2.2e-16

```

### Examine variance in log2cpm (pseudobulk resolution)

Can only look at variance across species, not individuals.

### Pseudobulk: Stages vs. Species

```{r}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("Time 0","Time 1","Time 2")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=Stage==j)
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",j)
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.stg <- dataSub@meta.data$Stage[w][1]
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.stg))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","Stage")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,sapply(dge$samples$Stage,function(x)sub(" ","",x)),sep = "."),
                      levels=c("Human.Time0","Human.Time1","Human.Time2","Chimp.Time0","Chimp.Time1","Chimp.Time2"))

# Calculate log2cpm means within species - mean is constant across time points
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human.Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human.Time0")],1, mean))
HC.mean["Human.Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human.Time1")],1, mean))
HC.mean["Human.Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human.Time2")],1, mean))
HC.mean["Chimp.Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp.Time0")],1, mean))
HC.mean["Chimp.Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp.Time1")],1, mean))
HC.mean["Chimp.Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp.Time2")],1, mean))
HC.mean.melt <- melt(HC.mean,id.vars="gene",measure.vars=c("Human.Time0","Human.Time1","Human.Time2","Chimp.Time0","Chimp.Time1","Chimp.Time2"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"[.]")[[1]][1])
HC.mean.melt$stage <- sapply(HC.mean.melt$variable,function(x)str_split(x,"[.]")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=stage)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human.Time0,HC.mean$Human.Time1) #p=0.19
t.test(HC.mean$Human.Time1,HC.mean$Human.Time2) #p=0.47
t.test(HC.mean$Chimp.Time0,HC.mean$Chimp.Time1) #p=0.84
t.test(HC.mean$Chimp.Time1,HC.mean$Chimp.Time2) #p=0.09

# Calculate log2cpm variances within species - variance increases in time 1 and time 2
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human.Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human.Time0")],1, var))
HC.var["Human.Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human.Time1")],1, var))
HC.var["Human.Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human.Time2")],1, var))
HC.var["Chimp.Time0"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp.Time0")],1, var))
HC.var["Chimp.Time1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp.Time1")],1, var))
HC.var["Chimp.Time2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp.Time2")],1, var))
HC.var.melt <- melt(HC.var,id.vars="gene",measure.vars=c("Human.Time0","Human.Time1","Human.Time2","Chimp.Time0","Chimp.Time1","Chimp.Time2"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"[.]")[[1]][1])
HC.var.melt$stage <- sapply(HC.var.melt$variable,function(x)str_split(x,"[.]")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=stage)) +
  geom_boxplot(width=0.8, outlier.shape=NA) +
  xlab("Species") +
  ylab('Log2 Variance in Gene Expression') +
  ylim(c(-10,5)) +
  scale_fill_manual(name="Stage", labels=c("Time 0","Time 1","Time 2"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=12), axis.title=element_text(size=12), legend.text=element_text(size=12))
t.test(HC.var$Human.Time0,HC.var$Human.Time1) #p<2.2e-16
t.test(HC.var$Human.Time1,HC.var$Human.Time2) #p=3.1e-13
t.test(HC.var$Chimp.Time0,HC.var$Chimp.Time1) #p<2.2e-16
t.test(HC.var$Chimp.Time1,HC.var$Chimp.Time2) #p<2.2e-16

```

### Pseudobulk: General Cluster vs. Species (res=0.05)

```{r}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=Cluster==j)
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",j)
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.clt <- dataSub@meta.data$Cluster[w][1]
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.clt))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","Cluster")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$Cluster,sep="_"),
                      levels=c("Human_iPSC.c1","Human_iPSC.c2","Human_iPSC.c3","Human_MSC.c1","Human_Osteogenic.c1","Human_Osteogenic.c2",
                               "Chimp_iPSC.c1","Chimp_iPSC.c2","Chimp_iPSC.c3","Chimp_MSC.c1","Chimp_Osteogenic.c1","Chimp_Osteogenic.c2"))

# Calculate log2cpm means within species - mean is constant across time points
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c1")],1, mean))
HC.mean["Human_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c2")],1, mean))
HC.mean["Human_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c3")],1, mean))
HC.mean["Human_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC.c1")],1, mean))
HC.mean["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, mean))
HC.mean["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, mean))
HC.mean["Chimp_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c1")],1, mean))
HC.mean["Chimp_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c2")],1, mean))
HC.mean["Chimp_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c3")],1, mean))
HC.mean["Chimp_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_iPSC.c1","Human_iPSC.c2","Human_iPSC.c3","Human_MSC.c1","Human_Osteogenic.c1","Human_Osteogenic.c2",
                                    "Chimp_iPSC.c1","Chimp_iPSC.c2","Chimp_iPSC.c3","Chimp_MSC.c1","Chimp_Osteogenic.c1","Chimp_Osteogenic.c2"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_iPSC.c1,HC.mean$Human_MSC.c1)       #p=0.8294
t.test(HC.mean$Human_MSC.c1,HC.mean$Human_Osteogenic.c1) #p=0.8799
t.test(HC.mean$Chimp_iPSC.c1,HC.mean$Chimp_MSC.c1)       #p=0.1768
t.test(HC.mean$Chimp_MSC.c1,HC.mean$Chimp_Osteogenic.c1) #p=0.3419

# Calculate log2cpm variances within species - variance increases in MSC.c1 and Osteogenic.c1
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c1")],1, var))
HC.var["Human_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c2")],1, var))
HC.var["Human_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC.c3")],1, var))
HC.var["Human_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC.c1")],1, var))
HC.var["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, var))
HC.var["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, var))
HC.var["Chimp_iPSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c1")],1, var))
HC.var["Chimp_iPSC.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c2")],1, var))
HC.var["Chimp_iPSC.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC.c3")],1, var))
HC.var["Chimp_MSC.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC.c1")],1, var))
HC.var["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, var))
HC.var["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_iPSC.c1","Human_iPSC.c2","Human_iPSC.c3","Human_MSC.c1","Human_Osteogenic.c1","Human_Osteogenic.c2",
                                   "Chimp_iPSC.c1","Chimp_iPSC.c2","Chimp_iPSC.c3","Chimp_MSC.c1","Chimp_Osteogenic.c1","Chimp_Osteogenic.c2"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","iPSC.c2","iPSC.c3","MSC.c1","Osteogenic.c1","Osteogenic.c2"),
                    values=c("pink","pink3","pink4","mediumorchid","dodgerblue","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("iPSC.c1","MSC.c1","Osteogenic.c1")), aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("iPSC.c1","MSC.c1","Osteogenic.c1"),
                    values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_iPSC.c1,HC.var$Human_MSC.c1)       #p<2.2e-16
t.test(HC.var$Human_MSC.c1,HC.var$Human_Osteogenic.c1) #p=0.00548
t.test(HC.var$Chimp_iPSC.c1,HC.var$Chimp_MSC.c1)       #p<2.2e-16
t.test(HC.var$Chimp_MSC.c1,HC.var$Chimp_Osteogenic.c1) #p<2.2e-16

```

### Pseudobulk: General Ad Hoc Classifications vs. Species (thresh0)

```{r}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("iPSC","MSC","Osteogenic","other")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=AdHoc.Assign.thresh0==j)
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",j)
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.adh <- as.character(dataSub@meta.data$AdHoc.Assign.thresh0[w][1])
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.adh))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","AdHoc")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc,sep = "_"),
                      levels=c("Human_iPSC","Human_MSC","Human_Osteogenic","Human_other","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic","Chimp_other"))

# Calculate log2cpm means within species - mean stays constant in MSCs and increases in Osteogenic cells
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, mean))
HC.mean["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, mean))
HC.mean["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, mean))
HC.mean["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, mean))
HC.mean["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, mean))
HC.mean["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_iPSC,HC.mean$Human_MSC)       #p=0.43100
t.test(HC.mean$Human_MSC,HC.mean$Human_Osteogenic) #p=0.00396
t.test(HC.mean$Chimp_iPSC,HC.mean$Chimp_MSC)       #p=0.10460
t.test(HC.mean$Chimp_MSC,HC.mean$Chimp_Osteogenic) #p=0.00013

# Calculate log2cpm variances within species - variance increases in MSCs and increases in Osteogenic cells
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, var))
HC.var["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, var))
HC.var["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, var))
HC.var["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, var))
HC.var["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, var))
HC.var["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_iPSC,HC.var$Human_MSC)       #p<2.2e-16
t.test(HC.var$Human_MSC,HC.var$Human_Osteogenic) #p<2.2e-16
t.test(HC.var$Chimp_iPSC,HC.var$Chimp_MSC)       #p<2.2e-16
t.test(HC.var$Chimp_MSC,HC.var$Chimp_Osteogenic) #p<2.2e-16

```

### Pseudobulk: General Ad Hoc Classifications vs. Species (median)

```{r, eval=FALSE}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("iPSC","MSC","Osteogenic","other")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=AdHoc.Assign.median==j)
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",j)
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.adh <- as.character(dataSub@meta.data$AdHoc.Assign.median[w][1])
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.adh))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","AdHoc")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc,sep = "_"),
                      levels=c("Human_iPSC","Human_MSC","Human_Osteogenic","Human_other","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic","Chimp_other"))

# Calculate log2cpm means within species - mean stays constant in MSCs (except H) and increases in Osteogenic cells
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, mean))
HC.mean["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, mean))
HC.mean["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, mean))
HC.mean["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, mean))
HC.mean["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, mean))
HC.mean["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, mean))
HC.mean.melt <- melt(HC.mean,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$adhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_iPSC,HC.mean$Human_MSC)       #p=0.00139
t.test(HC.mean$Human_MSC,HC.mean$Human_Osteogenic) #p=5.2e-08
t.test(HC.mean$Chimp_iPSC,HC.mean$Chimp_MSC)       #p=0.83960
t.test(HC.mean$Chimp_MSC,HC.mean$Chimp_Osteogenic) #p=4.9e-06

# Calculate log2cpm variances within species - variance increases in MSCs and decreases in Osteogenic cells
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_iPSC")],1, var))
HC.var["Human_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_MSC")],1, var))
HC.var["Human_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic")],1, var))
HC.var["Chimp_iPSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_iPSC")],1, var))
HC.var["Chimp_MSC"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_MSC")],1, var))
HC.var["Chimp_Osteogenic"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic")],1, var))
HC.var.melt <- melt(HC.var,id.vars="gene",measure.vars=c("Human_iPSC","Human_MSC","Human_Osteogenic","Chimp_iPSC","Chimp_MSC","Chimp_Osteogenic"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$adhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=adhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ad Hoc", labels=c("iPSC","MSC","Osteogenic"), values=c("pink","mediumorchid","dodgerblue")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_iPSC,HC.var$Human_MSC)       #p<2.2e-16
t.test(HC.var$Human_MSC,HC.var$Human_Osteogenic) #p<2.2e-16
t.test(HC.var$Chimp_iPSC,HC.var$Chimp_MSC)       #p<2.2e-16
t.test(HC.var$Chimp_MSC,HC.var$Chimp_Osteogenic) #p<2.2e-16

```

### Pseudobulk: Osteogenic Cluster vs. Species (res=0.5)

```{r}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=Cluster0.5==j)
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",j)
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.clt <- dataSub@meta.data$Cluster0.5[w][1]
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.clt))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","Cluster")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$Cluster,sep="_"),
                      levels=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                               "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))

# Calculate log2cpm means within species - mean is constant in Osteogenic.c2, decreases in Osteogenic.c3, and decreases in Osteogenic.c5
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, mean))
HC.mean["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, mean))
HC.mean["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, mean))
HC.mean["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, mean))
HC.mean["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, mean))
HC.mean["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, mean))
HC.mean["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, mean))
HC.mean["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, mean))
HC.mean["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5")), aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_Osteogenic.c1,HC.mean$Human_Osteogenic.c2) #p=0.87240
t.test(HC.mean$Human_Osteogenic.c2,HC.mean$Human_Osteogenic.c3) #p=1.2e-08
t.test(HC.mean$Human_Osteogenic.c3,HC.mean$Human_Osteogenic.c5) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c1,HC.mean$Chimp_Osteogenic.c2) #p=0.60630
t.test(HC.mean$Chimp_Osteogenic.c2,HC.mean$Chimp_Osteogenic.c3) #p=9.8e-15
t.test(HC.mean$Chimp_Osteogenic.c3,HC.mean$Chimp_Osteogenic.c5) #p<2.2e-16

# Calculate log2cpm variances within species - variance decreases in Osteogenic.c2, increases in Osteogenic.c3, and increases in Osteogenic.c5
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, var))
HC.var["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, var))
HC.var["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, var))
HC.var["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, var))
HC.var["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, var))
HC.var["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, var))
HC.var["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, var))
HC.var["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, var))
HC.var["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, var))
HC.var["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5")), aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_Osteogenic.c1,HC.var$Human_Osteogenic.c2) #p=2.7e-08
t.test(HC.var$Human_Osteogenic.c2,HC.var$Human_Osteogenic.c3) #p<2.2e-16
t.test(HC.var$Human_Osteogenic.c3,HC.var$Human_Osteogenic.c5) #p<2.2e-16
t.test(HC.var$Chimp_Osteogenic.c1,HC.var$Chimp_Osteogenic.c2) #p=0.00438
t.test(HC.var$Chimp_Osteogenic.c2,HC.var$Chimp_Osteogenic.c3) #p<2.2e-16
t.test(HC.var$Chimp_Osteogenic.c3,HC.var$Chimp_Osteogenic.c5) #p<2.2e-16

```

### Pseudobulk: Osteogenic Cluster vs. Species (t2 with res=0.1)

```{r, eval=FALSE}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=Cluster.t2==j)
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",j)
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.clt <- dataSub@meta.data$Cluster.t2[w][1]
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.clt))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","Cluster")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$Cluster,sep="_"),
                      levels=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                               "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))

# Calculate log2cpm means within species - mean is constant in Osteogenic.c2, decreases in Osteogenic.c3, and increases in Osteogenic.c5
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, mean))
HC.mean["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, mean))
HC.mean["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, mean))
HC.mean["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, mean))
HC.mean["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, mean))
HC.mean["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, mean))
HC.mean["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, mean))
HC.mean["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, mean))
HC.mean["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, mean))
HC.mean["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$cluster <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt %>% filter(cluster %in% c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5")), aes(x=species, y=value, fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_Osteogenic.c1,HC.mean$Human_Osteogenic.c2) #p=0.71170
t.test(HC.mean$Human_Osteogenic.c2,HC.mean$Human_Osteogenic.c3) #p<2.2e-16
t.test(HC.mean$Human_Osteogenic.c3,HC.mean$Human_Osteogenic.c5) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c1,HC.mean$Chimp_Osteogenic.c2) #p=0.09193
t.test(HC.mean$Chimp_Osteogenic.c2,HC.mean$Chimp_Osteogenic.c3) #p<2.2e-16
t.test(HC.mean$Chimp_Osteogenic.c3,HC.mean$Chimp_Osteogenic.c5) #p<2.2e-16

# Calculate log2cpm variances within species - variance decreases in Osteogenic.c2, increases in Osteogenic.c3, and decrease in Osteogenic.c5
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c1")],1, var))
HC.var["Human_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c2")],1, var))
HC.var["Human_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c3")],1, var))
HC.var["Human_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c4")],1, var))
HC.var["Human_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_Osteogenic.c5")],1, var))
HC.var["Chimp_Osteogenic.c1"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c1")],1, var))
HC.var["Chimp_Osteogenic.c2"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c2")],1, var))
HC.var["Chimp_Osteogenic.c3"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c3")],1, var))
HC.var["Chimp_Osteogenic.c4"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c4")],1, var))
HC.var["Chimp_Osteogenic.c5"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_Osteogenic.c5")],1, var))
HC.var.melt <- melt(HC.var,
                     id.vars="gene",
                     measure.vars=c("Human_Osteogenic.c1","Human_Osteogenic.c2","Human_Osteogenic.c3","Human_Osteogenic.c4","Human_Osteogenic.c5",
                                    "Chimp_Osteogenic.c1","Chimp_Osteogenic.c2","Chimp_Osteogenic.c3","Chimp_Osteogenic.c4","Chimp_Osteogenic.c5"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$cluster <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c4","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","black","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt %>% filter(cluster %in% c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5")), aes(x=species, y=log2(value), fill=cluster)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance gene expression') +
  scale_fill_manual(name="Cluster",
                    labels=c("Osteogenic.c1","Osteogenic.c2","Osteogenic.c3","Osteogenic.c5"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_Osteogenic.c1,HC.var$Human_Osteogenic.c2) #p=5.1e-07
t.test(HC.var$Human_Osteogenic.c2,HC.var$Human_Osteogenic.c3) #p<2.2e-16
t.test(HC.var$Human_Osteogenic.c3,HC.var$Human_Osteogenic.c5) #p<2.2e-16
t.test(HC.var$Chimp_Osteogenic.c1,HC.var$Chimp_Osteogenic.c2) #p=0.05122
t.test(HC.var$Chimp_Osteogenic.c2,HC.var$Chimp_Osteogenic.c3) #p<2.2e-16
t.test(HC.var$Chimp_Osteogenic.c3,HC.var$Chimp_Osteogenic.c5) #p<2.2e-16

```

### Pseudobulk: Osteogenic Ad Hoc Classifications vs. Species (thresh0)

```{r}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("preosteoblast","osteoblast","embedding osteoblast","mineralizing osteoblast","maturing osteocyte","unknown osteogenic","not osteogenic")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=OstAdHoc.Assign.5gene.thresh0==j)
  #dataSub <- subset(data,subset=(OstAdHoc.Assign.5gene.median==j & Stage=="Time 2"))
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",sub(" ",".",j))
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.adh <- sub(" ",".",as.character(dataSub@meta.data$OstAdHoc.Assign.5gene.thresh0[w][1]))
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.adh))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","AdHoc")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc,sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte","Chimp_other",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean decreases in osteoblasts (expt in C), increases in emb.osteoblasts, stays constant in min.osteoblasts, and decreases in mat.osteocytes
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","royalblue3","royalblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p<2.2e-16
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=0.17130
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p=0.11070
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p=6.2e-12
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p=0.12300
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in osteoblasts (expt C), decreases in emb.osteoblasts, increases in min.osteoblasts (expt C), and increases in mat.osteocytes
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p<2.2e-16
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p=2.3e-06
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p=4.7e-13
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=0.03064
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p<2.2e-16

```

### TEMPORARY
### Pseudobulk: Osteogenic Ad Hoc Classifications vs. Species (t2 with thresh0 in tot)

```{r TEMPORARY, eval=FALSE}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("preosteoblast","osteoblast","embedding osteoblast","mineralizing osteoblast","maturing osteocyte","unknown osteogenic","not osteogenic")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=OstAdHoc.Assign.5gene.thresh0==j)
  #dataSub <- subset(data,subset=(OstAdHoc.Assign.5gene.median==j & Stage=="Time 2"))
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",sub(" ",".",j))
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.adh <- sub(" ",".",as.character(dataSub@meta.data$OstAdHoc.Assign.5gene.thresh0[w][1]))
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.adh))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","AdHoc")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc,sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte","Chimp_other",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean decreases in osteoblasts (expt in C), increases in emb.osteoblasts, stays constant in min.osteoblasts, and decreases in mat.osteocytes
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","royalblue3","royalblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p<2.2e-16
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=0.17130
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p=0.11070
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p=6.2e-12
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p=0.12300
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in osteoblasts (expt C), decreases in emb.osteoblasts, increases in min.osteoblasts (expt C), and increases in mat.osteocytes
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p<2.2e-16
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p=2.3e-06
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p=4.7e-13
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=0.03064
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p<2.2e-16

```

### Pseudobulk: Osteogenic Ad Hoc Classifications vs. Species (median)

```{r, eval=FALSE}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("preosteoblast","osteoblast","embedding osteoblast","mineralizing osteoblast","maturing osteocyte","unknown osteogenic","not osteogenic")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=OstAdHoc.Assign.5gene.median==j)
  #dataSub <- subset(data,subset=(OstAdHoc.Assign.5gene.median==j & Stage=="Time 2"))
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",sub(" ",".",j))
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.adh <- sub(" ",".",as.character(dataSub@meta.data$OstAdHoc.Assign.5gene.median[w][1]))
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.adh))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","AdHoc")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc,sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte","Chimp_other",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean decreases in osteoblasts (expt H), increases in emb.osteoblasts, stays constant in min.osteoblasts, and decreases in mat.osteocytes
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p=0.08132
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p=1.7e-09
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=0.60830
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p<2.2e-16
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p=0.00089
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p=0.82010
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p<2.2e-16

# Calculate log2cpm variances within species - variance increases in osteoblasts, decreases in emb.osteoblasts, increases in min.osteoblasts, and increases in mat.osteocytes
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
ggplot(HC.var.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_violin(width=0.7) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","MSC.c1","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","skyblue","deepskyblue","dodgerblue2","dodgerblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p<3.6e-10
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p=7.8e-08
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=0.65830
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p<2.2e-16

```

### Pseudobulk: Osteogenic Ad Hoc Classifications vs. Species (thresh0 in t2)

```{r, eval=FALSE}

# Compile log2 normalized gene expression data
#make count matrix and metadata for edgeR object - pseudobulk
cell.subset <- c("preosteoblast","osteoblast","embedding osteoblast","mineralizing osteoblast","maturing osteocyte","unknown osteogenic","not osteogenic")
counts <- c()
metadata <- c()
labels <- c()
for(j in cell.subset) {
  dataSub <- subset(data,subset=OstAdHoc.Assign.5gene.thresh0.t2==j)
  #dataSub <- subset(data,subset=(OstAdHoc.Assign.5gene.median==j & Stage=="Time 2"))
  for (i in unique(dataSub@meta.data$Individual.Replicate)) {
    x.lab <- paste0(i,"_",sub(" ",".",j))
    w <- which(dataSub@meta.data$Individual.Replicate==i)
    if (length(w)>0) {
      x.spp <- dataSub@meta.data$Species[w][1]
      x.col <- dataSub@meta.data$Collection[w][1]
      x.ind <- dataSub@meta.data$Individual[w][1]
      x.rep <- dataSub@meta.data$Replicate[w][1]
      x.idr <- dataSub@meta.data$Individual.Replicate[w][1]
      x.adh <- sub(" ",".",as.character(dataSub@meta.data$OstAdHoc.Assign.5gene.thresh0.t2[w][1]))
      if (length(w)==1) {
        x.cnt <- dataSub@assays$RNA@counts[,w]
      } else {
        x.cnt <- Matrix::rowSums(dataSub@assays$RNA@counts[,w])
      }
      counts <- cbind(counts, x.cnt)
      metadata <- rbind(metadata, c(x.lab, x.spp, x.col, x.ind, x.rep, x.idr, x.adh))
      labels <- c(labels, x.lab)
    }
  }
}
colnames(counts) <- labels
rownames(metadata) <- labels
colnames(metadata) <- c("Sample","Species","Collection","Individual","Replicate","Individual.Replicate","AdHoc")
metadata <- as.data.frame(metadata)

#remove mitochodrial and ribosomal genes
counts <- counts[which(rownames(counts) %in% genes.no.mito.ribo),]
#make edgeR object
dge <- DGEList(counts)
meta_dge <- dge$samples[,c("lib.size","norm.factors")]
meta_dge <- cbind(meta_dge, metadata)
dge$samples <- meta_dge
rm(counts,metadata,meta_dge)
#filter genes
keep <- rowMeans(edgeR::cpm(dge,log=TRUE,prior.count=0.25))>0
dge$counts <- dge$counts[keep,]
#normalize data
dge <- calcNormFactors(dge, method="TMM")
#log2 transformed cpm
tmm <- edgeR::cpm(dge,normalized.lib.sizes=TRUE,log=TRUE,prior.count=0.25)

# Compile group labels of each species
groupFactor <- factor(paste(dge$samples$Species,dge$samples$AdHoc,sep="_"),
                      levels=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                               "Human_unknown.osteogenic","Human_not.osteogenic",
                               "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte","Chimp_other",
                               "Chimp_unknown.osteogenic","Chimp_not.osteogenic"))

# Calculate log2cpm means within species - mean stays constant in osteoblasts (expt C), increases in emb.osteoblasts, decreases in min.osteoblasts (expt C), and decreases in mat.osteocytes
HC.mean <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.mean["gene"] <- rownames(tmm)
HC.mean["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, mean))
HC.mean["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, mean))
HC.mean["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, mean))
HC.mean["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, mean))
HC.mean["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, mean))
HC.mean["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, mean))
HC.mean["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, mean))
HC.mean["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, mean))
HC.mean["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, mean))
HC.mean["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, mean))
HC.mean.melt <- melt(HC.mean,
                     id.vars="gene",
                     measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                    "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.mean.melt$species <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.mean.melt$ostadhoc <- sapply(HC.mean.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.mean.melt, aes(x=species, y=value, fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 mean gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","royalblue3","royalblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.mean$Human_preosteoblast,HC.mean$Human_osteoblast)                     #p=0.20460
t.test(HC.mean$Human_osteoblast,HC.mean$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.mean$Human_embedding.osteoblast,HC.mean$Human_mineralizing.osteoblast) #p=6.8e-07
t.test(HC.mean$Human_mineralizing.osteoblast,HC.mean$Human_maturing.osteocyte)   #p=2.6e-05
t.test(HC.mean$Chimp_preosteoblast,HC.mean$Chimp_osteoblast)                     #p=5.8e-13
t.test(HC.mean$Chimp_osteoblast,HC.mean$Chimp_embedding.osteoblast)              #p=6.9e-06
t.test(HC.mean$Chimp_embedding.osteoblast,HC.mean$Chimp_mineralizing.osteoblast) #p=0.73040
t.test(HC.mean$Chimp_mineralizing.osteoblast,HC.mean$Chimp_maturing.osteocyte)   #p=8.9e-06

# Calculate log2cpm variances within species - variance stays constant in osteoblasts (expt C), decreases in emb.osteoblasts, increases in min.osteoblasts, and increases in mat.osteocytes
HC.var <- data.frame(matrix(nrow=dim(tmm)[1],ncol=0))
HC.var["gene"] <- rownames(tmm)
HC.var["Human_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_preosteoblast")],1, var))
HC.var["Human_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_osteoblast")],1, var))
HC.var["Human_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_embedding.osteoblast")],1, var))
HC.var["Human_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_mineralizing.osteoblast")],1, var))
HC.var["Human_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Human_maturing.osteocyte")],1, var))
HC.var["Chimp_preosteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_preosteoblast")],1, var))
HC.var["Chimp_osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_osteoblast")],1, var))
HC.var["Chimp_embedding.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_embedding.osteoblast")],1, var))
HC.var["Chimp_mineralizing.osteoblast"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_mineralizing.osteoblast")],1, var))
HC.var["Chimp_maturing.osteocyte"] <- as.data.frame(apply(tmm[,which(groupFactor=="Chimp_maturing.osteocyte")],1, var))
HC.var.melt <- melt(HC.var,
                    id.vars="gene",
                    measure.vars=c("Human_preosteoblast","Human_osteoblast","Human_embedding.osteoblast","Human_mineralizing.osteoblast","Human_maturing.osteocyte",
                                   "Chimp_preosteoblast","Chimp_osteoblast","Chimp_embedding.osteoblast","Chimp_mineralizing.osteoblast","Chimp_maturing.osteocyte"))
HC.var.melt$species <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][1])
HC.var.melt$ostadhoc <- sapply(HC.var.melt$variable,function(x)str_split(x,"_")[[1]][2])

ggplot(HC.var.melt, aes(x=species, y=log2(value), fill=ostadhoc)) +
  geom_boxplot(width=0.4) +
  xlab("Species") +
  ylab('log2 variance in gene expression') +
  scale_fill_manual(name="Ost Ad Hoc",
                    labels=c("preosteoblast","osteoblast","embedding.osteoblast","mineralizing.osteoblast","maturing.osteocyte"),
                    values=c("lightblue1","deepskyblue","dodgerblue2","royalblue3","royalblue4")) +
  theme_classic() +
  theme(axis.text=element_text(size=10), axis.title=element_text(size=10), legend.text=element_text(size=10))
t.test(HC.var$Human_preosteoblast,HC.var$Human_osteoblast)                     #p=0.29580
t.test(HC.var$Human_osteoblast,HC.var$Human_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Human_embedding.osteoblast,HC.var$Human_mineralizing.osteoblast) #p<2.2e-16
t.test(HC.var$Human_mineralizing.osteoblast,HC.var$Human_maturing.osteocyte)   #p<2.2e-16
t.test(HC.var$Chimp_preosteoblast,HC.var$Chimp_osteoblast)                     #p<2.2e-16
t.test(HC.var$Chimp_osteoblast,HC.var$Chimp_embedding.osteoblast)              #p<2.2e-16
t.test(HC.var$Chimp_embedding.osteoblast,HC.var$Chimp_mineralizing.osteoblast) #p=5.2e-13
t.test(HC.var$Chimp_mineralizing.osteoblast,HC.var$Chimp_maturing.osteocyte)   #p<2.2e-16

```
