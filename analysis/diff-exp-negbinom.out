
R version 3.4.3 (2017-11-30) -- "Kite-Eating Tree"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Load libraries
> library(Seurat)
> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> library(stringi)
> library(stringr)
> library(ggplot2)
> library(grid)
> library(gbm)
Loaded gbm 2.1.5
> library(colorspace)
> library(RColorBrewer)
> 
> library(tidyr)
> library(UpSetR)
> library(reshape2)

Attaching package: ‘reshape2’

The following object is masked from ‘package:tidyr’:

    smiths

> 
> library(CountClust)
> library(classtpx)
Loading required package: slam
> 
> #Define main directory
> dir <- '/project2/gilad/ghousman/skeletal-human-chimp/'
> dir2 <- paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full")
> 
> #Load data
> #scrna <- "/data.filterMT.regMT.indv.log.10k.int.rds" #integrate across individuals - total
> scrna <- "/data.filterMT.merge.l-TEMP.rds"                #merge all data without integration - total
> indv <- readRDS(paste0(dir2,scrna))
> 
> #Find differentially expressed genes between humans and chimpanzees
> Idents(indv) <- factor(indv@meta.data$species, levels=c("Chimp","Human"))
> 
> #Find differentially expressed genes using differentiation stage at collection
> compare.ips  <- FindMarkers(subset(indv,subset=Cell.Type=="iPSC"),
+                             assay="RNA", slot="counts",
+                             ident.1="Human", ident.2="Chimp",
+                             logfc.threshold=0.25, min.pct=0.25,
+                             test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning message:
In glm.nb(formula = fmla, data = latent.vars) : alternation limit reached
> saveRDS(compare.ips, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.ips.rds"))
> compare.msc  <- FindMarkers(subset(indv,subset=Cell.Type=="MSC"),
+                             assay="RNA", slot="counts",
+                             ident.1="Human", ident.2="Chimp",
+                             logfc.threshold=0.25, min.pct=0.25,
+                             test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 31 warnings (use warnings() to see them)
> saveRDS(compare.msc, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.msc.rds"))
> compare.ost  <- FindMarkers(subset(indv,subset=Cell.Type=="Osteoblast"),
+                             assay="RNA", slot="counts",
+                             ident.1="Human", ident.2="Chimp",
+                             logfc.threshold=0.25, min.pct=0.25,
+                             test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 18 warnings (use warnings() to see them)
> saveRDS(compare.ost, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.ost.rds"))
> rm(compare.ips,compare.msc,compare.ost)
> 
> #Find differentially expressed genes using cluster definitions
> compare.i  <- FindMarkers(subset(indv,subset=(seurat_clusters==1|seurat_clusters==4|seurat_clusters==6)),
+                           assay="RNA", slot="counts",
+                           ident.1="Human", ident.2="Chimp",
+                           logfc.threshold=0.25, min.pct=0.25,
+                           test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning message:
In glm.nb(formula = fmla, data = latent.vars) : alternation limit reached
> saveRDS(compare.i, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.i.rds"))
> compare.m  <- FindMarkers(subset(indv,subset=seurat_clusters==0),
+                           assay="RNA", slot="counts",
+                           ident.1="Human", ident.2="Chimp",
+                           logfc.threshold=0.25, min.pct=0.25,
+                           test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 31 warnings (use warnings() to see them)
> saveRDS(compare.m, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.m.rds"))
> compare.o  <- FindMarkers(subset(indv,subset=(seurat_clusters==2|seurat_clusters==3|seurat_clusters==5)),
+                           assay="RNA", slot="counts",
+                           ident.1="Human", ident.2="Chimp",
+                           logfc.threshold=0.25, min.pct=0.25,
+                           test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning messages:
1: glm.fit: algorithm did not converge 
2: glm.fit: algorithm did not converge 
3: step size truncated due to divergence 
4: glm.fit: algorithm did not converge 
5: glm.fit: algorithm did not converge 
> saveRDS(compare.o, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.o.rds"))
> rm(compare.i,compare.m,compare.o)
> compare.i1  <- FindMarkers(subset(indv,subset=seurat_clusters==1),
+                            assay="RNA", slot="counts",
+                            ident.1="Human", ident.2="Chimp",
+                            logfc.threshold=0.25, min.pct=0.25,
+                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning messages:
1: In glm.nb(formula = fmla, data = latent.vars) :
  alternation limit reached
2: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
3: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
4: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
5: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
6: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
7: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
8: In theta.ml(Y, mu, sum(w), w, limit = control$maxit, trace = control$trace >  :
  iteration limit reached
> saveRDS(compare.i1, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.i1.rds"))
> compare.i2  <- FindMarkers(subset(indv,subset=seurat_clusters==4),
+                            assay="RNA", slot="counts",
+                            ident.1="Human", ident.2="Chimp",
+                            logfc.threshold=0.25, min.pct=0.25,
+                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 12 warnings (use warnings() to see them)
> saveRDS(compare.i2, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.i2.rds"))
> compare.i3  <- FindMarkers(subset(indv,subset=seurat_clusters==6),
+                            assay="RNA", slot="counts",
+                            ident.1="Human", ident.2="Chimp",
+                            logfc.threshold=0.25, min.pct=0.25,
+                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 50 or more warnings (use warnings() to see the first 50)
> saveRDS(compare.i3, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.i3.rds"))
> rm(compare.i1,compare.i2,compare.i3)
> compare.o1  <- FindMarkers(subset(indv,subset=seurat_clusters==2),
+                            assay="RNA", slot="counts",
+                            ident.1="Human", ident.2="Chimp",
+                            logfc.threshold=0.25, min.pct=0.25,
+                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 50 or more warnings (use warnings() to see the first 50)
> saveRDS(compare.o1, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.o1.rds"))
> compare.o2  <- FindMarkers(subset(indv,subset=seurat_clusters==3),
+                            assay="RNA", slot="counts",
+                            ident.1="Human", ident.2="Chimp",
+                            logfc.threshold=0.25, min.pct=0.25,
+                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning message:
In glm.nb(formula = fmla, data = latent.vars) : alternation limit reached
> saveRDS(compare.o2, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.o2.rds"))
> compare.o3  <- FindMarkers(subset(indv,subset=seurat_clusters==5),
+                            assay="RNA", slot="counts",
+                            ident.1="Human", ident.2="Chimp",
+                            logfc.threshold=0.25, min.pct=0.25,
+                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 50 or more warnings (use warnings() to see the first 50)
> saveRDS(compare.o3, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.o3.rds"))
> rm(compare.o1,compare.o2,compare.o3)
> 
> #Find differentially expressed genes using ad hoc definitions
> compare.hoci  <- FindMarkers(subset(indv,subset=AdHoc.Assign=="iPSC"),
+                              assay="RNA", slot="counts",
+                              ident.1="Human", ident.2="Chimp",
+                              logfc.threshold=0.25, min.pct=0.25,
+                              test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 12 warnings (use warnings() to see them)
> saveRDS(compare.hoci, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.hoci.rds"))
> compare.hocm  <- FindMarkers(subset(indv,subset=AdHoc.Assign=="MSC"),
+                              assay="RNA", slot="counts",
+                              ident.1="Human", ident.2="Chimp",
+                              logfc.threshold=0.25, min.pct=0.25,
+                              test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 31 warnings (use warnings() to see them)
> saveRDS(compare.hocm, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.hocm.rds"))
> compare.hoco  <- FindMarkers(subset(indv,subset=AdHoc.Assign=="Osteoblast"),
+                              assay="RNA", slot="counts",
+                              ident.1="Human", ident.2="Chimp",
+                              logfc.threshold=0.25, min.pct=0.25,
+                              test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 11 warnings (use warnings() to see them)
> saveRDS(compare.hoco, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.hoco.rds"))
> 
> #Find differentially expressed genes using osteogenic ad hoc definitions
> compare.pre  <- FindMarkers(subset(indv,subset=OstAdHoc.Assign=="preosteoblast"),
+                             assay="RNA", slot="counts",
+                             ident.1="Human", ident.2="Chimp",
+                             logfc.threshold=0.25, min.pct=0.25,
+                             test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 50 or more warnings (use warnings() to see the first 50)
> saveRDS(compare.pre, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.pre.rds"))
> compare.obl  <- FindMarkers(subset(indv,subset=OstAdHoc.Assign=="osteoblast"),
+                             assay="RNA", slot="counts",
+                             ident.1="Human", ident.2="Chimp",
+                             logfc.threshold=0.25, min.pct=0.25,
+                             test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 50 or more warnings (use warnings() to see the first 50)
> saveRDS(compare.obl, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.obl.rds"))
> compare.emb  <- FindMarkers(subset(indv,subset=OstAdHoc.Assign=="embedding osteoblast"),
+                             assay="RNA", slot="counts",
+                             ident.1="Human", ident.2="Chimp",
+                             logfc.threshold=0.25, min.pct=0.25,
+                             test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning messages:
1: glm.fit: algorithm did not converge 
2: glm.fit: algorithm did not converge 
3: step size truncated due to divergence 
4: glm.fit: algorithm did not converge 
5: In glm.nb(formula = fmla, data = latent.vars) :
  alternation limit reached
6: glm.fit: algorithm did not converge 
7: glm.fit: algorithm did not converge 
> saveRDS(compare.emb, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.emb.rds"))
> #compare.min  <- FindMarkers(subset(indv,subset=OstAdHoc.Assign=="mineralizing osteocyte"),
> #                            assay="RNA", slot="counts",
> #                            ident.1="Human", ident.2="Chimp",
> #                            logfc.threshold=0.25, min.pct=0.25,
> #                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
> #saveRDS(compare.min, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.min.rds"))
> #compare.mat  <- FindMarkers(subset(indv,subset=OstAdHoc.Assign=="mature osteocyte"),
> #                            assay="RNA", slot="counts",
> #                            ident.1="Human", ident.2="Chimp",
> #                            logfc.threshold=0.25, min.pct=0.25,
> #                            test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
> #saveRDS(compare.mat, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.mat.rds"))
> rm(compare.pre,compare.obl,compare.emb)
> #rm(compare.pre,compare.obl,compare.emb,compare.min,compare.mat)
> 
> #Find differentially expressed genes using grade of membership definitions
> compare.gomi  <- FindMarkers(subset(indv,subset=GoM.Assign=="iPSC"),
+                              assay="RNA", slot="counts",
+                              ident.1="Human", ident.2="Chimp",
+                              logfc.threshold=0.25, min.pct=0.25,
+                              test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning message:
In glm.nb(formula = fmla, data = latent.vars) : alternation limit reached
> saveRDS(compare.gomi, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.gomi.rds"))
> compare.gomm  <- FindMarkers(subset(indv,subset=GoM.Assign=="MSC"),
+                              assay="RNA", slot="counts",
+                              ident.1="Human", ident.2="Chimp",
+                              logfc.threshold=0.25, min.pct=0.25,
+                              test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
Warning messages:
1: glm.fit: fitted rates numerically 0 occurred 
2: step size truncated due to divergence 
> saveRDS(compare.gomm, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.gomm.rds"))
> compare.gomo  <- FindMarkers(subset(indv,subset=GoM.Assign=="Osteoblast"),
+                              assay="RNA", slot="counts",
+                              ident.1="Human", ident.2="Chimp",
+                              logfc.threshold=0.25, min.pct=0.25,
+                              test.use="negbinom", latent.vars=c("Collection","nCount_RNA","Phase"))
There were 50 or more warnings (use warnings() to see the first 50)
> saveRDS(compare.gomo, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/de.n-compare.gomo.rds"))
> rm(compare.gomi,compare.gomm,compare.gomo)
> 
> proc.time()
     user    system   elapsed 
84838.406  2688.003 87744.375 
