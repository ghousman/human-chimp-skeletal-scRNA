
R version 3.5.1 (2018-07-02) -- "Feather Spray"
Copyright (C) 2018 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> #Load libraries
> library(Seurat)
> library(dplyr)

Attaching package: 'dplyr'

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> library(stringi)
> library(stringr)
> library(ggplot2)
> library(colorspace)
> library(RColorBrewer)
> 
> #Define main directory
> dir <- '/project2/gilad/ghousman/skeletal-human-chimp/'
> 
> #Load batch info
> batch <- read.csv(file=paste0(dir,'human-chimp-skeletal-scRNA/data/scrna-batch.csv'), header=TRUE, sep=",")
> 
> #Read in files
> data <- readRDS(paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/data.rds"))
> 
> #Separate human and chimp data within each collection into separate objects
> objects <- list()
> idx <- 1
> for (i in 1:length(batch$Sample_Name_at_Core))
+ {
+   obj <- subset(data[[i]], species=='Human')
+   objects[[idx]] <- CreateSeuratObject(obj@assays$RNA@counts, meta.data=obj@meta.data)
+   idx <- idx+1
+   obj <- subset(data[[i]], species=='Chimp')
+   objects[[idx]] <- CreateSeuratObject(obj@assays$RNA@counts, meta.data=obj@meta.data)
+   idx <- idx+1
+ }
> rm(data,obj)
> 
> #Merge all cell types in humans and all cell types in chimps
> human <- merge(objects[[1]], y=c(objects[[3]],objects[[5]],objects[[7]],objects[[9]],objects[[11]],objects[[13]],objects[[15]],
+                                  objects[[17]],objects[[19]],objects[[21]],objects[[23]],objects[[25]],objects[[27]],objects[[29]],
+                                  objects[[31]],objects[[33]],objects[[35]],objects[[37]],objects[[39]],objects[[41]]),
+                add.cell.ids=c("H1.I","H1.M","H1.O","H1r.I","H1r.M","H1r.O","H2.I","H2.M","H2.O","H3.I","H3.M","H3.O",
+                               "H4.I","H4.M","H4.O","H5.I","H5.M","H5.O","H6.I","H6.M","H6.O"))
> chimp <- merge(objects[[2]], y=c(objects[[4]],objects[[6]],objects[[8]],objects[[10]],objects[[12]],objects[[14]],objects[[16]],
+                                  objects[[18]],objects[[20]],objects[[22]],objects[[24]],objects[[26]],objects[[28]],objects[[30]],
+                                  objects[[32]],objects[[34]],objects[[36]],objects[[38]],objects[[40]],objects[[42]]),
+                add.cell.ids=c("C1.I","C1.M","C1.O","C1r.I","C1r.M","C1r.O","C2.I","C2.M","C2.O","C3.I","C3.M","C3.O",
+                               "C4.I","C4.M","C4.O","C5.I","C5.M","C5.O","C5.I","C5.M","C5.O"))
Warning message:
In CheckDuplicateCellNames(object.list = objects) :
  Some cell names are duplicated across objects provided. Renaming to enforce unique cell names.
> objects <- list(human,chimp)
> 
> #Perform SCTransform normalization on each collection
> for (i in 1:length(objects)) {
+   print(i)
+   objects[[i]] <- NormalizeData(objects[[i]], verbose=FALSE)
+   objects[[i]] <- FindVariableFeatures(objects[[i]], selection.method="vst", nfeatures=3000, verbose=FALSE)
+ }
[1] 1
[1] 2
> 
> #Save data
> saveRDS(objects, file=paste0(dir,"/human-chimp-skeletal-scRNA/data/cellranger-data-full/data.spps.log.rds"))
> 
> 
> proc.time()
   user  system elapsed 
559.055 130.248 695.802 
